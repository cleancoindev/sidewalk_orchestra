!function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}}()({1:[function(require,module,exports){(function(process){var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(tweenId){return this._tweens[tweenId]}.bind(this))},removeAll:function(){this._tweens={}},add:function(tween){this._tweens[tween.getId()]=tween,this._tweensAddedDuringUpdate[tween.getId()]=tween},remove:function(tween){delete this._tweens[tween.getId()],delete this._tweensAddedDuringUpdate[tween.getId()]},update:function(time,preserve){var tweenIds=Object.keys(this._tweens);if(0===tweenIds.length)return!1;for(time=void 0!==time?time:TWEEN.now();tweenIds.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<tweenIds.length;i++){var tween=this._tweens[tweenIds[i]];tween&&!1===tween.update(time)&&(tween._isPlaying=!1,preserve||delete this._tweens[tweenIds[i]])}tweenIds=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,root,TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&void 0!==process?TWEEN.now=function(){var time=process.hrtime();return 1e3*time[0]+time[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(object,group){this._object=object,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=group||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(properties,duration){return this._valuesEnd=properties,void 0!==duration&&(this._duration=duration),this},start:function(time){for(var property in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==time?"string"==typeof time?TWEEN.now()+parseFloat(time):time:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[property]instanceof Array){if(0===this._valuesEnd[property].length)continue;this._valuesEnd[property]=[this._object[property]].concat(this._valuesEnd[property])}void 0!==this._object[property]&&(this._valuesStart[property]=this._object[property],this._valuesStart[property]instanceof Array==!1&&(this._valuesStart[property]*=1),this._valuesStartRepeat[property]=this._valuesStart[property]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++)this._chainedTweens[i].stop()},group:function(group){return this._group=group,this},delay:function(amount){return this._delayTime=amount,this},repeat:function(times){return this._repeat=times,this},repeatDelay:function(amount){return this._repeatDelayTime=amount,this},yoyo:function(yy){return this._yoyo=yy,this},easing:function(eas){return this._easingFunction=eas,this},interpolation:function(inter){return this._interpolationFunction=inter,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(callback){return this._onStartCallback=callback,this},onUpdate:function(callback){return this._onUpdateCallback=callback,this},onComplete:function(callback){return this._onCompleteCallback=callback,this},onStop:function(callback){return this._onStopCallback=callback,this},update:function(time){var property,elapsed,value;if(time<this._startTime)return!0;for(property in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),elapsed=(time-this._startTime)/this._duration,elapsed=0===this._duration||elapsed>1?1:elapsed,value=this._easingFunction(elapsed),this._valuesEnd)if(void 0!==this._valuesStart[property]){var start=this._valuesStart[property]||0,end=this._valuesEnd[property];end instanceof Array?this._object[property]=this._interpolationFunction(end,value):("string"==typeof end&&(end="+"===end.charAt(0)||"-"===end.charAt(0)?start+parseFloat(end):parseFloat(end)),"number"==typeof end&&(this._object[property]=start+(end-start)*value))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===elapsed){if(this._repeat>0){for(property in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[property]&&(this._valuesStartRepeat[property]=this._valuesStartRepeat[property]+parseFloat(this._valuesEnd[property])),this._yoyo){var tmp=this._valuesStartRepeat[property];this._valuesStartRepeat[property]=this._valuesEnd[property],this._valuesEnd[property]=tmp}this._valuesStart[property]=this._valuesStartRepeat[property]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=time+this._repeatDelayTime:this._startTime=time+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++)this._chainedTweens[i].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(2-Math.pow(2,-10*(k-1)))}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){return 0===k?0:1===k?1:-Math.pow(2,10*(k-1))*Math.sin(5*(k-1.1)*Math.PI)},Out:function(k){return 0===k?0:1===k?1:Math.pow(2,-10*k)*Math.sin(5*(k-.1)*Math.PI)+1},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?-.5*Math.pow(2,10*(k-1))*Math.sin(5*(k-1.1)*Math.PI):.5*Math.pow(2,-10*(k-1))*Math.sin(5*(k-1.1)*Math.PI)+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*TWEEN.Easing.Bounce.In(2*k):.5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return k<0?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){for(var b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein,i=0;i<=n;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(k<0&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):k<0?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:(a=[1],function(n){var s=1;if(a[n])return a[n];for(var i=n;i>1;i--)s*=i;return a[n]=s,s}),CatmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},root=this,"function"==typeof define&&define.amd?define([],function(){return TWEEN}):void 0!==module&&"object"==typeof exports?module.exports=TWEEN:void 0!==root&&(root.TWEEN=TWEEN)}).call(this,require("_process"))},{_process:209}],2:[function(require,module,exports){function noop(){}module.exports=function(count,callback,err_cb){var bail=!1;return err_cb=err_cb||noop,proxy.count=count,0===count?callback():proxy;function proxy(err,result){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,err?(bail=!0,callback(err),callback=err_cb):0!==proxy.count||bail||callback(null,result)}}},{}],3:[function(require,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;if(start=start||0,end=end||bytes,arraybuffer.slice)return arraybuffer.slice(start,end);if(start<0&&(start+=bytes),end<0&&(end+=bytes),end>bytes&&(end=bytes),start>=bytes||start>=end||0===bytes)return new ArrayBuffer(0);for(var abv=new Uint8Array(arraybuffer),result=new Uint8Array(end-start),i=start,ii=0;i<end;i++,ii++)result[ii]=abv[i];return result.buffer}},{}],4:[function(require,module,exports){function Backoff(opts){opts=opts||{},this.ms=opts.min||100,this.max=opts.max||1e4,this.factor=opts.factor||2,this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0,this.attempts=0}module.exports=Backoff,Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random(),deviation=Math.floor(rand*this.jitter*ms);ms=0==(1&Math.floor(10*rand))?ms-deviation:ms+deviation}return 0|Math.min(ms,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(min){this.ms=min},Backoff.prototype.setMax=function(max){this.max=max},Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],5:[function(require,module,exports){!function(){"use strict";for(var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256),i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;exports.encode=function(arraybuffer){var i,bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="";for(i=0;i<len;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3==2?base64=base64.substring(0,base64.length-1)+"=":len%3==1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}()},{}],6:[function(require,module,exports){"use strict";"use restrict";function countTrailingZeros(v){var c=32;return(v&=-v)&&c--,65535&v&&(c-=16),16711935&v&&(c-=8),252645135&v&&(c-=4),858993459&v&&(c-=2),1431655765&v&&(c-=1),c}exports.INT_BITS=32,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<31,exports.sign=function(v){return(v>0)-(v<0)},exports.abs=function(v){var mask=v>>31;return(v^mask)-mask},exports.min=function(x,y){return y^(x^y)&-(x<y)},exports.max=function(x,y){return x^(x^y)&-(x<y)},exports.isPow2=function(v){return!(v&v-1||!v)},exports.log2=function(v){var r,shift;return r=(v>65535)<<4,r|=shift=((v>>>=r)>255)<<3,r|=shift=((v>>>=shift)>15)<<2,(r|=shift=((v>>>=shift)>3)<<1)|(v>>>=shift)>>1},exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},exports.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},exports.countTrailingZeros=countTrailingZeros,exports.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},exports.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},exports.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var REVERSE_TABLE=new Array(256);!function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1)r<<=1,r|=1&v,--s;tab[i]=r<<s&255}}(REVERSE_TABLE),exports.reverse=function(v){return REVERSE_TABLE[255&v]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]},exports.interleave2=function(x,y){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},exports.deinterleave2=function(v,n){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>n&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},exports.interleave3=function(x,y,z){return x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2),(x|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<2},exports.deinterleave3=function(v,n){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>n&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],7:[function(require,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),blobSupportsArrayBufferView=blobSupported&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength)),buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++)bb.append(ary[i]);return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){return mapArrayBufferViews(ary),new Blob(ary,options||{})}module.exports=blobSupported?blobSupportsArrayBufferView?global.Blob:BlobConstructor:blobBuilderSupported?BlobBuilderConstructor:void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(require,module,exports){},{}],9:[function(require,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn&&(fn=obj[fn]),"function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],10:[function(require,module,exports){function Emitter(obj){if(obj)return function(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}(obj)}void 0!==module&&(module.exports=Emitter),Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){this.off(event,on),fn.apply(this,arguments)}return on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var cb,callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks["$"+event],this;for(var i=0;i<callbacks.length;i++)if((cb=callbacks[i])===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks)for(var i=0,len=(callbacks=callbacks.slice(0)).length;i<len;++i)callbacks[i].apply(this,args);return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks["$"+event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],11:[function(require,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],12:[function(require,module,exports){(function(process){function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}(exports=module.exports=require("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},exports.formatArgs=function(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){"%%"!==match&&"%c"===match&&(lastC=++index)}),args.splice(lastC,0,c)},exports.save=function(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}},exports.load=load,exports.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this,require("_process"))},{"./debug":13,_process:209}],13:[function(require,module,exports){var prevTime;function createDebug(namespace){function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),exports.formatArgs.call(self,args),(debug.log||exports.log||console.log.bind(console)).apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=function(namespace){var i,hash=0;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}(namespace),"function"==typeof exports.init&&exports.init(debug),debug}(exports=module.exports=createDebug.debug=createDebug.default=createDebug).coerce=function(val){return val instanceof Error?val.stack||val.message:val},exports.disable=function(){exports.enable("")},exports.enable=function(namespaces){exports.save(namespaces),exports.names=[],exports.skips=[];for(var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))},exports.enabled=function(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1},exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={}},{ms:37}],14:[function(require,module,exports){"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,start,end,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,(list=linkedList(data,start,end,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize),void earcutLinked(c,triangles,dim,minX,minY,invSize)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m.next;for(;p!==stop;)hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{p.x<leftmost.x&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))||area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}},{}],15:[function(require,module,exports){module.exports=require("./socket"),module.exports.parser=require("engine.io-parser")},{"./socket":16,"engine.io-parser":26}],16:[function(require,module,exports){(function(global){var transports=require("./transports/index"),Emitter=require("component-emitter"),debug=require("debug")("engine.io-client:socket"),index=require("indexof"),parser=require("engine.io-parser"),parseuri=require("parseuri"),parseqs=require("parseqs");function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{},uri&&"object"==typeof uri&&(opts=uri,uri=null),uri?(uri=parseuri(uri),opts.hostname=uri.host,opts.secure="https"===uri.protocol||"wss"===uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)):opts.host&&(opts.hostname=parseuri(opts.host).host),this.secure=null!=opts.secure?opts.secure:global.location&&"https:"===location.protocol,opts.hostname&&!opts.port&&(opts.port=this.secure?"443":"80"),this.agent=opts.agent||!1,this.hostname=opts.hostname||(global.location?location.hostname:"localhost"),this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=opts.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==opts.upgrade,this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!opts.forceJSONP,this.jsonp=!1!==opts.jsonp,this.forceBase64=!!opts.forceBase64,this.enablesXDR=!!opts.enablesXDR,this.timestampParam=opts.timestampParam||"t",this.timestampRequests=opts.timestampRequests,this.transports=opts.transports||["polling","websocket"],this.transportOptions=opts.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=opts.policyPort||843,this.rememberUpgrade=opts.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades,this.perMessageDeflate=!1!==opts.perMessageDeflate&&(opts.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=opts.pfx||null,this.key=opts.key||null,this.passphrase=opts.passphrase||null,this.cert=opts.cert||null,this.ca=opts.ca||null,this.ciphers=opts.ciphers||null,this.rejectUnauthorized=void 0===opts.rejectUnauthorized||opts.rejectUnauthorized,this.forceNode=!!opts.forceNode;var freeGlobal="object"==typeof global&&global;freeGlobal.global===freeGlobal&&(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0&&(this.extraHeaders=opts.extraHeaders),opts.localAddress&&(this.localAddress=opts.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=require("./transport"),Socket.transports=require("./transports/index"),Socket.parser=require("engine.io-parser"),Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=function(obj){var o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}(this.query);query.EIO=parser.protocol,query.transport=name;var options=this.transportOptions[name]||{};return this.id&&(query.sid=this.id),new transports[name]({query:query,socket:this,agent:options.agent||this.agent,hostname:options.hostname||this.hostname,port:options.port||this.port,secure:options.secure||this.secure,path:options.path||this.path,forceJSONP:options.forceJSONP||this.forceJSONP,jsonp:options.jsonp||this.jsonp,forceBase64:options.forceBase64||this.forceBase64,enablesXDR:options.enablesXDR||this.enablesXDR,timestampRequests:options.timestampRequests||this.timestampRequests,timestampParam:options.timestampParam||this.timestampParam,policyPort:options.policyPort||this.policyPort,pfx:options.pfx||this.pfx,key:options.key||this.key,passphrase:options.passphrase||this.passphrase,cert:options.cert||this.cert,ca:options.ca||this.ca,ciphers:options.ciphers||this.ciphers,rejectUnauthorized:options.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:options.perMessageDeflate||this.perMessageDeflate,extraHeaders:options.extraHeaders||this.extraHeaders,forceNode:options.forceNode||this.forceNode,localAddress:options.localAddress||this.localAddress,requestTimeout:options.requestTimeout||this.requestTimeout,protocols:options.protocols||void 0})},Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))transport="websocket";else{if(0===this.transports.length){var self=this;return void setTimeout(function(){self.emit("error","No transports available")},0)}transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)},Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=transport,transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})},Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=!1,self=this;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe"}]),transport.once("packet",function(msg){if(!failed)if("pong"===msg.type&&"probe"===msg.data){if(debug('probe transport "%s" pong',name),self.upgrading=!0,self.emit("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name,debug('pausing current transport "%s"',self.transport.name),self.transport.pause(function(){failed||"closed"!==self.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),self.setTransport(transport),transport.send([{type:"upgrade"}]),self.emit("upgrade",transport),transport=null,self.upgrading=!1,self.flush())})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name,self.emit("upgradeError",err)}}))}function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!==transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),self.removeListener("close",onclose),self.removeListener("upgrading",onupgrade)}Socket.priorWebsocketSuccess=!1,transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++)this.probe(this.upgrades[i])}},Socket.prototype.onPacket=function(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emit("packet",packet),this.emit("heartbeat"),packet.type){case"open":this.onHandshake(JSON.parse(packet.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var err=new Error("server error");err.code=packet.data,this.onError(err);break;case"message":this.emit("data",packet.data),this.emit("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(data){this.emit("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){"closed"!==self.readyState&&self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)},Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer),self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout),self.ping(),self.onHeartbeat(self.pingTimeout)},self.pingInterval)},Socket.prototype.ping=function(){var self=this;this.sendPacket("ping",function(){self.emit("ping")})},Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){return this.sendPacket("message",msg,options,fn),this},Socket.prototype.sendPacket=function(type,data,options,fn){if("function"==typeof data&&(fn=data,data=void 0),"function"==typeof options&&(fn=options,options=null),"closing"!==this.readyState&&"closed"!==this.readyState){(options=options||{}).compress=!1!==options.compress;var packet={type:type,data:data,options:options};this.emit("packetCreate",packet),this.writeBuffer.push(packet),fn&&this.once("flush",fn),this.flush()}},Socket.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var self=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()}function close(){self.onClose("forced close"),debug("socket closing - telling transport to close"),self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose),self.removeListener("upgradeError",cleanupAndClose),close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose),self.once("upgradeError",cleanupAndClose)}return this},Socket.prototype.onError=function(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emit("error",err),this.onClose("transport error",err)},Socket.prototype.onClose=function(reason,desc){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket close with reason: "%s"',reason);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",reason,desc),this.writeBuffer=[],this.prevBufferLen=0}},Socket.prototype.filterUpgrades=function(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;i<j;i++)~index(this.transports,upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":17,"./transports/index":18,"component-emitter":10,debug:24,"engine.io-parser":26,indexof:32,parseqs:40,parseuri:41}],17:[function(require,module,exports){var parser=require("engine.io-parser"),Emitter=require("component-emitter");function Transport(opts){this.path=opts.path,this.hostname=opts.hostname,this.port=opts.port,this.secure=opts.secure,this.query=opts.query,this.timestampParam=opts.timestampParam,this.timestampRequests=opts.timestampRequests,this.readyState="",this.agent=opts.agent||!1,this.socket=opts.socket,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.forceNode=opts.forceNode,this.extraHeaders=opts.extraHeaders,this.localAddress=opts.localAddress}module.exports=Transport,Emitter(Transport.prototype),Transport.prototype.onError=function(msg,desc){var err=new Error(msg);return err.type="TransportError",err.description=desc,this.emit("error",err),this},Transport.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Transport.prototype.send=function(packets){if("open"!==this.readyState)throw new Error("Transport not open");this.write(packets)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)},Transport.prototype.onPacket=function(packet){this.emit("packet",packet)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":10,"engine.io-parser":26}],18:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl"),XHR=require("./polling-xhr"),JSONP=require("./polling-jsonp"),websocket=require("./websocket");exports.polling=function(opts){var xd=!1,xs=!1,jsonp=!1!==opts.jsonp;if(global.location){var isSSL="https:"===location.protocol,port=location.port;port||(port=isSSL?443:80),xd=opts.hostname!==location.hostname||port!==opts.port,xs=opts.secure!==isSSL}if(opts.xdomain=xd,opts.xscheme=xs,"open"in new XMLHttpRequest(opts)&&!opts.forceJSONP)return new XHR(opts);if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)},exports.websocket=websocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":19,"./polling-xhr":20,"./websocket":22,"xmlhttprequest-ssl":23}],19:[function(require,module,exports){(function(global){var Polling=require("./polling"),inherit=require("component-inherit");module.exports=JSONPPolling;var callbacks,rNewline=/\n/g,rEscapedNewline=/\\n/g;function empty(){}function JSONPPolling(opts){Polling.call(this,opts),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){self.script&&(self.script.onerror=empty)},!1)}inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var self=this,script=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.uri(),script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt?insertAt.parentNode.insertBefore(script,insertAt):(document.head||document.body).appendChild(script),this.script=script,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var iframe,form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="eio_iframe_"+this.index;form.className="socketio",form.style.position="absolute",form.style.top="-1000px",form.style.left="-1000px",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}function complete(){initIframe(),fn()}function initIframe(){if(self.iframe)try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){(iframe=document.createElement("iframe")).name=self.iframeId,iframe.src="javascript:0"}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}this.form.action=this.uri(),initIframe(),data=data.replace(rEscapedNewline,"\\\n"),this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===self.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":21,"component-inherit":11}],20:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl"),Polling=require("./polling"),Emitter=require("component-emitter"),inherit=require("component-inherit"),debug=require("debug")("engine.io-client:polling-xhr");function empty(){}function XHR(opts){if(Polling.call(this,opts),this.requestTimeout=opts.requestTimeout,this.extraHeaders=opts.extraHeaders,global.location){var isSSL="https:"===location.protocol,port=location.port;port||(port=isSSL?443:80),this.xd=opts.hostname!==global.location.hostname||port!==opts.port,this.xs=opts.secure!==isSSL}}function Request(opts){this.method=opts.method||"GET",this.uri=opts.uri,this.xd=!!opts.xd,this.xs=!!opts.xs,this.async=!1!==opts.async,this.data=void 0!==opts.data?opts.data:null,this.agent=opts.agent,this.isBinary=opts.isBinary,this.supportsBinary=opts.supportsBinary,this.enablesXDR=opts.enablesXDR,this.requestTimeout=opts.requestTimeout,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.extraHeaders=opts.extraHeaders,this.create()}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(opts){return(opts=opts||{}).uri=this.uri(),opts.xd=this.xd,opts.xs=this.xs,opts.agent=this.agent||!1,opts.supportsBinary=this.supportsBinary,opts.enablesXDR=this.enablesXDR,opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,opts.requestTimeout=this.requestTimeout,opts.extraHeaders=this.extraHeaders,new Request(opts)},XHR.prototype.doWrite=function(data,fn){var isBinary="string"!=typeof data&&void 0!==data,req=this.request({method:"POST",data:data,isBinary:isBinary}),self=this;req.on("success",fn),req.on("error",function(err){self.onError("xhr post error",err)}),this.sendXhr=req},XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request(),self=this;req.on("data",function(data){self.onData(data)}),req.on("error",function(err){self.onError("xhr poll error",err)}),this.pollXhr=req},Emitter(Request.prototype),Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts),self=this;try{debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in xhr.setDisableHeaderCheck&&xhr.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&xhr.setRequestHeader(i,this.extraHeaders[i])}catch(e){}if("POST"===this.method)try{this.isBinary?xhr.setRequestHeader("Content-type","application/octet-stream"):xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=!0),this.requestTimeout&&(xhr.timeout=this.requestTimeout),this.hasXDR()?(xhr.onload=function(){self.onLoad()},xhr.onerror=function(){self.onError(xhr.responseText)}):xhr.onreadystatechange=function(){if(2===xhr.readyState)try{var contentType=xhr.getResponseHeader("Content-Type");self.supportsBinary&&"application/octet-stream"===contentType&&(xhr.responseType="arraybuffer")}catch(e){}4===xhr.readyState&&(200===xhr.status||1223===xhr.status?self.onLoad():setTimeout(function(){self.onError(xhr.status)},0))},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void setTimeout(function(){self.onError(e)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(data){this.emit("data",data),this.onSuccess()},Request.prototype.onError=function(err){this.emit("error",err),this.cleanup(!0)},Request.prototype.cleanup=function(fromError){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type")}catch(e){}data="application/octet-stream"===contentType&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=data&&this.onData(data)},Request.prototype.hasXDR=function(){return void 0!==global.XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},Request.requestsCount=0,Request.requests={},global.document&&(global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":21,"component-emitter":10,"component-inherit":11,debug:24,"xmlhttprequest-ssl":23}],21:[function(require,module,exports){var Transport=require("../transport"),parseqs=require("parseqs"),parser=require("engine.io-parser"),inherit=require("component-inherit"),yeast=require("yeast"),debug=require("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=null!=new(require("xmlhttprequest-ssl"))({xdomain:!1}).responseType;function Polling(opts){var forceBase64=opts&&opts.forceBase64;hasXHR2&&!forceBase64||(this.supportsBinary=!1),Transport.call(this,opts)}inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(onPause){var self=this;function pause(){debug("paused"),self.readyState="paused",onPause()}if(this.readyState="pausing",this.polling||!this.writable){var total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);parser.decodePayload(data,this.socket.binaryType,function(packet,index,total){if("opening"===self.readyState&&self.onOpen(),"close"===packet.type)return self.onClose(),!1;self.onPacket(packet)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet"),self.write([{type:"close"}])}"open"===this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(packets){var self=this;this.writable=!1;var callbackfn=function(){self.writable=!0,self.emit("drain")};parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})},Polling.prototype.uri=function(){var query=this.query||{},schema=this.secure?"https":"http",port="";return!1!==this.timestampRequests&&(query[this.timestampParam]=yeast()),this.supportsBinary||query.sid||(query.b64=1),query=parseqs.encode(query),this.port&&("https"===schema&&443!==Number(this.port)||"http"===schema&&80!==Number(this.port))&&(port=":"+this.port),query.length&&(query="?"+query),schema+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+port+this.path+query}},{"../transport":17,"component-inherit":11,debug:24,"engine.io-parser":26,parseqs:40,"xmlhttprequest-ssl":23,yeast:235}],22:[function(require,module,exports){(function(global){var NodeWebSocket,Transport=require("../transport"),parser=require("engine.io-parser"),parseqs=require("parseqs"),inherit=require("component-inherit"),yeast=require("yeast"),debug=require("debug")("engine.io-client:websocket"),BrowserWebSocket=global.WebSocket||global.MozWebSocket;if("undefined"==typeof window)try{NodeWebSocket=require("ws")}catch(e){}var WebSocket=BrowserWebSocket;function WS(opts){opts&&opts.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=opts.perMessageDeflate,this.usingBrowserWebSocket=BrowserWebSocket&&!opts.forceNode,this.protocols=opts.protocols,this.usingBrowserWebSocket||(WebSocket=NodeWebSocket),Transport.call(this,opts)}WebSocket||"undefined"!=typeof window||(WebSocket=NodeWebSocket),module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var uri=this.uri(),protocols=this.protocols,opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(opts.headers=this.extraHeaders),this.localAddress&&(opts.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?protocols?new WebSocket(uri,protocols):new WebSocket(uri):new WebSocket(uri,protocols,opts)}catch(err){return this.emit("error",err)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()},this.ws.onclose=function(){self.onClose()},this.ws.onmessage=function(ev){self.onData(ev.data)},this.ws.onerror=function(e){self.onError("websocket error",e)}},WS.prototype.write=function(packets){var self=this;this.writable=!1;for(var total=packets.length,i=0,l=total;i<l;i++)!function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!self.usingBrowserWebSocket){var opts={};if(packet.options&&(opts.compress=packet.options.compress),self.perMessageDeflate)("string"==typeof data?global.Buffer.byteLength(data):data.length)<self.perMessageDeflate.threshold&&(opts.compress=!1)}try{self.usingBrowserWebSocket?self.ws.send(data):self.ws.send(data,opts)}catch(e){debug("websocket closed before onclose event")}--total||done()})}(packets[i]);function done(){self.emit("flush"),setTimeout(function(){self.writable=!0,self.emit("drain")},0)}},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},WS.prototype.uri=function(){var query=this.query||{},schema=this.secure?"wss":"ws",port="";return this.port&&("wss"===schema&&443!==Number(this.port)||"ws"===schema&&80!==Number(this.port))&&(port=":"+this.port),this.timestampRequests&&(query[this.timestampParam]=yeast()),this.supportsBinary||(query.b64=1),(query=parseqs.encode(query)).length&&(query="?"+query),schema+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+port+this.path+query},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../transport":17,"component-inherit":11,debug:24,"engine.io-parser":26,parseqs:40,ws:8,yeast:235}],23:[function(require,module,exports){(function(global){var hasCORS=require("has-cors");module.exports=function(opts){var xdomain=opts.xdomain,xscheme=opts.xscheme,enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR)return new XDomainRequest}catch(e){}if(!xdomain)try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"has-cors":31}],24:[function(require,module,exports){(function(process){function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}(exports=module.exports=require("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},exports.formatArgs=function(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){"%%"!==match&&"%c"===match&&(lastC=++index)}),args.splice(lastC,0,c)},exports.save=function(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}},exports.load=load,exports.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this,require("_process"))},{"./debug":25,_process:209}],25:[function(require,module,exports){function createDebug(namespace){var prevTime;function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),exports.formatArgs.call(self,args),(debug.log||exports.log||console.log.bind(console)).apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=function(namespace){var i,hash=0;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}(namespace),debug.destroy=destroy,"function"==typeof exports.init&&exports.init(debug),exports.instances.push(debug),debug}function destroy(){var index=exports.instances.indexOf(this);return-1!==index&&(exports.instances.splice(index,1),!0)}(exports=module.exports=createDebug.debug=createDebug.default=createDebug).coerce=function(val){return val instanceof Error?val.stack||val.message:val},exports.disable=function(){exports.enable("")},exports.enable=function(namespaces){var i;exports.save(namespaces),exports.names=[],exports.skips=[];var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")));for(i=0;i<exports.instances.length;i++){var instance=exports.instances[i];instance.enabled=exports.enabled(instance.namespace)}},exports.enabled=function(name){if("*"===name[name.length-1])return!0;var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1},exports.humanize=require("ms"),exports.instances=[],exports.names=[],exports.skips=[],exports.formatters={}},{ms:37}],26:[function(require,module,exports){(function(global){var base64encoder,keys=require("./keys"),hasBinary=require("has-binary2"),sliceBuffer=require("arraybuffer.slice"),after=require("after"),utf8=require("./utf8");global&&global.ArrayBuffer&&(base64encoder=require("base64-arraybuffer"));var isAndroid="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),isPhantomJS="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=require("blob");function map(ary,each,done){for(var result=new Array(ary.length),next=after(ary.length,done),eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg,cb(error,result)})},i=0;i<ary.length;i++)eachWithIndex(i,ary[i],next)}exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=!1),"function"==typeof utf8encode&&(callback=utf8encode,utf8encode=null);var data=void 0===packet.data?void 0:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var data=packet.data,contentArray=new Uint8Array(data),resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++)resultBuffer[i+1]=contentArray[i];return callback(resultBuffer.buffer)}(packet,supportsBinary,callback);if(Blob&&data instanceof global.Blob)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);if(dontSendBlobs)return function(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var fr=new FileReader;return fr.onload=function(){packet.data=fr.result,exports.encodePacket(packet,supportsBinary,!0,callback)},fr.readAsArrayBuffer(packet.data)}(packet,supportsBinary,callback);var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}(packet,supportsBinary,callback);if(data&&data.base64)return function(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}(packet,callback);var encoded=packets[packet.type];return void 0!==packet.data&&(encoded+=utf8encode?utf8.encode(String(packet.data),{strict:!1}):String(packet.data)),callback(""+encoded)},exports.encodeBase64Packet=function(packet,callback){var b64data,message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;return fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)},fr.readAsDataURL(packet.data)}try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){for(var typed=new Uint8Array(packet.data),basic=new Array(typed.length),i=0;i<typed.length;i++)basic[i]=typed[i];b64data=String.fromCharCode.apply(null,basic)}return message+=global.btoa(b64data),callback(message)},exports.decodePacket=function(data,binaryType,utf8decode){if(void 0===data)return err;if("string"==typeof data){if("b"===data.charAt(0))return exports.decodeBase64Packet(data.substr(1),binaryType);if(utf8decode&&!1===(data=function(data){try{data=utf8.decode(data,{strict:!1})}catch(e){return!1}return data}(data)))return err;var type=data.charAt(0);return Number(type)==type&&packetslist[type]?data.length>1?{type:packetslist[type],data:data.substring(1)}:{type:packetslist[type]}:err}type=new Uint8Array(data)[0];var rest=sliceBuffer(data,1);return Blob&&"blob"===binaryType&&(rest=new Blob([rest])),{type:packetslist[type],data:rest}},exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!base64encoder)return{type:type,data:{base64:!0,data:msg.substr(1)}};var data=base64encoder.decode(msg.substr(1));return"blob"===binaryType&&Blob&&(data=new Blob([data])),{type:type,data:data}},exports.encodePayload=function(packets,supportsBinary,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=null);var isBinary=hasBinary(packets);if(supportsBinary&&isBinary)return Blob&&!dontSendBlobs?exports.encodePayloadAsBlob(packets,callback):exports.encodePayloadAsArrayBuffer(packets,callback);if(!packets.length)return callback("0:");map(packets,function(packet,doneCallback){exports.encodePacket(packet,!!isBinary&&supportsBinary,!1,function(message){doneCallback(null,function(message){return message.length+":"+message}(message))})},function(err,results){return callback(results.join(""))})},exports.decodePayload=function(data,binaryType,callback){if("string"!=typeof data)return exports.decodePayloadAsBinary(data,binaryType,callback);var packet;if("function"==typeof binaryType&&(callback=binaryType,binaryType=null),""===data)return callback(err,0,1);for(var n,msg,length="",i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"===chr){if(""===length||length!=(n=Number(length)))return callback(err,0,1);if(length!=(msg=data.substr(i+1,n)).length)return callback(err,0,1);if(msg.length){if(packet=exports.decodePacket(msg,binaryType,!1),err.type===packet.type&&err.data===packet.data)return callback(err,0,1);if(!1===callback(packet,i+n,l))return}i+=n,length=""}else length+=chr}return""!==length?callback(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length)return callback(new ArrayBuffer(0));map(packets,function(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(data){return doneCallback(null,data)})},function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;return acc+(len="string"==typeof p?p.length:p.byteLength).toString().length+len+2},0),resultArray=new Uint8Array(totalLength),bufferIndex=0;return encodedPackets.forEach(function(p){var isString="string"==typeof p,ab=p;if(isString){for(var view=new Uint8Array(p.length),i=0;i<p.length;i++)view[i]=p.charCodeAt(i);ab=view.buffer}resultArray[bufferIndex++]=isString?0:1;var lenStr=ab.byteLength.toString();for(i=0;i<lenStr.length;i++)resultArray[bufferIndex++]=parseInt(lenStr[i]);resultArray[bufferIndex++]=255;for(view=new Uint8Array(ab),i=0;i<view.length;i++)resultArray[bufferIndex++]=view[i]}),callback(resultArray.buffer)})},exports.encodePayloadAsBlob=function(packets,callback){map(packets,function(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(encoded){var binaryIdentifier=new Uint8Array(1);if(binaryIdentifier[0]=1,"string"==typeof encoded){for(var view=new Uint8Array(encoded.length),i=0;i<encoded.length;i++)view[i]=encoded.charCodeAt(i);encoded=view.buffer,binaryIdentifier[0]=0}var lenStr=(encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size).toString(),lengthAry=new Uint8Array(lenStr.length+1);for(i=0;i<lenStr.length;i++)lengthAry[i]=parseInt(lenStr[i]);if(lengthAry[lenStr.length]=255,Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})},function(err,results){return callback(new Blob(results))})},exports.decodePayloadAsBinary=function(data,binaryType,callback){"function"==typeof binaryType&&(callback=binaryType,binaryType=null);for(var bufferTail=data,buffers=[];bufferTail.byteLength>0;){for(var tailArray=new Uint8Array(bufferTail),isString=0===tailArray[0],msgLength="",i=1;255!==tailArray[i];i++){if(msgLength.length>310)return callback(err,0,1);msgLength+=tailArray[i]}bufferTail=sliceBuffer(bufferTail,2+msgLength.length),msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString)try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(i=0;i<typed.length;i++)msg+=String.fromCharCode(typed[i])}buffers.push(msg),bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,!0),i,total)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":27,"./utf8":28,after:2,"arraybuffer.slice":3,"base64-arraybuffer":5,blob:7,"has-binary2":30}],27:[function(require,module,exports){module.exports=Object.keys||function(obj){var arr=[],has=Object.prototype.hasOwnProperty;for(var i in obj)has.call(obj,i)&&arr.push(i);return arr}},{}],28:[function(require,module,exports){(function(global){!function(root){var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var byteArray,byteCount,byteIndex,stringFromCharCode=String.fromCharCode;function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function checkScalarValue(codePoint,strict){if(codePoint>=55296&&codePoint<=57343){if(strict)throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint,strict){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(checkScalarValue(codePoint,strict)||(codePoint=65533),symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}function decodeSymbol(strict){var byte1,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){if((codePoint=(31&byte1)<<6|readContinuationByte())>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if((codePoint=(15&byte1)<<12|readContinuationByte()<<6|readContinuationByte())>=2048)return checkScalarValue(codePoint,strict)?codePoint:65533;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(codePoint=(7&byte1)<<18|readContinuationByte()<<12|readContinuationByte()<<6|readContinuationByte())>=65536&&codePoint<=1114111)return codePoint;throw Error("Invalid UTF-8 detected")}var utf8={version:"2.1.2",encode:function(string,opts){for(var strict=!1!==(opts=opts||{}).strict,codePoints=ucs2decode(string),length=codePoints.length,index=-1,byteString="";++index<length;)byteString+=encodeCodePoint(codePoints[index],strict);return byteString},decode:function(byteString,opts){var strict=!1!==(opts=opts||{}).strict;byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var tmp,codePoints=[];!1!==(tmp=decodeSymbol(strict));)codePoints.push(tmp);return function(array){for(var value,length=array.length,index=-1,output="";++index<length;)(value=array[index])>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}(codePoints)}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return utf8});else if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=utf8;else{var hasOwnProperty={}.hasOwnProperty;for(var key in utf8)hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}else root.utf8=utf8}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],29:[function(require,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):(this._events[evt]=listener,this._eventsCount++),this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,!0),evt=prefix?prefix+event:event;return this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):(this._events[evt]=listener,this._eventsCount++),this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return 0==--this._eventsCount?this._events=new Events:delete this._events[evt],this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||(0==--this._eventsCount?this._events=new Events:delete this._events[evt]);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:0==--this._eventsCount?this._events=new Events:delete this._events[evt]}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&(0==--this._eventsCount?this._events=new Events:delete this._events[evt])):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,void 0!==module&&(module.exports=EventEmitter)},{}],30:[function(require,module,exports){(function(global){var isArray=require("isarray"),toString=Object.prototype.toString,withNativeBlob="function"==typeof global.Blob||"[object BlobConstructor]"===toString.call(global.Blob),withNativeFile="function"==typeof global.File||"[object FileConstructor]"===toString.call(global.File);module.exports=function hasBinary(obj){if(!obj||"object"!=typeof obj)return!1;if(isArray(obj)){for(var i=0,l=obj.length;i<l;i++)if(hasBinary(obj[i]))return!0;return!1}if("function"==typeof global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||"function"==typeof global.ArrayBuffer&&obj instanceof ArrayBuffer||withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File)return!0;if(obj.toJSON&&"function"==typeof obj.toJSON&&1===arguments.length)return hasBinary(obj.toJSON(),!0);for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&hasBinary(obj[key]))return!0;return!1}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:33}],31:[function(require,module,exports){try{module.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=!1}},{}],32:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],33:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],34:[function(require,module,exports){var global,apple_phone,apple_ipod,apple_tablet,android_phone,android_tablet,amazon_phone,amazon_tablet,windows_phone,windows_tablet,other_blackberry,other_blackberry_10,other_opera,other_chrome,other_firefox,seven_inch,match,IsMobileClass,instantiate;global=this,apple_phone=/iPhone/i,apple_ipod=/iPod/i,apple_tablet=/iPad/i,android_phone=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,android_tablet=/Android/i,amazon_phone=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,amazon_tablet=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,windows_phone=/Windows Phone/i,windows_tablet=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,other_blackberry=/BlackBerry/i,other_blackberry_10=/BB10/i,other_opera=/Opera Mini/i,other_chrome=/(CriOS|Chrome)(?=.*\bMobile\b)/i,other_firefox=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,seven_inch=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),match=function(regex,userAgent){return regex.test(userAgent)},IsMobileClass=function(userAgent){var ua=userAgent||navigator.userAgent,tmp=ua.split("[FBAN");if(void 0!==tmp[1]&&(ua=tmp[0]),void 0!==(tmp=ua.split("Twitter"))[1]&&(ua=tmp[0]),this.apple={phone:match(apple_phone,ua),ipod:match(apple_ipod,ua),tablet:!match(apple_phone,ua)&&match(apple_tablet,ua),device:match(apple_phone,ua)||match(apple_ipod,ua)||match(apple_tablet,ua)},this.amazon={phone:match(amazon_phone,ua),tablet:!match(amazon_phone,ua)&&match(amazon_tablet,ua),device:match(amazon_phone,ua)||match(amazon_tablet,ua)},this.android={phone:match(amazon_phone,ua)||match(android_phone,ua),tablet:!match(amazon_phone,ua)&&!match(android_phone,ua)&&(match(amazon_tablet,ua)||match(android_tablet,ua)),device:match(amazon_phone,ua)||match(amazon_tablet,ua)||match(android_phone,ua)||match(android_tablet,ua)},this.windows={phone:match(windows_phone,ua),tablet:match(windows_tablet,ua),device:match(windows_phone,ua)||match(windows_tablet,ua)},this.other={blackberry:match(other_blackberry,ua),blackberry10:match(other_blackberry_10,ua),opera:match(other_opera,ua),firefox:match(other_firefox,ua),chrome:match(other_chrome,ua),device:match(other_blackberry,ua)||match(other_blackberry_10,ua)||match(other_opera,ua)||match(other_firefox,ua)||match(other_chrome,ua)},this.seven_inch=match(seven_inch,ua),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},instantiate=function(){var IM=new IsMobileClass;return IM.Class=IsMobileClass,IM},void 0!==module&&module.exports&&"undefined"==typeof window?module.exports=IsMobileClass:void 0!==module&&module.exports&&"undefined"!=typeof window?module.exports=instantiate():"function"==typeof define&&define.amd?define("isMobile",[],global.isMobile=instantiate()):global.isMobile=instantiate()},{}],35:[function(require,module,exports){(function(global){!function(f){if("object"==typeof exports&&void 0!==module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this).Matter=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var Body={};module.exports=Body;var Vertices=_dereq_("../geometry/Vertices"),Vector=_dereq_("../geometry/Vector"),Sleeping=_dereq_("../core/Sleeping"),Common=(_dereq_("../render/Render"),_dereq_("../core/Common")),Bounds=_dereq_("../geometry/Bounds"),Axes=_dereq_("../geometry/Axes");!function(){Body._inertiaScale=4,Body._nextCollidingGroupId=1,Body._nextNonCollidingGroupId=-1,Body._nextCategory=1,Body.create=function(options){var defaults={id:Common.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:Vertices.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0}},body=Common.extend(defaults,options);return _initProperties(body,options),body},Body.nextGroup=function(isNonColliding){return isNonColliding?Body._nextNonCollidingGroupId--:Body._nextCollidingGroupId++},Body.nextCategory=function(){return Body._nextCategory=Body._nextCategory<<1,Body._nextCategory};var _initProperties=function(body,options){options=options||{},Body.set(body,{bounds:body.bounds||Bounds.create(body.vertices),positionPrev:body.positionPrev||Vector.clone(body.position),anglePrev:body.anglePrev||body.angle,vertices:body.vertices,parts:body.parts||[body],isStatic:body.isStatic,isSleeping:body.isSleeping,parent:body.parent||body}),Vertices.rotate(body.vertices,body.angle,body.position),Axes.rotate(body.axes,body.angle),Bounds.update(body.bounds,body.vertices,body.velocity),Body.set(body,{axes:options.axes||body.axes,area:options.area||body.area,mass:options.mass||body.mass,inertia:options.inertia||body.inertia});var defaultFillStyle=body.isStatic?"#2e2b44":Common.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);body.render.fillStyle=body.render.fillStyle||defaultFillStyle,body.render.strokeStyle=body.render.strokeStyle||"#000",body.render.sprite.xOffset+=-(body.bounds.min.x-body.position.x)/(body.bounds.max.x-body.bounds.min.x),body.render.sprite.yOffset+=-(body.bounds.min.y-body.position.y)/(body.bounds.max.y-body.bounds.min.y)};Body.set=function(body,settings,value){var property;for(property in"string"==typeof settings&&(property=settings,(settings={})[property]=value),settings)if(value=settings[property],settings.hasOwnProperty(property))switch(property){case"isStatic":Body.setStatic(body,value);break;case"isSleeping":Sleeping.set(body,value);break;case"mass":Body.setMass(body,value);break;case"density":Body.setDensity(body,value);break;case"inertia":Body.setInertia(body,value);break;case"vertices":Body.setVertices(body,value);break;case"position":Body.setPosition(body,value);break;case"angle":Body.setAngle(body,value);break;case"velocity":Body.setVelocity(body,value);break;case"angularVelocity":Body.setAngularVelocity(body,value);break;case"parts":Body.setParts(body,value);break;default:body[property]=value}},Body.setStatic=function(body,isStatic){for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.isStatic=isStatic,isStatic?(part._original={restitution:part.restitution,friction:part.friction,mass:part.mass,inertia:part.inertia,density:part.density,inverseMass:part.inverseMass,inverseInertia:part.inverseInertia},part.restitution=0,part.friction=1,part.mass=part.inertia=part.density=1/0,part.inverseMass=part.inverseInertia=0,part.positionPrev.x=part.position.x,part.positionPrev.y=part.position.y,part.anglePrev=part.angle,part.angularVelocity=0,part.speed=0,part.angularSpeed=0,part.motion=0):part._original&&(part.restitution=part._original.restitution,part.friction=part._original.friction,part.mass=part._original.mass,part.inertia=part._original.inertia,part.density=part._original.density,part.inverseMass=part._original.inverseMass,part.inverseInertia=part._original.inverseInertia,delete part._original)}},Body.setMass=function(body,mass){var moment=body.inertia/(body.mass/6);body.inertia=moment*(mass/6),body.inverseInertia=1/body.inertia,body.mass=mass,body.inverseMass=1/body.mass,body.density=body.mass/body.area},Body.setDensity=function(body,density){Body.setMass(body,density*body.area),body.density=density},Body.setInertia=function(body,inertia){body.inertia=inertia,body.inverseInertia=1/body.inertia},Body.setVertices=function(body,vertices){vertices[0].body===body?body.vertices=vertices:body.vertices=Vertices.create(vertices,body),body.axes=Axes.fromVertices(body.vertices),body.area=Vertices.area(body.vertices),Body.setMass(body,body.density*body.area);var centre=Vertices.centre(body.vertices);Vertices.translate(body.vertices,centre,-1),Body.setInertia(body,Body._inertiaScale*Vertices.inertia(body.vertices,body.mass)),Vertices.translate(body.vertices,body.position),Bounds.update(body.bounds,body.vertices,body.velocity)},Body.setParts=function(body,parts,autoHull){var i;for(parts=parts.slice(0),body.parts.length=0,body.parts.push(body),body.parent=body,i=0;i<parts.length;i++){var part=parts[i];part!==body&&(part.parent=body,body.parts.push(part))}if(1!==body.parts.length){if(autoHull=void 0===autoHull||autoHull){var vertices=[];for(i=0;i<parts.length;i++)vertices=vertices.concat(parts[i].vertices);Vertices.clockwiseSort(vertices);var hull=Vertices.hull(vertices),hullCentre=Vertices.centre(hull);Body.setVertices(body,hull),Vertices.translate(body.vertices,hullCentre)}var total=Body._totalProperties(body);body.area=total.area,body.parent=body,body.position.x=total.centre.x,body.position.y=total.centre.y,body.positionPrev.x=total.centre.x,body.positionPrev.y=total.centre.y,Body.setMass(body,total.mass),Body.setInertia(body,total.inertia),Body.setPosition(body,total.centre)}},Body.setPosition=function(body,position){var delta=Vector.sub(position,body.position);body.positionPrev.x+=delta.x,body.positionPrev.y+=delta.y;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.position.x+=delta.x,part.position.y+=delta.y,Vertices.translate(part.vertices,delta),Bounds.update(part.bounds,part.vertices,body.velocity)}},Body.setAngle=function(body,angle){var delta=angle-body.angle;body.anglePrev+=delta;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.angle+=delta,Vertices.rotate(part.vertices,delta,body.position),Axes.rotate(part.axes,delta),Bounds.update(part.bounds,part.vertices,body.velocity),i>0&&Vector.rotateAbout(part.position,delta,body.position,part.position)}},Body.setVelocity=function(body,velocity){body.positionPrev.x=body.position.x-velocity.x,body.positionPrev.y=body.position.y-velocity.y,body.velocity.x=velocity.x,body.velocity.y=velocity.y,body.speed=Vector.magnitude(body.velocity)},Body.setAngularVelocity=function(body,velocity){body.anglePrev=body.angle-velocity,body.angularVelocity=velocity,body.angularSpeed=Math.abs(body.angularVelocity)},Body.translate=function(body,translation){Body.setPosition(body,Vector.add(body.position,translation))},Body.rotate=function(body,rotation,point){if(point){var cos=Math.cos(rotation),sin=Math.sin(rotation),dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+(dx*cos-dy*sin),y:point.y+(dx*sin+dy*cos)}),Body.setAngle(body,body.angle+rotation)}else Body.setAngle(body,body.angle+rotation)},Body.scale=function(body,scaleX,scaleY,point){var totalArea=0,totalInertia=0;point=point||body.position;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];Vertices.scale(part.vertices,scaleX,scaleY,point),part.axes=Axes.fromVertices(part.vertices),part.area=Vertices.area(part.vertices),Body.setMass(part,body.density*part.area),Vertices.translate(part.vertices,{x:-part.position.x,y:-part.position.y}),Body.setInertia(part,Body._inertiaScale*Vertices.inertia(part.vertices,part.mass)),Vertices.translate(part.vertices,{x:part.position.x,y:part.position.y}),i>0&&(totalArea+=part.area,totalInertia+=part.inertia),part.position.x=point.x+(part.position.x-point.x)*scaleX,part.position.y=point.y+(part.position.y-point.y)*scaleY,Bounds.update(part.bounds,part.vertices,body.velocity)}body.parts.length>1&&(body.area=totalArea,body.isStatic||(Body.setMass(body,body.density*totalArea),Body.setInertia(body,totalInertia))),body.circleRadius&&(scaleX===scaleY?body.circleRadius*=scaleX:body.circleRadius=null)},Body.update=function(body,deltaTime,timeScale,correction){var deltaTimeSquared=Math.pow(deltaTime*timeScale*body.timeScale,2),frictionAir=1-body.frictionAir*timeScale*body.timeScale,velocityPrevX=body.position.x-body.positionPrev.x,velocityPrevY=body.position.y-body.positionPrev.y;body.velocity.x=velocityPrevX*frictionAir*correction+body.force.x/body.mass*deltaTimeSquared,body.velocity.y=velocityPrevY*frictionAir*correction+body.force.y/body.mass*deltaTimeSquared,body.positionPrev.x=body.position.x,body.positionPrev.y=body.position.y,body.position.x+=body.velocity.x,body.position.y+=body.velocity.y,body.angularVelocity=(body.angle-body.anglePrev)*frictionAir*correction+body.torque/body.inertia*deltaTimeSquared,body.anglePrev=body.angle,body.angle+=body.angularVelocity,body.speed=Vector.magnitude(body.velocity),body.angularSpeed=Math.abs(body.angularVelocity);for(var i=0;i<body.parts.length;i++){var part=body.parts[i];Vertices.translate(part.vertices,body.velocity),i>0&&(part.position.x+=body.velocity.x,part.position.y+=body.velocity.y),0!==body.angularVelocity&&(Vertices.rotate(part.vertices,body.angularVelocity,body.position),Axes.rotate(part.axes,body.angularVelocity),i>0&&Vector.rotateAbout(part.position,body.angularVelocity,body.position,part.position)),Bounds.update(part.bounds,part.vertices,body.velocity)}},Body.applyForce=function(body,position,force){body.force.x+=force.x,body.force.y+=force.y;var offset_x=position.x-body.position.x,offset_y=position.y-body.position.y;body.torque+=offset_x*force.y-offset_y*force.x},Body._totalProperties=function(body){for(var properties={mass:0,area:0,inertia:0,centre:{x:0,y:0}},i=1===body.parts.length?0:1;i<body.parts.length;i++){var part=body.parts[i],mass=part.mass!==1/0?part.mass:1;properties.mass+=mass,properties.area+=part.area,properties.inertia+=part.inertia,properties.centre=Vector.add(properties.centre,Vector.mult(part.position,mass))}return properties.centre=Vector.div(properties.centre,properties.mass),properties}}()},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31}],2:[function(_dereq_,module,exports){var Composite={};module.exports=Composite;var Events=_dereq_("../core/Events"),Common=_dereq_("../core/Common"),Body=_dereq_("./Body");Composite.create=function(options){return Common.extend({id:Common.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},options)},Composite.setModified=function(composite,isModified,updateParents,updateChildren){if(composite.isModified=isModified,updateParents&&composite.parent&&Composite.setModified(composite.parent,isModified,updateParents,updateChildren),updateChildren)for(var i=0;i<composite.composites.length;i++){var childComposite=composite.composites[i];Composite.setModified(childComposite,isModified,updateParents,updateChildren)}},Composite.add=function(composite,object){var objects=[].concat(object);Events.trigger(composite,"beforeAdd",{object:object});for(var i=0;i<objects.length;i++){var obj=objects[i];switch(obj.type){case"body":if(obj.parent!==obj){Common.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}Composite.addBody(composite,obj);break;case"constraint":Composite.addConstraint(composite,obj);break;case"composite":Composite.addComposite(composite,obj);break;case"mouseConstraint":Composite.addConstraint(composite,obj.constraint)}}return Events.trigger(composite,"afterAdd",{object:object}),composite},Composite.remove=function(composite,object,deep){var objects=[].concat(object);Events.trigger(composite,"beforeRemove",{object:object});for(var i=0;i<objects.length;i++){var obj=objects[i];switch(obj.type){case"body":Composite.removeBody(composite,obj,deep);break;case"constraint":Composite.removeConstraint(composite,obj,deep);break;case"composite":Composite.removeComposite(composite,obj,deep);break;case"mouseConstraint":Composite.removeConstraint(composite,obj.constraint)}}return Events.trigger(composite,"afterRemove",{object:object}),composite},Composite.addComposite=function(compositeA,compositeB){return compositeA.composites.push(compositeB),compositeB.parent=compositeA,Composite.setModified(compositeA,!0,!0,!1),compositeA},Composite.removeComposite=function(compositeA,compositeB,deep){var position=Common.indexOf(compositeA.composites,compositeB);if(-1!==position&&(Composite.removeCompositeAt(compositeA,position),Composite.setModified(compositeA,!0,!0,!1)),deep)for(var i=0;i<compositeA.composites.length;i++)Composite.removeComposite(compositeA.composites[i],compositeB,!0);return compositeA},Composite.removeCompositeAt=function(composite,position){return composite.composites.splice(position,1),Composite.setModified(composite,!0,!0,!1),composite},Composite.addBody=function(composite,body){return composite.bodies.push(body),Composite.setModified(composite,!0,!0,!1),composite},Composite.removeBody=function(composite,body,deep){var position=Common.indexOf(composite.bodies,body);if(-1!==position&&(Composite.removeBodyAt(composite,position),Composite.setModified(composite,!0,!0,!1)),deep)for(var i=0;i<composite.composites.length;i++)Composite.removeBody(composite.composites[i],body,!0);return composite},Composite.removeBodyAt=function(composite,position){return composite.bodies.splice(position,1),Composite.setModified(composite,!0,!0,!1),composite},Composite.addConstraint=function(composite,constraint){return composite.constraints.push(constraint),Composite.setModified(composite,!0,!0,!1),composite},Composite.removeConstraint=function(composite,constraint,deep){var position=Common.indexOf(composite.constraints,constraint);if(-1!==position&&Composite.removeConstraintAt(composite,position),deep)for(var i=0;i<composite.composites.length;i++)Composite.removeConstraint(composite.composites[i],constraint,!0);return composite},Composite.removeConstraintAt=function(composite,position){return composite.constraints.splice(position,1),Composite.setModified(composite,!0,!0,!1),composite},Composite.clear=function(composite,keepStatic,deep){if(deep)for(var i=0;i<composite.composites.length;i++)Composite.clear(composite.composites[i],keepStatic,!0);return keepStatic?composite.bodies=composite.bodies.filter(function(body){return body.isStatic}):composite.bodies.length=0,composite.constraints.length=0,composite.composites.length=0,Composite.setModified(composite,!0,!0,!1),composite},Composite.allBodies=function(composite){for(var bodies=[].concat(composite.bodies),i=0;i<composite.composites.length;i++)bodies=bodies.concat(Composite.allBodies(composite.composites[i]));return bodies},Composite.allConstraints=function(composite){for(var constraints=[].concat(composite.constraints),i=0;i<composite.composites.length;i++)constraints=constraints.concat(Composite.allConstraints(composite.composites[i]));return constraints},Composite.allComposites=function(composite){for(var composites=[].concat(composite.composites),i=0;i<composite.composites.length;i++)composites=composites.concat(Composite.allComposites(composite.composites[i]));return composites},Composite.get=function(composite,id,type){var objects,object;switch(type){case"body":objects=Composite.allBodies(composite);break;case"constraint":objects=Composite.allConstraints(composite);break;case"composite":objects=Composite.allComposites(composite).concat(composite)}return objects?0===(object=objects.filter(function(object){return object.id.toString()===id.toString()})).length?null:object[0]:null},Composite.move=function(compositeA,objects,compositeB){return Composite.remove(compositeA,objects),Composite.add(compositeB,objects),compositeA},Composite.rebase=function(composite){for(var objects=Composite.allBodies(composite).concat(Composite.allConstraints(composite)).concat(Composite.allComposites(composite)),i=0;i<objects.length;i++)objects[i].id=Common.nextId();return Composite.setModified(composite,!0,!0,!1),composite},Composite.translate=function(composite,translation,recursive){for(var bodies=recursive?Composite.allBodies(composite):composite.bodies,i=0;i<bodies.length;i++)Body.translate(bodies[i],translation);return Composite.setModified(composite,!0,!0,!1),composite},Composite.rotate=function(composite,rotation,point,recursive){for(var cos=Math.cos(rotation),sin=Math.sin(rotation),bodies=recursive?Composite.allBodies(composite):composite.bodies,i=0;i<bodies.length;i++){var body=bodies[i],dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+(dx*cos-dy*sin),y:point.y+(dx*sin+dy*cos)}),Body.rotate(body,rotation)}return Composite.setModified(composite,!0,!0,!1),composite},Composite.scale=function(composite,scaleX,scaleY,point,recursive){for(var bodies=recursive?Composite.allBodies(composite):composite.bodies,i=0;i<bodies.length;i++){var body=bodies[i],dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+dx*scaleX,y:point.y+dy*scaleY}),Body.scale(body,scaleX,scaleY)}return Composite.setModified(composite,!0,!0,!1),composite},Composite.bounds=function(composite){for(var bodies=Matter.Composite.allBodies(composite),vertices=[],i=0;i<bodies.length;i+=1){var body=bodies[i];vertices.push(body.bounds.min,body.bounds.max)}return Matter.Bounds.create(vertices)}},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(_dereq_,module,exports){var World={};module.exports=World;var Composite=_dereq_("./Composite"),Common=(_dereq_("../constraint/Constraint"),_dereq_("../core/Common"));World.create=function(options){var composite=Composite.create(),defaults={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}};return Common.extend(composite,defaults,options)}},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(_dereq_,module,exports){var Contact={};module.exports=Contact,Contact.create=function(vertex){return{id:Contact.id(vertex),vertex:vertex,normalImpulse:0,tangentImpulse:0}},Contact.id=function(vertex){return vertex.body.id+"_"+vertex.index}},{}],5:[function(_dereq_,module,exports){var Detector={};module.exports=Detector;var SAT=_dereq_("./SAT"),Pair=_dereq_("./Pair"),Bounds=_dereq_("../geometry/Bounds");Detector.collisions=function(broadphasePairs,engine){for(var collisions=[],pairsTable=engine.pairs.table,i=0;i<broadphasePairs.length;i++){var bodyA=broadphasePairs[i][0],bodyB=broadphasePairs[i][1];if((!bodyA.isStatic&&!bodyA.isSleeping||!bodyB.isStatic&&!bodyB.isSleeping)&&Detector.canCollide(bodyA.collisionFilter,bodyB.collisionFilter)&&Bounds.overlaps(bodyA.bounds,bodyB.bounds))for(var j=bodyA.parts.length>1?1:0;j<bodyA.parts.length;j++)for(var partA=bodyA.parts[j],k=bodyB.parts.length>1?1:0;k<bodyB.parts.length;k++){var partB=bodyB.parts[k];if(partA===bodyA&&partB===bodyB||Bounds.overlaps(partA.bounds,partB.bounds)){var previousCollision,pair=pairsTable[Pair.id(partA,partB)];previousCollision=pair&&pair.isActive?pair.collision:null;var collision=SAT.collides(partA,partB,previousCollision);collision.collided&&collisions.push(collision)}}}return collisions},Detector.canCollide=function(filterA,filterB){return filterA.group===filterB.group&&0!==filterA.group?filterA.group>0:0!=(filterA.mask&filterB.category)&&0!=(filterB.mask&filterA.category)}},{"../geometry/Bounds":26,"./Pair":7,"./SAT":11}],6:[function(_dereq_,module,exports){var Grid={};module.exports=Grid;var Pair=_dereq_("./Pair"),Detector=_dereq_("./Detector"),Common=_dereq_("../core/Common");Grid.create=function(options){var defaults={controller:Grid,detector:Detector.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return Common.extend(defaults,options)},Grid.update=function(grid,bodies,engine,forceUpdate){var i,col,row,bucket,bucketId,world=engine.world,buckets=grid.buckets,gridChanged=!1;for(i=0;i<bodies.length;i++){var body=bodies[i];if((!body.isSleeping||forceUpdate)&&!(body.bounds.max.x<world.bounds.min.x||body.bounds.min.x>world.bounds.max.x||body.bounds.max.y<world.bounds.min.y||body.bounds.min.y>world.bounds.max.y)){var newRegion=Grid._getRegion(grid,body);if(!body.region||newRegion.id!==body.region.id||forceUpdate){body.region&&!forceUpdate||(body.region=newRegion);var union=Grid._regionUnion(newRegion,body.region);for(col=union.startCol;col<=union.endCol;col++)for(row=union.startRow;row<=union.endRow;row++){bucket=buckets[bucketId=Grid._getBucketId(col,row)];var isInsideNewRegion=col>=newRegion.startCol&&col<=newRegion.endCol&&row>=newRegion.startRow&&row<=newRegion.endRow,isInsideOldRegion=col>=body.region.startCol&&col<=body.region.endCol&&row>=body.region.startRow&&row<=body.region.endRow;!isInsideNewRegion&&isInsideOldRegion&&isInsideOldRegion&&bucket&&Grid._bucketRemoveBody(grid,bucket,body),(body.region===newRegion||isInsideNewRegion&&!isInsideOldRegion||forceUpdate)&&(bucket||(bucket=Grid._createBucket(buckets,bucketId)),Grid._bucketAddBody(grid,bucket,body))}body.region=newRegion,gridChanged=!0}}}gridChanged&&(grid.pairsList=Grid._createActivePairsList(grid))},Grid.clear=function(grid){grid.buckets={},grid.pairs={},grid.pairsList=[]},Grid._regionUnion=function(regionA,regionB){var startCol=Math.min(regionA.startCol,regionB.startCol),endCol=Math.max(regionA.endCol,regionB.endCol),startRow=Math.min(regionA.startRow,regionB.startRow),endRow=Math.max(regionA.endRow,regionB.endRow);return Grid._createRegion(startCol,endCol,startRow,endRow)},Grid._getRegion=function(grid,body){var bounds=body.bounds,startCol=Math.floor(bounds.min.x/grid.bucketWidth),endCol=Math.floor(bounds.max.x/grid.bucketWidth),startRow=Math.floor(bounds.min.y/grid.bucketHeight),endRow=Math.floor(bounds.max.y/grid.bucketHeight);return Grid._createRegion(startCol,endCol,startRow,endRow)},Grid._createRegion=function(startCol,endCol,startRow,endRow){return{id:startCol+","+endCol+","+startRow+","+endRow,startCol:startCol,endCol:endCol,startRow:startRow,endRow:endRow}},Grid._getBucketId=function(column,row){return"C"+column+"R"+row},Grid._createBucket=function(buckets,bucketId){return buckets[bucketId]=[]},Grid._bucketAddBody=function(grid,bucket,body){for(var i=0;i<bucket.length;i++){var bodyB=bucket[i];if(!(body.id===bodyB.id||body.isStatic&&bodyB.isStatic)){var pairId=Pair.id(body,bodyB),pair=grid.pairs[pairId];pair?pair[2]+=1:grid.pairs[pairId]=[body,bodyB,1]}}bucket.push(body)},Grid._bucketRemoveBody=function(grid,bucket,body){bucket.splice(Common.indexOf(bucket,body),1);for(var i=0;i<bucket.length;i++){var bodyB=bucket[i],pairId=Pair.id(body,bodyB),pair=grid.pairs[pairId];pair&&(pair[2]-=1)}},Grid._createActivePairsList=function(grid){var pairKeys,pair,pairs=[];pairKeys=Common.keys(grid.pairs);for(var k=0;k<pairKeys.length;k++)(pair=grid.pairs[pairKeys[k]])[2]>0?pairs.push(pair):delete grid.pairs[pairKeys[k]];return pairs}},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(_dereq_,module,exports){var Pair={};module.exports=Pair;var Contact=_dereq_("./Contact");Pair.create=function(collision,timestamp){var bodyA=collision.bodyA,bodyB=collision.bodyB,parentA=collision.parentA,parentB=collision.parentB,pair={id:Pair.id(bodyA,bodyB),bodyA:bodyA,bodyB:bodyB,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:bodyA.isSensor||bodyB.isSensor,timeCreated:timestamp,timeUpdated:timestamp,inverseMass:parentA.inverseMass+parentB.inverseMass,friction:Math.min(parentA.friction,parentB.friction),frictionStatic:Math.max(parentA.frictionStatic,parentB.frictionStatic),restitution:Math.max(parentA.restitution,parentB.restitution),slop:Math.max(parentA.slop,parentB.slop)};return Pair.update(pair,collision,timestamp),pair},Pair.update=function(pair,collision,timestamp){var contacts=pair.contacts,supports=collision.supports,activeContacts=pair.activeContacts,parentA=collision.parentA,parentB=collision.parentB;if(pair.collision=collision,pair.inverseMass=parentA.inverseMass+parentB.inverseMass,pair.friction=Math.min(parentA.friction,parentB.friction),pair.frictionStatic=Math.max(parentA.frictionStatic,parentB.frictionStatic),pair.restitution=Math.max(parentA.restitution,parentB.restitution),pair.slop=Math.max(parentA.slop,parentB.slop),activeContacts.length=0,collision.collided){for(var i=0;i<supports.length;i++){var support=supports[i],contactId=Contact.id(support),contact=contacts[contactId];contact?activeContacts.push(contact):activeContacts.push(contacts[contactId]=Contact.create(support))}pair.separation=collision.depth,Pair.setActive(pair,!0,timestamp)}else!0===pair.isActive&&Pair.setActive(pair,!1,timestamp)},Pair.setActive=function(pair,isActive,timestamp){isActive?(pair.isActive=!0,pair.timeUpdated=timestamp):(pair.isActive=!1,pair.activeContacts.length=0)},Pair.id=function(bodyA,bodyB){return bodyA.id<bodyB.id?"A"+bodyA.id+"B"+bodyB.id:"A"+bodyB.id+"B"+bodyA.id}},{"./Contact":4}],8:[function(_dereq_,module,exports){var Pairs={};module.exports=Pairs;var Pair=_dereq_("./Pair"),Common=_dereq_("../core/Common");Pairs._pairMaxIdleLife=1e3,Pairs.create=function(options){return Common.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},options)},Pairs.update=function(pairs,collisions,timestamp){var collision,pairId,pair,i,pairsList=pairs.list,pairsTable=pairs.table,collisionStart=pairs.collisionStart,collisionEnd=pairs.collisionEnd,collisionActive=pairs.collisionActive,activePairIds=[];for(collisionStart.length=0,collisionEnd.length=0,collisionActive.length=0,i=0;i<collisions.length;i++)(collision=collisions[i]).collided&&(pairId=Pair.id(collision.bodyA,collision.bodyB),activePairIds.push(pairId),(pair=pairsTable[pairId])?(pair.isActive?collisionActive.push(pair):collisionStart.push(pair),Pair.update(pair,collision,timestamp)):(pair=Pair.create(collision,timestamp),pairsTable[pairId]=pair,collisionStart.push(pair),pairsList.push(pair)));for(i=0;i<pairsList.length;i++)(pair=pairsList[i]).isActive&&-1===Common.indexOf(activePairIds,pair.id)&&(Pair.setActive(pair,!1,timestamp),collisionEnd.push(pair))},Pairs.removeOld=function(pairs,timestamp){var pair,collision,pairIndex,i,pairsList=pairs.list,pairsTable=pairs.table,indexesToRemove=[];for(i=0;i<pairsList.length;i++)(collision=(pair=pairsList[i]).collision).bodyA.isSleeping||collision.bodyB.isSleeping?pair.timeUpdated=timestamp:timestamp-pair.timeUpdated>Pairs._pairMaxIdleLife&&indexesToRemove.push(i);for(i=0;i<indexesToRemove.length;i++)delete pairsTable[(pair=pairsList[pairIndex=indexesToRemove[i]-i]).id],pairsList.splice(pairIndex,1)},Pairs.clear=function(pairs){return pairs.table={},pairs.list.length=0,pairs.collisionStart.length=0,pairs.collisionActive.length=0,pairs.collisionEnd.length=0,pairs}},{"../core/Common":14,"./Pair":7}],9:[function(_dereq_,module,exports){var Query={};module.exports=Query;var Vector=_dereq_("../geometry/Vector"),SAT=_dereq_("./SAT"),Bounds=_dereq_("../geometry/Bounds"),Bodies=_dereq_("../factory/Bodies"),Vertices=_dereq_("../geometry/Vertices");Query.collides=function(body,bodies){for(var collisions=[],i=0;i<bodies.length;i++){var bodyA=bodies[i];if(Bounds.overlaps(bodyA.bounds,body.bounds))for(var j=1===bodyA.parts.length?0:1;j<bodyA.parts.length;j++){var part=bodyA.parts[j];if(Bounds.overlaps(part.bounds,body.bounds)){var collision=SAT.collides(part,body);if(collision.collided){collisions.push(collision);break}}}}return collisions},Query.ray=function(bodies,startPoint,endPoint,rayWidth){rayWidth=rayWidth||1e-100;for(var rayAngle=Vector.angle(startPoint,endPoint),rayLength=Vector.magnitude(Vector.sub(startPoint,endPoint)),rayX=.5*(endPoint.x+startPoint.x),rayY=.5*(endPoint.y+startPoint.y),ray=Bodies.rectangle(rayX,rayY,rayLength,rayWidth,{angle:rayAngle}),collisions=Query.collides(ray,bodies),i=0;i<collisions.length;i+=1){var collision=collisions[i];collision.body=collision.bodyB=collision.bodyA}return collisions},Query.region=function(bodies,bounds,outside){for(var result=[],i=0;i<bodies.length;i++){var body=bodies[i],overlaps=Bounds.overlaps(body.bounds,bounds);(overlaps&&!outside||!overlaps&&outside)&&result.push(body)}return result},Query.point=function(bodies,point){for(var result=[],i=0;i<bodies.length;i++){var body=bodies[i];if(Bounds.contains(body.bounds,point))for(var j=1===body.parts.length?0:1;j<body.parts.length;j++){var part=body.parts[j];if(Bounds.contains(part.bounds,point)&&Vertices.contains(part.vertices,point)){result.push(body);break}}}return result}},{"../factory/Bodies":23,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"./SAT":11}],10:[function(_dereq_,module,exports){var Resolver={};module.exports=Resolver;var Vertices=_dereq_("../geometry/Vertices"),Vector=_dereq_("../geometry/Vector"),Common=_dereq_("../core/Common"),Bounds=_dereq_("../geometry/Bounds");Resolver._restingThresh=4,Resolver._restingThreshTangent=6,Resolver._positionDampen=.9,Resolver._positionWarming=.8,Resolver._frictionNormalMultiplier=5,Resolver.preSolvePosition=function(pairs){var i,pair,activeCount;for(i=0;i<pairs.length;i++)(pair=pairs[i]).isActive&&(activeCount=pair.activeContacts.length,pair.collision.parentA.totalContacts+=activeCount,pair.collision.parentB.totalContacts+=activeCount)},Resolver.solvePosition=function(pairs,timeScale){var i,pair,collision,bodyA,bodyB,normal,bodyBtoA,contactShare,positionImpulse,tempA=Vector._temp[0],tempB=Vector._temp[1],tempC=Vector._temp[2],tempD=Vector._temp[3];for(i=0;i<pairs.length;i++)(pair=pairs[i]).isActive&&!pair.isSensor&&(bodyA=(collision=pair.collision).parentA,bodyB=collision.parentB,normal=collision.normal,bodyBtoA=Vector.sub(Vector.add(bodyB.positionImpulse,bodyB.position,tempA),Vector.add(bodyA.positionImpulse,Vector.sub(bodyB.position,collision.penetration,tempB),tempC),tempD),pair.separation=Vector.dot(normal,bodyBtoA));for(i=0;i<pairs.length;i++)(pair=pairs[i]).isActive&&!pair.isSensor&&(bodyA=(collision=pair.collision).parentA,bodyB=collision.parentB,normal=collision.normal,positionImpulse=(pair.separation-pair.slop)*timeScale,(bodyA.isStatic||bodyB.isStatic)&&(positionImpulse*=2),bodyA.isStatic||bodyA.isSleeping||(contactShare=Resolver._positionDampen/bodyA.totalContacts,bodyA.positionImpulse.x+=normal.x*positionImpulse*contactShare,bodyA.positionImpulse.y+=normal.y*positionImpulse*contactShare),bodyB.isStatic||bodyB.isSleeping||(contactShare=Resolver._positionDampen/bodyB.totalContacts,bodyB.positionImpulse.x-=normal.x*positionImpulse*contactShare,bodyB.positionImpulse.y-=normal.y*positionImpulse*contactShare))},Resolver.postSolvePosition=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i];if(body.totalContacts=0,0!==body.positionImpulse.x||0!==body.positionImpulse.y){for(var j=0;j<body.parts.length;j++){var part=body.parts[j];Vertices.translate(part.vertices,body.positionImpulse),Bounds.update(part.bounds,part.vertices,body.velocity),part.position.x+=body.positionImpulse.x,part.position.y+=body.positionImpulse.y}body.positionPrev.x+=body.positionImpulse.x,body.positionPrev.y+=body.positionImpulse.y,Vector.dot(body.positionImpulse,body.velocity)<0?(body.positionImpulse.x=0,body.positionImpulse.y=0):(body.positionImpulse.x*=Resolver._positionWarming,body.positionImpulse.y*=Resolver._positionWarming)}}},Resolver.preSolveVelocity=function(pairs){var i,j,pair,contacts,collision,bodyA,bodyB,normal,tangent,contact,contactVertex,normalImpulse,tangentImpulse,offset,impulse=Vector._temp[0],tempA=Vector._temp[1];for(i=0;i<pairs.length;i++)if((pair=pairs[i]).isActive&&!pair.isSensor)for(contacts=pair.activeContacts,bodyA=(collision=pair.collision).parentA,bodyB=collision.parentB,normal=collision.normal,tangent=collision.tangent,j=0;j<contacts.length;j++)contactVertex=(contact=contacts[j]).vertex,normalImpulse=contact.normalImpulse,tangentImpulse=contact.tangentImpulse,0===normalImpulse&&0===tangentImpulse||(impulse.x=normal.x*normalImpulse+tangent.x*tangentImpulse,impulse.y=normal.y*normalImpulse+tangent.y*tangentImpulse,bodyA.isStatic||bodyA.isSleeping||(offset=Vector.sub(contactVertex,bodyA.position,tempA),bodyA.positionPrev.x+=impulse.x*bodyA.inverseMass,bodyA.positionPrev.y+=impulse.y*bodyA.inverseMass,bodyA.anglePrev+=Vector.cross(offset,impulse)*bodyA.inverseInertia),bodyB.isStatic||bodyB.isSleeping||(offset=Vector.sub(contactVertex,bodyB.position,tempA),bodyB.positionPrev.x-=impulse.x*bodyB.inverseMass,bodyB.positionPrev.y-=impulse.y*bodyB.inverseMass,bodyB.anglePrev-=Vector.cross(offset,impulse)*bodyB.inverseInertia))},Resolver.solveVelocity=function(pairs,timeScale){for(var timeScaleSquared=timeScale*timeScale,impulse=Vector._temp[0],tempA=Vector._temp[1],tempB=Vector._temp[2],tempC=Vector._temp[3],tempD=Vector._temp[4],tempE=Vector._temp[5],i=0;i<pairs.length;i++){var pair=pairs[i];if(pair.isActive&&!pair.isSensor){var collision=pair.collision,bodyA=collision.parentA,bodyB=collision.parentB,normal=collision.normal,tangent=collision.tangent,contacts=pair.activeContacts,contactShare=1/contacts.length;bodyA.velocity.x=bodyA.position.x-bodyA.positionPrev.x,bodyA.velocity.y=bodyA.position.y-bodyA.positionPrev.y,bodyB.velocity.x=bodyB.position.x-bodyB.positionPrev.x,bodyB.velocity.y=bodyB.position.y-bodyB.positionPrev.y,bodyA.angularVelocity=bodyA.angle-bodyA.anglePrev,bodyB.angularVelocity=bodyB.angle-bodyB.anglePrev;for(var j=0;j<contacts.length;j++){var contact=contacts[j],contactVertex=contact.vertex,offsetA=Vector.sub(contactVertex,bodyA.position,tempA),offsetB=Vector.sub(contactVertex,bodyB.position,tempB),velocityPointA=Vector.add(bodyA.velocity,Vector.mult(Vector.perp(offsetA),bodyA.angularVelocity),tempC),velocityPointB=Vector.add(bodyB.velocity,Vector.mult(Vector.perp(offsetB),bodyB.angularVelocity),tempD),relativeVelocity=Vector.sub(velocityPointA,velocityPointB,tempE),normalVelocity=Vector.dot(normal,relativeVelocity),tangentVelocity=Vector.dot(tangent,relativeVelocity),tangentSpeed=Math.abs(tangentVelocity),tangentVelocityDirection=Common.sign(tangentVelocity),normalImpulse=(1+pair.restitution)*normalVelocity,normalForce=Common.clamp(pair.separation+normalVelocity,0,1)*Resolver._frictionNormalMultiplier,tangentImpulse=tangentVelocity,maxFriction=1/0;tangentSpeed>pair.friction*pair.frictionStatic*normalForce*timeScaleSquared&&(maxFriction=tangentSpeed,tangentImpulse=Common.clamp(pair.friction*tangentVelocityDirection*timeScaleSquared,-maxFriction,maxFriction));var oAcN=Vector.cross(offsetA,normal),oBcN=Vector.cross(offsetB,normal),share=contactShare/(bodyA.inverseMass+bodyB.inverseMass+bodyA.inverseInertia*oAcN*oAcN+bodyB.inverseInertia*oBcN*oBcN);if(normalImpulse*=share,tangentImpulse*=share,normalVelocity<0&&normalVelocity*normalVelocity>Resolver._restingThresh*timeScaleSquared)contact.normalImpulse=0;else{var contactNormalImpulse=contact.normalImpulse;contact.normalImpulse=Math.min(contact.normalImpulse+normalImpulse,0),normalImpulse=contact.normalImpulse-contactNormalImpulse}if(tangentVelocity*tangentVelocity>Resolver._restingThreshTangent*timeScaleSquared)contact.tangentImpulse=0;else{var contactTangentImpulse=contact.tangentImpulse;contact.tangentImpulse=Common.clamp(contact.tangentImpulse+tangentImpulse,-maxFriction,maxFriction),tangentImpulse=contact.tangentImpulse-contactTangentImpulse}impulse.x=normal.x*normalImpulse+tangent.x*tangentImpulse,impulse.y=normal.y*normalImpulse+tangent.y*tangentImpulse,bodyA.isStatic||bodyA.isSleeping||(bodyA.positionPrev.x+=impulse.x*bodyA.inverseMass,bodyA.positionPrev.y+=impulse.y*bodyA.inverseMass,bodyA.anglePrev+=Vector.cross(offsetA,impulse)*bodyA.inverseInertia),bodyB.isStatic||bodyB.isSleeping||(bodyB.positionPrev.x-=impulse.x*bodyB.inverseMass,bodyB.positionPrev.y-=impulse.y*bodyB.inverseMass,bodyB.anglePrev-=Vector.cross(offsetB,impulse)*bodyB.inverseInertia)}}}}},{"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],11:[function(_dereq_,module,exports){var SAT={};module.exports=SAT;var Vertices=_dereq_("../geometry/Vertices"),Vector=_dereq_("../geometry/Vector");SAT.collides=function(bodyA,bodyB,previousCollision){var overlapAB,overlapBA,minOverlap,collision,canReusePrevCol=!1;if(previousCollision){var parentA=bodyA.parent,parentB=bodyB.parent,motion=parentA.speed*parentA.speed+parentA.angularSpeed*parentA.angularSpeed+parentB.speed*parentB.speed+parentB.angularSpeed*parentB.angularSpeed;canReusePrevCol=previousCollision&&previousCollision.collided&&motion<.2,collision=previousCollision}else collision={collided:!1,bodyA:bodyA,bodyB:bodyB};if(previousCollision&&canReusePrevCol){var axisBodyA=collision.axisBody,axisBodyB=axisBodyA===bodyA?bodyB:bodyA,axes=[axisBodyA.axes[previousCollision.axisNumber]];if(minOverlap=SAT._overlapAxes(axisBodyA.vertices,axisBodyB.vertices,axes),collision.reused=!0,minOverlap.overlap<=0)return collision.collided=!1,collision}else{if((overlapAB=SAT._overlapAxes(bodyA.vertices,bodyB.vertices,bodyA.axes)).overlap<=0)return collision.collided=!1,collision;if((overlapBA=SAT._overlapAxes(bodyB.vertices,bodyA.vertices,bodyB.axes)).overlap<=0)return collision.collided=!1,collision;overlapAB.overlap<overlapBA.overlap?(minOverlap=overlapAB,collision.axisBody=bodyA):(minOverlap=overlapBA,collision.axisBody=bodyB),collision.axisNumber=minOverlap.axisNumber}collision.bodyA=bodyA.id<bodyB.id?bodyA:bodyB,collision.bodyB=bodyA.id<bodyB.id?bodyB:bodyA,collision.collided=!0,collision.depth=minOverlap.overlap,collision.parentA=collision.bodyA.parent,collision.parentB=collision.bodyB.parent,bodyA=collision.bodyA,bodyB=collision.bodyB,Vector.dot(minOverlap.axis,Vector.sub(bodyB.position,bodyA.position))<0?collision.normal={x:minOverlap.axis.x,y:minOverlap.axis.y}:collision.normal={x:-minOverlap.axis.x,y:-minOverlap.axis.y},collision.tangent=Vector.perp(collision.normal),collision.penetration=collision.penetration||{},collision.penetration.x=collision.normal.x*collision.depth,collision.penetration.y=collision.normal.y*collision.depth;var verticesB=SAT._findSupports(bodyA,bodyB,collision.normal),supports=[];if(Vertices.contains(bodyA.vertices,verticesB[0])&&supports.push(verticesB[0]),Vertices.contains(bodyA.vertices,verticesB[1])&&supports.push(verticesB[1]),supports.length<2){var verticesA=SAT._findSupports(bodyB,bodyA,Vector.neg(collision.normal));Vertices.contains(bodyB.vertices,verticesA[0])&&supports.push(verticesA[0]),supports.length<2&&Vertices.contains(bodyB.vertices,verticesA[1])&&supports.push(verticesA[1])}return supports.length<1&&(supports=[verticesB[0]]),collision.supports=supports,collision},SAT._overlapAxes=function(verticesA,verticesB,axes){for(var overlap,axis,projectionA=Vector._temp[0],projectionB=Vector._temp[1],result={overlap:Number.MAX_VALUE},i=0;i<axes.length;i++){if(axis=axes[i],SAT._projectToAxis(projectionA,verticesA,axis),SAT._projectToAxis(projectionB,verticesB,axis),(overlap=Math.min(projectionA.max-projectionB.min,projectionB.max-projectionA.min))<=0)return result.overlap=overlap,result;overlap<result.overlap&&(result.overlap=overlap,result.axis=axis,result.axisNumber=i)}return result},SAT._projectToAxis=function(projection,vertices,axis){for(var min=Vector.dot(vertices[0],axis),max=min,i=1;i<vertices.length;i+=1){var dot=Vector.dot(vertices[i],axis);dot>max?max=dot:dot<min&&(min=dot)}projection.min=min,projection.max=max},SAT._findSupports=function(bodyA,bodyB,normal){for(var distance,vertex,vertexA,vertexB,nearestDistance=Number.MAX_VALUE,vertexToBody=Vector._temp[0],vertices=bodyB.vertices,bodyAPosition=bodyA.position,i=0;i<vertices.length;i++)vertex=vertices[i],vertexToBody.x=vertex.x-bodyAPosition.x,vertexToBody.y=vertex.y-bodyAPosition.y,(distance=-Vector.dot(normal,vertexToBody))<nearestDistance&&(nearestDistance=distance,vertexA=vertex);return vertex=vertices[vertexA.index-1>=0?vertexA.index-1:vertices.length-1],vertexToBody.x=vertex.x-bodyAPosition.x,vertexToBody.y=vertex.y-bodyAPosition.y,nearestDistance=-Vector.dot(normal,vertexToBody),vertexB=vertex,vertex=vertices[(vertexA.index+1)%vertices.length],vertexToBody.x=vertex.x-bodyAPosition.x,vertexToBody.y=vertex.y-bodyAPosition.y,(distance=-Vector.dot(normal,vertexToBody))<nearestDistance&&(vertexB=vertex),[vertexA,vertexB]}},{"../geometry/Vector":28,"../geometry/Vertices":29}],12:[function(_dereq_,module,exports){var Constraint={};module.exports=Constraint;var Vertices=_dereq_("../geometry/Vertices"),Vector=_dereq_("../geometry/Vector"),Sleeping=_dereq_("../core/Sleeping"),Bounds=_dereq_("../geometry/Bounds"),Axes=_dereq_("../geometry/Axes"),Common=_dereq_("../core/Common");Constraint._warming=.4,Constraint._torqueDampen=1,Constraint._minLength=1e-6,Constraint.create=function(options){var constraint=options;constraint.bodyA&&!constraint.pointA&&(constraint.pointA={x:0,y:0}),constraint.bodyB&&!constraint.pointB&&(constraint.pointB={x:0,y:0});var initialPointA=constraint.bodyA?Vector.add(constraint.bodyA.position,constraint.pointA):constraint.pointA,initialPointB=constraint.bodyB?Vector.add(constraint.bodyB.position,constraint.pointB):constraint.pointB,length=Vector.magnitude(Vector.sub(initialPointA,initialPointB));constraint.length=void 0!==constraint.length?constraint.length:length,constraint.id=constraint.id||Common.nextId(),constraint.label=constraint.label||"Constraint",constraint.type="constraint",constraint.stiffness=constraint.stiffness||(constraint.length>0?1:.7),constraint.damping=constraint.damping||0,constraint.angularStiffness=constraint.angularStiffness||0,constraint.angleA=constraint.bodyA?constraint.bodyA.angle:constraint.angleA,constraint.angleB=constraint.bodyB?constraint.bodyB.angle:constraint.angleB,constraint.plugin={};var render={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===constraint.length&&constraint.stiffness>.1?(render.type="pin",render.anchors=!1):constraint.stiffness<.9&&(render.type="spring"),constraint.render=Common.extend(render,constraint.render),constraint},Constraint.preSolveAll=function(bodies){for(var i=0;i<bodies.length;i+=1){var body=bodies[i],impulse=body.constraintImpulse;body.isStatic||0===impulse.x&&0===impulse.y&&0===impulse.angle||(body.position.x+=impulse.x,body.position.y+=impulse.y,body.angle+=impulse.angle)}},Constraint.solveAll=function(constraints,timeScale){for(var i=0;i<constraints.length;i+=1){var constraint=constraints[i],fixedA=!constraint.bodyA||constraint.bodyA&&constraint.bodyA.isStatic,fixedB=!constraint.bodyB||constraint.bodyB&&constraint.bodyB.isStatic;(fixedA||fixedB)&&Constraint.solve(constraints[i],timeScale)}for(i=0;i<constraints.length;i+=1)fixedA=!(constraint=constraints[i]).bodyA||constraint.bodyA&&constraint.bodyA.isStatic,fixedB=!constraint.bodyB||constraint.bodyB&&constraint.bodyB.isStatic,fixedA||fixedB||Constraint.solve(constraints[i],timeScale)},Constraint.solve=function(constraint,timeScale){var bodyA=constraint.bodyA,bodyB=constraint.bodyB,pointA=constraint.pointA,pointB=constraint.pointB;if(bodyA||bodyB){bodyA&&!bodyA.isStatic&&(Vector.rotate(pointA,bodyA.angle-constraint.angleA,pointA),constraint.angleA=bodyA.angle),bodyB&&!bodyB.isStatic&&(Vector.rotate(pointB,bodyB.angle-constraint.angleB,pointB),constraint.angleB=bodyB.angle);var pointAWorld=pointA,pointBWorld=pointB;if(bodyA&&(pointAWorld=Vector.add(bodyA.position,pointA)),bodyB&&(pointBWorld=Vector.add(bodyB.position,pointB)),pointAWorld&&pointBWorld){var delta=Vector.sub(pointAWorld,pointBWorld),currentLength=Vector.magnitude(delta);currentLength<Constraint._minLength&&(currentLength=Constraint._minLength);var torque,share,normal,normalVelocity,relativeVelocity,difference=(currentLength-constraint.length)/currentLength,stiffness=constraint.stiffness<1?constraint.stiffness*timeScale:constraint.stiffness,force=Vector.mult(delta,difference*stiffness),massTotal=(bodyA?bodyA.inverseMass:0)+(bodyB?bodyB.inverseMass:0),resistanceTotal=massTotal+((bodyA?bodyA.inverseInertia:0)+(bodyB?bodyB.inverseInertia:0));if(constraint.damping){var zero=Vector.create();normal=Vector.div(delta,currentLength),relativeVelocity=Vector.sub(bodyB&&Vector.sub(bodyB.position,bodyB.positionPrev)||zero,bodyA&&Vector.sub(bodyA.position,bodyA.positionPrev)||zero),normalVelocity=Vector.dot(normal,relativeVelocity)}bodyA&&!bodyA.isStatic&&(share=bodyA.inverseMass/massTotal,bodyA.constraintImpulse.x-=force.x*share,bodyA.constraintImpulse.y-=force.y*share,bodyA.position.x-=force.x*share,bodyA.position.y-=force.y*share,constraint.damping&&(bodyA.positionPrev.x-=constraint.damping*normal.x*normalVelocity*share,bodyA.positionPrev.y-=constraint.damping*normal.y*normalVelocity*share),torque=Vector.cross(pointA,force)/resistanceTotal*Constraint._torqueDampen*bodyA.inverseInertia*(1-constraint.angularStiffness),bodyA.constraintImpulse.angle-=torque,bodyA.angle-=torque),bodyB&&!bodyB.isStatic&&(share=bodyB.inverseMass/massTotal,bodyB.constraintImpulse.x+=force.x*share,bodyB.constraintImpulse.y+=force.y*share,bodyB.position.x+=force.x*share,bodyB.position.y+=force.y*share,constraint.damping&&(bodyB.positionPrev.x+=constraint.damping*normal.x*normalVelocity*share,bodyB.positionPrev.y+=constraint.damping*normal.y*normalVelocity*share),torque=Vector.cross(pointB,force)/resistanceTotal*Constraint._torqueDampen*bodyB.inverseInertia*(1-constraint.angularStiffness),bodyB.constraintImpulse.angle+=torque,bodyB.angle+=torque)}}},Constraint.postSolveAll=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i],impulse=body.constraintImpulse;if(!(body.isStatic||0===impulse.x&&0===impulse.y&&0===impulse.angle)){Sleeping.set(body,!1);for(var j=0;j<body.parts.length;j++){var part=body.parts[j];Vertices.translate(part.vertices,impulse),j>0&&(part.position.x+=impulse.x,part.position.y+=impulse.y),0!==impulse.angle&&(Vertices.rotate(part.vertices,impulse.angle,body.position),Axes.rotate(part.axes,impulse.angle),j>0&&Vector.rotateAbout(part.position,impulse.angle,body.position,part.position)),Bounds.update(part.bounds,part.vertices,body.velocity)}impulse.angle*=Constraint._warming,impulse.x*=Constraint._warming,impulse.y*=Constraint._warming}}}},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],13:[function(_dereq_,module,exports){var MouseConstraint={};module.exports=MouseConstraint;var Vertices=_dereq_("../geometry/Vertices"),Sleeping=_dereq_("../core/Sleeping"),Mouse=_dereq_("../core/Mouse"),Events=_dereq_("../core/Events"),Detector=_dereq_("../collision/Detector"),Constraint=_dereq_("./Constraint"),Composite=_dereq_("../body/Composite"),Common=_dereq_("../core/Common"),Bounds=_dereq_("../geometry/Bounds");MouseConstraint.create=function(engine,options){var mouse=(engine?engine.mouse:null)||(options?options.mouse:null);mouse||(engine&&engine.render&&engine.render.canvas?mouse=Mouse.create(engine.render.canvas):options&&options.element?mouse=Mouse.create(options.element):(mouse=Mouse.create(),Common.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var defaults={type:"mouseConstraint",mouse:mouse,element:null,body:null,constraint:Constraint.create({label:"Mouse Constraint",pointA:mouse.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},mouseConstraint=Common.extend(defaults,options);return Events.on(engine,"beforeUpdate",function(){var allBodies=Composite.allBodies(engine.world);MouseConstraint.update(mouseConstraint,allBodies),MouseConstraint._triggerEvents(mouseConstraint)}),mouseConstraint},MouseConstraint.update=function(mouseConstraint,bodies){var mouse=mouseConstraint.mouse,constraint=mouseConstraint.constraint,body=mouseConstraint.body;if(0===mouse.button){if(constraint.bodyB)Sleeping.set(constraint.bodyB,!1),constraint.pointA=mouse.position;else for(var i=0;i<bodies.length;i++)if(body=bodies[i],Bounds.contains(body.bounds,mouse.position)&&Detector.canCollide(body.collisionFilter,mouseConstraint.collisionFilter))for(var j=body.parts.length>1?1:0;j<body.parts.length;j++){var part=body.parts[j];if(Vertices.contains(part.vertices,mouse.position)){constraint.pointA=mouse.position,constraint.bodyB=mouseConstraint.body=body,constraint.pointB={x:mouse.position.x-body.position.x,y:mouse.position.y-body.position.y},constraint.angleB=body.angle,Sleeping.set(body,!1),Events.trigger(mouseConstraint,"startdrag",{mouse:mouse,body:body});break}}}else constraint.bodyB=mouseConstraint.body=null,constraint.pointB=null,body&&Events.trigger(mouseConstraint,"enddrag",{mouse:mouse,body:body})},MouseConstraint._triggerEvents=function(mouseConstraint){var mouse=mouseConstraint.mouse,mouseEvents=mouse.sourceEvents;mouseEvents.mousemove&&Events.trigger(mouseConstraint,"mousemove",{mouse:mouse}),mouseEvents.mousedown&&Events.trigger(mouseConstraint,"mousedown",{mouse:mouse}),mouseEvents.mouseup&&Events.trigger(mouseConstraint,"mouseup",{mouse:mouse}),Mouse.clearSourceEvents(mouse)}},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../core/Sleeping":22,"../geometry/Bounds":26,"../geometry/Vertices":29,"./Constraint":12}],14:[function(_dereq_,module,exports){var Common={};module.exports=Common,function(){Common._nextId=0,Common._seed=0,Common._nowStartTime=+new Date,Common.extend=function(obj,deep){var argsStart,deepClone;"boolean"==typeof deep?(argsStart=2,deepClone=deep):(argsStart=1,deepClone=!0);for(var i=argsStart;i<arguments.length;i++){var source=arguments[i];if(source)for(var prop in source)deepClone&&source[prop]&&source[prop].constructor===Object?obj[prop]&&obj[prop].constructor!==Object?obj[prop]=source[prop]:(obj[prop]=obj[prop]||{},Common.extend(obj[prop],deepClone,source[prop])):obj[prop]=source[prop]}return obj},Common.clone=function(obj,deep){return Common.extend({},deep,obj)},Common.keys=function(obj){if(Object.keys)return Object.keys(obj);var keys=[];for(var key in obj)keys.push(key);return keys},Common.values=function(obj){var values=[];if(Object.keys){for(var keys=Object.keys(obj),i=0;i<keys.length;i++)values.push(obj[keys[i]]);return values}for(var key in obj)values.push(obj[key]);return values},Common.get=function(obj,path,begin,end){path=path.split(".").slice(begin,end);for(var i=0;i<path.length;i+=1)obj=obj[path[i]];return obj},Common.set=function(obj,path,val,begin,end){var parts=path.split(".").slice(begin,end);return Common.get(obj,path,0,-1)[parts[parts.length-1]]=val,val},Common.shuffle=function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Common.random()*(i+1)),temp=array[i];array[i]=array[j],array[j]=temp}return array},Common.choose=function(choices){return choices[Math.floor(Common.random()*choices.length)]},Common.isElement=function(obj){return"undefined"!=typeof HTMLElement?obj instanceof HTMLElement:!!(obj&&obj.nodeType&&obj.nodeName)},Common.isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},Common.isFunction=function(obj){return"function"==typeof obj},Common.isPlainObject=function(obj){return"object"==typeof obj&&obj.constructor===Object},Common.isString=function(obj){return"[object String]"===toString.call(obj)},Common.clamp=function(value,min,max){return value<min?min:value>max?max:value},Common.sign=function(value){return value<0?-1:1},Common.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-Common._nowStartTime},Common.random=function(min,max){return min=void 0!==min?min:0,max=void 0!==max?max:1,min+_seededRandom()*(max-min)};var _seededRandom=function(){return Common._seed=(9301*Common._seed+49297)%233280,Common._seed/233280};Common.colorToNumber=function(colorString){return 3==(colorString=colorString.replace("#","")).length&&(colorString=colorString.charAt(0)+colorString.charAt(0)+colorString.charAt(1)+colorString.charAt(1)+colorString.charAt(2)+colorString.charAt(2)),parseInt(colorString,16)},Common.logLevel=1,Common.log=function(){console&&Common.logLevel>0&&Common.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},Common.info=function(){console&&Common.logLevel>0&&Common.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},Common.warn=function(){console&&Common.logLevel>0&&Common.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},Common.nextId=function(){return Common._nextId++},Common.indexOf=function(haystack,needle){if(haystack.indexOf)return haystack.indexOf(needle);for(var i=0;i<haystack.length;i++)if(haystack[i]===needle)return i;return-1},Common.map=function(list,func){if(list.map)return list.map(func);for(var mapped=[],i=0;i<list.length;i+=1)mapped.push(func(list[i]));return mapped},Common.topologicalSort=function(graph){var result=[],visited=[],temp=[];for(var node in graph)visited[node]||temp[node]||Common._topologicalSort(node,visited,temp,graph,result);return result},Common._topologicalSort=function(node,visited,temp,graph,result){var neighbors=graph[node]||[];temp[node]=!0;for(var i=0;i<neighbors.length;i+=1){var neighbor=neighbors[i];temp[neighbor]||(visited[neighbor]||Common._topologicalSort(neighbor,visited,temp,graph,result))}temp[node]=!1,visited[node]=!0,result.push(node)},Common.chain=function(){for(var funcs=[],i=0;i<arguments.length;i+=1){var func=arguments[i];func._chained?funcs.push.apply(funcs,func._chained):funcs.push(func)}var chain=function(){for(var lastResult,args=new Array(arguments.length),i=0,l=arguments.length;i<l;i++)args[i]=arguments[i];for(i=0;i<funcs.length;i+=1){var result=funcs[i].apply(lastResult,args);void 0!==result&&(lastResult=result)}return lastResult};return chain._chained=funcs,chain},Common.chainPathBefore=function(base,path,func){return Common.set(base,path,Common.chain(func,Common.get(base,path)))},Common.chainPathAfter=function(base,path,func){return Common.set(base,path,Common.chain(Common.get(base,path),func))}}()},{}],15:[function(_dereq_,module,exports){var Engine={};module.exports=Engine;var World=_dereq_("../body/World"),Sleeping=_dereq_("./Sleeping"),Resolver=_dereq_("../collision/Resolver"),Render=_dereq_("../render/Render"),Pairs=_dereq_("../collision/Pairs"),Grid=(_dereq_("./Metrics"),_dereq_("../collision/Grid")),Events=_dereq_("./Events"),Composite=_dereq_("../body/Composite"),Constraint=_dereq_("../constraint/Constraint"),Common=_dereq_("./Common"),Body=_dereq_("../body/Body");Engine.create=function(element,options){options=Common.isElement(element)?options:element,element=Common.isElement(element)?element:null,options=options||{},(element||options.render)&&Common.warn("Engine.create: engine.render is deprecated (see docs)");var defaults={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:Grid}},engine=Common.extend(defaults,options);if(element||engine.render){var renderDefaults={element:element,controller:Render};engine.render=Common.extend(renderDefaults,engine.render)}return engine.render&&engine.render.controller&&(engine.render=engine.render.controller.create(engine.render)),engine.render&&(engine.render.engine=engine),engine.world=options.world||World.create(engine.world),engine.pairs=Pairs.create(),engine.broadphase=engine.broadphase.controller.create(engine.broadphase),engine.metrics=engine.metrics||{extended:!1},engine},Engine.update=function(engine,delta,correction){delta=delta||1e3/60,correction=correction||1;var i,world=engine.world,timing=engine.timing,broadphase=engine.broadphase,broadphasePairs=[];timing.timestamp+=delta*timing.timeScale;var event={timestamp:timing.timestamp};Events.trigger(engine,"beforeUpdate",event);var allBodies=Composite.allBodies(world),allConstraints=Composite.allConstraints(world);for(engine.enableSleeping&&Sleeping.update(allBodies,timing.timeScale),Engine._bodiesApplyGravity(allBodies,world.gravity),Engine._bodiesUpdate(allBodies,delta,timing.timeScale,correction,world.bounds),Constraint.preSolveAll(allBodies),i=0;i<engine.constraintIterations;i++)Constraint.solveAll(allConstraints,timing.timeScale);Constraint.postSolveAll(allBodies),broadphase.controller?(world.isModified&&broadphase.controller.clear(broadphase),broadphase.controller.update(broadphase,allBodies,engine,world.isModified),broadphasePairs=broadphase.pairsList):broadphasePairs=allBodies,world.isModified&&Composite.setModified(world,!1,!1,!0);var collisions=broadphase.detector(broadphasePairs,engine),pairs=engine.pairs,timestamp=timing.timestamp;for(Pairs.update(pairs,collisions,timestamp),Pairs.removeOld(pairs,timestamp),engine.enableSleeping&&Sleeping.afterCollisions(pairs.list,timing.timeScale),pairs.collisionStart.length>0&&Events.trigger(engine,"collisionStart",{pairs:pairs.collisionStart}),Resolver.preSolvePosition(pairs.list),i=0;i<engine.positionIterations;i++)Resolver.solvePosition(pairs.list,timing.timeScale);for(Resolver.postSolvePosition(allBodies),Constraint.preSolveAll(allBodies),i=0;i<engine.constraintIterations;i++)Constraint.solveAll(allConstraints,timing.timeScale);for(Constraint.postSolveAll(allBodies),Resolver.preSolveVelocity(pairs.list),i=0;i<engine.velocityIterations;i++)Resolver.solveVelocity(pairs.list,timing.timeScale);return pairs.collisionActive.length>0&&Events.trigger(engine,"collisionActive",{pairs:pairs.collisionActive}),pairs.collisionEnd.length>0&&Events.trigger(engine,"collisionEnd",{pairs:pairs.collisionEnd}),Engine._bodiesClearForces(allBodies),Events.trigger(engine,"afterUpdate",event),engine},Engine.merge=function(engineA,engineB){if(Common.extend(engineA,engineB),engineB.world){engineA.world=engineB.world,Engine.clear(engineA);for(var bodies=Composite.allBodies(engineA.world),i=0;i<bodies.length;i++){var body=bodies[i];Sleeping.set(body,!1),body.id=Common.nextId()}}},Engine.clear=function(engine){var world=engine.world;Pairs.clear(engine.pairs);var broadphase=engine.broadphase;if(broadphase.controller){var bodies=Composite.allBodies(world);broadphase.controller.clear(broadphase),broadphase.controller.update(broadphase,bodies,engine,!0)}},Engine._bodiesClearForces=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i];body.force.x=0,body.force.y=0,body.torque=0}},Engine._bodiesApplyGravity=function(bodies,gravity){var gravityScale=void 0!==gravity.scale?gravity.scale:.001;if((0!==gravity.x||0!==gravity.y)&&0!==gravityScale)for(var i=0;i<bodies.length;i++){var body=bodies[i];body.isStatic||body.isSleeping||(body.force.y+=body.mass*gravity.y*gravityScale,body.force.x+=body.mass*gravity.x*gravityScale)}},Engine._bodiesUpdate=function(bodies,deltaTime,timeScale,correction,worldBounds){for(var i=0;i<bodies.length;i++){var body=bodies[i];body.isStatic||body.isSleeping||Body.update(body,deltaTime,timeScale,correction)}}},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":31,"./Common":14,"./Events":16,"./Metrics":18,"./Sleeping":22}],16:[function(_dereq_,module,exports){var Events={};module.exports=Events;var Common=_dereq_("./Common");Events.on=function(object,eventNames,callback){for(var name,names=eventNames.split(" "),i=0;i<names.length;i++)name=names[i],object.events=object.events||{},object.events[name]=object.events[name]||[],object.events[name].push(callback);return callback},Events.off=function(object,eventNames,callback){if(eventNames){"function"==typeof eventNames&&(callback=eventNames,eventNames=Common.keys(object.events).join(" "));for(var names=eventNames.split(" "),i=0;i<names.length;i++){var callbacks=object.events[names[i]],newCallbacks=[];if(callback&&callbacks)for(var j=0;j<callbacks.length;j++)callbacks[j]!==callback&&newCallbacks.push(callbacks[j]);object.events[names[i]]=newCallbacks}}else object.events={}},Events.trigger=function(object,eventNames,event){var names,name,callbacks,eventClone;if(object.events){event||(event={}),names=eventNames.split(" ");for(var i=0;i<names.length;i++)if(name=names[i],callbacks=object.events[name]){(eventClone=Common.clone(event,!1)).name=name,eventClone.source=object;for(var j=0;j<callbacks.length;j++)callbacks[j].apply(object,[eventClone])}}}},{"./Common":14}],17:[function(_dereq_,module,exports){var Matter={};module.exports=Matter;var Plugin=_dereq_("./Plugin"),Common=_dereq_("./Common");Matter.name="matter-js",Matter.version="0.14.1",Matter.uses=[],Matter.used=[],Matter.use=function(){Plugin.use(Matter,Array.prototype.slice.call(arguments))},Matter.before=function(path,func){return path=path.replace(/^Matter./,""),Common.chainPathBefore(Matter,path,func)},Matter.after=function(path,func){return path=path.replace(/^Matter./,""),Common.chainPathAfter(Matter,path,func)}},{"./Common":14,"./Plugin":20}],18:[function(_dereq_,module,exports){},{"../body/Composite":2,"./Common":14}],19:[function(_dereq_,module,exports){var Mouse={};module.exports=Mouse;var Common=_dereq_("../core/Common");Mouse.create=function(element){var mouse={};return element||Common.log("Mouse.create: element was undefined, defaulting to document.body","warn"),mouse.element=element||document.body,mouse.absolute={x:0,y:0},mouse.position={x:0,y:0},mouse.mousedownPosition={x:0,y:0},mouse.mouseupPosition={x:0,y:0},mouse.offset={x:0,y:0},mouse.scale={x:1,y:1},mouse.wheelDelta=0,mouse.button=-1,mouse.pixelRatio=mouse.element.getAttribute("data-pixel-ratio")||1,mouse.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},mouse.mousemove=function(event){var position=Mouse._getRelativeMousePosition(event,mouse.element,mouse.pixelRatio);event.changedTouches&&(mouse.button=0,event.preventDefault()),mouse.absolute.x=position.x,mouse.absolute.y=position.y,mouse.position.x=mouse.absolute.x*mouse.scale.x+mouse.offset.x,mouse.position.y=mouse.absolute.y*mouse.scale.y+mouse.offset.y,mouse.sourceEvents.mousemove=event},mouse.mousedown=function(event){var position=Mouse._getRelativeMousePosition(event,mouse.element,mouse.pixelRatio);event.changedTouches?(mouse.button=0,event.preventDefault()):mouse.button=event.button,mouse.absolute.x=position.x,mouse.absolute.y=position.y,mouse.position.x=mouse.absolute.x*mouse.scale.x+mouse.offset.x,mouse.position.y=mouse.absolute.y*mouse.scale.y+mouse.offset.y,mouse.mousedownPosition.x=mouse.position.x,mouse.mousedownPosition.y=mouse.position.y,mouse.sourceEvents.mousedown=event},mouse.mouseup=function(event){var position=Mouse._getRelativeMousePosition(event,mouse.element,mouse.pixelRatio);event.changedTouches&&event.preventDefault(),mouse.button=-1,mouse.absolute.x=position.x,mouse.absolute.y=position.y,mouse.position.x=mouse.absolute.x*mouse.scale.x+mouse.offset.x,mouse.position.y=mouse.absolute.y*mouse.scale.y+mouse.offset.y,mouse.mouseupPosition.x=mouse.position.x,mouse.mouseupPosition.y=mouse.position.y,mouse.sourceEvents.mouseup=event},mouse.mousewheel=function(event){mouse.wheelDelta=Math.max(-1,Math.min(1,event.wheelDelta||-event.detail)),event.preventDefault()},Mouse.setElement(mouse,mouse.element),mouse},Mouse.setElement=function(mouse,element){mouse.element=element,element.addEventListener("mousemove",mouse.mousemove),element.addEventListener("mousedown",mouse.mousedown),element.addEventListener("mouseup",mouse.mouseup),element.addEventListener("mousewheel",mouse.mousewheel),element.addEventListener("DOMMouseScroll",mouse.mousewheel),element.addEventListener("touchmove",mouse.mousemove),element.addEventListener("touchstart",mouse.mousedown),element.addEventListener("touchend",mouse.mouseup)},Mouse.clearSourceEvents=function(mouse){mouse.sourceEvents.mousemove=null,mouse.sourceEvents.mousedown=null,mouse.sourceEvents.mouseup=null,mouse.sourceEvents.mousewheel=null,mouse.wheelDelta=0},Mouse.setOffset=function(mouse,offset){mouse.offset.x=offset.x,mouse.offset.y=offset.y,mouse.position.x=mouse.absolute.x*mouse.scale.x+mouse.offset.x,mouse.position.y=mouse.absolute.y*mouse.scale.y+mouse.offset.y},Mouse.setScale=function(mouse,scale){mouse.scale.x=scale.x,mouse.scale.y=scale.y,mouse.position.x=mouse.absolute.x*mouse.scale.x+mouse.offset.x,mouse.position.y=mouse.absolute.y*mouse.scale.y+mouse.offset.y},Mouse._getRelativeMousePosition=function(event,element,pixelRatio){var x,y,elementBounds=element.getBoundingClientRect(),rootNode=document.documentElement||document.body.parentNode||document.body,scrollX=void 0!==window.pageXOffset?window.pageXOffset:rootNode.scrollLeft,scrollY=void 0!==window.pageYOffset?window.pageYOffset:rootNode.scrollTop,touches=event.changedTouches;return touches?(x=touches[0].pageX-elementBounds.left-scrollX,y=touches[0].pageY-elementBounds.top-scrollY):(x=event.pageX-elementBounds.left-scrollX,y=event.pageY-elementBounds.top-scrollY),{x:x/(element.clientWidth/(element.width||element.clientWidth)*pixelRatio),y:y/(element.clientHeight/(element.height||element.clientHeight)*pixelRatio)}}},{"../core/Common":14}],20:[function(_dereq_,module,exports){var Plugin={};module.exports=Plugin;var Common=_dereq_("./Common");Plugin._registry={},Plugin.register=function(plugin){if(Plugin.isPlugin(plugin)||Common.warn("Plugin.register:",Plugin.toString(plugin),"does not implement all required fields."),plugin.name in Plugin._registry){var registered=Plugin._registry[plugin.name],pluginVersion=Plugin.versionParse(plugin.version).number,registeredVersion=Plugin.versionParse(registered.version).number;pluginVersion>registeredVersion?(Common.warn("Plugin.register:",Plugin.toString(registered),"was upgraded to",Plugin.toString(plugin)),Plugin._registry[plugin.name]=plugin):pluginVersion<registeredVersion?Common.warn("Plugin.register:",Plugin.toString(registered),"can not be downgraded to",Plugin.toString(plugin)):plugin!==registered&&Common.warn("Plugin.register:",Plugin.toString(plugin),"is already registered to different plugin object")}else Plugin._registry[plugin.name]=plugin;return plugin},Plugin.resolve=function(dependency){return Plugin._registry[Plugin.dependencyParse(dependency).name]},Plugin.toString=function(plugin){return"string"==typeof plugin?plugin:(plugin.name||"anonymous")+"@"+(plugin.version||plugin.range||"0.0.0")},Plugin.isPlugin=function(obj){return obj&&obj.name&&obj.version&&obj.install},Plugin.isUsed=function(module,name){return module.used.indexOf(name)>-1},Plugin.isFor=function(plugin,module){var parsed=plugin.for&&Plugin.dependencyParse(plugin.for);return!plugin.for||module.name===parsed.name&&Plugin.versionSatisfies(module.version,parsed.range)},Plugin.use=function(module,plugins){if(module.uses=(module.uses||[]).concat(plugins||[]),0!==module.uses.length){for(var dependencies=Plugin.dependencies(module),sortedDependencies=Common.topologicalSort(dependencies),status=[],i=0;i<sortedDependencies.length;i+=1)if(sortedDependencies[i]!==module.name){var plugin=Plugin.resolve(sortedDependencies[i]);plugin?Plugin.isUsed(module,plugin.name)||(Plugin.isFor(plugin,module)||(Common.warn("Plugin.use:",Plugin.toString(plugin),"is for",plugin.for,"but installed on",Plugin.toString(module)+"."),plugin._warned=!0),plugin.install?plugin.install(module):(Common.warn("Plugin.use:",Plugin.toString(plugin),"does not specify an install function."),plugin._warned=!0),plugin._warned?(status.push("🔶 "+Plugin.toString(plugin)),delete plugin._warned):status.push("✅ "+Plugin.toString(plugin)),module.used.push(plugin.name)):status.push("❌ "+sortedDependencies[i])}status.length>0&&Common.info(status.join("  "))}else Common.warn("Plugin.use:",Plugin.toString(module),"does not specify any dependencies to install.")},Plugin.dependencies=function(module,tracked){var parsedBase=Plugin.dependencyParse(module),name=parsedBase.name;if(!(name in(tracked=tracked||{}))){module=Plugin.resolve(module)||module,tracked[name]=Common.map(module.uses||[],function(dependency){Plugin.isPlugin(dependency)&&Plugin.register(dependency);var parsed=Plugin.dependencyParse(dependency),resolved=Plugin.resolve(dependency);return resolved&&!Plugin.versionSatisfies(resolved.version,parsed.range)?(Common.warn("Plugin.dependencies:",Plugin.toString(resolved),"does not satisfy",Plugin.toString(parsed),"used by",Plugin.toString(parsedBase)+"."),resolved._warned=!0,module._warned=!0):resolved||(Common.warn("Plugin.dependencies:",Plugin.toString(dependency),"used by",Plugin.toString(parsedBase),"could not be resolved."),module._warned=!0),parsed.name});for(var i=0;i<tracked[name].length;i+=1)Plugin.dependencies(tracked[name][i],tracked);return tracked}},Plugin.dependencyParse=function(dependency){return Common.isString(dependency)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/.test(dependency)||Common.warn("Plugin.dependencyParse:",dependency,"is not a valid dependency string."),{name:dependency.split("@")[0],range:dependency.split("@")[1]||"*"}):{name:dependency.name,range:dependency.range||dependency.version}},Plugin.versionParse=function(range){/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/.test(range)||Common.warn("Plugin.versionParse:",range,"is not a valid version or range.");var identifiers=range.split("-");range=identifiers[0];var isRange=isNaN(Number(range[0])),version=isRange?range.substr(1):range,parts=Common.map(version.split("."),function(part){return Number(part)});return{isRange:isRange,version:version,range:range,operator:isRange?range[0]:"",parts:parts,prerelease:identifiers[1],number:1e8*parts[0]+1e4*parts[1]+parts[2]}},Plugin.versionSatisfies=function(version,range){range=range||"*";var rangeParsed=Plugin.versionParse(range),rangeParts=rangeParsed.parts,versionParsed=Plugin.versionParse(version),versionParts=versionParsed.parts;if(rangeParsed.isRange){if("*"===rangeParsed.operator||"*"===version)return!0;if("~"===rangeParsed.operator)return versionParts[0]===rangeParts[0]&&versionParts[1]===rangeParts[1]&&versionParts[2]>=rangeParts[2];if("^"===rangeParsed.operator)return rangeParts[0]>0?versionParts[0]===rangeParts[0]&&versionParsed.number>=rangeParsed.number:rangeParts[1]>0?versionParts[1]===rangeParts[1]&&versionParts[2]>=rangeParts[2]:versionParts[2]===rangeParts[2]}return version===range||"*"===version}},{"./Common":14}],21:[function(_dereq_,module,exports){var Runner={};module.exports=Runner;var Events=_dereq_("./Events"),Engine=_dereq_("./Engine"),Common=_dereq_("./Common");!function(){var _requestAnimationFrame,_cancelAnimationFrame,_frameTimeout;("undefined"!=typeof window&&(_requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,_cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),_requestAnimationFrame)||(_requestAnimationFrame=function(callback){_frameTimeout=setTimeout(function(){callback(Common.now())},1e3/60)},_cancelAnimationFrame=function(){clearTimeout(_frameTimeout)});Runner.create=function(options){var runner=Common.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},options);return runner.delta=runner.delta||1e3/runner.fps,runner.deltaMin=runner.deltaMin||1e3/runner.fps,runner.deltaMax=runner.deltaMax||1e3/(.5*runner.fps),runner.fps=1e3/runner.delta,runner},Runner.run=function(runner,engine){return void 0!==runner.positionIterations&&(engine=runner,runner=Runner.create()),function render(time){runner.frameRequestId=_requestAnimationFrame(render),time&&runner.enabled&&Runner.tick(runner,engine,time)}(),runner},Runner.tick=function(runner,engine,time){var delta,timing=engine.timing,correction=1,event={timestamp:timing.timestamp};Events.trigger(runner,"beforeTick",event),Events.trigger(engine,"beforeTick",event),runner.isFixed?delta=runner.delta:(delta=time-runner.timePrev||runner.delta,runner.timePrev=time,runner.deltaHistory.push(delta),runner.deltaHistory=runner.deltaHistory.slice(-runner.deltaSampleSize),correction=(delta=(delta=(delta=Math.min.apply(null,runner.deltaHistory))<runner.deltaMin?runner.deltaMin:delta)>runner.deltaMax?runner.deltaMax:delta)/runner.delta,runner.delta=delta),0!==runner.timeScalePrev&&(correction*=timing.timeScale/runner.timeScalePrev),0===timing.timeScale&&(correction=0),runner.timeScalePrev=timing.timeScale,runner.correction=correction,runner.frameCounter+=1,time-runner.counterTimestamp>=1e3&&(runner.fps=runner.frameCounter*((time-runner.counterTimestamp)/1e3),runner.counterTimestamp=time,runner.frameCounter=0),Events.trigger(runner,"tick",event),Events.trigger(engine,"tick",event),engine.world.isModified&&engine.render&&engine.render.controller&&engine.render.controller.clear&&engine.render.controller.clear(engine.render),Events.trigger(runner,"beforeUpdate",event),Engine.update(engine,delta,correction),Events.trigger(runner,"afterUpdate",event),engine.render&&engine.render.controller&&(Events.trigger(runner,"beforeRender",event),Events.trigger(engine,"beforeRender",event),engine.render.controller.world(engine.render),Events.trigger(runner,"afterRender",event),Events.trigger(engine,"afterRender",event)),Events.trigger(runner,"afterTick",event),Events.trigger(engine,"afterTick",event)},Runner.stop=function(runner){_cancelAnimationFrame(runner.frameRequestId)},Runner.start=function(runner,engine){Runner.run(runner,engine)}}()},{"./Common":14,"./Engine":15,"./Events":16}],22:[function(_dereq_,module,exports){var Sleeping={};module.exports=Sleeping;var Events=_dereq_("./Events");Sleeping._motionWakeThreshold=.18,Sleeping._motionSleepThreshold=.08,Sleeping._minBias=.9,Sleeping.update=function(bodies,timeScale){for(var timeFactor=timeScale*timeScale*timeScale,i=0;i<bodies.length;i++){var body=bodies[i],motion=body.speed*body.speed+body.angularSpeed*body.angularSpeed;if(0===body.force.x&&0===body.force.y){var minMotion=Math.min(body.motion,motion),maxMotion=Math.max(body.motion,motion);body.motion=Sleeping._minBias*minMotion+(1-Sleeping._minBias)*maxMotion,body.sleepThreshold>0&&body.motion<Sleeping._motionSleepThreshold*timeFactor?(body.sleepCounter+=1,body.sleepCounter>=body.sleepThreshold&&Sleeping.set(body,!0)):body.sleepCounter>0&&(body.sleepCounter-=1)}else Sleeping.set(body,!1)}},Sleeping.afterCollisions=function(pairs,timeScale){for(var timeFactor=timeScale*timeScale*timeScale,i=0;i<pairs.length;i++){var pair=pairs[i];if(pair.isActive){var collision=pair.collision,bodyA=collision.bodyA.parent,bodyB=collision.bodyB.parent;if(!(bodyA.isSleeping&&bodyB.isSleeping||bodyA.isStatic||bodyB.isStatic)&&(bodyA.isSleeping||bodyB.isSleeping)){var sleepingBody=bodyA.isSleeping&&!bodyA.isStatic?bodyA:bodyB,movingBody=sleepingBody===bodyA?bodyB:bodyA;!sleepingBody.isStatic&&movingBody.motion>Sleeping._motionWakeThreshold*timeFactor&&Sleeping.set(sleepingBody,!1)}}}},Sleeping.set=function(body,isSleeping){var wasSleeping=body.isSleeping;isSleeping?(body.isSleeping=!0,body.sleepCounter=body.sleepThreshold,body.positionImpulse.x=0,body.positionImpulse.y=0,body.positionPrev.x=body.position.x,body.positionPrev.y=body.position.y,body.anglePrev=body.angle,body.speed=0,body.angularSpeed=0,body.motion=0,wasSleeping||Events.trigger(body,"sleepStart")):(body.isSleeping=!1,body.sleepCounter=0,wasSleeping&&Events.trigger(body,"sleepEnd"))}},{"./Events":16}],23:[function(_dereq_,module,exports){(function(global){var Bodies={};module.exports=Bodies;var Vertices=_dereq_("../geometry/Vertices"),Common=_dereq_("../core/Common"),Body=_dereq_("../body/Body"),Bounds=_dereq_("../geometry/Bounds"),Vector=_dereq_("../geometry/Vector"),decomp="undefined"!=typeof window?window.decomp:void 0!==global?global.decomp:null;Bodies.rectangle=function(x,y,width,height,options){options=options||{};var rectangle={label:"Rectangle Body",position:{x:x,y:y},vertices:Vertices.fromPath("L 0 0 L "+width+" 0 L "+width+" "+height+" L 0 "+height)};if(options.chamfer){var chamfer=options.chamfer;rectangle.vertices=Vertices.chamfer(rectangle.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax),delete options.chamfer}return Body.create(Common.extend({},rectangle,options))},Bodies.trapezoid=function(x,y,width,height,slope,options){options=options||{};var verticesPath,x1=width*(slope*=.5),x2=x1+(1-2*slope)*width,x3=x2+x1;verticesPath=slope<.5?"L 0 0 L "+x1+" "+-height+" L "+x2+" "+-height+" L "+x3+" 0":"L 0 0 L "+x2+" "+-height+" L "+x3+" 0";var trapezoid={label:"Trapezoid Body",position:{x:x,y:y},vertices:Vertices.fromPath(verticesPath)};if(options.chamfer){var chamfer=options.chamfer;trapezoid.vertices=Vertices.chamfer(trapezoid.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax),delete options.chamfer}return Body.create(Common.extend({},trapezoid,options))},Bodies.circle=function(x,y,radius,options,maxSides){options=options||{};var circle={label:"Circle Body",circleRadius:radius};maxSides=maxSides||25;var sides=Math.ceil(Math.max(10,Math.min(maxSides,radius)));return sides%2==1&&(sides+=1),Bodies.polygon(x,y,sides,radius,Common.extend({},circle,options))},Bodies.polygon=function(x,y,sides,radius,options){if(options=options||{},sides<3)return Bodies.circle(x,y,radius,options);for(var theta=2*Math.PI/sides,path="",offset=.5*theta,i=0;i<sides;i+=1){var angle=offset+i*theta,xx=Math.cos(angle)*radius,yy=Math.sin(angle)*radius;path+="L "+xx.toFixed(3)+" "+yy.toFixed(3)+" "}var polygon={label:"Polygon Body",position:{x:x,y:y},vertices:Vertices.fromPath(path)};if(options.chamfer){var chamfer=options.chamfer;polygon.vertices=Vertices.chamfer(polygon.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax),delete options.chamfer}return Body.create(Common.extend({},polygon,options))},Bodies.fromVertices=function(x,y,vertexSets,options,flagInternal,removeCollinear,minimumArea){var body,parts,isConvex,vertices,i,j,k,v,z;for(options=options||{},parts=[],flagInternal=void 0!==flagInternal&&flagInternal,removeCollinear=void 0!==removeCollinear?removeCollinear:.01,minimumArea=void 0!==minimumArea?minimumArea:10,decomp||Common.warn("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull."),Common.isArray(vertexSets[0])||(vertexSets=[vertexSets]),v=0;v<vertexSets.length;v+=1)if(vertices=vertexSets[v],(isConvex=Vertices.isConvex(vertices))||!decomp)vertices=isConvex?Vertices.clockwiseSort(vertices):Vertices.hull(vertices),parts.push({position:{x:x,y:y},vertices:vertices});else{var concave=vertices.map(function(vertex){return[vertex.x,vertex.y]});decomp.makeCCW(concave),!1!==removeCollinear&&decomp.removeCollinearPoints(concave,removeCollinear);var decomposed=decomp.quickDecomp(concave);for(i=0;i<decomposed.length;i++){var chunkVertices=decomposed[i].map(function(vertices){return{x:vertices[0],y:vertices[1]}});minimumArea>0&&Vertices.area(chunkVertices)<minimumArea||parts.push({position:Vertices.centre(chunkVertices),vertices:chunkVertices})}}for(i=0;i<parts.length;i++)parts[i]=Body.create(Common.extend(parts[i],options));if(flagInternal)for(i=0;i<parts.length;i++){var partA=parts[i];for(j=i+1;j<parts.length;j++){var partB=parts[j];if(Bounds.overlaps(partA.bounds,partB.bounds)){var pav=partA.vertices,pbv=partB.vertices;for(k=0;k<partA.vertices.length;k++)for(z=0;z<partB.vertices.length;z++){var da=Vector.magnitudeSquared(Vector.sub(pav[(k+1)%pav.length],pbv[z])),db=Vector.magnitudeSquared(Vector.sub(pav[k],pbv[(z+1)%pbv.length]));da<5&&db<5&&(pav[k].isInternal=!0,pbv[z].isInternal=!0)}}}}return parts.length>1?(body=Body.create(Common.extend({parts:parts.slice(0)},options)),Body.setPosition(body,{x:x,y:y}),body):parts[0]}}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],24:[function(_dereq_,module,exports){var Composites={};module.exports=Composites;var Composite=_dereq_("../body/Composite"),Constraint=_dereq_("../constraint/Constraint"),Common=_dereq_("../core/Common"),Body=_dereq_("../body/Body"),Bodies=_dereq_("./Bodies");Composites.stack=function(xx,yy,columns,rows,columnGap,rowGap,callback){for(var lastBody,stack=Composite.create({label:"Stack"}),x=xx,y=yy,i=0,row=0;row<rows;row++){for(var maxHeight=0,column=0;column<columns;column++){var body=callback(x,y,column,row,lastBody,i);if(body){var bodyHeight=body.bounds.max.y-body.bounds.min.y,bodyWidth=body.bounds.max.x-body.bounds.min.x;bodyHeight>maxHeight&&(maxHeight=bodyHeight),Body.translate(body,{x:.5*bodyWidth,y:.5*bodyHeight}),x=body.bounds.max.x+columnGap,Composite.addBody(stack,body),lastBody=body,i+=1}else x+=columnGap}y+=maxHeight+rowGap,x=xx}return stack},Composites.chain=function(composite,xOffsetA,yOffsetA,xOffsetB,yOffsetB,options){for(var bodies=composite.bodies,i=1;i<bodies.length;i++){var bodyA=bodies[i-1],bodyB=bodies[i],bodyAHeight=bodyA.bounds.max.y-bodyA.bounds.min.y,bodyAWidth=bodyA.bounds.max.x-bodyA.bounds.min.x,bodyBHeight=bodyB.bounds.max.y-bodyB.bounds.min.y,defaults={bodyA:bodyA,pointA:{x:bodyAWidth*xOffsetA,y:bodyAHeight*yOffsetA},bodyB:bodyB,pointB:{x:(bodyB.bounds.max.x-bodyB.bounds.min.x)*xOffsetB,y:bodyBHeight*yOffsetB}},constraint=Common.extend(defaults,options);Composite.addConstraint(composite,Constraint.create(constraint))}return composite.label+=" Chain",composite},Composites.mesh=function(composite,columns,rows,crossBrace,options){var row,col,bodyA,bodyB,bodyC,bodies=composite.bodies;for(row=0;row<rows;row++){for(col=1;col<columns;col++)bodyA=bodies[col-1+row*columns],bodyB=bodies[col+row*columns],Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyA,bodyB:bodyB},options)));if(row>0)for(col=0;col<columns;col++)bodyA=bodies[col+(row-1)*columns],bodyB=bodies[col+row*columns],Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyA,bodyB:bodyB},options))),crossBrace&&col>0&&(bodyC=bodies[col-1+(row-1)*columns],Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyC,bodyB:bodyB},options)))),crossBrace&&col<columns-1&&(bodyC=bodies[col+1+(row-1)*columns],Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyC,bodyB:bodyB},options))))}return composite.label+=" Mesh",composite},Composites.pyramid=function(xx,yy,columns,rows,columnGap,rowGap,callback){return Composites.stack(xx,yy,columns,rows,columnGap,rowGap,function(x,y,column,row,lastBody,i){var actualRows=Math.min(rows,Math.ceil(columns/2)),lastBodyWidth=lastBody?lastBody.bounds.max.x-lastBody.bounds.min.x:0;if(!(row>actualRows||column<(row=actualRows-row)||column>columns-1-row))return 1===i&&Body.translate(lastBody,{x:(column+(columns%2==1?1:-1))*lastBodyWidth,y:0}),callback(xx+(lastBody?column*lastBodyWidth:0)+column*columnGap,y,column,row,lastBody,i)})},Composites.newtonsCradle=function(xx,yy,number,size,length){for(var newtonsCradle=Composite.create({label:"Newtons Cradle"}),i=0;i<number;i++){var circle=Bodies.circle(xx+i*(1.9*size),yy+length,size,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),constraint=Constraint.create({pointA:{x:xx+i*(1.9*size),y:yy},bodyB:circle});Composite.addBody(newtonsCradle,circle),Composite.addConstraint(newtonsCradle,constraint)}return newtonsCradle},Composites.car=function(xx,yy,width,height,wheelSize){var group=Body.nextGroup(!0),wheelAOffset=.5*-width+20,wheelBOffset=.5*width-20,car=Composite.create({label:"Car"}),body=Bodies.rectangle(xx,yy,width,height,{collisionFilter:{group:group},chamfer:{radius:.5*height},density:2e-4}),wheelA=Bodies.circle(xx+wheelAOffset,yy+0,wheelSize,{collisionFilter:{group:group},friction:.8}),wheelB=Bodies.circle(xx+wheelBOffset,yy+0,wheelSize,{collisionFilter:{group:group},friction:.8}),axelA=Constraint.create({bodyB:body,pointB:{x:wheelAOffset,y:0},bodyA:wheelA,stiffness:1,length:0}),axelB=Constraint.create({bodyB:body,pointB:{x:wheelBOffset,y:0},bodyA:wheelB,stiffness:1,length:0});return Composite.addBody(car,body),Composite.addBody(car,wheelA),Composite.addBody(car,wheelB),Composite.addConstraint(car,axelA),Composite.addConstraint(car,axelB),car},Composites.softBody=function(xx,yy,columns,rows,columnGap,rowGap,crossBrace,particleRadius,particleOptions,constraintOptions){particleOptions=Common.extend({inertia:1/0},particleOptions),constraintOptions=Common.extend({stiffness:.2,render:{type:"line",anchors:!1}},constraintOptions);var softBody=Composites.stack(xx,yy,columns,rows,columnGap,rowGap,function(x,y){return Bodies.circle(x,y,particleRadius,particleOptions)});return Composites.mesh(softBody,columns,rows,crossBrace,constraintOptions),softBody.label="Soft Body",softBody}},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":23}],25:[function(_dereq_,module,exports){var Axes={};module.exports=Axes;var Vector=_dereq_("../geometry/Vector"),Common=_dereq_("../core/Common");Axes.fromVertices=function(vertices){for(var axes={},i=0;i<vertices.length;i++){var j=(i+1)%vertices.length,normal=Vector.normalise({x:vertices[j].y-vertices[i].y,y:vertices[i].x-vertices[j].x}),gradient=0===normal.y?1/0:normal.x/normal.y;axes[gradient=gradient.toFixed(3).toString()]=normal}return Common.values(axes)},Axes.rotate=function(axes,angle){if(0!==angle)for(var cos=Math.cos(angle),sin=Math.sin(angle),i=0;i<axes.length;i++){var xx,axis=axes[i];xx=axis.x*cos-axis.y*sin,axis.y=axis.x*sin+axis.y*cos,axis.x=xx}}},{"../core/Common":14,"../geometry/Vector":28}],26:[function(_dereq_,module,exports){var Bounds={};module.exports=Bounds,Bounds.create=function(vertices){var bounds={min:{x:0,y:0},max:{x:0,y:0}};return vertices&&Bounds.update(bounds,vertices),bounds},Bounds.update=function(bounds,vertices,velocity){bounds.min.x=1/0,bounds.max.x=-1/0,bounds.min.y=1/0,bounds.max.y=-1/0;for(var i=0;i<vertices.length;i++){var vertex=vertices[i];vertex.x>bounds.max.x&&(bounds.max.x=vertex.x),vertex.x<bounds.min.x&&(bounds.min.x=vertex.x),vertex.y>bounds.max.y&&(bounds.max.y=vertex.y),vertex.y<bounds.min.y&&(bounds.min.y=vertex.y)}velocity&&(velocity.x>0?bounds.max.x+=velocity.x:bounds.min.x+=velocity.x,velocity.y>0?bounds.max.y+=velocity.y:bounds.min.y+=velocity.y)},Bounds.contains=function(bounds,point){return point.x>=bounds.min.x&&point.x<=bounds.max.x&&point.y>=bounds.min.y&&point.y<=bounds.max.y},Bounds.overlaps=function(boundsA,boundsB){return boundsA.min.x<=boundsB.max.x&&boundsA.max.x>=boundsB.min.x&&boundsA.max.y>=boundsB.min.y&&boundsA.min.y<=boundsB.max.y},Bounds.translate=function(bounds,vector){bounds.min.x+=vector.x,bounds.max.x+=vector.x,bounds.min.y+=vector.y,bounds.max.y+=vector.y},Bounds.shift=function(bounds,position){var deltaX=bounds.max.x-bounds.min.x,deltaY=bounds.max.y-bounds.min.y;bounds.min.x=position.x,bounds.max.x=position.x+deltaX,bounds.min.y=position.y,bounds.max.y=position.y+deltaY}},{}],27:[function(_dereq_,module,exports){var Svg={};module.exports=Svg;_dereq_("../geometry/Bounds");Svg.pathToVertices=function(path,sampleLength){var i,il,total,point,segment,segments,segmentsQueue,lastSegment,lastPoint,lx,ly,points=[],length=0,x=0,y=0;sampleLength=sampleLength||15;var addPoint=function(px,py,pathSegType){var isRelative=pathSegType%2==1&&pathSegType>1;if(!lastPoint||px!=lastPoint.x||py!=lastPoint.y){lastPoint&&isRelative?(lx=lastPoint.x,ly=lastPoint.y):(lx=0,ly=0);var point={x:lx+px,y:ly+py};!isRelative&&lastPoint||(lastPoint=point),points.push(point),x=lx+px,y=ly+py}},addSegmentPoint=function(segment){var segType=segment.pathSegTypeAsLetter.toUpperCase();if("Z"!==segType){switch(segType){case"M":case"L":case"T":case"C":case"S":case"Q":x=segment.x,y=segment.y;break;case"H":x=segment.x;break;case"V":y=segment.y}addPoint(x,y,segment.pathSegType)}};for(Svg._svgPathToAbsolute(path),total=path.getTotalLength(),segments=[],i=0;i<path.pathSegList.numberOfItems;i+=1)segments.push(path.pathSegList.getItem(i));for(segmentsQueue=segments.concat();length<total;){if((segment=segments[path.getPathSegAtLength(length)])!=lastSegment){for(;segmentsQueue.length&&segmentsQueue[0]!=segment;)addSegmentPoint(segmentsQueue.shift());lastSegment=segment}switch(segment.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":point=path.getPointAtLength(length),addPoint(point.x,point.y,0)}length+=sampleLength}for(i=0,il=segmentsQueue.length;i<il;++i)addSegmentPoint(segmentsQueue[i]);return points},Svg._svgPathToAbsolute=function(path){for(var x0,y0,x1,y1,x2,y2,segs=path.pathSegList,x=0,y=0,len=segs.numberOfItems,i=0;i<len;++i){var seg=segs.getItem(i),segType=seg.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(segType))"x"in seg&&(x=seg.x),"y"in seg&&(y=seg.y);else switch("x1"in seg&&(x1=x+seg.x1),"x2"in seg&&(x2=x+seg.x2),"y1"in seg&&(y1=y+seg.y1),"y2"in seg&&(y2=y+seg.y2),"x"in seg&&(x+=seg.x),"y"in seg&&(y+=seg.y),segType){case"m":segs.replaceItem(path.createSVGPathSegMovetoAbs(x,y),i);break;case"l":segs.replaceItem(path.createSVGPathSegLinetoAbs(x,y),i);break;case"h":segs.replaceItem(path.createSVGPathSegLinetoHorizontalAbs(x),i);break;case"v":segs.replaceItem(path.createSVGPathSegLinetoVerticalAbs(y),i);break;case"c":segs.replaceItem(path.createSVGPathSegCurvetoCubicAbs(x,y,x1,y1,x2,y2),i);break;case"s":segs.replaceItem(path.createSVGPathSegCurvetoCubicSmoothAbs(x,y,x2,y2),i);break;case"q":segs.replaceItem(path.createSVGPathSegCurvetoQuadraticAbs(x,y,x1,y1),i);break;case"t":segs.replaceItem(path.createSVGPathSegCurvetoQuadraticSmoothAbs(x,y),i);break;case"a":segs.replaceItem(path.createSVGPathSegArcAbs(x,y,seg.r1,seg.r2,seg.angle,seg.largeArcFlag,seg.sweepFlag),i);break;case"z":case"Z":x=x0,y=y0}"M"!=segType&&"m"!=segType||(x0=x,y0=y)}}},{"../geometry/Bounds":26}],28:[function(_dereq_,module,exports){var Vector={};module.exports=Vector,Vector.create=function(x,y){return{x:x||0,y:y||0}},Vector.clone=function(vector){return{x:vector.x,y:vector.y}},Vector.magnitude=function(vector){return Math.sqrt(vector.x*vector.x+vector.y*vector.y)},Vector.magnitudeSquared=function(vector){return vector.x*vector.x+vector.y*vector.y},Vector.rotate=function(vector,angle,output){var cos=Math.cos(angle),sin=Math.sin(angle);output||(output={});var x=vector.x*cos-vector.y*sin;return output.y=vector.x*sin+vector.y*cos,output.x=x,output},Vector.rotateAbout=function(vector,angle,point,output){var cos=Math.cos(angle),sin=Math.sin(angle);output||(output={});var x=point.x+((vector.x-point.x)*cos-(vector.y-point.y)*sin);return output.y=point.y+((vector.x-point.x)*sin+(vector.y-point.y)*cos),output.x=x,output},Vector.normalise=function(vector){var magnitude=Vector.magnitude(vector);return 0===magnitude?{x:0,y:0}:{x:vector.x/magnitude,y:vector.y/magnitude}},Vector.dot=function(vectorA,vectorB){return vectorA.x*vectorB.x+vectorA.y*vectorB.y},Vector.cross=function(vectorA,vectorB){return vectorA.x*vectorB.y-vectorA.y*vectorB.x},Vector.cross3=function(vectorA,vectorB,vectorC){return(vectorB.x-vectorA.x)*(vectorC.y-vectorA.y)-(vectorB.y-vectorA.y)*(vectorC.x-vectorA.x)},Vector.add=function(vectorA,vectorB,output){return output||(output={}),output.x=vectorA.x+vectorB.x,output.y=vectorA.y+vectorB.y,output},Vector.sub=function(vectorA,vectorB,output){return output||(output={}),output.x=vectorA.x-vectorB.x,output.y=vectorA.y-vectorB.y,output},Vector.mult=function(vector,scalar){return{x:vector.x*scalar,y:vector.y*scalar}},Vector.div=function(vector,scalar){return{x:vector.x/scalar,y:vector.y/scalar}},Vector.perp=function(vector,negate){return{x:(negate=!0===negate?-1:1)*-vector.y,y:negate*vector.x}},Vector.neg=function(vector){return{x:-vector.x,y:-vector.y}},Vector.angle=function(vectorA,vectorB){return Math.atan2(vectorB.y-vectorA.y,vectorB.x-vectorA.x)},Vector._temp=[Vector.create(),Vector.create(),Vector.create(),Vector.create(),Vector.create(),Vector.create()]},{}],29:[function(_dereq_,module,exports){var Vertices={};module.exports=Vertices;var Vector=_dereq_("../geometry/Vector"),Common=_dereq_("../core/Common");Vertices.create=function(points,body){for(var vertices=[],i=0;i<points.length;i++){var point=points[i],vertex={x:point.x,y:point.y,index:i,body:body,isInternal:!1};vertices.push(vertex)}return vertices},Vertices.fromPath=function(path,body){var points=[];return path.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,function(match,x,y){points.push({x:parseFloat(x),y:parseFloat(y)})}),Vertices.create(points,body)},Vertices.centre=function(vertices){for(var cross,temp,j,area=Vertices.area(vertices,!0),centre={x:0,y:0},i=0;i<vertices.length;i++)j=(i+1)%vertices.length,cross=Vector.cross(vertices[i],vertices[j]),temp=Vector.mult(Vector.add(vertices[i],vertices[j]),cross),centre=Vector.add(centre,temp);return Vector.div(centre,6*area)},Vertices.mean=function(vertices){for(var average={x:0,y:0},i=0;i<vertices.length;i++)average.x+=vertices[i].x,average.y+=vertices[i].y;return Vector.div(average,vertices.length)},Vertices.area=function(vertices,signed){for(var area=0,j=vertices.length-1,i=0;i<vertices.length;i++)area+=(vertices[j].x-vertices[i].x)*(vertices[j].y+vertices[i].y),j=i;return signed?area/2:Math.abs(area)/2},Vertices.inertia=function(vertices,mass){for(var cross,j,numerator=0,denominator=0,v=vertices,n=0;n<v.length;n++)j=(n+1)%v.length,numerator+=(cross=Math.abs(Vector.cross(v[j],v[n])))*(Vector.dot(v[j],v[j])+Vector.dot(v[j],v[n])+Vector.dot(v[n],v[n])),denominator+=cross;return mass/6*(numerator/denominator)},Vertices.translate=function(vertices,vector,scalar){var i;if(scalar)for(i=0;i<vertices.length;i++)vertices[i].x+=vector.x*scalar,vertices[i].y+=vector.y*scalar;else for(i=0;i<vertices.length;i++)vertices[i].x+=vector.x,vertices[i].y+=vector.y;return vertices},Vertices.rotate=function(vertices,angle,point){if(0!==angle){for(var cos=Math.cos(angle),sin=Math.sin(angle),i=0;i<vertices.length;i++){var vertice=vertices[i],dx=vertice.x-point.x,dy=vertice.y-point.y;vertice.x=point.x+(dx*cos-dy*sin),vertice.y=point.y+(dx*sin+dy*cos)}return vertices}},Vertices.contains=function(vertices,point){for(var i=0;i<vertices.length;i++){var vertice=vertices[i],nextVertice=vertices[(i+1)%vertices.length];if((point.x-vertice.x)*(nextVertice.y-vertice.y)+(point.y-vertice.y)*(vertice.x-nextVertice.x)>0)return!1}return!0},Vertices.scale=function(vertices,scaleX,scaleY,point){if(1===scaleX&&1===scaleY)return vertices;var vertex,delta;point=point||Vertices.centre(vertices);for(var i=0;i<vertices.length;i++)vertex=vertices[i],delta=Vector.sub(vertex,point),vertices[i].x=point.x+delta.x*scaleX,vertices[i].y=point.y+delta.y*scaleY;return vertices},Vertices.chamfer=function(vertices,radius,quality,qualityMin,qualityMax){radius="number"==typeof radius?[radius]:radius||[8],quality=void 0!==quality?quality:-1,qualityMin=qualityMin||2,qualityMax=qualityMax||14;for(var newVertices=[],i=0;i<vertices.length;i++){var prevVertex=vertices[i-1>=0?i-1:vertices.length-1],vertex=vertices[i],nextVertex=vertices[(i+1)%vertices.length],currentRadius=radius[i<radius.length?i:radius.length-1];if(0!==currentRadius){var prevNormal=Vector.normalise({x:vertex.y-prevVertex.y,y:prevVertex.x-vertex.x}),nextNormal=Vector.normalise({x:nextVertex.y-vertex.y,y:vertex.x-nextVertex.x}),diagonalRadius=Math.sqrt(2*Math.pow(currentRadius,2)),radiusVector=Vector.mult(Common.clone(prevNormal),currentRadius),midNormal=Vector.normalise(Vector.mult(Vector.add(prevNormal,nextNormal),.5)),scaledVertex=Vector.sub(vertex,Vector.mult(midNormal,diagonalRadius)),precision=quality;-1===quality&&(precision=1.75*Math.pow(currentRadius,.32)),(precision=Common.clamp(precision,qualityMin,qualityMax))%2==1&&(precision+=1);for(var theta=Math.acos(Vector.dot(prevNormal,nextNormal))/precision,j=0;j<precision;j++)newVertices.push(Vector.add(Vector.rotate(radiusVector,theta*j),scaledVertex))}else newVertices.push(vertex)}return newVertices},Vertices.clockwiseSort=function(vertices){var centre=Vertices.mean(vertices);return vertices.sort(function(vertexA,vertexB){return Vector.angle(centre,vertexA)-Vector.angle(centre,vertexB)}),vertices},Vertices.isConvex=function(vertices){var i,j,k,z,flag=0,n=vertices.length;if(n<3)return null;for(i=0;i<n;i++)if(k=(i+2)%n,z=(vertices[j=(i+1)%n].x-vertices[i].x)*(vertices[k].y-vertices[j].y),(z-=(vertices[j].y-vertices[i].y)*(vertices[k].x-vertices[j].x))<0?flag|=1:z>0&&(flag|=2),3===flag)return!1;return 0!==flag||null},Vertices.hull=function(vertices){var vertex,i,upper=[],lower=[];for((vertices=vertices.slice(0)).sort(function(vertexA,vertexB){var dx=vertexA.x-vertexB.x;return 0!==dx?dx:vertexA.y-vertexB.y}),i=0;i<vertices.length;i+=1){for(vertex=vertices[i];lower.length>=2&&Vector.cross3(lower[lower.length-2],lower[lower.length-1],vertex)<=0;)lower.pop();lower.push(vertex)}for(i=vertices.length-1;i>=0;i-=1){for(vertex=vertices[i];upper.length>=2&&Vector.cross3(upper[upper.length-2],upper[upper.length-1],vertex)<=0;)upper.pop();upper.push(vertex)}return upper.pop(),lower.pop(),upper.concat(lower)}},{"../core/Common":14,"../geometry/Vector":28}],30:[function(_dereq_,module,exports){var Matter=module.exports=_dereq_("../core/Matter");Matter.Body=_dereq_("../body/Body"),Matter.Composite=_dereq_("../body/Composite"),Matter.World=_dereq_("../body/World"),Matter.Contact=_dereq_("../collision/Contact"),Matter.Detector=_dereq_("../collision/Detector"),Matter.Grid=_dereq_("../collision/Grid"),Matter.Pairs=_dereq_("../collision/Pairs"),Matter.Pair=_dereq_("../collision/Pair"),Matter.Query=_dereq_("../collision/Query"),Matter.Resolver=_dereq_("../collision/Resolver"),Matter.SAT=_dereq_("../collision/SAT"),Matter.Constraint=_dereq_("../constraint/Constraint"),Matter.MouseConstraint=_dereq_("../constraint/MouseConstraint"),Matter.Common=_dereq_("../core/Common"),Matter.Engine=_dereq_("../core/Engine"),Matter.Events=_dereq_("../core/Events"),Matter.Mouse=_dereq_("../core/Mouse"),Matter.Runner=_dereq_("../core/Runner"),Matter.Sleeping=_dereq_("../core/Sleeping"),Matter.Plugin=_dereq_("../core/Plugin"),Matter.Bodies=_dereq_("../factory/Bodies"),Matter.Composites=_dereq_("../factory/Composites"),Matter.Axes=_dereq_("../geometry/Axes"),Matter.Bounds=_dereq_("../geometry/Bounds"),Matter.Svg=_dereq_("../geometry/Svg"),Matter.Vector=_dereq_("../geometry/Vector"),Matter.Vertices=_dereq_("../geometry/Vertices"),Matter.Render=_dereq_("../render/Render"),Matter.RenderPixi=_dereq_("../render/RenderPixi"),Matter.World.add=Matter.Composite.add,Matter.World.remove=Matter.Composite.remove,Matter.World.addComposite=Matter.Composite.addComposite,Matter.World.addBody=Matter.Composite.addBody,Matter.World.addConstraint=Matter.Composite.addConstraint,Matter.World.clear=Matter.Composite.clear,Matter.Engine.run=Matter.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Matter":17,"../core/Metrics":18,"../core/Mouse":19,"../core/Plugin":20,"../core/Runner":21,"../core/Sleeping":22,"../factory/Bodies":23,"../factory/Composites":24,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Svg":27,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31,"../render/RenderPixi":32}],31:[function(_dereq_,module,exports){var Render={};module.exports=Render;var Common=_dereq_("../core/Common"),Composite=_dereq_("../body/Composite"),Bounds=_dereq_("../geometry/Bounds"),Events=_dereq_("../core/Events"),Grid=_dereq_("../collision/Grid"),Vector=_dereq_("../geometry/Vector"),Mouse=_dereq_("../core/Mouse");!function(){var _requestAnimationFrame,_cancelAnimationFrame;"undefined"!=typeof window&&(_requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(function(){callback(Common.now())},1e3/60)},_cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),Render.create=function(options){var defaults={controller:Render,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",hasBounds:!!options.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},render=Common.extend(defaults,options);return render.canvas&&(render.canvas.width=render.options.width||render.canvas.width,render.canvas.height=render.options.height||render.canvas.height),render.mouse=options.mouse,render.engine=options.engine,render.canvas=render.canvas||_createCanvas(render.options.width,render.options.height),render.context=render.canvas.getContext("2d"),render.textures={},render.bounds=render.bounds||{min:{x:0,y:0},max:{x:render.canvas.width,y:render.canvas.height}},1!==render.options.pixelRatio&&Render.setPixelRatio(render,render.options.pixelRatio),Common.isElement(render.element)?render.element.appendChild(render.canvas):render.canvas.parentNode||Common.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),render},Render.run=function(render){!function loop(time){render.frameRequestId=_requestAnimationFrame(loop),Render.world(render)}()},Render.stop=function(render){_cancelAnimationFrame(render.frameRequestId)},Render.setPixelRatio=function(render,pixelRatio){var options=render.options,canvas=render.canvas;"auto"===pixelRatio&&(pixelRatio=_getPixelRatio(canvas)),options.pixelRatio=pixelRatio,canvas.setAttribute("data-pixel-ratio",pixelRatio),canvas.width=options.width*pixelRatio,canvas.height=options.height*pixelRatio,canvas.style.width=options.width+"px",canvas.style.height=options.height+"px",render.context.scale(pixelRatio,pixelRatio)},Render.lookAt=function(render,objects,padding,center){center=void 0===center||center,objects=Common.isArray(objects)?objects:[objects],padding=padding||{x:0,y:0};for(var bounds={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},i=0;i<objects.length;i+=1){var object=objects[i],min=object.bounds?object.bounds.min:object.min||object.position||object,max=object.bounds?object.bounds.max:object.max||object.position||object;min&&max&&(min.x<bounds.min.x&&(bounds.min.x=min.x),max.x>bounds.max.x&&(bounds.max.x=max.x),min.y<bounds.min.y&&(bounds.min.y=min.y),max.y>bounds.max.y&&(bounds.max.y=max.y))}var width=bounds.max.x-bounds.min.x+2*padding.x,height=bounds.max.y-bounds.min.y+2*padding.y,viewHeight=render.canvas.height,outerRatio=render.canvas.width/viewHeight,innerRatio=width/height,scaleX=1,scaleY=1;innerRatio>outerRatio?scaleY=innerRatio/outerRatio:scaleX=outerRatio/innerRatio,render.options.hasBounds=!0,render.bounds.min.x=bounds.min.x,render.bounds.max.x=bounds.min.x+width*scaleX,render.bounds.min.y=bounds.min.y,render.bounds.max.y=bounds.min.y+height*scaleY,center&&(render.bounds.min.x+=.5*width-width*scaleX*.5,render.bounds.max.x+=.5*width-width*scaleX*.5,render.bounds.min.y+=.5*height-height*scaleY*.5,render.bounds.max.y+=.5*height-height*scaleY*.5),render.bounds.min.x-=padding.x,render.bounds.max.x-=padding.x,render.bounds.min.y-=padding.y,render.bounds.max.y-=padding.y,render.mouse&&(Mouse.setScale(render.mouse,{x:(render.bounds.max.x-render.bounds.min.x)/render.canvas.width,y:(render.bounds.max.y-render.bounds.min.y)/render.canvas.height}),Mouse.setOffset(render.mouse,render.bounds.min))},Render.startViewTransform=function(render){var boundsWidth=render.bounds.max.x-render.bounds.min.x,boundsHeight=render.bounds.max.y-render.bounds.min.y,boundsScaleX=boundsWidth/render.options.width,boundsScaleY=boundsHeight/render.options.height;render.context.scale(1/boundsScaleX,1/boundsScaleY),render.context.translate(-render.bounds.min.x,-render.bounds.min.y)},Render.endViewTransform=function(render){render.context.setTransform(render.options.pixelRatio,0,0,render.options.pixelRatio,0,0)},Render.world=function(render){var i,engine=render.engine,world=engine.world,canvas=render.canvas,context=render.context,options=render.options,allBodies=Composite.allBodies(world),allConstraints=Composite.allConstraints(world),background=options.wireframes?options.wireframeBackground:options.background,bodies=[],constraints=[],event={timestamp:engine.timing.timestamp};if(Events.trigger(render,"beforeRender",event),render.currentBackground!==background&&_applyBackground(render,background),context.globalCompositeOperation="source-in",context.fillStyle="transparent",context.fillRect(0,0,canvas.width,canvas.height),context.globalCompositeOperation="source-over",options.hasBounds){for(i=0;i<allBodies.length;i++){var body=allBodies[i];Bounds.overlaps(body.bounds,render.bounds)&&bodies.push(body)}for(i=0;i<allConstraints.length;i++){var constraint=allConstraints[i],bodyA=constraint.bodyA,bodyB=constraint.bodyB,pointAWorld=constraint.pointA,pointBWorld=constraint.pointB;bodyA&&(pointAWorld=Vector.add(bodyA.position,constraint.pointA)),bodyB&&(pointBWorld=Vector.add(bodyB.position,constraint.pointB)),pointAWorld&&pointBWorld&&((Bounds.contains(render.bounds,pointAWorld)||Bounds.contains(render.bounds,pointBWorld))&&constraints.push(constraint))}Render.startViewTransform(render),render.mouse&&(Mouse.setScale(render.mouse,{x:(render.bounds.max.x-render.bounds.min.x)/render.canvas.width,y:(render.bounds.max.y-render.bounds.min.y)/render.canvas.height}),Mouse.setOffset(render.mouse,render.bounds.min))}else constraints=allConstraints,bodies=allBodies;!options.wireframes||engine.enableSleeping&&options.showSleeping?Render.bodies(render,bodies,context):(options.showConvexHulls&&Render.bodyConvexHulls(render,bodies,context),Render.bodyWireframes(render,bodies,context)),options.showBounds&&Render.bodyBounds(render,bodies,context),(options.showAxes||options.showAngleIndicator)&&Render.bodyAxes(render,bodies,context),options.showPositions&&Render.bodyPositions(render,bodies,context),options.showVelocity&&Render.bodyVelocity(render,bodies,context),options.showIds&&Render.bodyIds(render,bodies,context),options.showSeparations&&Render.separations(render,engine.pairs.list,context),options.showCollisions&&Render.collisions(render,engine.pairs.list,context),options.showVertexNumbers&&Render.vertexNumbers(render,bodies,context),options.showMousePosition&&Render.mousePosition(render,render.mouse,context),Render.constraints(constraints,context),options.showBroadphase&&engine.broadphase.controller===Grid&&Render.grid(render,engine.broadphase,context),options.showDebug&&Render.debug(render,context),options.hasBounds&&Render.endViewTransform(render),Events.trigger(render,"afterRender",event)},Render.debug=function(render,context){var c=context,engine=render.engine,world=engine.world,metrics=engine.metrics,options=render.options;Composite.allBodies(world);if(engine.timing.timestamp-(render.debugTimestamp||0)>=500){var text="";metrics.timing&&(text+="fps: "+Math.round(metrics.timing.fps)+"    "),render.debugString=text,render.debugTimestamp=engine.timing.timestamp}if(render.debugString){c.font="12px Arial",options.wireframes?c.fillStyle="rgba(255,255,255,0.5)":c.fillStyle="rgba(0,0,0,0.5)";for(var split=render.debugString.split("\n"),i=0;i<split.length;i++)c.fillText(split[i],50,50+18*i)}},Render.constraints=function(constraints,context){for(var c=context,i=0;i<constraints.length;i++){var constraint=constraints[i];if(constraint.render.visible&&constraint.pointA&&constraint.pointB){var start,end,bodyA=constraint.bodyA,bodyB=constraint.bodyB;if(start=bodyA?Vector.add(bodyA.position,constraint.pointA):constraint.pointA,"pin"===constraint.render.type)c.beginPath(),c.arc(start.x,start.y,3,0,2*Math.PI),c.closePath();else{if(end=bodyB?Vector.add(bodyB.position,constraint.pointB):constraint.pointB,c.beginPath(),c.moveTo(start.x,start.y),"spring"===constraint.render.type)for(var offset,delta=Vector.sub(end,start),normal=Vector.perp(Vector.normalise(delta)),coils=Math.ceil(Common.clamp(constraint.length/5,12,20)),j=1;j<coils;j+=1)offset=j%2==0?1:-1,c.lineTo(start.x+delta.x*(j/coils)+normal.x*offset*4,start.y+delta.y*(j/coils)+normal.y*offset*4);c.lineTo(end.x,end.y)}constraint.render.lineWidth&&(c.lineWidth=constraint.render.lineWidth,c.strokeStyle=constraint.render.strokeStyle,c.stroke()),constraint.render.anchors&&(c.fillStyle=constraint.render.strokeStyle,c.beginPath(),c.arc(start.x,start.y,3,0,2*Math.PI),c.arc(end.x,end.y,3,0,2*Math.PI),c.closePath(),c.fill())}}},Render.bodyShadows=function(render,bodies,context){for(var c=context,i=(render.engine,0);i<bodies.length;i++){var body=bodies[i];if(body.render.visible){if(body.circleRadius)c.beginPath(),c.arc(body.position.x,body.position.y,body.circleRadius,0,2*Math.PI),c.closePath();else{c.beginPath(),c.moveTo(body.vertices[0].x,body.vertices[0].y);for(var j=1;j<body.vertices.length;j++)c.lineTo(body.vertices[j].x,body.vertices[j].y);c.closePath()}var distanceX=body.position.x-.5*render.options.width,distanceY=body.position.y-.2*render.options.height,distance=Math.abs(distanceX)+Math.abs(distanceY);c.shadowColor="rgba(0,0,0,0.15)",c.shadowOffsetX=.05*distanceX,c.shadowOffsetY=.05*distanceY,c.shadowBlur=1+12*Math.min(1,distance/1e3),c.fill(),c.shadowColor=null,c.shadowOffsetX=null,c.shadowOffsetY=null,c.shadowBlur=null}}},Render.bodies=function(render,bodies,context){var body,part,i,k,c=context,options=(render.engine,render.options),showInternalEdges=options.showInternalEdges||!options.wireframes;for(i=0;i<bodies.length;i++)if((body=bodies[i]).render.visible)for(k=body.parts.length>1?1:0;k<body.parts.length;k++)if((part=body.parts[k]).render.visible){if(options.showSleeping&&body.isSleeping?c.globalAlpha=.5*part.render.opacity:1!==part.render.opacity&&(c.globalAlpha=part.render.opacity),part.render.sprite&&part.render.sprite.texture&&!options.wireframes){var sprite=part.render.sprite,texture=_getTexture(render,sprite.texture);c.translate(part.position.x,part.position.y),c.rotate(part.angle),c.drawImage(texture,texture.width*-sprite.xOffset*sprite.xScale,texture.height*-sprite.yOffset*sprite.yScale,texture.width*sprite.xScale,texture.height*sprite.yScale),c.rotate(-part.angle),c.translate(-part.position.x,-part.position.y)}else{if(part.circleRadius)c.beginPath(),c.arc(part.position.x,part.position.y,part.circleRadius,0,2*Math.PI);else{c.beginPath(),c.moveTo(part.vertices[0].x,part.vertices[0].y);for(var j=1;j<part.vertices.length;j++)!part.vertices[j-1].isInternal||showInternalEdges?c.lineTo(part.vertices[j].x,part.vertices[j].y):c.moveTo(part.vertices[j].x,part.vertices[j].y),part.vertices[j].isInternal&&!showInternalEdges&&c.moveTo(part.vertices[(j+1)%part.vertices.length].x,part.vertices[(j+1)%part.vertices.length].y);c.lineTo(part.vertices[0].x,part.vertices[0].y),c.closePath()}options.wireframes?(c.lineWidth=1,c.strokeStyle="#bbb",c.stroke()):(c.fillStyle=part.render.fillStyle,part.render.lineWidth&&(c.lineWidth=part.render.lineWidth,c.strokeStyle=part.render.strokeStyle,c.stroke()),c.fill())}c.globalAlpha=1}},Render.bodyWireframes=function(render,bodies,context){var body,part,i,j,k,c=context,showInternalEdges=render.options.showInternalEdges;for(c.beginPath(),i=0;i<bodies.length;i++)if((body=bodies[i]).render.visible)for(k=body.parts.length>1?1:0;k<body.parts.length;k++){for(part=body.parts[k],c.moveTo(part.vertices[0].x,part.vertices[0].y),j=1;j<part.vertices.length;j++)!part.vertices[j-1].isInternal||showInternalEdges?c.lineTo(part.vertices[j].x,part.vertices[j].y):c.moveTo(part.vertices[j].x,part.vertices[j].y),part.vertices[j].isInternal&&!showInternalEdges&&c.moveTo(part.vertices[(j+1)%part.vertices.length].x,part.vertices[(j+1)%part.vertices.length].y);c.lineTo(part.vertices[0].x,part.vertices[0].y)}c.lineWidth=1,c.strokeStyle="#bbb",c.stroke()},Render.bodyConvexHulls=function(render,bodies,context){var body,i,j,c=context;for(c.beginPath(),i=0;i<bodies.length;i++)if((body=bodies[i]).render.visible&&1!==body.parts.length){for(c.moveTo(body.vertices[0].x,body.vertices[0].y),j=1;j<body.vertices.length;j++)c.lineTo(body.vertices[j].x,body.vertices[j].y);c.lineTo(body.vertices[0].x,body.vertices[0].y)}c.lineWidth=1,c.strokeStyle="rgba(255,255,255,0.2)",c.stroke()},Render.vertexNumbers=function(render,bodies,context){var i,j,k,c=context;for(i=0;i<bodies.length;i++){var parts=bodies[i].parts;for(k=parts.length>1?1:0;k<parts.length;k++){var part=parts[k];for(j=0;j<part.vertices.length;j++)c.fillStyle="rgba(255,255,255,0.2)",c.fillText(i+"_"+j,part.position.x+.8*(part.vertices[j].x-part.position.x),part.position.y+.8*(part.vertices[j].y-part.position.y))}}},Render.mousePosition=function(render,mouse,context){var c=context;c.fillStyle="rgba(255,255,255,0.8)",c.fillText(mouse.position.x+"  "+mouse.position.y,mouse.position.x+5,mouse.position.y-5)},Render.bodyBounds=function(render,bodies,context){var c=context,options=(render.engine,render.options);c.beginPath();for(var i=0;i<bodies.length;i++){if(bodies[i].render.visible)for(var parts=bodies[i].parts,j=parts.length>1?1:0;j<parts.length;j++){var part=parts[j];c.rect(part.bounds.min.x,part.bounds.min.y,part.bounds.max.x-part.bounds.min.x,part.bounds.max.y-part.bounds.min.y)}}options.wireframes?c.strokeStyle="rgba(255,255,255,0.08)":c.strokeStyle="rgba(0,0,0,0.1)",c.lineWidth=1,c.stroke()},Render.bodyAxes=function(render,bodies,context){var part,i,j,k,c=context,options=(render.engine,render.options);for(c.beginPath(),i=0;i<bodies.length;i++){var body=bodies[i],parts=body.parts;if(body.render.visible)if(options.showAxes)for(j=parts.length>1?1:0;j<parts.length;j++)for(part=parts[j],k=0;k<part.axes.length;k++){var axis=part.axes[k];c.moveTo(part.position.x,part.position.y),c.lineTo(part.position.x+20*axis.x,part.position.y+20*axis.y)}else for(j=parts.length>1?1:0;j<parts.length;j++)for(part=parts[j],k=0;k<part.axes.length;k++)c.moveTo(part.position.x,part.position.y),c.lineTo((part.vertices[0].x+part.vertices[part.vertices.length-1].x)/2,(part.vertices[0].y+part.vertices[part.vertices.length-1].y)/2)}options.wireframes?(c.strokeStyle="indianred",c.lineWidth=1):(c.strokeStyle="rgba(255, 255, 255, 0.4)",c.globalCompositeOperation="overlay",c.lineWidth=2),c.stroke(),c.globalCompositeOperation="source-over"},Render.bodyPositions=function(render,bodies,context){var body,part,i,k,c=context,options=(render.engine,render.options);for(c.beginPath(),i=0;i<bodies.length;i++)if((body=bodies[i]).render.visible)for(k=0;k<body.parts.length;k++)part=body.parts[k],c.arc(part.position.x,part.position.y,3,0,2*Math.PI,!1),c.closePath();for(options.wireframes?c.fillStyle="indianred":c.fillStyle="rgba(0,0,0,0.5)",c.fill(),c.beginPath(),i=0;i<bodies.length;i++)(body=bodies[i]).render.visible&&(c.arc(body.positionPrev.x,body.positionPrev.y,2,0,2*Math.PI,!1),c.closePath());c.fillStyle="rgba(255,165,0,0.8)",c.fill()},Render.bodyVelocity=function(render,bodies,context){var c=context;c.beginPath();for(var i=0;i<bodies.length;i++){var body=bodies[i];body.render.visible&&(c.moveTo(body.position.x,body.position.y),c.lineTo(body.position.x+2*(body.position.x-body.positionPrev.x),body.position.y+2*(body.position.y-body.positionPrev.y)))}c.lineWidth=3,c.strokeStyle="cornflowerblue",c.stroke()},Render.bodyIds=function(render,bodies,context){var i,j,c=context;for(i=0;i<bodies.length;i++)if(bodies[i].render.visible){var parts=bodies[i].parts;for(j=parts.length>1?1:0;j<parts.length;j++){var part=parts[j];c.font="12px Arial",c.fillStyle="rgba(255,255,255,0.5)",c.fillText(part.id,part.position.x+10,part.position.y-10)}}},Render.collisions=function(render,pairs,context){var pair,collision,i,j,c=context,options=render.options;for(c.beginPath(),i=0;i<pairs.length;i++)if((pair=pairs[i]).isActive)for(collision=pair.collision,j=0;j<pair.activeContacts.length;j++){var vertex=pair.activeContacts[j].vertex;c.rect(vertex.x-1.5,vertex.y-1.5,3.5,3.5)}for(options.wireframes?c.fillStyle="rgba(255,255,255,0.7)":c.fillStyle="orange",c.fill(),c.beginPath(),i=0;i<pairs.length;i++)if((pair=pairs[i]).isActive&&(collision=pair.collision,pair.activeContacts.length>0)){var normalPosX=pair.activeContacts[0].vertex.x,normalPosY=pair.activeContacts[0].vertex.y;2===pair.activeContacts.length&&(normalPosX=(pair.activeContacts[0].vertex.x+pair.activeContacts[1].vertex.x)/2,normalPosY=(pair.activeContacts[0].vertex.y+pair.activeContacts[1].vertex.y)/2),collision.bodyB===collision.supports[0].body||!0===collision.bodyA.isStatic?c.moveTo(normalPosX-8*collision.normal.x,normalPosY-8*collision.normal.y):c.moveTo(normalPosX+8*collision.normal.x,normalPosY+8*collision.normal.y),c.lineTo(normalPosX,normalPosY)}options.wireframes?c.strokeStyle="rgba(255,165,0,0.7)":c.strokeStyle="orange",c.lineWidth=1,c.stroke()},Render.separations=function(render,pairs,context){var pair,collision,bodyA,bodyB,i,c=context,options=render.options;for(c.beginPath(),i=0;i<pairs.length;i++)if((pair=pairs[i]).isActive){bodyA=(collision=pair.collision).bodyA;var k=1;(bodyB=collision.bodyB).isStatic||bodyA.isStatic||(k=.5),bodyB.isStatic&&(k=0),c.moveTo(bodyB.position.x,bodyB.position.y),c.lineTo(bodyB.position.x-collision.penetration.x*k,bodyB.position.y-collision.penetration.y*k),k=1,bodyB.isStatic||bodyA.isStatic||(k=.5),bodyA.isStatic&&(k=0),c.moveTo(bodyA.position.x,bodyA.position.y),c.lineTo(bodyA.position.x+collision.penetration.x*k,bodyA.position.y+collision.penetration.y*k)}options.wireframes?c.strokeStyle="rgba(255,165,0,0.5)":c.strokeStyle="orange",c.stroke()},Render.grid=function(render,grid,context){var c=context;render.options.wireframes?c.strokeStyle="rgba(255,180,0,0.1)":c.strokeStyle="rgba(255,180,0,0.5)",c.beginPath();for(var bucketKeys=Common.keys(grid.buckets),i=0;i<bucketKeys.length;i++){var bucketId=bucketKeys[i];if(!(grid.buckets[bucketId].length<2)){var region=bucketId.split(/C|R/);c.rect(.5+parseInt(region[1],10)*grid.bucketWidth,.5+parseInt(region[2],10)*grid.bucketHeight,grid.bucketWidth,grid.bucketHeight)}}c.lineWidth=1,c.stroke()},Render.inspector=function(inspector,context){inspector.engine;var bounds,selected=inspector.selected,render=inspector.render,options=render.options;if(options.hasBounds){var boundsWidth=render.bounds.max.x-render.bounds.min.x,boundsHeight=render.bounds.max.y-render.bounds.min.y,boundsScaleX=boundsWidth/render.options.width,boundsScaleY=boundsHeight/render.options.height;context.scale(1/boundsScaleX,1/boundsScaleY),context.translate(-render.bounds.min.x,-render.bounds.min.y)}for(var i=0;i<selected.length;i++){var item=selected[i].data;switch(context.translate(.5,.5),context.lineWidth=1,context.strokeStyle="rgba(255,165,0,0.9)",context.setLineDash([1,2]),item.type){case"body":bounds=item.bounds,context.beginPath(),context.rect(Math.floor(bounds.min.x-3),Math.floor(bounds.min.y-3),Math.floor(bounds.max.x-bounds.min.x+6),Math.floor(bounds.max.y-bounds.min.y+6)),context.closePath(),context.stroke();break;case"constraint":var point=item.pointA;item.bodyA&&(point=item.pointB),context.beginPath(),context.arc(point.x,point.y,10,0,2*Math.PI),context.closePath(),context.stroke()}context.setLineDash([]),context.translate(-.5,-.5)}null!==inspector.selectStart&&(context.translate(.5,.5),context.lineWidth=1,context.strokeStyle="rgba(255,165,0,0.6)",context.fillStyle="rgba(255,165,0,0.1)",bounds=inspector.selectBounds,context.beginPath(),context.rect(Math.floor(bounds.min.x),Math.floor(bounds.min.y),Math.floor(bounds.max.x-bounds.min.x),Math.floor(bounds.max.y-bounds.min.y)),context.closePath(),context.stroke(),context.fill(),context.translate(-.5,-.5)),options.hasBounds&&context.setTransform(1,0,0,1,0,0)};var _createCanvas=function(width,height){var canvas=document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas.oncontextmenu=function(){return!1},canvas.onselectstart=function(){return!1},canvas},_getPixelRatio=function(canvas){var context=canvas.getContext("2d");return(window.devicePixelRatio||1)/(context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1)},_getTexture=function(render,imagePath){var image=render.textures[imagePath];return image||((image=render.textures[imagePath]=new Image).src=imagePath,image)},_applyBackground=function(render,background){var cssBackground=background;/(jpg|gif|png)$/.test(background)&&(cssBackground="url("+background+")"),render.canvas.style.background=cssBackground,render.canvas.style.backgroundSize="contain",render.currentBackground=background}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../geometry/Bounds":26,"../geometry/Vector":28}],32:[function(_dereq_,module,exports){var RenderPixi={};module.exports=RenderPixi;var Bounds=_dereq_("../geometry/Bounds"),Composite=_dereq_("../body/Composite"),Common=_dereq_("../core/Common"),Events=_dereq_("../core/Events"),Vector=_dereq_("../geometry/Vector");!function(){var _requestAnimationFrame,_cancelAnimationFrame;"undefined"!=typeof window&&(_requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(function(){callback(Common.now())},1e3/60)},_cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),RenderPixi.create=function(options){Common.warn("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)");var defaults={controller:RenderPixi,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},render=Common.extend(defaults,options),transparent=!render.options.wireframes&&"transparent"===render.options.background;return render.pixiOptions=render.pixiOptions||{view:render.canvas,transparent:transparent,antialias:!0,backgroundColor:options.background},render.mouse=options.mouse,render.engine=options.engine,render.renderer=render.renderer||new PIXI.WebGLRenderer(render.options.width,render.options.height,render.pixiOptions),render.container=render.container||new PIXI.Container,render.spriteContainer=render.spriteContainer||new PIXI.Container,render.canvas=render.canvas||render.renderer.view,render.bounds=render.bounds||{min:{x:0,y:0},max:{x:render.options.width,y:render.options.height}},Events.on(render.engine,"beforeUpdate",function(){RenderPixi.clear(render)}),render.textures={},render.sprites={},render.primitives={},render.container.addChild(render.spriteContainer),Common.isElement(render.element)?render.element.appendChild(render.canvas):Common.warn('No "render.element" passed, "render.canvas" was not inserted into document.'),render.canvas.oncontextmenu=function(){return!1},render.canvas.onselectstart=function(){return!1},render},RenderPixi.run=function(render){!function loop(time){render.frameRequestId=_requestAnimationFrame(loop),RenderPixi.world(render)}()},RenderPixi.stop=function(render){_cancelAnimationFrame(render.frameRequestId)},RenderPixi.clear=function(render){for(var container=render.container,spriteContainer=render.spriteContainer;container.children[0];)container.removeChild(container.children[0]);for(;spriteContainer.children[0];)spriteContainer.removeChild(spriteContainer.children[0]);var bgSprite=render.sprites["bg-0"];render.textures={},render.sprites={},render.primitives={},render.sprites["bg-0"]=bgSprite,bgSprite&&container.addChildAt(bgSprite,0),render.container.addChild(render.spriteContainer),render.currentBackground=null,container.scale.set(1,1),container.position.set(0,0)},RenderPixi.setBackground=function(render,background){if(render.currentBackground!==background){var isColor=background.indexOf&&-1!==background.indexOf("#"),bgSprite=render.sprites["bg-0"];if(isColor){var color=Common.colorToNumber(background);render.renderer.backgroundColor=color,bgSprite&&render.container.removeChild(bgSprite)}else if(!bgSprite){var texture=_getTexture(render,background);(bgSprite=render.sprites["bg-0"]=new PIXI.Sprite(texture)).position.x=0,bgSprite.position.y=0,render.container.addChildAt(bgSprite,0)}render.currentBackground=background}},RenderPixi.world=function(render){var i,world=render.engine.world,renderer=render.renderer,container=render.container,options=render.options,bodies=Composite.allBodies(world),allConstraints=Composite.allConstraints(world),constraints=[];options.wireframes?RenderPixi.setBackground(render,options.wireframeBackground):RenderPixi.setBackground(render,options.background);var boundsWidth=render.bounds.max.x-render.bounds.min.x,boundsHeight=render.bounds.max.y-render.bounds.min.y,boundsScaleX=boundsWidth/render.options.width,boundsScaleY=boundsHeight/render.options.height;if(options.hasBounds){for(i=0;i<bodies.length;i++){var body=bodies[i];body.render.sprite.visible=Bounds.overlaps(body.bounds,render.bounds)}for(i=0;i<allConstraints.length;i++){var constraint=allConstraints[i],bodyA=constraint.bodyA,bodyB=constraint.bodyB,pointAWorld=constraint.pointA,pointBWorld=constraint.pointB;bodyA&&(pointAWorld=Vector.add(bodyA.position,constraint.pointA)),bodyB&&(pointBWorld=Vector.add(bodyB.position,constraint.pointB)),pointAWorld&&pointBWorld&&((Bounds.contains(render.bounds,pointAWorld)||Bounds.contains(render.bounds,pointBWorld))&&constraints.push(constraint))}container.scale.set(1/boundsScaleX,1/boundsScaleY),container.position.set(-render.bounds.min.x*(1/boundsScaleX),-render.bounds.min.y*(1/boundsScaleY))}else constraints=allConstraints;for(i=0;i<bodies.length;i++)RenderPixi.body(render,bodies[i]);for(i=0;i<constraints.length;i++)RenderPixi.constraint(render,constraints[i]);renderer.render(container)},RenderPixi.constraint=function(render,constraint){render.engine;var bodyA=constraint.bodyA,bodyB=constraint.bodyB,pointA=constraint.pointA,pointB=constraint.pointB,container=render.container,constraintRender=constraint.render,primitiveId="c-"+constraint.id,primitive=render.primitives[primitiveId];primitive||(primitive=render.primitives[primitiveId]=new PIXI.Graphics),constraintRender.visible&&constraint.pointA&&constraint.pointB?(-1===Common.indexOf(container.children,primitive)&&container.addChild(primitive),primitive.clear(),primitive.beginFill(0,0),primitive.lineStyle(constraintRender.lineWidth,Common.colorToNumber(constraintRender.strokeStyle),1),bodyA?primitive.moveTo(bodyA.position.x+pointA.x,bodyA.position.y+pointA.y):primitive.moveTo(pointA.x,pointA.y),bodyB?primitive.lineTo(bodyB.position.x+pointB.x,bodyB.position.y+pointB.y):primitive.lineTo(pointB.x,pointB.y),primitive.endFill()):primitive.clear()},RenderPixi.body=function(render,body){render.engine;var bodyRender=body.render;if(bodyRender.visible)if(bodyRender.sprite&&bodyRender.sprite.texture){var spriteId="b-"+body.id,sprite=render.sprites[spriteId],spriteContainer=render.spriteContainer;sprite||(sprite=render.sprites[spriteId]=_createBodySprite(render,body)),-1===Common.indexOf(spriteContainer.children,sprite)&&spriteContainer.addChild(sprite),sprite.position.x=body.position.x,sprite.position.y=body.position.y,sprite.rotation=body.angle,sprite.scale.x=bodyRender.sprite.xScale||1,sprite.scale.y=bodyRender.sprite.yScale||1}else{var primitiveId="b-"+body.id,primitive=render.primitives[primitiveId],container=render.container;primitive||((primitive=render.primitives[primitiveId]=_createBodyPrimitive(render,body)).initialAngle=body.angle),-1===Common.indexOf(container.children,primitive)&&container.addChild(primitive),primitive.position.x=body.position.x,primitive.position.y=body.position.y,primitive.rotation=body.angle-primitive.initialAngle}};var _createBodySprite=function(render,body){var texturePath=body.render.sprite.texture,texture=_getTexture(render,texturePath),sprite=new PIXI.Sprite(texture);return sprite.anchor.x=body.render.sprite.xOffset,sprite.anchor.y=body.render.sprite.yOffset,sprite},_createBodyPrimitive=function(render,body){var part,bodyRender=body.render,options=render.options,primitive=new PIXI.Graphics,fillStyle=Common.colorToNumber(bodyRender.fillStyle),strokeStyle=Common.colorToNumber(bodyRender.strokeStyle),strokeStyleIndicator=Common.colorToNumber(bodyRender.strokeStyle),strokeStyleWireframe=Common.colorToNumber("#bbb"),strokeStyleWireframeIndicator=Common.colorToNumber("#CD5C5C");primitive.clear();for(var k=body.parts.length>1?1:0;k<body.parts.length;k++){part=body.parts[k],options.wireframes?(primitive.beginFill(0,0),primitive.lineStyle(1,strokeStyleWireframe,1)):(primitive.beginFill(fillStyle,1),primitive.lineStyle(bodyRender.lineWidth,strokeStyle,1)),primitive.moveTo(part.vertices[0].x-body.position.x,part.vertices[0].y-body.position.y);for(var j=1;j<part.vertices.length;j++)primitive.lineTo(part.vertices[j].x-body.position.x,part.vertices[j].y-body.position.y);primitive.lineTo(part.vertices[0].x-body.position.x,part.vertices[0].y-body.position.y),primitive.endFill(),(options.showAngleIndicator||options.showAxes)&&(primitive.beginFill(0,0),options.wireframes?primitive.lineStyle(1,strokeStyleWireframeIndicator,1):primitive.lineStyle(1,strokeStyleIndicator),primitive.moveTo(part.position.x-body.position.x,part.position.y-body.position.y),primitive.lineTo((part.vertices[0].x+part.vertices[part.vertices.length-1].x)/2-body.position.x,(part.vertices[0].y+part.vertices[part.vertices.length-1].y)/2-body.position.y),primitive.endFill())}return primitive},_getTexture=function(render,imagePath){var texture=render.textures[imagePath];return texture||(texture=render.textures[imagePath]=PIXI.Texture.fromImage(imagePath)),texture}}()},{"../body/Composite":2,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"../geometry/Vector":28}]},{},[30])(30)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MiniSignalBinding=function(){function MiniSignalBinding(fn,once,thisArg){void 0===once&&(once=!1),_classCallCheck(this,MiniSignalBinding),this._fn=fn,this._once=once,this._thisArg=thisArg,this._next=this._prev=this._owner=null}return _createClass(MiniSignalBinding,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),MiniSignalBinding}();function _addMiniSignalBinding(self,node){return self._head?(self._tail._next=node,node._prev=self._tail,self._tail=node):(self._head=node,self._tail=node),node._owner=self,node}var MiniSignal=function(){function MiniSignal(){_classCallCheck(this,MiniSignal),this._head=this._tail=void 0}return _createClass(MiniSignal,[{key:"handlers",value:function(){var exists=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],node=this._head;if(exists)return!!node;for(var ee=[];node;)ee.push(node),node=node._next;return ee}},{key:"has",value:function(node){if(!(node instanceof MiniSignalBinding))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return node._owner===this}},{key:"dispatch",value:function(){var node=this._head;if(!node)return!1;for(;node;)node._once&&this.detach(node),node._fn.apply(node._thisArg,arguments),node=node._next;return!0}},{key:"add",value:function(fn){var thisArg=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof fn)throw new Error("MiniSignal#add(): First arg must be a Function.");return _addMiniSignalBinding(this,new MiniSignalBinding(fn,!1,thisArg))}},{key:"once",value:function(fn){var thisArg=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof fn)throw new Error("MiniSignal#once(): First arg must be a Function.");return _addMiniSignalBinding(this,new MiniSignalBinding(fn,!0,thisArg))}},{key:"detach",value:function(node){if(!(node instanceof MiniSignalBinding))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return node._owner!==this?this:(node._prev&&(node._prev._next=node._next),node._next&&(node._next._prev=node._prev),node===this._head?(this._head=node._next,null===node._next&&(this._tail=null)):node===this._tail&&(this._tail=node._prev,this._tail._next=null),node._owner=null,this)}},{key:"detachAll",value:function(){var node=this._head;if(!node)return this;for(this._head=this._tail=null;node;)node._owner=null,node=node._next;return this}}]),MiniSignal}();MiniSignal.MiniSignalBinding=MiniSignalBinding,exports.default=MiniSignal,module.exports=exports.default},{}],37:[function(require,module,exports){var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}module.exports=function(val,options){options=options||{};var ms,type=typeof val;if("string"===type&&val.length>0)return function(str){if((str=String(str)).length>100)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(val);if("number"===type&&!1===isNaN(val))return options.long?plural(ms=val,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms":function(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],38:[function(require,module,exports){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map(function(n){return test2[n]}).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=function(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],39:[function(require,module,exports){"use strict";module.exports=function(str,opts){opts=opts||{};for(var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser[opts.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}},{}],40:[function(require,module,exports){exports.encode=function(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],41:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri}},{}],42:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return(path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"))||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}var outputParts=[];for(i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return(outputParts=outputParts.concat(toParts.slice(samePartsLength))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:209}],43:[function(require,module,exports){var EMPTY_ARRAY_BUFFER=new ArrayBuffer(0),Buffer=function(gl,type,data,drawType){this.gl=gl,this.buffer=gl.createBuffer(),this.type=type||gl.ARRAY_BUFFER,this.drawType=drawType||gl.STATIC_DRAW,this.data=EMPTY_ARRAY_BUFFER,data&&this.upload(data),this._updateID=0};Buffer.prototype.upload=function(data,offset,dontBind){dontBind||this.bind();var gl=this.gl;data=data||this.data,offset=offset||0,this.data.byteLength>=data.byteLength?gl.bufferSubData(this.type,offset,data):gl.bufferData(this.type,data,this.drawType),this.data=data},Buffer.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},Buffer.createVertexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ARRAY_BUFFER,data,drawType)},Buffer.createIndexBuffer=function(gl,data,drawType){return new Buffer(gl,gl.ELEMENT_ARRAY_BUFFER,data,drawType)},Buffer.create=function(gl,type,data,drawType){return new Buffer(gl,type,data,drawType)},Buffer.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},module.exports=Buffer},{}],44:[function(require,module,exports){var Texture=require("./GLTexture"),Framebuffer=function(gl,width,height){this.gl=gl,this.framebuffer=gl.createFramebuffer(),this.stencil=null,this.texture=null,this.width=width||100,this.height=height||100};Framebuffer.prototype.enableTexture=function(texture){var gl=this.gl;this.texture=texture||new Texture(gl),this.texture.bind(),this.bind(),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture.texture,0)},Framebuffer.prototype.enableStencil=function(){if(!this.stencil){var gl=this.gl;this.stencil=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,this.width,this.height)}},Framebuffer.prototype.clear=function(r,g,b,a){this.bind();var gl=this.gl;gl.clearColor(r,g,b,a),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)},Framebuffer.prototype.bind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer)},Framebuffer.prototype.unbind=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null)},Framebuffer.prototype.resize=function(width,height){var gl=this.gl;this.width=width,this.height=height,this.texture&&this.texture.uploadData(null,width,height),this.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height))},Framebuffer.prototype.destroy=function(){var gl=this.gl;this.texture&&this.texture.destroy(),gl.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},Framebuffer.createRGBA=function(gl,width,height,data){var texture=Texture.fromData(gl,null,width,height);texture.enableNearestScaling(),texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);return fbo.enableTexture(texture),fbo.unbind(),fbo},Framebuffer.createFloat32=function(gl,width,height,data){var texture=new Texture.fromData(gl,data,width,height);texture.enableNearestScaling(),texture.enableWrapClamp();var fbo=new Framebuffer(gl,width,height);return fbo.enableTexture(texture),fbo.unbind(),fbo},module.exports=Framebuffer},{"./GLTexture":46}],45:[function(require,module,exports){var compileProgram=require("./shader/compileProgram"),extractAttributes=require("./shader/extractAttributes"),extractUniforms=require("./shader/extractUniforms"),setPrecision=require("./shader/setPrecision"),generateUniformAccessObject=require("./shader/generateUniformAccessObject"),Shader=function(gl,vertexSrc,fragmentSrc,precision,attributeLocations){this.gl=gl,precision&&(vertexSrc=setPrecision(vertexSrc,precision),fragmentSrc=setPrecision(fragmentSrc,precision)),this.program=compileProgram(gl,vertexSrc,fragmentSrc,attributeLocations),this.attributes=extractAttributes(gl,this.program),this.uniformData=extractUniforms(gl,this.program),this.uniforms=generateUniformAccessObject(gl,this.uniformData)};Shader.prototype.bind=function(){return this.gl.useProgram(this.program),this},Shader.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},module.exports=Shader},{"./shader/compileProgram":51,"./shader/extractAttributes":53,"./shader/extractUniforms":54,"./shader/generateUniformAccessObject":55,"./shader/setPrecision":59}],46:[function(require,module,exports){var Texture=function(gl,width,height,format,type){this.gl=gl,this.texture=gl.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=width||-1,this.height=height||-1,this.format=format||gl.RGBA,this.type=type||gl.UNSIGNED_BYTE};Texture.prototype.upload=function(source){this.bind();var gl=this.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var newWidth=source.videoWidth||source.width,newHeight=source.videoHeight||source.height;newHeight!==this.height||newWidth!==this.width?gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,this.type,source):gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.format,this.type,source),this.width=newWidth,this.height=newHeight};var FLOATING_POINT_AVAILABLE=!1;Texture.prototype.uploadData=function(data,width,height){this.bind();var gl=this.gl;if(data instanceof Float32Array){if(!FLOATING_POINT_AVAILABLE){if(!gl.getExtension("OES_texture_float"))throw new Error("floating point textures not available");FLOATING_POINT_AVAILABLE=!0}this.type=gl.FLOAT}else this.type=this.type||gl.UNSIGNED_BYTE;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),width!==this.width||height!==this.height?gl.texImage2D(gl.TEXTURE_2D,0,this.format,width,height,0,this.format,this.type,data||null):gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,width,height,this.format,this.type,data||null),this.width=width,this.height=height},Texture.prototype.bind=function(location){var gl=this.gl;void 0!==location&&gl.activeTexture(gl.TEXTURE0+location),gl.bindTexture(gl.TEXTURE_2D,this.texture)},Texture.prototype.unbind=function(){var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,null)},Texture.prototype.minFilter=function(linear){var gl=this.gl;this.bind(),this.mipmap?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linear?gl.LINEAR:gl.NEAREST)},Texture.prototype.magFilter=function(linear){var gl=this.gl;this.bind(),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linear?gl.LINEAR:gl.NEAREST)},Texture.prototype.enableMipmap=function(){var gl=this.gl;this.bind(),this.mipmap=!0,gl.generateMipmap(gl.TEXTURE_2D)},Texture.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},Texture.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},Texture.prototype.enableWrapClamp=function(){var gl=this.gl;this.bind(),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)},Texture.prototype.enableWrapRepeat=function(){var gl=this.gl;this.bind(),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)},Texture.prototype.enableWrapMirrorRepeat=function(){var gl=this.gl;this.bind(),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.MIRRORED_REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.MIRRORED_REPEAT)},Texture.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},Texture.fromSource=function(gl,source,premultiplyAlpha){var texture=new Texture(gl);return texture.premultiplyAlpha=premultiplyAlpha||!1,texture.upload(source),texture},Texture.fromData=function(gl,data,width,height){var texture=new Texture(gl);return texture.uploadData(data,width,height),texture},module.exports=Texture},{}],47:[function(require,module,exports){var setVertexAttribArrays=require("./setVertexAttribArrays");function VertexArrayObject(gl,state){if(this.nativeVaoExtension=null,VertexArrayObject.FORCE_NATIVE||(this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=state,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(maxAttribs),attribState:new Array(maxAttribs)}}this.gl=gl,this.attributes=[],this.indexBuffer=null,this.dirty=!1}VertexArrayObject.prototype.constructor=VertexArrayObject,module.exports=VertexArrayObject,VertexArrayObject.FORCE_NATIVE=!1,VertexArrayObject.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},VertexArrayObject.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},VertexArrayObject.prototype.activate=function(){for(var gl=this.gl,lastBuffer=null,i=0;i<this.attributes.length;i++){var attrib=this.attributes[i];lastBuffer!==attrib.buffer&&(attrib.buffer.bind(),lastBuffer=attrib.buffer),gl.vertexAttribPointer(attrib.attribute.location,attrib.attribute.size,attrib.type||gl.FLOAT,attrib.normalized||!1,attrib.stride||0,attrib.start||0)}return setVertexAttribArrays(gl,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},VertexArrayObject.prototype.addAttribute=function(buffer,attribute,type,normalized,stride,start){return this.attributes.push({buffer:buffer,attribute:attribute,location:attribute.location,type:type||this.gl.FLOAT,normalized:normalized||!1,stride:stride||0,start:start||0}),this.dirty=!0,this},VertexArrayObject.prototype.addIndex=function(buffer){return this.indexBuffer=buffer,this.dirty=!0,this},VertexArrayObject.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},VertexArrayObject.prototype.draw=function(type,size,start){var gl=this.gl;return this.indexBuffer?gl.drawElements(type,size||this.indexBuffer.data.length,gl.UNSIGNED_SHORT,2*(start||0)):gl.drawArrays(type,start,size||this.getSize()),this},VertexArrayObject.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},VertexArrayObject.prototype.getSize=function(){var attrib=this.attributes[0];return attrib.buffer.data.length/(attrib.stride/4||attrib.attribute.size)}},{"./setVertexAttribArrays":50}],48:[function(require,module,exports){module.exports=function(canvas,options){var gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options);if(!gl)throw new Error("This browser does not support webGL. Try using the canvas renderer");return gl}},{}],49:[function(require,module,exports){var gl={createContext:require("./createContext"),setVertexAttribArrays:require("./setVertexAttribArrays"),GLBuffer:require("./GLBuffer"),GLFramebuffer:require("./GLFramebuffer"),GLShader:require("./GLShader"),GLTexture:require("./GLTexture"),VertexArrayObject:require("./VertexArrayObject"),shader:require("./shader")};void 0!==module&&module.exports&&(module.exports=gl),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=gl)},{"./GLBuffer":43,"./GLFramebuffer":44,"./GLShader":45,"./GLTexture":46,"./VertexArrayObject":47,"./createContext":48,"./setVertexAttribArrays":50,"./shader":56}],50:[function(require,module,exports){module.exports=function(gl,attribs,state){var i;if(state){var tempAttribState=state.tempAttribState,attribState=state.attribState;for(i=0;i<tempAttribState.length;i++)tempAttribState[i]=!1;for(i=0;i<attribs.length;i++)tempAttribState[attribs[i].attribute.location]=!0;for(i=0;i<attribState.length;i++)attribState[i]!==tempAttribState[i]&&(attribState[i]=tempAttribState[i],state.attribState[i]?gl.enableVertexAttribArray(i):gl.disableVertexAttribArray(i))}else for(i=0;i<attribs.length;i++){var attrib=attribs[i];gl.enableVertexAttribArray(attrib.attribute.location)}}},{}],51:[function(require,module,exports){var compileShader=function(gl,type,src){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(console.log(gl.getShaderInfoLog(shader)),null)};module.exports=function(gl,vertexSrc,fragmentSrc,attributeLocations){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,vertexSrc),glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragmentSrc),program=gl.createProgram();if(gl.attachShader(program,glVertShader),gl.attachShader(program,glFragShader),attributeLocations)for(var i in attributeLocations)gl.bindAttribLocation(program,attributeLocations[i],i);return gl.linkProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS)),console.error("gl.getError()",gl.getError()),""!==gl.getProgramInfoLog(program)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)),gl.deleteProgram(program),program=null),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader),program}},{}],52:[function(require,module,exports){var booleanArray=function(size){for(var array=new Array(size),i=0;i<array.length;i++)array[i]=!1;return array};module.exports=function(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"bool":return!1;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},{}],53:[function(require,module,exports){var mapType=require("./mapType"),mapSize=require("./mapSize"),pointer=function(type,normalized,stride,start){gl.vertexAttribPointer(this.location,this.size,type||gl.FLOAT,normalized||!1,stride||0,start||0)};module.exports=function(gl,program){for(var attributes={},totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i),type=mapType(gl,attribData.type);attributes[attribData.name]={type:type,size:mapSize(type),location:gl.getAttribLocation(program,attribData.name),pointer:pointer}}return attributes}},{"./mapSize":57,"./mapType":58}],54:[function(require,module,exports){var mapType=require("./mapType"),defaultValue=require("./defaultValue");module.exports=function(gl,program){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]/,""),type=mapType(gl,uniformData.type);uniforms[name]={type:type,size:uniformData.size,location:gl.getUniformLocation(program,name),value:defaultValue(type,uniformData.size)}}return uniforms}},{"./defaultValue":52,"./mapType":58}],55:[function(require,module,exports){var generateGetter=function(name){return function(){return this.data[name].value}},GLSL_SINGLE_SETTERS={float:function(gl,location,value){gl.uniform1f(location,value)},vec2:function(gl,location,value){gl.uniform2f(location,value[0],value[1])},vec3:function(gl,location,value){gl.uniform3f(location,value[0],value[1],value[2])},vec4:function(gl,location,value){gl.uniform4f(location,value[0],value[1],value[2],value[3])},int:function(gl,location,value){gl.uniform1i(location,value)},ivec2:function(gl,location,value){gl.uniform2i(location,value[0],value[1])},ivec3:function(gl,location,value){gl.uniform3i(location,value[0],value[1],value[2])},ivec4:function(gl,location,value){gl.uniform4i(location,value[0],value[1],value[2],value[3])},bool:function(gl,location,value){gl.uniform1i(location,value)},bvec2:function(gl,location,value){gl.uniform2i(location,value[0],value[1])},bvec3:function(gl,location,value){gl.uniform3i(location,value[0],value[1],value[2])},bvec4:function(gl,location,value){gl.uniform4i(location,value[0],value[1],value[2],value[3])},mat2:function(gl,location,value){gl.uniformMatrix2fv(location,!1,value)},mat3:function(gl,location,value){gl.uniformMatrix3fv(location,!1,value)},mat4:function(gl,location,value){gl.uniformMatrix4fv(location,!1,value)},sampler2D:function(gl,location,value){gl.uniform1i(location,value)}},GLSL_ARRAY_SETTERS={float:function(gl,location,value){gl.uniform1fv(location,value)},vec2:function(gl,location,value){gl.uniform2fv(location,value)},vec3:function(gl,location,value){gl.uniform3fv(location,value)},vec4:function(gl,location,value){gl.uniform4fv(location,value)},int:function(gl,location,value){gl.uniform1iv(location,value)},ivec2:function(gl,location,value){gl.uniform2iv(location,value)},ivec3:function(gl,location,value){gl.uniform3iv(location,value)},ivec4:function(gl,location,value){gl.uniform4iv(location,value)},bool:function(gl,location,value){gl.uniform1iv(location,value)},bvec2:function(gl,location,value){gl.uniform2iv(location,value)},bvec3:function(gl,location,value){gl.uniform3iv(location,value)},bvec4:function(gl,location,value){gl.uniform4iv(location,value)},sampler2D:function(gl,location,value){gl.uniform1iv(location,value)}};function generateSetter(name,uniform){return function(value){this.data[name].value=value;var location=this.data[name].location;1===uniform.size?GLSL_SINGLE_SETTERS[uniform.type](this.gl,location,value):GLSL_ARRAY_SETTERS[uniform.type](this.gl,location,value)}}function getUniformGroup(nameTokens,uniform){for(var cur=uniform,i=0;i<nameTokens.length-1;i++){var o=cur[nameTokens[i]]||{data:{}};cur[nameTokens[i]]=o,cur=o}return cur}module.exports=function(gl,uniformData){var uniforms={data:{}};uniforms.gl=gl;for(var uniformKeys=Object.keys(uniformData),i=0;i<uniformKeys.length;i++){var fullName=uniformKeys[i],nameTokens=fullName.split("."),name=nameTokens[nameTokens.length-1],uniformGroup=getUniformGroup(nameTokens,uniforms),uniform=uniformData[fullName];uniformGroup.data[name]=uniform,uniformGroup.gl=gl,Object.defineProperty(uniformGroup,name,{get:generateGetter(name),set:generateSetter(name,uniform)})}return uniforms}},{}],56:[function(require,module,exports){module.exports={compileProgram:require("./compileProgram"),defaultValue:require("./defaultValue"),extractAttributes:require("./extractAttributes"),extractUniforms:require("./extractUniforms"),generateUniformAccessObject:require("./generateUniformAccessObject"),setPrecision:require("./setPrecision"),mapSize:require("./mapSize"),mapType:require("./mapType")}},{"./compileProgram":51,"./defaultValue":52,"./extractAttributes":53,"./extractUniforms":54,"./generateUniformAccessObject":55,"./mapSize":57,"./mapType":58,"./setPrecision":59}],57:[function(require,module,exports){var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};module.exports=function(type){return GLSL_TO_SIZE[type]}},{}],58:[function(require,module,exports){var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};module.exports=function(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}},{}],59:[function(require,module,exports){module.exports=function(src,precision){return"precision"!==src.substring(0,9)?"precision "+precision+" float;\n"+src:src}},{}],60:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_ismobilejs2=_interopRequireDefault(require("ismobilejs")),_accessibleTarget2=_interopRequireDefault(require("./accessibleTarget"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_accessibleTarget2.default);var DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,AccessibilityManager=function(){function AccessibilityManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AccessibilityManager),!_ismobilejs2.default.tablet&&!_ismobilejs2.default.phone||navigator.isCocoonJS||this.createTouchHook();var div=document.createElement("div");div.style.width=DIV_TOUCH_SIZE+"px",div.style.height=DIV_TOUCH_SIZE+"px",div.style.position="absolute",div.style.top=DIV_TOUCH_POS_X+"px",div.style.left=DIV_TOUCH_POS_Y+"px",div.style.zIndex=DIV_TOUCH_ZINDEX,this.div=div,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=renderer,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return AccessibilityManager.prototype.createTouchHook=function(){var _this=this,hookDiv=document.createElement("button");hookDiv.style.width="1px",hookDiv.style.height="1px",hookDiv.style.position="absolute",hookDiv.style.top="-1000px",hookDiv.style.left="-1000px",hookDiv.style.zIndex=2,hookDiv.style.backgroundColor="#FF0000",hookDiv.title="HOOK DIV",hookDiv.addEventListener("focus",function(){_this.isMobileAccessabillity=!0,_this.activate(),document.body.removeChild(hookDiv)}),document.body.appendChild(hookDiv)},AccessibilityManager.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},AccessibilityManager.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},AccessibilityManager.prototype.updateAccessibleObjects=function(displayObject){if(displayObject.visible){displayObject.accessible&&displayObject.interactive&&(displayObject._accessibleActive||this.addChild(displayObject),displayObject.renderId=this.renderId);for(var children=displayObject.children,i=children.length-1;i>=0;i--)this.updateAccessibleObjects(children[i])}},AccessibilityManager.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect(),sx=rect.width/this.renderer.width,sy=rect.height/this.renderer.height,div=this.div;div.style.left=rect.left+"px",div.style.top=rect.top+"px",div.style.width=this.renderer.width+"px",div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId)child._accessibleActive=!1,core.utils.removeItems(this.children,i,1),this.div.removeChild(child._accessibleDiv),this.pool.push(child._accessibleDiv),child._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{div=child._accessibleDiv;var hitArea=child.hitArea,wt=child.worldTransform;child.hitArea?(div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px",div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px",div.style.width=hitArea.width*wt.a*sx+"px",div.style.height=hitArea.height*wt.d*sy+"px"):(hitArea=child.getBounds(),this.capHitArea(hitArea),div.style.left=hitArea.x*sx+"px",div.style.top=hitArea.y*sy+"px",div.style.width=hitArea.width*sx+"px",div.style.height=hitArea.height*sy+"px")}}this.renderId++}},AccessibilityManager.prototype.capHitArea=function(hitArea){hitArea.x<0&&(hitArea.width+=hitArea.x,hitArea.x=0),hitArea.y<0&&(hitArea.height+=hitArea.y,hitArea.y=0),hitArea.x+hitArea.width>this.renderer.width&&(hitArea.width=this.renderer.width-hitArea.x),hitArea.y+hitArea.height>this.renderer.height&&(hitArea.height=this.renderer.height-hitArea.y)},AccessibilityManager.prototype.addChild=function(displayObject){var div=this.pool.pop();div||((div=document.createElement("button")).style.width=DIV_TOUCH_SIZE+"px",div.style.height=DIV_TOUCH_SIZE+"px",div.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",div.style.position="absolute",div.style.zIndex=DIV_TOUCH_ZINDEX,div.style.borderStyle="none",div.addEventListener("click",this._onClick.bind(this)),div.addEventListener("focus",this._onFocus.bind(this)),div.addEventListener("focusout",this._onFocusOut.bind(this))),displayObject.accessibleTitle?div.title=displayObject.accessibleTitle:displayObject.accessibleTitle||displayObject.accessibleHint||(div.title="displayObject "+this.tabIndex),displayObject.accessibleHint&&div.setAttribute("aria-label",displayObject.accessibleHint),displayObject._accessibleActive=!0,displayObject._accessibleDiv=div,div.displayObject=displayObject,this.children.push(displayObject),this.div.appendChild(displayObject._accessibleDiv),displayObject._accessibleDiv.tabIndex=displayObject.tabIndex},AccessibilityManager.prototype._onClick=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData)},AccessibilityManager.prototype._onFocus=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)},AccessibilityManager.prototype._onFocusOut=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)},AccessibilityManager.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},AccessibilityManager.prototype._onMouseMove=function(){this.deactivate()},AccessibilityManager.prototype.destroy=function(){this.div=null;for(var i=0;i<this.children.length;i++)this.children[i].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},AccessibilityManager}();exports.default=AccessibilityManager,core.WebGLRenderer.registerPlugin("accessibility",AccessibilityManager),core.CanvasRenderer.registerPlugin("accessibility",AccessibilityManager)},{"../core":85,"./accessibleTarget":61,ismobilejs:34}],61:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},{}],62:[function(require,module,exports){"use strict";exports.__esModule=!0;var _accessibleTarget=require("./accessibleTarget");Object.defineProperty(exports,"accessibleTarget",{enumerable:!0,get:function(){return _interopRequireDefault(_accessibleTarget).default}});var _AccessibilityManager=require("./AccessibilityManager");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"AccessibilityManager",{enumerable:!0,get:function(){return _interopRequireDefault(_AccessibilityManager).default}})},{"./AccessibilityManager":60,"./accessibleTarget":61}],63:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_autoDetectRenderer=require("./autoDetectRenderer"),_Container2=_interopRequireDefault(require("./display/Container")),_ticker=require("./ticker"),_settings2=_interopRequireDefault(require("./settings")),_const=require("./const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Application=function(){function Application(options,arg2,arg3,arg4,arg5){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Application),"number"==typeof options&&(options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height,forceCanvas:!!arg4,sharedTicker:!!arg5},arg3)),this._options=options=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},options),this.renderer=(0,_autoDetectRenderer.autoDetectRenderer)(options),this.stage=new _Container2.default,this._ticker=null,this.ticker=options.sharedTicker?_ticker.shared:new _ticker.Ticker,options.autoStart&&this.start()}return Application.prototype.render=function(){this.renderer.render(this.stage)},Application.prototype.stop=function(){this._ticker.stop()},Application.prototype.start=function(){this._ticker.start()},Application.prototype.destroy=function(removeView){var oldTicker=this._ticker;this.ticker=null,oldTicker.destroy(),this.stage.destroy(),this.stage=null,this.renderer.destroy(removeView),this.renderer=null,this._options=null},_createClass(Application,[{key:"ticker",set:function(ticker){this._ticker&&this._ticker.remove(this.render,this),this._ticker=ticker,ticker&&ticker.add(this.render,this,_const.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),Application}();exports.default=Application},{"./autoDetectRenderer":65,"./const":66,"./display/Container":68,"./settings":121,"./ticker":141}],64:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_pixiGlCore=require("pixi-gl-core"),_settings=require("./settings"),_settings2=(obj=_settings)&&obj.__esModule?obj:{default:obj};function checkPrecision(src,def){if(src instanceof Array){if("precision"!==src[0].substring(0,9)){var copy=src.slice(0);return copy.unshift("precision "+def+" float;"),copy}}else if("precision"!==src.trim().substring(0,9))return"precision "+def+" float;\n"+src;return src}var Shader=function(_GLShader){function Shader(gl,vertexSrc,fragmentSrc,attributeLocations,precision){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Shader),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_GLShader.call(this,gl,checkPrecision(vertexSrc,precision||_settings2.default.PRECISION_VERTEX),checkPrecision(fragmentSrc,precision||_settings2.default.PRECISION_FRAGMENT),void 0,attributeLocations))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Shader,_GLShader),Shader}(_pixiGlCore.GLShader);exports.default=Shader},{"./settings":121,"pixi-gl-core":49}],65:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.autoDetectRenderer=function(options,arg1,arg2,arg3){var forceCanvas=options&&options.forceCanvas;void 0!==arg3&&(forceCanvas=arg3);if(!forceCanvas&&utils.isWebGLSupported())return new _WebGLRenderer2.default(options,arg1,arg2);return new _CanvasRenderer2.default(options,arg1,arg2)};var utils=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./utils")),_CanvasRenderer2=_interopRequireDefault(require("./renderers/canvas/CanvasRenderer")),_WebGLRenderer2=_interopRequireDefault(require("./renderers/webgl/WebGLRenderer"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./renderers/canvas/CanvasRenderer":97,"./renderers/webgl/WebGLRenderer":104,"./utils":145}],66:[function(require,module,exports){"use strict";exports.__esModule=!0;exports.VERSION="4.7.0",exports.PI_2=2*Math.PI,exports.RAD_TO_DEG=180/Math.PI,exports.DEG_TO_RAD=Math.PI/180,exports.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},exports.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},exports.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},exports.SCALE_MODES={LINEAR:0,NEAREST:1},exports.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},exports.GC_MODES={AUTO:0,MANUAL:1},exports.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,exports.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;(charset=[\w-]+|base64))?,(.*)/i,exports.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,exports.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},exports.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},exports.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},exports.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},exports.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50}},{}],67:[function(require,module,exports){"use strict";exports.__esModule=!0;var _math=require("../math");var Bounds=function(){function Bounds(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Bounds),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return Bounds.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},Bounds.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},Bounds.prototype.getRectangle=function(rect){return this.minX>this.maxX||this.minY>this.maxY?_math.Rectangle.EMPTY:((rect=rect||new _math.Rectangle(0,0,1,1)).x=this.minX,rect.y=this.minY,rect.width=this.maxX-this.minX,rect.height=this.maxY-this.minY,rect)},Bounds.prototype.addPoint=function(point){this.minX=Math.min(this.minX,point.x),this.maxX=Math.max(this.maxX,point.x),this.minY=Math.min(this.minY,point.y),this.maxY=Math.max(this.maxY,point.y)},Bounds.prototype.addQuad=function(vertices){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=vertices[0],y=vertices[1];minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[2],y=vertices[3],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[4],y=vertices[5],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,x=vertices[6],y=vertices[7],minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addFrame=function(transform,x0,y0,x1,y1){var matrix=transform.worldTransform,a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=a*x0+c*y0+tx,y=b*x0+d*y0+ty;minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,y=b*x1+d*y0+ty,minX=(x=a*x1+c*y0+tx)<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,y=b*x0+d*y1+ty,minX=(x=a*x0+c*y1+tx)<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,y=b*x1+d*y1+ty,minX=(x=a*x1+c*y1+tx)<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addVertices=function(transform,vertices,beginOffset,endOffset){for(var matrix=transform.worldTransform,a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i],rawY=vertices[i+1],x=a*rawX+c*rawY+tx,y=d*rawY+b*rawX+ty;minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addBounds=function(bounds){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX,this.minY=bounds.minY<minY?bounds.minY:minY,this.maxX=bounds.maxX>maxX?bounds.maxX:maxX,this.maxY=bounds.maxY>maxY?bounds.maxY:maxY},Bounds.prototype.addBoundsMask=function(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX,_minY=bounds.minY>mask.minY?bounds.minY:mask.minY,_maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX,_maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds.prototype.addBoundsArea=function(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x,_minY=bounds.minY>area.y?bounds.minY:area.y,_maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width,_maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds}();exports.default=Bounds},{"../math":90}],68:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_utils=require("../utils"),_DisplayObject2=require("./DisplayObject");var Container=function(_DisplayObject){function Container(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Container);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_DisplayObject.call(this));return _this.children=[],_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Container,_DisplayObject),Container.prototype.onChildrenChange=function(){},Container.prototype.addChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1)for(var i=0;i<argumentsLength;i++)this.addChild(arguments[i]);else child.parent&&child.parent.removeChild(child),child.parent=this,child.transform._parentID=-1,this.children.push(child),this._boundsID++,this.onChildrenChange(this.children.length-1),child.emit("added",this);return child},Container.prototype.addChildAt=function(child,index){if(index<0||index>this.children.length)throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length);return child.parent&&child.parent.removeChild(child),child.parent=this,child.transform._parentID=-1,this.children.splice(index,0,child),this._boundsID++,this.onChildrenChange(index),child.emit("added",this),child},Container.prototype.swapChildren=function(child,child2){if(child!==child2){var index1=this.getChildIndex(child),index2=this.getChildIndex(child2);this.children[index1]=child2,this.children[index2]=child,this.onChildrenChange(index1<index2?index1:index2)}},Container.prototype.getChildIndex=function(child){var index=this.children.indexOf(child);if(-1===index)throw new Error("The supplied DisplayObject must be a child of the caller");return index},Container.prototype.setChildIndex=function(child,index){if(index<0||index>=this.children.length)throw new Error("The supplied index is out of bounds");var currentIndex=this.getChildIndex(child);(0,_utils.removeItems)(this.children,currentIndex,1),this.children.splice(index,0,child),this.onChildrenChange(index)},Container.prototype.getChildAt=function(index){if(index<0||index>=this.children.length)throw new Error("getChildAt: Index ("+index+") does not exist.");return this.children[index]},Container.prototype.removeChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1)for(var i=0;i<argumentsLength;i++)this.removeChild(arguments[i]);else{var index=this.children.indexOf(child);if(-1===index)return null;child.parent=null,child.transform._parentID=-1,(0,_utils.removeItems)(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this)}return child},Container.prototype.removeChildAt=function(index){var child=this.getChildAt(index);return child.parent=null,child.transform._parentID=-1,(0,_utils.removeItems)(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this),child},Container.prototype.removeChildren=function(){var beginIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,endIndex=arguments[1],begin=beginIndex,end="number"==typeof endIndex?endIndex:this.children.length,range=end-begin,removed=void 0;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(var i=0;i<removed.length;++i)removed[i].parent=null,removed[i].transform&&(removed[i].transform._parentID=-1);this._boundsID++,this.onChildrenChange(beginIndex);for(var _i=0;_i<removed.length;++_i)removed[_i].emit("removed",this);return removed}if(0===range&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},Container.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&child.updateTransform()}},Container.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];child.visible&&child.renderable&&(child.calculateBounds(),child._mask?(child._mask.calculateBounds(),this._bounds.addBoundsMask(child._bounds,child._mask._bounds)):child.filterArea?this._bounds.addBoundsArea(child._bounds,child.filterArea):this._bounds.addBounds(child._bounds))}this._lastBoundsID=this._boundsID},Container.prototype._calculateBounds=function(){},Container.prototype.renderWebGL=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(renderer);else{this._renderWebGL(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].renderWebGL(renderer)}},Container.prototype.renderAdvancedWebGL=function(renderer){renderer.flush();var filters=this._filters,mask=this._mask;if(filters){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<filters.length;i++)filters[i].enabled&&this._enabledFilters.push(filters[i]);this._enabledFilters.length&&renderer.filterManager.pushFilter(this,this._enabledFilters)}mask&&renderer.maskManager.pushMask(this,this._mask),this._renderWebGL(renderer);for(var _i2=0,j=this.children.length;_i2<j;_i2++)this.children[_i2].renderWebGL(renderer);renderer.flush(),mask&&renderer.maskManager.popMask(this,this._mask),filters&&this._enabledFilters&&this._enabledFilters.length&&renderer.filterManager.popFilter()},Container.prototype._renderWebGL=function(renderer){},Container.prototype._renderCanvas=function(renderer){},Container.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&renderer.maskManager.pushMask(this._mask),this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].renderCanvas(renderer);this._mask&&renderer.maskManager.popMask(renderer)}},Container.prototype.destroy=function(options){_DisplayObject.prototype.destroy.call(this);var destroyChildren="boolean"==typeof options?options:options&&options.children,oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren)for(var i=0;i<oldChildren.length;++i)oldChildren[i].destroy(options)},_createClass(Container,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;this.scale.x=0!==width?value/width:1,this._width=value}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;this.scale.y=0!==height?value/height:1,this._height=value}}]),Container}(((obj=_DisplayObject2)&&obj.__esModule?obj:{default:obj}).default);exports.default=Container,Container.prototype.containerUpdateTransform=Container.prototype.updateTransform},{"../utils":145,"./DisplayObject":69}],69:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_const=require("../const"),_settings2=_interopRequireDefault(require("../settings")),_TransformStatic2=_interopRequireDefault(require("./TransformStatic")),_Transform2=_interopRequireDefault(require("./Transform")),_Bounds2=_interopRequireDefault(require("./Bounds")),_math=require("../math");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DisplayObject=function(_EventEmitter){function DisplayObject(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DisplayObject);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this)),TransformClass=_settings2.default.TRANSFORM_MODE===_const.TRANSFORM_MODE.STATIC?_TransformStatic2.default:_Transform2.default;return _this.tempDisplayObjectParent=null,_this.transform=new TransformClass,_this.alpha=1,_this.visible=!0,_this.renderable=!0,_this.parent=null,_this.worldAlpha=1,_this.filterArea=null,_this._filters=null,_this._enabledFilters=null,_this._bounds=new _Bounds2.default,_this._boundsID=0,_this._lastBoundsID=-1,_this._boundsRect=null,_this._localBoundsRect=null,_this._mask=null,_this._destroyed=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(DisplayObject,_EventEmitter),DisplayObject.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},DisplayObject.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},DisplayObject.prototype.getBounds=function(skipUpdate,rect){return skipUpdate||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),rect||(this._boundsRect||(this._boundsRect=new _math.Rectangle),rect=this._boundsRect),this._bounds.getRectangle(rect)},DisplayObject.prototype.getLocalBounds=function(rect){var transformRef=this.transform,parentRef=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,rect||(this._localBoundsRect||(this._localBoundsRect=new _math.Rectangle),rect=this._localBoundsRect);var bounds=this.getBounds(!1,rect);return this.parent=parentRef,this.transform=transformRef,bounds},DisplayObject.prototype.toGlobal=function(position,point){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(position,point)},DisplayObject.prototype.toLocal=function(position,from,point,skipUpdate){return from&&(position=from.toGlobal(position,point,skipUpdate)),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(position,point)},DisplayObject.prototype.renderWebGL=function(renderer){},DisplayObject.prototype.renderCanvas=function(renderer){},DisplayObject.prototype.setParent=function(container){if(!container||!container.addChild)throw new Error("setParent: Argument must be a Container");return container.addChild(this),container},DisplayObject.prototype.setTransform=function(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,scaleX=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,scaleY=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,rotation=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,skewX=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,skewY=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,pivotX=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,pivotY=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=x,this.position.y=y,this.scale.x=scaleX||1,this.scale.y=scaleY||1,this.rotation=rotation,this.skew.x=skewX,this.skew.y=skewY,this.pivot.x=pivotX,this.pivot.y=pivotY,this},DisplayObject.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},_createClass(DisplayObject,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new DisplayObject),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(value){this.transform.position.x=value}},{key:"y",get:function(){return this.position.y},set:function(value){this.transform.position.y=value}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(value){this.transform.position.copy(value)}},{key:"scale",get:function(){return this.transform.scale},set:function(value){this.transform.scale.copy(value)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(value){this.transform.pivot.copy(value)}},{key:"skew",get:function(){return this.transform.skew},set:function(value){this.transform.skew.copy(value)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(value){this.transform.rotation=value}},{key:"worldVisible",get:function(){var item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0}},{key:"mask",get:function(){return this._mask},set:function(value){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=value,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(value){this._filters=value&&value.slice()}}]),DisplayObject}(_eventemitter2.default);exports.default=DisplayObject,DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform},{"../const":66,"../math":90,"../settings":121,"./Bounds":67,"./Transform":70,"./TransformStatic":72,eventemitter3:29}],70:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_math=require("../math"),_TransformBase2=require("./TransformBase");var Transform=function(_TransformBase){function Transform(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Transform);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_TransformBase.call(this));return _this.position=new _math.Point(0,0),_this.scale=new _math.Point(1,1),_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0),_this.pivot=new _math.Point(0,0),_this._rotation=0,_this._cx=1,_this._sx=0,_this._cy=0,_this._sy=1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Transform,_TransformBase),Transform.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},Transform.prototype.updateLocalTransform=function(){var lt=this.localTransform;lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d)},Transform.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d);var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._worldID++},Transform.prototype.setFromMatrix=function(matrix){matrix.decompose(this)},_createClass(Transform,[{key:"rotation",get:function(){return this._rotation},set:function(value){this._rotation=value,this.updateSkew()}}]),Transform}(((obj=_TransformBase2)&&obj.__esModule?obj:{default:obj}).default);exports.default=Transform},{"../math":90,"./TransformBase":71}],71:[function(require,module,exports){"use strict";exports.__esModule=!0;var _math=require("../math");var TransformBase=function(){function TransformBase(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TransformBase),this.worldTransform=new _math.Matrix,this.localTransform=new _math.Matrix,this._worldID=0,this._parentID=0}return TransformBase.prototype.updateLocalTransform=function(){},TransformBase.prototype.updateTransform=function(parentTransform){var pt=parentTransform.worldTransform,wt=this.worldTransform,lt=this.localTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._worldID++},TransformBase}();exports.default=TransformBase,TransformBase.prototype.updateWorldTransform=TransformBase.prototype.updateTransform,TransformBase.IDENTITY=new TransformBase},{"../math":90}],72:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_math=require("../math"),_TransformBase2=require("./TransformBase");var TransformStatic=function(_TransformBase){function TransformStatic(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TransformStatic);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_TransformBase.call(this));return _this.position=new _math.ObservablePoint(_this.onChange,_this,0,0),_this.scale=new _math.ObservablePoint(_this.onChange,_this,1,1),_this.pivot=new _math.ObservablePoint(_this.onChange,_this,0,0),_this.skew=new _math.ObservablePoint(_this.updateSkew,_this,0,0),_this._rotation=0,_this._cx=1,_this._sx=0,_this._cy=0,_this._sy=1,_this._localID=0,_this._currentLocalID=0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TransformStatic,_TransformBase),TransformStatic.prototype.onChange=function(){this._localID++},TransformStatic.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},TransformStatic.prototype.updateLocalTransform=function(){var lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale._x,lt.b=this._sx*this.scale._x,lt.c=this._cy*this.scale._y,lt.d=this._sy*this.scale._y,lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c),lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)},TransformStatic.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale._x,lt.b=this._sx*this.scale._x,lt.c=this._cy*this.scale._y,lt.d=this._sy*this.scale._y,lt.tx=this.position._x-(this.pivot._x*lt.a+this.pivot._y*lt.c),lt.ty=this.position._y-(this.pivot._x*lt.b+this.pivot._y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}},TransformStatic.prototype.setFromMatrix=function(matrix){matrix.decompose(this),this._localID++},_createClass(TransformStatic,[{key:"rotation",get:function(){return this._rotation},set:function(value){this._rotation=value,this.updateSkew()}}]),TransformStatic}(((obj=_TransformBase2)&&obj.__esModule?obj:{default:obj}).default);exports.default=TransformStatic},{"../math":90,"./TransformBase":71}],73:[function(require,module,exports){"use strict";exports.__esModule=!0;var _Container3=_interopRequireDefault(require("../display/Container")),_RenderTexture2=_interopRequireDefault(require("../textures/RenderTexture")),_Texture2=_interopRequireDefault(require("../textures/Texture")),_GraphicsData2=_interopRequireDefault(require("./GraphicsData")),_Sprite2=_interopRequireDefault(require("../sprites/Sprite")),_math=require("../math"),_utils=require("../utils"),_const=require("../const"),_Bounds2=_interopRequireDefault(require("../display/Bounds")),_bezierCurveTo3=_interopRequireDefault(require("./utils/bezierCurveTo")),_CanvasRenderer2=_interopRequireDefault(require("../renderers/canvas/CanvasRenderer"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var canvasRenderer=void 0,tempMatrix=new _math.Matrix,tempPoint=new _math.Point,tempColor1=new Float32Array(4),tempColor2=new Float32Array(4),Graphics=function(_Container){function Graphics(){var nativeLines=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Graphics);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Container.call(this));return _this.fillAlpha=1,_this.lineWidth=0,_this.nativeLines=nativeLines,_this.lineColor=0,_this.graphicsData=[],_this.tint=16777215,_this._prevTint=16777215,_this.blendMode=_const.BLEND_MODES.NORMAL,_this.currentPath=null,_this._webGL={},_this.isMask=!1,_this.boundsPadding=0,_this._localBounds=new _Bounds2.default,_this.dirty=0,_this.fastRectDirty=-1,_this.clearDirty=0,_this.boundsDirty=-1,_this.cachedSpriteDirty=!1,_this._spriteRect=null,_this._fastRect=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Graphics,_Container),Graphics.prototype.clone=function(){var clone=new Graphics;clone.renderable=this.renderable,clone.fillAlpha=this.fillAlpha,clone.lineWidth=this.lineWidth,clone.lineColor=this.lineColor,clone.tint=this.tint,clone.blendMode=this.blendMode,clone.isMask=this.isMask,clone.boundsPadding=this.boundsPadding,clone.dirty=0,clone.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i)clone.graphicsData.push(this.graphicsData[i].clone());return clone.currentPath=clone.graphicsData[clone.graphicsData.length-1],clone.updateLocalBounds(),clone},Graphics.prototype.lineStyle=function(){var lineWidth=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,color=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,alpha=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.lineWidth=lineWidth,this.lineColor=color,this.lineAlpha=alpha,this.currentPath)if(this.currentPath.shape.points.length){var shape=new _math.Polygon(this.currentPath.shape.points.slice(-2));shape.closed=!1,this.drawShape(shape)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},Graphics.prototype.moveTo=function(x,y){var shape=new _math.Polygon([x,y]);return shape.closed=!1,this.drawShape(shape),this},Graphics.prototype.lineTo=function(x,y){return this.currentPath.shape.points.push(x,y),this.dirty++,this},Graphics.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var points=this.currentPath.shape.points,xa=0,ya=0;0===points.length&&this.moveTo(0,0);for(var fromX=points[points.length-2],fromY=points[points.length-1],i=1;i<=20;++i){var j=i/20;xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}return this.dirty++,this},Graphics.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1];return points.length-=2,(0,_bezierCurveTo3.default)(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY,points),this.dirty++,this},Graphics.prototype.arcTo=function(x1,y1,x2,y2,radius){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(x1,y1):this.moveTo(x1,y1);var points=this.currentPath.shape.points,fromX=points[points.length-2],a1=points[points.length-1]-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||0===radius)points[points.length-2]===x1&&points[points.length-1]===y1||points.push(x1,y1);else{var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}return this.dirty++,this},Graphics.prototype.arc=function(cx,cy,radius,startAngle,endAngle){var anticlockwise=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(startAngle===endAngle)return this;!anticlockwise&&endAngle<=startAngle?endAngle+=_const.PI_2:anticlockwise&&startAngle<=endAngle&&(startAngle+=_const.PI_2);var sweep=endAngle-startAngle,segs=40*Math.ceil(Math.abs(sweep)/_const.PI_2);if(0===sweep)return this;var startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius,points=this.currentPath?this.currentPath.shape.points:null;points?points[points.length-2]===startX&&points[points.length-1]===startY||points.push(startX,startY):(this.moveTo(startX,startY),points=this.currentPath.shape.points);for(var theta=sweep/(2*segs),theta2=2*theta,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=segs-1,remainder=segMinus%1/segMinus,i=0;i<=segMinus;++i){var angle=theta+startAngle+theta2*(i+remainder*i),c=Math.cos(angle),s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}return this.dirty++,this},Graphics.prototype.beginFill=function(){var color=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,alpha=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=color,this.fillAlpha=alpha,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},Graphics.prototype.drawRect=function(x,y,width,height){return this.drawShape(new _math.Rectangle(x,y,width,height)),this},Graphics.prototype.drawRoundedRect=function(x,y,width,height,radius){return this.drawShape(new _math.RoundedRectangle(x,y,width,height,radius)),this},Graphics.prototype.drawCircle=function(x,y,radius){return this.drawShape(new _math.Circle(x,y,radius)),this},Graphics.prototype.drawEllipse=function(x,y,width,height){return this.drawShape(new _math.Ellipse(x,y,width,height)),this},Graphics.prototype.drawPolygon=function(path){var points=path,closed=!0;if(points instanceof _math.Polygon&&(closed=points.closed,points=points.points),!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i)points[i]=arguments[i]}var shape=new _math.Polygon(points);return shape.closed=closed,this.drawShape(shape),this},Graphics.prototype.drawStar=function(x,y,points,radius,innerRadius){var rotation=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;innerRadius=innerRadius||radius/2;for(var startAngle=-1*Math.PI/2+rotation,len=2*points,delta=_const.PI_2/len,polygon=[],i=0;i<len;i++){var r=i%2?innerRadius:radius,angle=i*delta+startAngle;polygon.push(x+r*Math.cos(angle),y+r*Math.sin(angle))}return this.drawPolygon(polygon)},Graphics.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.filling=!1,this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},Graphics.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===_const.SHAPES.RECT&&!this.graphicsData[0].lineWidth},Graphics.prototype._renderWebGL=function(renderer){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(renderer):(renderer.setObjectRenderer(renderer.plugins.graphics),renderer.plugins.graphics.render(this))},Graphics.prototype._renderSpriteRect=function(renderer){var rect=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new _Sprite2.default(new _Texture2.default(_Texture2.default.WHITE)));var sprite=this._spriteRect;if(16777215===this.tint)sprite.tint=this.graphicsData[0].fillColor;else{var t1=tempColor1,t2=tempColor2;(0,_utils.hex2rgb)(this.graphicsData[0].fillColor,t1),(0,_utils.hex2rgb)(this.tint,t2),t1[0]*=t2[0],t1[1]*=t2[1],t1[2]*=t2[2],sprite.tint=(0,_utils.rgb2hex)(t1)}sprite.alpha=this.graphicsData[0].fillAlpha,sprite.worldAlpha=this.worldAlpha*sprite.alpha,sprite.blendMode=this.blendMode,sprite._texture._frame.width=rect.width,sprite._texture._frame.height=rect.height,sprite.transform.worldTransform=this.transform.worldTransform,sprite.anchor.set(-rect.x/rect.width,-rect.y/rect.height),sprite._onAnchorUpdate(),sprite._renderWebGL(renderer)},Graphics.prototype._renderCanvas=function(renderer){!0!==this.isMask&&renderer.plugins.graphics.render(this)},Graphics.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var lb=this._localBounds;this._bounds.addFrame(this.transform,lb.minX,lb.minY,lb.maxX,lb.maxY)},Graphics.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);for(var graphicsData=this.graphicsData,i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(data.fill&&(data.shape&&data.shape.contains(tempPoint.x,tempPoint.y))){if(data.holes)for(var _i=0;_i<data.holes.length;_i++){if(data.holes[_i].contains(tempPoint.x,tempPoint.y))return!1}return!0}}return!1},Graphics.prototype.updateLocalBounds=function(){var minX=1/0,maxX=-1/0,minY=1/0,maxY=-1/0;if(this.graphicsData.length)for(var shape=0,x=0,y=0,w=0,h=0,i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i],type=data.type,lineWidth=data.lineWidth;if(shape=data.shape,type===_const.SHAPES.RECT||type===_const.SHAPES.RREC)x=shape.x-lineWidth/2,y=shape.y-lineWidth/2,w=shape.width+lineWidth,h=shape.height+lineWidth,minX=x<minX?x:minX,maxX=x+w>maxX?x+w:maxX,minY=y<minY?y:minY,maxY=y+h>maxY?y+h:maxY;else if(type===_const.SHAPES.CIRC)x=shape.x,y=shape.y,w=shape.radius+lineWidth/2,h=shape.radius+lineWidth/2,minX=x-w<minX?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=y-h<minY?y-h:minY,maxY=y+h>maxY?y+h:maxY;else if(type===_const.SHAPES.ELIP)x=shape.x,y=shape.y,w=shape.width+lineWidth/2,h=shape.height+lineWidth/2,minX=x-w<minX?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=y-h<minY?y-h:minY,maxY=y+h>maxY?y+h:maxY;else for(var points=shape.points,x2=0,y2=0,dx=0,dy=0,rw=0,rh=0,cx=0,cy=0,j=0;j+2<points.length;j+=2)x=points[j],y=points[j+1],x2=points[j+2],y2=points[j+3],dx=Math.abs(x2-x),dy=Math.abs(y2-y),h=lineWidth,(w=Math.sqrt(dx*dx+dy*dy))<1e-9||(rh=(h/w*dx+dy)/2,cy=(y2+y)/2,minX=(cx=(x2+x)/2)-(rw=(h/w*dy+dx)/2)<minX?cx-rw:minX,maxX=cx+rw>maxX?cx+rw:maxX,minY=cy-rh<minY?cy-rh:minY,maxY=cy+rh>maxY?cy+rh:maxY)}else minX=0,maxX=0,minY=0,maxY=0;var padding=this.boundsPadding;this._localBounds.minX=minX-padding,this._localBounds.maxX=maxX+padding,this._localBounds.minY=minY-padding,this._localBounds.maxY=maxY+padding},Graphics.prototype.drawShape=function(shape){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var data=new _GraphicsData2.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,shape);return this.graphicsData.push(data),data.type===_const.SHAPES.POLY&&(data.shape.closed=data.shape.closed||this.filling,this.currentPath=data),this.dirty++,data},Graphics.prototype.generateCanvasTexture=function(scaleMode){var resolution=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,bounds=this.getLocalBounds(),canvasBuffer=_RenderTexture2.default.create(bounds.width,bounds.height,scaleMode,resolution);canvasRenderer||(canvasRenderer=new _CanvasRenderer2.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(tempMatrix),tempMatrix.invert(),tempMatrix.tx-=bounds.x,tempMatrix.ty-=bounds.y,canvasRenderer.render(this,canvasBuffer,!0,tempMatrix);var texture=_Texture2.default.fromCanvas(canvasBuffer.baseTexture._canvasRenderTarget.canvas,scaleMode,"graphics");return texture.baseTexture.resolution=resolution,texture.baseTexture.update(),texture},Graphics.prototype.closePath=function(){var currentPath=this.currentPath;return currentPath&&currentPath.shape&&currentPath.shape.close(),this},Graphics.prototype.addHole=function(){var hole=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(hole.shape),this.currentPath=null,this},Graphics.prototype.destroy=function(options){_Container.prototype.destroy.call(this,options);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();for(var id in this._webgl)for(var j=0;j<this._webgl[id].data.length;++j)this._webgl[id].data[j].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null},Graphics}(_Container3.default);exports.default=Graphics,Graphics._SPRITE_TEXTURE=null},{"../const":66,"../display/Bounds":67,"../display/Container":68,"../math":90,"../renderers/canvas/CanvasRenderer":97,"../sprites/Sprite":122,"../textures/RenderTexture":133,"../textures/Texture":135,"../utils":145,"./GraphicsData":74,"./utils/bezierCurveTo":76}],74:[function(require,module,exports){"use strict";exports.__esModule=!0;var GraphicsData=function(){function GraphicsData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,nativeLines,shape){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GraphicsData),this.lineWidth=lineWidth,this.nativeLines=nativeLines,this.lineColor=lineColor,this.lineAlpha=lineAlpha,this._lineTint=lineColor,this.fillColor=fillColor,this.fillAlpha=fillAlpha,this._fillTint=fillColor,this.fill=fill,this.holes=[],this.shape=shape,this.type=shape.type}return GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape)},GraphicsData.prototype.addHole=function(shape){this.holes.push(shape)},GraphicsData.prototype.destroy=function(){this.shape=null,this.holes=null},GraphicsData}();exports.default=GraphicsData},{}],75:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_CanvasRenderer=require("../../renderers/canvas/CanvasRenderer"),_CanvasRenderer2=(obj=_CanvasRenderer)&&obj.__esModule?obj:{default:obj},_const=require("../../const");var CanvasGraphicsRenderer=function(){function CanvasGraphicsRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasGraphicsRenderer),this.renderer=renderer}return CanvasGraphicsRenderer.prototype.render=function(graphics){var renderer=this.renderer,context=renderer.context,worldAlpha=graphics.worldAlpha,transform=graphics.transform.worldTransform,resolution=renderer.resolution;this._prevTint!==this.tint&&(this.dirty=!0),context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),graphics.dirty&&(this.updateGraphicsTint(graphics),graphics.dirty=!1),renderer.setBlendMode(graphics.blendMode);for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i],shape=data.shape,fillColor=data._fillTint,lineColor=data._lineTint;if(context.lineWidth=data.lineWidth,data.type===_const.SHAPES.POLY){context.beginPath(),this.renderPolygon(shape.points,shape.closed,context);for(var j=0;j<data.holes.length;j++)this.renderPolygon(data.holes[j].points,!0,context);data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===_const.SHAPES.RECT)(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fillRect(shape.x,shape.y,shape.width,shape.height)),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.strokeRect(shape.x,shape.y,shape.width,shape.height));else if(data.type===_const.SHAPES.CIRC)context.beginPath(),context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke());else if(data.type===_const.SHAPES.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2;context.beginPath();var ox=w/2*.5522848,oy=h/2*.5522848,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===_const.SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.beginPath(),context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath(),(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}}},CanvasGraphicsRenderer.prototype.updateGraphicsTint=function(graphics){graphics._prevTint=graphics.tint;for(var tintR=(graphics.tint>>16&255)/255,tintG=(graphics.tint>>8&255)/255,tintB=(255&graphics.tint)/255,i=0;i<graphics.graphicsData.length;++i){var data=graphics.graphicsData[i],fillColor=0|data.fillColor,lineColor=0|data.lineColor;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(255&fillColor)/255*tintB*255,data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(255&lineColor)/255*tintB*255}},CanvasGraphicsRenderer.prototype.renderPolygon=function(points,close,context){context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;++j)context.lineTo(points[2*j],points[2*j+1]);close&&context.closePath()},CanvasGraphicsRenderer.prototype.destroy=function(){this.renderer=null},CanvasGraphicsRenderer}();exports.default=CanvasGraphicsRenderer,_CanvasRenderer2.default.registerPlugin("graphics",CanvasGraphicsRenderer)},{"../../const":66,"../../renderers/canvas/CanvasRenderer":97}],76:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){var path=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],dt=0,dt2=0,dt3=0,t2=0,t3=0;path.push(fromX,fromY);for(var i=1,j=0;i<=20;++i)dt3=(dt2=(dt=1-(j=i/20))*dt)*dt,t3=(t2=j*j)*j,path.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY);return path}},{}],77:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../../utils"),_const=require("../../const"),_ObjectRenderer3=_interopRequireDefault(require("../../renderers/webgl/utils/ObjectRenderer")),_WebGLRenderer2=_interopRequireDefault(require("../../renderers/webgl/WebGLRenderer")),_WebGLGraphicsData2=_interopRequireDefault(require("./WebGLGraphicsData")),_PrimitiveShader2=_interopRequireDefault(require("./shaders/PrimitiveShader")),_buildPoly2=_interopRequireDefault(require("./utils/buildPoly")),_buildRectangle2=_interopRequireDefault(require("./utils/buildRectangle")),_buildRoundedRectangle2=_interopRequireDefault(require("./utils/buildRoundedRectangle")),_buildCircle2=_interopRequireDefault(require("./utils/buildCircle"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var GraphicsRenderer=function(_ObjectRenderer){function GraphicsRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GraphicsRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_ObjectRenderer.call(this,renderer));return _this.graphicsDataPool=[],_this.primitiveShader=null,_this.gl=renderer.gl,_this.CONTEXT_UID=0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(GraphicsRenderer,_ObjectRenderer),GraphicsRenderer.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new _PrimitiveShader2.default(this.gl)},GraphicsRenderer.prototype.destroy=function(){_ObjectRenderer3.default.prototype.destroy.call(this);for(var i=0;i<this.graphicsDataPool.length;++i)this.graphicsDataPool[i].destroy();this.graphicsDataPool=null},GraphicsRenderer.prototype.render=function(graphics){var renderer=this.renderer,gl=renderer.gl,webGLData=void 0,webGL=graphics._webGL[this.CONTEXT_UID];webGL&&graphics.dirty===webGL.dirty||(this.updateGraphics(graphics),webGL=graphics._webGL[this.CONTEXT_UID]);var shader=this.primitiveShader;renderer.bindShader(shader),renderer.state.setBlendMode(graphics.blendMode);for(var i=0,n=webGL.data.length;i<n;i++){var shaderTemp=(webGLData=webGL.data[i]).shader;renderer.bindShader(shaderTemp),shaderTemp.uniforms.translationMatrix=graphics.transform.worldTransform.toArray(!0),shaderTemp.uniforms.tint=(0,_utils.hex2rgb)(graphics.tint),shaderTemp.uniforms.alpha=graphics.worldAlpha,renderer.bindVao(webGLData.vao),webGLData.nativeLines?gl.drawArrays(gl.LINES,0,webGLData.points.length/6):webGLData.vao.draw(gl.TRIANGLE_STRIP,webGLData.indices.length)}},GraphicsRenderer.prototype.updateGraphics=function(graphics){var gl=this.renderer.gl,webGL=graphics._webGL[this.CONTEXT_UID];if(webGL||(webGL=graphics._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:gl,clearDirty:-1,dirty:-1}),webGL.dirty=graphics.dirty,graphics.clearDirty!==webGL.clearDirty){webGL.clearDirty=graphics.clearDirty;for(var i=0;i<webGL.data.length;i++)this.graphicsDataPool.push(webGL.data[i]);webGL.data.length=0,webGL.lastIndex=0}for(var webGLData=void 0,webGLDataNativeLines=void 0,_i=webGL.lastIndex;_i<graphics.graphicsData.length;_i++){var data=graphics.graphicsData[_i];webGLData=this.getWebGLData(webGL,0),data.nativeLines&&data.lineWidth&&(webGLDataNativeLines=this.getWebGLData(webGL,0,!0),webGL.lastIndex++),data.type===_const.SHAPES.POLY&&(0,_buildPoly2.default)(data,webGLData,webGLDataNativeLines),data.type===_const.SHAPES.RECT?(0,_buildRectangle2.default)(data,webGLData,webGLDataNativeLines):data.type===_const.SHAPES.CIRC||data.type===_const.SHAPES.ELIP?(0,_buildCircle2.default)(data,webGLData,webGLDataNativeLines):data.type===_const.SHAPES.RREC&&(0,_buildRoundedRectangle2.default)(data,webGLData,webGLDataNativeLines),webGL.lastIndex++}this.renderer.bindVao(null);for(var _i2=0;_i2<webGL.data.length;_i2++)(webGLData=webGL.data[_i2]).dirty&&webGLData.upload()},GraphicsRenderer.prototype.getWebGLData=function(gl,type,nativeLines){var webGLData=gl.data[gl.data.length-1];return(!webGLData||webGLData.nativeLines!==nativeLines||webGLData.points.length>32e4)&&((webGLData=this.graphicsDataPool.pop()||new _WebGLGraphicsData2.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=nativeLines,webGLData.reset(type),gl.data.push(webGLData)),webGLData.dirty=!0,webGLData},GraphicsRenderer}(_ObjectRenderer3.default);exports.default=GraphicsRenderer,_WebGLRenderer2.default.registerPlugin("graphics",GraphicsRenderer)},{"../../const":66,"../../renderers/webgl/WebGLRenderer":104,"../../renderers/webgl/utils/ObjectRenderer":114,"../../utils":145,"./WebGLGraphicsData":78,"./shaders/PrimitiveShader":79,"./utils/buildCircle":80,"./utils/buildPoly":82,"./utils/buildRectangle":83,"./utils/buildRoundedRectangle":84}],78:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_pixiGlCore=require("pixi-gl-core"),_pixiGlCore2=(obj=_pixiGlCore)&&obj.__esModule?obj:{default:obj};var WebGLGraphicsData=function(){function WebGLGraphicsData(gl,shader,attribsState){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLGraphicsData),this.gl=gl,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl),this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=shader,this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,attribsState).addIndex(this.indexBuffer).addAttribute(this.buffer,shader.attributes.aVertexPosition,gl.FLOAT,!1,24,0).addAttribute(this.buffer,shader.attributes.aColor,gl.FLOAT,!1,24,8)}return WebGLGraphicsData.prototype.reset=function(){this.points.length=0,this.indices.length=0},WebGLGraphicsData.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},WebGLGraphicsData.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},WebGLGraphicsData}();exports.default=WebGLGraphicsData},{"pixi-gl-core":49}],79:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Shader2=require("../../../Shader");var PrimitiveShader=function(_Shader){function PrimitiveShader(gl){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PrimitiveShader),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(PrimitiveShader,_Shader),PrimitiveShader}(((obj=_Shader2)&&obj.__esModule?obj:{default:obj}).default);exports.default=PrimitiveShader},{"../../../Shader":64}],80:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(graphicsData,webGLData,webGLDataNativeLines){var circleData=graphicsData.shape,x=circleData.x,y=circleData.y,width=void 0,height=void 0;graphicsData.type===_const.SHAPES.CIRC?(width=circleData.radius,height=circleData.radius):(width=circleData.width,height=circleData.height);if(0===width||0===height)return;var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height)),seg=2*Math.PI/totalSegs;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6;indices.push(vecPos);for(var i=0;i<totalSegs+1;i++)verts.push(x,y,r,g,b,alpha),verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha),indices.push(vecPos++,vecPos++);indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[];for(var _i=0;_i<totalSegs+1;_i++)graphicsData.points.push(x+Math.sin(seg*_i)*width,y+Math.cos(seg*_i)*height);(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines),graphicsData.points=tempPoints}};var obj,_buildLine=require("./buildLine"),_buildLine2=(obj=_buildLine)&&obj.__esModule?obj:{default:obj},_const=require("../../../const"),_utils=require("../../../utils")},{"../../../const":66,"../../../utils":145,"./buildLine":81}],81:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(graphicsData,webGLData,webGLDataNativeLines){graphicsData.nativeLines?function(graphicsData,webGLData){var i=0,points=graphicsData.points;if(0===points.length)return;var verts=webGLData.points,length=points.length/2,color=(0,_utils.hex2rgb)(graphicsData.lineColor),alpha=graphicsData.lineAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha;for(i=1;i<length;i++){var p1x=points[2*(i-1)],p1y=points[2*(i-1)+1],p2x=points[2*i],p2y=points[2*i+1];verts.push(p1x,p1y),verts.push(r,g,b,alpha),verts.push(p2x,p2y),verts.push(r,g,b,alpha)}}(graphicsData,webGLDataNativeLines):function(graphicsData,webGLData){var points=graphicsData.points;if(0===points.length)return;var firstPoint=new _math.Point(points[0],points[1]),lastPoint=new _math.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){(points=points.slice()).pop(),points.pop();var midPointX=(lastPoint=new _math.Point(points[points.length-2],points[points.length-1])).x+.5*(firstPoint.x-lastPoint.x),midPointY=lastPoint.y+.5*(firstPoint.y-lastPoint.y);points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}var verts=webGLData.points,indices=webGLData.indices,length=points.length/2,indexCount=points.length,indexStart=verts.length/6,width=graphicsData.lineWidth/2,color=(0,_utils.hex2rgb)(graphicsData.lineColor),alpha=graphicsData.lineAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,p1x=points[0],p1y=points[1],p2x=points[2],p2y=points[3],p3x=0,p3y=0,perpx=-(p1y-p2y),perpy=p1x-p2x,perp2x=0,perp2y=0,perp3x=0,perp3y=0,dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha),verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha);for(var i=1;i<length-1;++i){p1x=points[2*(i-1)],p1y=points[2*(i-1)+1],p2x=points[2*i],p2y=points[2*i+1],p3x=points[2*(i+1)],p3y=points[2*(i+1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,perp2x=-(p2y-p3y),perp2y=p2x-p3x,dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y),perp2x/=dist,perp2y/=dist;var a1=-perpy+p1y-(-perpy+p2y),b1=-perpx+p2x-(-perpx+p1x),c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y),a2=-(perp2y*=width)+p3y-(-perp2y+p2y),b2=-(perp2x*=width)+p2x-(-perp2x+p3x),c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y),denom=a1*b2-a2*b1;if(Math.abs(denom)<.1)denom+=10.1,verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha);else{var px=(b1*c2-b2*c1)/denom,py=(a2*c1-a1*c2)/denom,pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y);pdist>196*width*width?(perp3x=perpx-perp2x,perp3y=perpy-perp2y,dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y),perp3x/=dist,perp3y/=dist,perp3x*=width,perp3y*=width,verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),verts.push(p2x+perp3x,p2y+perp3y),verts.push(r,g,b,alpha),verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),indexCount++):(verts.push(px,py),verts.push(r,g,b,alpha),verts.push(p2x-(px-p2x),p2y-(py-p2y)),verts.push(r,g,b,alpha))}}p1x=points[2*(length-2)],p1y=points[2*(length-2)+1],p2x=points[2*(length-1)],p2y=points[2*(length-1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p2x-perpx,p2y-perpy),verts.push(r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy),verts.push(r,g,b,alpha),indices.push(indexStart);for(var _i=0;_i<indexCount;++_i)indices.push(indexStart++);indices.push(indexStart-1)}(graphicsData,webGLData)};var _math=require("../../../math"),_utils=require("../../../utils")},{"../../../math":90,"../../../utils":145}],82:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(graphicsData,webGLData,webGLDataNativeLines){graphicsData.points=graphicsData.shape.points.slice();var points=graphicsData.points;if(graphicsData.fill&&points.length>=6){for(var holeArray=[],holes=graphicsData.holes,i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2),points=points.concat(hole.points)}var verts=webGLData.points,indices=webGLData.indices,length=points.length/2,color=(0,_utils.hex2rgb)(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,triangles=(0,_earcut2.default)(points,holeArray,2);if(!triangles)return;for(var vertPos=verts.length/6,_i=0;_i<triangles.length;_i+=3)indices.push(triangles[_i]+vertPos),indices.push(triangles[_i]+vertPos),indices.push(triangles[_i+1]+vertPos),indices.push(triangles[_i+2]+vertPos),indices.push(triangles[_i+2]+vertPos);for(var _i2=0;_i2<length;_i2++)verts.push(points[2*_i2],points[2*_i2+1],r,g,b,alpha)}graphicsData.lineWidth>0&&(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines)};var _buildLine2=_interopRequireDefault(require("./buildLine")),_utils=require("../../../utils"),_earcut2=_interopRequireDefault(require("earcut"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"../../../utils":145,"./buildLine":81,earcut:14}],83:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(graphicsData,webGLData,webGLDataNativeLines){var rectData=graphicsData.shape,x=rectData.x,y=rectData.y,width=rectData.width,height=rectData.height;if(graphicsData.fill){var color=(0,_utils.hex2rgb)(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vertPos=verts.length/6;verts.push(x,y),verts.push(r,g,b,alpha),verts.push(x+width,y),verts.push(r,g,b,alpha),verts.push(x,y+height),verts.push(r,g,b,alpha),verts.push(x+width,y+height),verts.push(r,g,b,alpha),indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y],(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines),graphicsData.points=tempPoints}};var obj,_buildLine=require("./buildLine"),_buildLine2=(obj=_buildLine)&&obj.__esModule?obj:{default:obj},_utils=require("../../../utils")},{"../../../utils":145,"./buildLine":81}],84:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(graphicsData,webGLData,webGLDataNativeLines){var rrectData=graphicsData.shape,x=rrectData.x,y=rrectData.y,width=rrectData.width,height=rrectData.height,radius=rrectData.radius,recPoints=[];if(recPoints.push(x,y+radius),quadraticBezierCurve(x,y+height-radius,x,y+height,x+radius,y+height,recPoints),quadraticBezierCurve(x+width-radius,y+height,x+width,y+height,x+width,y+height-radius,recPoints),quadraticBezierCurve(x+width,y+radius,x+width,y,x+width-radius,y,recPoints),quadraticBezierCurve(x+radius,y,x,y,x,y+radius+1e-10,recPoints),graphicsData.fill){for(var color=(0,_utils.hex2rgb)(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6,triangles=(0,_earcut2.default)(recPoints,null,2),i=0,j=triangles.length;i<j;i+=3)indices.push(triangles[i]+vecPos),indices.push(triangles[i]+vecPos),indices.push(triangles[i+1]+vecPos),indices.push(triangles[i+2]+vecPos),indices.push(triangles[i+2]+vecPos);for(var _i=0,_j=recPoints.length;_i<_j;_i++)verts.push(recPoints[_i],recPoints[++_i],r,g,b,alpha)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints,(0,_buildLine2.default)(graphicsData,webGLData,webGLDataNativeLines),graphicsData.points=tempPoints}};var _earcut2=_interopRequireDefault(require("earcut")),_buildLine2=_interopRequireDefault(require("./buildLine")),_utils=require("../../../utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getPt(n1,n2,perc){return n1+(n2-n1)*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY){for(var points=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],xa=0,ya=0,xb=0,yb=0,x=0,y=0,i=0,j=0;i<=20;++i)xa=getPt(fromX,cpX,j=i/20),ya=getPt(fromY,cpY,j),xb=getPt(cpX,toX,j),yb=getPt(cpY,toY,j),x=getPt(xa,xb,j),y=getPt(ya,yb,j),points.push(x,y);return points}},{"../../../utils":145,"./buildLine":81,earcut:14}],85:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.autoDetectRenderer=exports.Application=exports.Filter=exports.SpriteMaskFilter=exports.Quad=exports.RenderTarget=exports.ObjectRenderer=exports.WebGLManager=exports.Shader=exports.CanvasRenderTarget=exports.TextureUvs=exports.VideoBaseTexture=exports.BaseRenderTexture=exports.RenderTexture=exports.BaseTexture=exports.TextureMatrix=exports.Texture=exports.Spritesheet=exports.CanvasGraphicsRenderer=exports.GraphicsRenderer=exports.GraphicsData=exports.Graphics=exports.TextMetrics=exports.TextStyle=exports.Text=exports.SpriteRenderer=exports.CanvasTinter=exports.CanvasSpriteRenderer=exports.Sprite=exports.TransformBase=exports.TransformStatic=exports.Transform=exports.Container=exports.DisplayObject=exports.Bounds=exports.glCore=exports.WebGLRenderer=exports.CanvasRenderer=exports.ticker=exports.utils=exports.settings=void 0;var _const=require("./const");Object.keys(_const).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _const[key]}})});var _math=require("./math");Object.keys(_math).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _math[key]}})});var _pixiGlCore=require("pixi-gl-core");Object.defineProperty(exports,"glCore",{enumerable:!0,get:function(){return _interopRequireDefault(_pixiGlCore).default}});var _Bounds=require("./display/Bounds");Object.defineProperty(exports,"Bounds",{enumerable:!0,get:function(){return _interopRequireDefault(_Bounds).default}});var _DisplayObject=require("./display/DisplayObject");Object.defineProperty(exports,"DisplayObject",{enumerable:!0,get:function(){return _interopRequireDefault(_DisplayObject).default}});var _Container=require("./display/Container");Object.defineProperty(exports,"Container",{enumerable:!0,get:function(){return _interopRequireDefault(_Container).default}});var _Transform=require("./display/Transform");Object.defineProperty(exports,"Transform",{enumerable:!0,get:function(){return _interopRequireDefault(_Transform).default}});var _TransformStatic=require("./display/TransformStatic");Object.defineProperty(exports,"TransformStatic",{enumerable:!0,get:function(){return _interopRequireDefault(_TransformStatic).default}});var _TransformBase=require("./display/TransformBase");Object.defineProperty(exports,"TransformBase",{enumerable:!0,get:function(){return _interopRequireDefault(_TransformBase).default}});var _Sprite=require("./sprites/Sprite");Object.defineProperty(exports,"Sprite",{enumerable:!0,get:function(){return _interopRequireDefault(_Sprite).default}});var _CanvasSpriteRenderer=require("./sprites/canvas/CanvasSpriteRenderer");Object.defineProperty(exports,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasSpriteRenderer).default}});var _CanvasTinter=require("./sprites/canvas/CanvasTinter");Object.defineProperty(exports,"CanvasTinter",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasTinter).default}});var _SpriteRenderer=require("./sprites/webgl/SpriteRenderer");Object.defineProperty(exports,"SpriteRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_SpriteRenderer).default}});var _Text=require("./text/Text");Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return _interopRequireDefault(_Text).default}});var _TextStyle=require("./text/TextStyle");Object.defineProperty(exports,"TextStyle",{enumerable:!0,get:function(){return _interopRequireDefault(_TextStyle).default}});var _TextMetrics=require("./text/TextMetrics");Object.defineProperty(exports,"TextMetrics",{enumerable:!0,get:function(){return _interopRequireDefault(_TextMetrics).default}});var _Graphics=require("./graphics/Graphics");Object.defineProperty(exports,"Graphics",{enumerable:!0,get:function(){return _interopRequireDefault(_Graphics).default}});var _GraphicsData=require("./graphics/GraphicsData");Object.defineProperty(exports,"GraphicsData",{enumerable:!0,get:function(){return _interopRequireDefault(_GraphicsData).default}});var _GraphicsRenderer=require("./graphics/webgl/GraphicsRenderer");Object.defineProperty(exports,"GraphicsRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_GraphicsRenderer).default}});var _CanvasGraphicsRenderer=require("./graphics/canvas/CanvasGraphicsRenderer");Object.defineProperty(exports,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasGraphicsRenderer).default}});var _Spritesheet=require("./textures/Spritesheet");Object.defineProperty(exports,"Spritesheet",{enumerable:!0,get:function(){return _interopRequireDefault(_Spritesheet).default}});var _Texture=require("./textures/Texture");Object.defineProperty(exports,"Texture",{enumerable:!0,get:function(){return _interopRequireDefault(_Texture).default}});var _TextureMatrix=require("./textures/TextureMatrix");Object.defineProperty(exports,"TextureMatrix",{enumerable:!0,get:function(){return _interopRequireDefault(_TextureMatrix).default}});var _BaseTexture=require("./textures/BaseTexture");Object.defineProperty(exports,"BaseTexture",{enumerable:!0,get:function(){return _interopRequireDefault(_BaseTexture).default}});var _RenderTexture=require("./textures/RenderTexture");Object.defineProperty(exports,"RenderTexture",{enumerable:!0,get:function(){return _interopRequireDefault(_RenderTexture).default}});var _BaseRenderTexture=require("./textures/BaseRenderTexture");Object.defineProperty(exports,"BaseRenderTexture",{enumerable:!0,get:function(){return _interopRequireDefault(_BaseRenderTexture).default}});var _VideoBaseTexture=require("./textures/VideoBaseTexture");Object.defineProperty(exports,"VideoBaseTexture",{enumerable:!0,get:function(){return _interopRequireDefault(_VideoBaseTexture).default}});var _TextureUvs=require("./textures/TextureUvs");Object.defineProperty(exports,"TextureUvs",{enumerable:!0,get:function(){return _interopRequireDefault(_TextureUvs).default}});var _CanvasRenderTarget=require("./renderers/canvas/utils/CanvasRenderTarget");Object.defineProperty(exports,"CanvasRenderTarget",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasRenderTarget).default}});var _Shader=require("./Shader");Object.defineProperty(exports,"Shader",{enumerable:!0,get:function(){return _interopRequireDefault(_Shader).default}});var _WebGLManager=require("./renderers/webgl/managers/WebGLManager");Object.defineProperty(exports,"WebGLManager",{enumerable:!0,get:function(){return _interopRequireDefault(_WebGLManager).default}});var _ObjectRenderer=require("./renderers/webgl/utils/ObjectRenderer");Object.defineProperty(exports,"ObjectRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_ObjectRenderer).default}});var _RenderTarget=require("./renderers/webgl/utils/RenderTarget");Object.defineProperty(exports,"RenderTarget",{enumerable:!0,get:function(){return _interopRequireDefault(_RenderTarget).default}});var _Quad=require("./renderers/webgl/utils/Quad");Object.defineProperty(exports,"Quad",{enumerable:!0,get:function(){return _interopRequireDefault(_Quad).default}});var _SpriteMaskFilter=require("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");Object.defineProperty(exports,"SpriteMaskFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_SpriteMaskFilter).default}});var _Filter=require("./renderers/webgl/filters/Filter");Object.defineProperty(exports,"Filter",{enumerable:!0,get:function(){return _interopRequireDefault(_Filter).default}});var _Application=require("./Application");Object.defineProperty(exports,"Application",{enumerable:!0,get:function(){return _interopRequireDefault(_Application).default}});var _autoDetectRenderer=require("./autoDetectRenderer");Object.defineProperty(exports,"autoDetectRenderer",{enumerable:!0,get:function(){return _autoDetectRenderer.autoDetectRenderer}});var utils=_interopRequireWildcard(require("./utils")),ticker=_interopRequireWildcard(require("./ticker")),_settings2=_interopRequireDefault(require("./settings")),_CanvasRenderer2=_interopRequireDefault(require("./renderers/canvas/CanvasRenderer")),_WebGLRenderer2=_interopRequireDefault(require("./renderers/webgl/WebGLRenderer"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.settings=_settings2.default,exports.utils=utils,exports.ticker=ticker,exports.CanvasRenderer=_CanvasRenderer2.default,exports.WebGLRenderer=_WebGLRenderer2.default},{"./Application":63,"./Shader":64,"./autoDetectRenderer":65,"./const":66,"./display/Bounds":67,"./display/Container":68,"./display/DisplayObject":69,"./display/Transform":70,"./display/TransformBase":71,"./display/TransformStatic":72,"./graphics/Graphics":73,"./graphics/GraphicsData":74,"./graphics/canvas/CanvasGraphicsRenderer":75,"./graphics/webgl/GraphicsRenderer":77,"./math":90,"./renderers/canvas/CanvasRenderer":97,"./renderers/canvas/utils/CanvasRenderTarget":99,"./renderers/webgl/WebGLRenderer":104,"./renderers/webgl/filters/Filter":106,"./renderers/webgl/filters/spriteMask/SpriteMaskFilter":109,"./renderers/webgl/managers/WebGLManager":113,"./renderers/webgl/utils/ObjectRenderer":114,"./renderers/webgl/utils/Quad":115,"./renderers/webgl/utils/RenderTarget":116,"./settings":121,"./sprites/Sprite":122,"./sprites/canvas/CanvasSpriteRenderer":123,"./sprites/canvas/CanvasTinter":124,"./sprites/webgl/SpriteRenderer":126,"./text/Text":128,"./text/TextMetrics":129,"./text/TextStyle":130,"./textures/BaseRenderTexture":131,"./textures/BaseTexture":132,"./textures/RenderTexture":133,"./textures/Spritesheet":134,"./textures/Texture":135,"./textures/TextureMatrix":136,"./textures/TextureUvs":137,"./textures/VideoBaseTexture":138,"./ticker":141,"./utils":145,"pixi-gl-core":49}],86:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Matrix=require("./Matrix"),_Matrix2=(obj=_Matrix)&&obj.__esModule?obj:{default:obj};var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],tempMatrices=[],mul=[];function signum(x){return x<0?-1:x>0?1:0}!function(){for(var i=0;i<16;i++){var row=[];mul.push(row);for(var j=0;j<16;j++)for(var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]),_uy=signum(uy[i]*ux[j]+vy[i]*uy[j]),_vx=signum(ux[i]*vx[j]+vx[i]*vy[j]),_vy=signum(uy[i]*vx[j]+vy[i]*vy[j]),k=0;k<16;k++)if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}for(var _i=0;_i<16;_i++){var mat=new _Matrix2.default;mat.set(ux[_i],uy[_i],vx[_i],vy[_i],0,0),tempMatrices.push(mat)}}();var GroupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(ind){return ux[ind]},uY:function(ind){return uy[ind]},vX:function(ind){return vx[ind]},vY:function(ind){return vy[ind]},inv:function(rotation){return 8&rotation?15&rotation:7&-rotation},add:function(rotationSecond,rotationFirst){return mul[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return mul[rotationSecond][GroupD8.inv(rotationFirst)]},rotate180:function(rotation){return 4^rotation},isVertical:function(rotation){return 2==(3&rotation)},byDirection:function(dx,dy){return 2*Math.abs(dx)<=Math.abs(dy)?dy>=0?GroupD8.S:GroupD8.N:2*Math.abs(dy)<=Math.abs(dx)?dx>0?GroupD8.E:GroupD8.W:dy>0?dx>0?GroupD8.SE:GroupD8.SW:dx>0?GroupD8.NE:GroupD8.NW},matrixAppendRotationInv:function(matrix,rotation){var tx=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,ty=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,mat=tempMatrices[GroupD8.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}};exports.default=GroupD8},{"./Matrix":87}],87:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Point=require("./Point"),_Point2=(obj=_Point)&&obj.__esModule?obj:{default:obj};var Matrix=function(){function Matrix(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,tx=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ty=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Matrix),this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this.array=null}return Matrix.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix.prototype.apply=function(pos,newPos){newPos=newPos||new _Point2.default;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new _Point2.default;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){var sr=Math.sin(rotation),cr=Math.cos(rotation),cy=Math.cos(skewY),sy=Math.sin(skewY),nsx=-Math.sin(skewX),cx=Math.cos(skewX),a=cr*scaleX,b=sr*scaleX,c=-sr*scaleY,d=cr*scaleY;return this.a=cy*a+sy*c,this.b=cy*b+sy*d,this.c=nsx*a+cx*c,this.d=nsx*b+cx*d,this.tx=x+(pivotX*a+pivotY*c),this.ty=y+(pivotX*b+pivotY*d),this},Matrix.prototype.prepend=function(matrix){var tx1=this.tx;if(1!==matrix.a||0!==matrix.b||0!==matrix.c||1!==matrix.d){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix.prototype.decompose=function(transform){var a=this.a,b=this.b,c=this.c,d=this.d,skewX=-Math.atan2(-c,d),skewY=Math.atan2(b,a);return Math.abs(skewX+skewY)<1e-5?(transform.rotation=skewY,a<0&&d>=0&&(transform.rotation+=transform.rotation<=0?Math.PI:-Math.PI),transform.skew.x=transform.skew.y=0):(transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a*a+b*b),transform.scale.y=Math.sqrt(c*c+d*d),transform.position.x=this.tx,transform.position.y=this.ty,transform},Matrix.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix.prototype.clone=function(){var matrix=new Matrix;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copy=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},_createClass(Matrix,null,[{key:"IDENTITY",get:function(){return new Matrix}},{key:"TEMP_MATRIX",get:function(){return new Matrix}}]),Matrix}();exports.default=Matrix},{"./Point":89}],88:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ObservablePoint=function(){function ObservablePoint(cb,scope){var x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ObservablePoint),this._x=x,this._y=y,this.cb=cb,this.scope=scope}return ObservablePoint.prototype.set=function(x,y){var _x=x||0,_y=y||(0!==y?_x:0);this._x===_x&&this._y===_y||(this._x=_x,this._y=_y,this.cb.call(this.scope))},ObservablePoint.prototype.copy=function(point){this._x===point.x&&this._y===point.y||(this._x=point.x,this._y=point.y,this.cb.call(this.scope))},_createClass(ObservablePoint,[{key:"x",get:function(){return this._x},set:function(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))}}]),ObservablePoint}();exports.default=ObservablePoint},{}],89:[function(require,module,exports){"use strict";exports.__esModule=!0;var Point=function(){function Point(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Point),this.x=x,this.y=y}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copy=function(p){this.set(p.x,p.y)},Point.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point.prototype.set=function(x,y){this.x=x||0,this.y=y||(0!==y?this.x:0)},Point}();exports.default=Point},{}],90:[function(require,module,exports){"use strict";exports.__esModule=!0;var _Point=require("./Point");Object.defineProperty(exports,"Point",{enumerable:!0,get:function(){return _interopRequireDefault(_Point).default}});var _ObservablePoint=require("./ObservablePoint");Object.defineProperty(exports,"ObservablePoint",{enumerable:!0,get:function(){return _interopRequireDefault(_ObservablePoint).default}});var _Matrix=require("./Matrix");Object.defineProperty(exports,"Matrix",{enumerable:!0,get:function(){return _interopRequireDefault(_Matrix).default}});var _GroupD=require("./GroupD8");Object.defineProperty(exports,"GroupD8",{enumerable:!0,get:function(){return _interopRequireDefault(_GroupD).default}});var _Circle=require("./shapes/Circle");Object.defineProperty(exports,"Circle",{enumerable:!0,get:function(){return _interopRequireDefault(_Circle).default}});var _Ellipse=require("./shapes/Ellipse");Object.defineProperty(exports,"Ellipse",{enumerable:!0,get:function(){return _interopRequireDefault(_Ellipse).default}});var _Polygon=require("./shapes/Polygon");Object.defineProperty(exports,"Polygon",{enumerable:!0,get:function(){return _interopRequireDefault(_Polygon).default}});var _Rectangle=require("./shapes/Rectangle");Object.defineProperty(exports,"Rectangle",{enumerable:!0,get:function(){return _interopRequireDefault(_Rectangle).default}});var _RoundedRectangle=require("./shapes/RoundedRectangle");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"RoundedRectangle",{enumerable:!0,get:function(){return _interopRequireDefault(_RoundedRectangle).default}})},{"./GroupD8":86,"./Matrix":87,"./ObservablePoint":88,"./Point":89,"./shapes/Circle":91,"./shapes/Ellipse":92,"./shapes/Polygon":93,"./shapes/Rectangle":94,"./shapes/RoundedRectangle":95}],91:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Rectangle=require("./Rectangle"),_Rectangle2=(obj=_Rectangle)&&obj.__esModule?obj:{default:obj},_const=require("../../const");var Circle=function(){function Circle(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,radius=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Circle),this.x=x,this.y=y,this.radius=radius,this.type=_const.SHAPES.CIRC}return Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius)},Circle.prototype.contains=function(x,y){if(this.radius<=0)return!1;var r2=this.radius*this.radius,dx=this.x-x,dy=this.y-y;return(dx*=dx)+(dy*=dy)<=r2},Circle.prototype.getBounds=function(){return new _Rectangle2.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},Circle}();exports.default=Circle},{"../../const":66,"./Rectangle":94}],92:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Rectangle=require("./Rectangle"),_Rectangle2=(obj=_Rectangle)&&obj.__esModule?obj:{default:obj},_const=require("../../const");var Ellipse=function(){function Ellipse(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,width=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,height=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Ellipse),this.x=x,this.y=y,this.width=width,this.height=height,this.type=_const.SHAPES.ELIP}return Ellipse.prototype.clone=function(){return new Ellipse(this.x,this.y,this.width,this.height)},Ellipse.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;return(normx*=normx)+(normy*=normy)<=1},Ellipse.prototype.getBounds=function(){return new _Rectangle2.default(this.x-this.width,this.y-this.height,this.width,this.height)},Ellipse}();exports.default=Ellipse},{"../../const":66,"./Rectangle":94}],93:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Point=require("../Point"),_Point2=(obj=_Point)&&obj.__esModule?obj:{default:obj},_const=require("../../const");var Polygon=function(){function Polygon(){for(var _len=arguments.length,points=Array(_len),_key=0;_key<_len;_key++)points[_key]=arguments[_key];if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Polygon),Array.isArray(points[0])&&(points=points[0]),points[0]instanceof _Point2.default){for(var p=[],i=0,il=points.length;i<il;i++)p.push(points[i].x,points[i].y);points=p}this.closed=!0,this.points=points,this.type=_const.SHAPES.POLY}return Polygon.prototype.clone=function(){return new Polygon(this.points.slice())},Polygon.prototype.close=function(){var points=this.points;points[0]===points[points.length-2]&&points[1]===points[points.length-1]||points.push(points[0],points[1])},Polygon.prototype.contains=function(x,y){for(var inside=!1,length=this.points.length/2,i=0,j=length-1;i<length;j=i++){var xi=this.points[2*i],yi=this.points[2*i+1],xj=this.points[2*j],yj=this.points[2*j+1];yi>y!=yj>y&&x<(y-yi)/(yj-yi)*(xj-xi)+xi&&(inside=!inside)}return inside},Polygon}();exports.default=Polygon},{"../../const":66,"../Point":89}],94:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_const=require("../../const");var Rectangle=function(){function Rectangle(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,width=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,height=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Rectangle),this.x=Number(x),this.y=Number(y),this.width=Number(width),this.height=Number(height),this.type=_const.SHAPES.RECT}return Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.copy=function(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this},Rectangle.prototype.contains=function(x,y){return!(this.width<=0||this.height<=0)&&(x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height)},Rectangle.prototype.pad=function(paddingX,paddingY){paddingX=paddingX||0,paddingY=paddingY||(0!==paddingY?paddingX:0),this.x-=paddingX,this.y-=paddingY,this.width+=2*paddingX,this.height+=2*paddingY},Rectangle.prototype.fit=function(rectangle){this.x<rectangle.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=rectangle.x),this.y<rectangle.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=rectangle.y),this.x+this.width>rectangle.x+rectangle.width&&(this.width=rectangle.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>rectangle.y+rectangle.height&&(this.height=rectangle.height-this.y,this.height<0&&(this.height=0))},Rectangle.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1},_createClass(Rectangle,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new Rectangle(0,0,0,0)}}]),Rectangle}();exports.default=Rectangle},{"../../const":66}],95:[function(require,module,exports){"use strict";exports.__esModule=!0;var _const=require("../../const");var RoundedRectangle=function(){function RoundedRectangle(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,width=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,height=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,radius=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RoundedRectangle),this.x=x,this.y=y,this.width=width,this.height=height,this.radius=radius,this.type=_const.SHAPES.RREC}return RoundedRectangle.prototype.clone=function(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},RoundedRectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;if(x>=this.x&&x<=this.x+this.width&&y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius)return!0;var dx=x-(this.x+this.radius),dy=y-(this.y+this.radius),radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2)return!0;if((dx=x-(this.x+this.width-this.radius))*dx+dy*dy<=radius2)return!0;if(dx*dx+(dy=y-(this.y+this.height-this.radius))*dy<=radius2)return!0;if((dx=x-(this.x+this.radius))*dx+dy*dy<=radius2)return!0}return!1},RoundedRectangle}();exports.default=RoundedRectangle},{"../../const":66}],96:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_utils=require("../utils"),_math=require("../math"),_const=require("../const"),_settings2=_interopRequireDefault(require("../settings")),_Container2=_interopRequireDefault(require("../display/Container")),_RenderTexture2=_interopRequireDefault(require("../textures/RenderTexture")),_eventemitter2=_interopRequireDefault(require("eventemitter3"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var tempMatrix=new _math.Matrix,SystemRenderer=function(_EventEmitter){function SystemRenderer(system,options,arg2,arg3){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SystemRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return(0,_utils.sayHello)(system),"number"==typeof options&&(options=Object.assign({width:options,height:arg2||_settings2.default.RENDER_OPTIONS.height},arg3)),options=Object.assign({},_settings2.default.RENDER_OPTIONS,options),_this.options=options,_this.type=_const.RENDERER_TYPE.UNKNOWN,_this.screen=new _math.Rectangle(0,0,options.width,options.height),_this.view=options.view||document.createElement("canvas"),_this.resolution=options.resolution||_settings2.default.RESOLUTION,_this.transparent=options.transparent,_this.autoResize=options.autoResize||!1,_this.blendModes=null,_this.preserveDrawingBuffer=options.preserveDrawingBuffer,_this.clearBeforeRender=options.clearBeforeRender,_this.roundPixels=options.roundPixels,_this._backgroundColor=0,_this._backgroundColorRgba=[0,0,0,0],_this._backgroundColorString="#000000",_this.backgroundColor=options.backgroundColor||_this._backgroundColor,_this._tempDisplayObjectParent=new _Container2.default,_this._lastObjectRendered=_this._tempDisplayObjectParent,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SystemRenderer,_EventEmitter),SystemRenderer.prototype.resize=function(screenWidth,screenHeight){this.screen.width=screenWidth,this.screen.height=screenHeight,this.view.width=screenWidth*this.resolution,this.view.height=screenHeight*this.resolution,this.autoResize&&(this.view.style.width=screenWidth+"px",this.view.style.height=screenHeight+"px")},SystemRenderer.prototype.generateTexture=function(displayObject,scaleMode,resolution,region){region=region||displayObject.getLocalBounds();var renderTexture=_RenderTexture2.default.create(0|region.width,0|region.height,scaleMode,resolution);return tempMatrix.tx=-region.x,tempMatrix.ty=-region.y,this.render(displayObject,renderTexture,!1,tempMatrix,!0),renderTexture},SystemRenderer.prototype.destroy=function(removeView){removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=_const.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},_createClass(SystemRenderer,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(value){this._backgroundColor=value,this._backgroundColorString=(0,_utils.hex2string)(value),(0,_utils.hex2rgb)(value,this._backgroundColorRgba)}}]),SystemRenderer}(_eventemitter2.default);exports.default=SystemRenderer},{"../const":66,"../display/Container":68,"../math":90,"../settings":121,"../textures/RenderTexture":133,"../utils":145,eventemitter3:29}],97:[function(require,module,exports){"use strict";exports.__esModule=!0;var _SystemRenderer3=_interopRequireDefault(require("../SystemRenderer")),_CanvasMaskManager2=_interopRequireDefault(require("./utils/CanvasMaskManager")),_CanvasRenderTarget2=_interopRequireDefault(require("./utils/CanvasRenderTarget")),_mapCanvasBlendModesToPixi2=_interopRequireDefault(require("./utils/mapCanvasBlendModesToPixi")),_utils=require("../../utils"),_const=require("../../const"),_settings2=_interopRequireDefault(require("../../settings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CanvasRenderer=function(_SystemRenderer){function CanvasRenderer(options,arg2,arg3){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_SystemRenderer.call(this,"Canvas",options,arg2,arg3));return _this.type=_const.RENDERER_TYPE.CANVAS,_this.rootContext=_this.view.getContext("2d",{alpha:_this.transparent}),_this.context=_this.rootContext,_this.refresh=!0,_this.maskManager=new _CanvasMaskManager2.default(_this),_this.smoothProperty="imageSmoothingEnabled",_this.rootContext.imageSmoothingEnabled||(_this.rootContext.webkitImageSmoothingEnabled?_this.smoothProperty="webkitImageSmoothingEnabled":_this.rootContext.mozImageSmoothingEnabled?_this.smoothProperty="mozImageSmoothingEnabled":_this.rootContext.oImageSmoothingEnabled?_this.smoothProperty="oImageSmoothingEnabled":_this.rootContext.msImageSmoothingEnabled&&(_this.smoothProperty="msImageSmoothingEnabled")),_this.initPlugins(),_this.blendModes=(0,_mapCanvasBlendModesToPixi2.default)(),_this._activeBlendMode=null,_this.renderingToScreen=!1,_this.resize(_this.options.width,_this.options.height),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(CanvasRenderer,_SystemRenderer),CanvasRenderer.prototype.render=function(displayObject,renderTexture,clear,transform,skipUpdateTransform){if(this.view){this.renderingToScreen=!renderTexture,this.emit("prerender");var rootResolution=this.resolution;renderTexture?((renderTexture=renderTexture.baseTexture||renderTexture)._canvasRenderTarget||(renderTexture._canvasRenderTarget=new _CanvasRenderTarget2.default(renderTexture.width,renderTexture.height,renderTexture.resolution),renderTexture.source=renderTexture._canvasRenderTarget.canvas,renderTexture.valid=!0),this.context=renderTexture._canvasRenderTarget.context,this.resolution=renderTexture._canvasRenderTarget.resolution):this.context=this.rootContext;var context=this.context;if(renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.parent,tempWt=this._tempDisplayObjectParent.transform.worldTransform;transform?(transform.copy(tempWt),this._tempDisplayObjectParent.transform._worldID=-1):tempWt.identity(),displayObject.parent=this._tempDisplayObjectParent,displayObject.updateTransform(),displayObject.parent=cacheParent}context.save(),context.setTransform(1,0,0,1,0,0),context.globalAlpha=1,this._activeBlendMode=_const.BLEND_MODES.NORMAL,context.globalCompositeOperation=this.blendModes[_const.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(context.fillStyle="black",context.clear()),(void 0!==clear?clear:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?context.clearRect(0,0,this.width,this.height):(context.fillStyle=this._backgroundColorString,context.fillRect(0,0,this.width,this.height)));var tempContext=this.context;this.context=context,displayObject.renderCanvas(this),this.context=tempContext,context.restore(),this.resolution=rootResolution,this.emit("postrender")}},CanvasRenderer.prototype.clear=function(clearColor){var context=this.context;clearColor=clearColor||this._backgroundColorString,!this.transparent&&clearColor?(context.fillStyle=clearColor,context.fillRect(0,0,this.width,this.height)):context.clearRect(0,0,this.width,this.height)},CanvasRenderer.prototype.setBlendMode=function(blendMode){this._activeBlendMode!==blendMode&&(this._activeBlendMode=blendMode,this.context.globalCompositeOperation=this.blendModes[blendMode])},CanvasRenderer.prototype.destroy=function(removeView){this.destroyPlugins(),_SystemRenderer.prototype.destroy.call(this,removeView),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},CanvasRenderer.prototype.resize=function(screenWidth,screenHeight){_SystemRenderer.prototype.resize.call(this,screenWidth,screenHeight),this.smoothProperty&&(this.rootContext[this.smoothProperty]=_settings2.default.SCALE_MODE===_const.SCALE_MODES.LINEAR)},CanvasRenderer.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},CanvasRenderer}(_SystemRenderer3.default);exports.default=CanvasRenderer,_utils.pluginTarget.mixin(CanvasRenderer)},{"../../const":66,"../../settings":121,"../../utils":145,"../SystemRenderer":96,"./utils/CanvasMaskManager":98,"./utils/CanvasRenderTarget":99,"./utils/mapCanvasBlendModesToPixi":101}],98:[function(require,module,exports){"use strict";exports.__esModule=!0;var _const=require("../../../const");var CanvasMaskManager=function(){function CanvasMaskManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasMaskManager),this.renderer=renderer}return CanvasMaskManager.prototype.pushMask=function(maskData){var renderer=this.renderer;renderer.context.save();var cacheAlpha=maskData.alpha,transform=maskData.transform.worldTransform,resolution=renderer.resolution;renderer.context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),maskData._texture||(this.renderGraphicsShape(maskData),renderer.context.clip()),maskData.worldAlpha=cacheAlpha},CanvasMaskManager.prototype.renderGraphicsShape=function(graphics){var context=this.renderer.context,len=graphics.graphicsData.length;if(0!==len){context.beginPath();for(var i=0;i<len;i++){var data=graphics.graphicsData[i],shape=data.shape;if(data.type===_const.SHAPES.POLY){var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath()}else if(data.type===_const.SHAPES.RECT)context.rect(shape.x,shape.y,shape.width,shape.height),context.closePath();else if(data.type===_const.SHAPES.CIRC)context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath();else if(data.type===_const.SHAPES.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2,ox=w/2*.5522848,oy=h/2*.5522848,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath()}else if(data.type===_const.SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath()}}}},CanvasMaskManager.prototype.popMask=function(renderer){renderer.context.restore(),renderer.invalidateBlendMode()},CanvasMaskManager.prototype.destroy=function(){},CanvasMaskManager}();exports.default=CanvasMaskManager},{"../../../const":66}],99:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_settings=require("../../../settings"),_settings2=(obj=_settings)&&obj.__esModule?obj:{default:obj};var CanvasRenderTarget=function(){function CanvasRenderTarget(width,height,resolution){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasRenderTarget),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||_settings2.default.RESOLUTION,this.resize(width,height)}return CanvasRenderTarget.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget.prototype.resize=function(width,height){this.canvas.width=width*this.resolution,this.canvas.height=height*this.resolution},CanvasRenderTarget.prototype.destroy=function(){this.context=null,this.canvas=null},_createClass(CanvasRenderTarget,[{key:"width",get:function(){return this.canvas.width},set:function(val){this.canvas.width=val}},{key:"height",get:function(){return this.canvas.height},set:function(val){this.canvas.height=val}}]),CanvasRenderTarget}();exports.default=CanvasRenderTarget},{"../../../settings":121}],100:[function(require,module,exports){"use strict";function createColoredCanvas(color){var canvas=document.createElement("canvas");canvas.width=6,canvas.height=1;var context=canvas.getContext("2d");return context.fillStyle=color,context.fillRect(0,0,6,1),canvas}exports.__esModule=!0,exports.default=function(){if("undefined"==typeof document)return!1;var magenta=createColoredCanvas("#ff00ff"),yellow=createColoredCanvas("#ffff00"),canvas=document.createElement("canvas");canvas.width=6,canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply",context.drawImage(magenta,0,0),context.drawImage(yellow,2,0);var imageData=context.getImageData(2,0,1,1);if(!imageData)return!1;var data=imageData.data;return 255===data[0]&&0===data[1]&&0===data[2]}},{}],101:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(){var array=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,_canUseNewCanvasBlendModes2.default)()?(array[_const.BLEND_MODES.NORMAL]="source-over",array[_const.BLEND_MODES.ADD]="lighter",array[_const.BLEND_MODES.MULTIPLY]="multiply",array[_const.BLEND_MODES.SCREEN]="screen",array[_const.BLEND_MODES.OVERLAY]="overlay",array[_const.BLEND_MODES.DARKEN]="darken",array[_const.BLEND_MODES.LIGHTEN]="lighten",array[_const.BLEND_MODES.COLOR_DODGE]="color-dodge",array[_const.BLEND_MODES.COLOR_BURN]="color-burn",array[_const.BLEND_MODES.HARD_LIGHT]="hard-light",array[_const.BLEND_MODES.SOFT_LIGHT]="soft-light",array[_const.BLEND_MODES.DIFFERENCE]="difference",array[_const.BLEND_MODES.EXCLUSION]="exclusion",array[_const.BLEND_MODES.HUE]="hue",array[_const.BLEND_MODES.SATURATION]="saturate",array[_const.BLEND_MODES.COLOR]="color",array[_const.BLEND_MODES.LUMINOSITY]="luminosity"):(array[_const.BLEND_MODES.NORMAL]="source-over",array[_const.BLEND_MODES.ADD]="lighter",array[_const.BLEND_MODES.MULTIPLY]="source-over",array[_const.BLEND_MODES.SCREEN]="source-over",array[_const.BLEND_MODES.OVERLAY]="source-over",array[_const.BLEND_MODES.DARKEN]="source-over",array[_const.BLEND_MODES.LIGHTEN]="source-over",array[_const.BLEND_MODES.COLOR_DODGE]="source-over",array[_const.BLEND_MODES.COLOR_BURN]="source-over",array[_const.BLEND_MODES.HARD_LIGHT]="source-over",array[_const.BLEND_MODES.SOFT_LIGHT]="source-over",array[_const.BLEND_MODES.DIFFERENCE]="source-over",array[_const.BLEND_MODES.EXCLUSION]="source-over",array[_const.BLEND_MODES.HUE]="source-over",array[_const.BLEND_MODES.SATURATION]="source-over",array[_const.BLEND_MODES.COLOR]="source-over",array[_const.BLEND_MODES.LUMINOSITY]="source-over");return array[_const.BLEND_MODES.NORMAL_NPM]=array[_const.BLEND_MODES.NORMAL],array[_const.BLEND_MODES.ADD_NPM]=array[_const.BLEND_MODES.ADD],array[_const.BLEND_MODES.SCREEN_NPM]=array[_const.BLEND_MODES.SCREEN],array};var obj,_const=require("../../../const"),_canUseNewCanvasBlendModes=require("./canUseNewCanvasBlendModes"),_canUseNewCanvasBlendModes2=(obj=_canUseNewCanvasBlendModes)&&obj.__esModule?obj:{default:obj}},{"../../../const":66,"./canUseNewCanvasBlendModes":100}],102:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_const=require("../../const"),_settings=require("../../settings"),_settings2=(obj=_settings)&&obj.__esModule?obj:{default:obj};var TextureGarbageCollector=function(){function TextureGarbageCollector(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextureGarbageCollector),this.renderer=renderer,this.count=0,this.checkCount=0,this.maxIdle=_settings2.default.GC_MAX_IDLE,this.checkCountMax=_settings2.default.GC_MAX_CHECK_COUNT,this.mode=_settings2.default.GC_MODE}return TextureGarbageCollector.prototype.update=function(){this.count++,this.mode!==_const.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},TextureGarbageCollector.prototype.run=function(){for(var tm=this.renderer.textureManager,managedTextures=tm._managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture._glRenderTargets&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){for(var j=0,_i=0;_i<managedTextures.length;_i++)null!==managedTextures[_i]&&(managedTextures[j++]=managedTextures[_i]);managedTextures.length=j}},TextureGarbageCollector.prototype.unload=function(displayObject){var tm=this.renderer.textureManager;displayObject._texture&&displayObject._texture._glRenderTargets&&tm.destroyTexture(displayObject._texture,!0);for(var i=displayObject.children.length-1;i>=0;i--)this.unload(displayObject.children[i])},TextureGarbageCollector}();exports.default=TextureGarbageCollector},{"../../const":66,"../../settings":121}],103:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_pixiGlCore=require("pixi-gl-core"),_const=require("../../const"),_RenderTarget=require("./utils/RenderTarget"),_RenderTarget2=(obj=_RenderTarget)&&obj.__esModule?obj:{default:obj},_utils=require("../../utils");var TextureManager=function(){function TextureManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextureManager),this.renderer=renderer,this.gl=renderer.gl,this._managedTextures=[]}return TextureManager.prototype.bindTexture=function(){},TextureManager.prototype.getTexture=function(){},TextureManager.prototype.updateTexture=function(texture,location){var gl=this.gl,isRenderTexture=!!texture._glRenderTargets;if(!texture.hasLoaded)return null;var boundTextures=this.renderer.boundTextures;if(void 0===location){location=0;for(var i=0;i<boundTextures.length;++i)if(boundTextures[i]===texture){location=i;break}}boundTextures[location]=texture,gl.activeTexture(gl.TEXTURE0+location);var glTexture=texture._glTextures[this.renderer.CONTEXT_UID];if(glTexture)isRenderTexture?texture._glRenderTargets[this.renderer.CONTEXT_UID].resize(texture.width,texture.height):glTexture.upload(texture.source);else{if(isRenderTexture){var renderTarget=new _RenderTarget2.default(this.gl,texture.width,texture.height,texture.scaleMode,texture.resolution);renderTarget.resize(texture.width,texture.height),texture._glRenderTargets[this.renderer.CONTEXT_UID]=renderTarget,glTexture=renderTarget.texture}else(glTexture=new _pixiGlCore.GLTexture(this.gl,null,null,null,null)).bind(location),glTexture.premultiplyAlpha=!0,glTexture.upload(texture.source);texture._glTextures[this.renderer.CONTEXT_UID]=glTexture,texture.on("update",this.updateTexture,this),texture.on("dispose",this.destroyTexture,this),this._managedTextures.push(texture),texture.isPowerOfTwo?(texture.mipmap&&glTexture.enableMipmap(),texture.wrapMode===_const.WRAP_MODES.CLAMP?glTexture.enableWrapClamp():texture.wrapMode===_const.WRAP_MODES.REPEAT?glTexture.enableWrapRepeat():glTexture.enableWrapMirrorRepeat()):glTexture.enableWrapClamp(),texture.scaleMode===_const.SCALE_MODES.NEAREST?glTexture.enableNearestScaling():glTexture.enableLinearScaling()}return glTexture},TextureManager.prototype.destroyTexture=function(texture,skipRemove){if((texture=texture.baseTexture||texture).hasLoaded){var uid=this.renderer.CONTEXT_UID,glTextures=texture._glTextures,glRenderTargets=texture._glRenderTargets;if(glTextures[uid]&&(this.renderer.unbindTexture(texture),glTextures[uid].destroy(),texture.off("update",this.updateTexture,this),texture.off("dispose",this.destroyTexture,this),delete glTextures[uid],!skipRemove)){var i=this._managedTextures.indexOf(texture);-1!==i&&(0,_utils.removeItems)(this._managedTextures,i,1)}glRenderTargets&&glRenderTargets[uid]&&(glRenderTargets[uid].destroy(),delete glRenderTargets[uid])}},TextureManager.prototype.removeAll=function(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];texture._glTextures[this.renderer.CONTEXT_UID]&&delete texture._glTextures[this.renderer.CONTEXT_UID]}},TextureManager.prototype.destroy=function(){for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];this.destroyTexture(texture,!0),texture.off("update",this.updateTexture,this),texture.off("dispose",this.destroyTexture,this)}this._managedTextures=null},TextureManager}();exports.default=TextureManager},{"../../const":66,"../../utils":145,"./utils/RenderTarget":116,"pixi-gl-core":49}],104:[function(require,module,exports){"use strict";exports.__esModule=!0;var _SystemRenderer3=_interopRequireDefault(require("../SystemRenderer")),_MaskManager2=_interopRequireDefault(require("./managers/MaskManager")),_StencilManager2=_interopRequireDefault(require("./managers/StencilManager")),_FilterManager2=_interopRequireDefault(require("./managers/FilterManager")),_RenderTarget2=_interopRequireDefault(require("./utils/RenderTarget")),_ObjectRenderer2=_interopRequireDefault(require("./utils/ObjectRenderer")),_TextureManager2=_interopRequireDefault(require("./TextureManager")),_BaseTexture2=_interopRequireDefault(require("../../textures/BaseTexture")),_TextureGarbageCollector2=_interopRequireDefault(require("./TextureGarbageCollector")),_WebGLState2=_interopRequireDefault(require("./WebGLState")),_mapWebGLDrawModesToPixi2=_interopRequireDefault(require("./utils/mapWebGLDrawModesToPixi")),_validateContext2=_interopRequireDefault(require("./utils/validateContext")),_utils=require("../../utils"),_pixiGlCore2=_interopRequireDefault(require("pixi-gl-core")),_const=require("../../const");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CONTEXT_UID=0,WebGLRenderer=function(_SystemRenderer){function WebGLRenderer(options,arg2,arg3){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_SystemRenderer.call(this,"WebGL",options,arg2,arg3));return _this.legacy=_this.options.legacy,_this.legacy&&(_pixiGlCore2.default.VertexArrayObject.FORCE_NATIVE=!0),_this.type=_const.RENDERER_TYPE.WEBGL,_this.handleContextLost=_this.handleContextLost.bind(_this),_this.handleContextRestored=_this.handleContextRestored.bind(_this),_this.view.addEventListener("webglcontextlost",_this.handleContextLost,!1),_this.view.addEventListener("webglcontextrestored",_this.handleContextRestored,!1),_this._contextOptions={alpha:_this.transparent,antialias:_this.options.antialias,premultipliedAlpha:_this.transparent&&"notMultiplied"!==_this.transparent,stencil:!0,preserveDrawingBuffer:_this.options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference},_this._backgroundColorRgba[3]=_this.transparent?0:1,_this.maskManager=new _MaskManager2.default(_this),_this.stencilManager=new _StencilManager2.default(_this),_this.emptyRenderer=new _ObjectRenderer2.default(_this),_this.currentRenderer=_this.emptyRenderer,_this.textureManager=null,_this.filterManager=null,_this.initPlugins(),_this.options.context&&(0,_validateContext2.default)(_this.options.context),_this.gl=_this.options.context||_pixiGlCore2.default.createContext(_this.view,_this._contextOptions),_this.CONTEXT_UID=CONTEXT_UID++,_this.state=new _WebGLState2.default(_this.gl),_this.renderingToScreen=!0,_this.boundTextures=null,_this._activeShader=null,_this._activeVao=null,_this._activeRenderTarget=null,_this._initContext(),_this.drawModes=(0,_mapWebGLDrawModesToPixi2.default)(_this.gl),_this._nextTextureLocation=0,_this.setBlendMode(0),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WebGLRenderer,_SystemRenderer),WebGLRenderer.prototype._initContext=function(){var gl=this.gl;gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext();var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(maxTextures),this.emptyTextures=new Array(maxTextures),this.textureManager=new _TextureManager2.default(this),this.filterManager=new _FilterManager2.default(this),this.textureGC=new _TextureGarbageCollector2.default(this),this.state.resetToDefault(),this.rootRenderTarget=new _RenderTarget2.default(gl,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var emptyGLTexture=new _pixiGlCore2.default.GLTexture.fromData(gl,null,1,1),tempObj={_glTextures:{}};tempObj._glTextures[this.CONTEXT_UID]={};for(var i=0;i<maxTextures;i++){var empty=new _BaseTexture2.default;empty._glTextures[this.CONTEXT_UID]=emptyGLTexture,this.boundTextures[i]=tempObj,this.emptyTextures[i]=empty,this.bindTexture(null,i)}this.emit("context",gl),this.resize(this.screen.width,this.screen.height)},WebGLRenderer.prototype.render=function(displayObject,renderTexture,clear,transform,skipUpdateTransform){if(this.renderingToScreen=!renderTexture,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.parent;displayObject.parent=this._tempDisplayObjectParent,displayObject.updateTransform(),displayObject.parent=cacheParent}this.bindRenderTexture(renderTexture,transform),this.currentRenderer.start(),(void 0!==clear?clear:this.clearBeforeRender)&&this._activeRenderTarget.clear(),displayObject.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},WebGLRenderer.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},WebGLRenderer.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},WebGLRenderer.prototype.resize=function(screenWidth,screenHeight){_SystemRenderer3.default.prototype.resize.call(this,screenWidth,screenHeight),this.rootRenderTarget.resize(screenWidth,screenHeight),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},WebGLRenderer.prototype.setBlendMode=function(blendMode){this.state.setBlendMode(blendMode)},WebGLRenderer.prototype.clear=function(clearColor){this._activeRenderTarget.clear(clearColor)},WebGLRenderer.prototype.setTransform=function(matrix){this._activeRenderTarget.transform=matrix},WebGLRenderer.prototype.clearRenderTexture=function(renderTexture,clearColor){var renderTarget=renderTexture.baseTexture._glRenderTargets[this.CONTEXT_UID];return renderTarget&&renderTarget.clear(clearColor),this},WebGLRenderer.prototype.bindRenderTexture=function(renderTexture,transform){var renderTarget=void 0;if(renderTexture){var baseTexture=renderTexture.baseTexture;baseTexture._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(baseTexture,0),this.unbindTexture(baseTexture),(renderTarget=baseTexture._glRenderTargets[this.CONTEXT_UID]).setFrame(renderTexture.frame)}else renderTarget=this.rootRenderTarget;return renderTarget.transform=transform,this.bindRenderTarget(renderTarget),this},WebGLRenderer.prototype.bindRenderTarget=function(renderTarget){return renderTarget!==this._activeRenderTarget&&(this._activeRenderTarget=renderTarget,renderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=renderTarget.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(renderTarget.stencilMaskStack)),this},WebGLRenderer.prototype.bindShader=function(shader,autoProject){return this._activeShader!==shader&&(this._activeShader=shader,shader.bind(),!1!==autoProject&&(shader.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},WebGLRenderer.prototype.bindTexture=function(texture,location,forceLocation){if((texture=(texture=texture||this.emptyTextures[location]).baseTexture||texture).touched=this.textureGC.count,forceLocation)location=location||0;else{for(var i=0;i<this.boundTextures.length;i++)if(this.boundTextures[i]===texture)return i;void 0===location&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,location=this.boundTextures.length-this._nextTextureLocation-1)}var gl=this.gl,glTexture=texture._glTextures[this.CONTEXT_UID];return glTexture?(this.boundTextures[location]=texture,gl.activeTexture(gl.TEXTURE0+location),gl.bindTexture(gl.TEXTURE_2D,glTexture.texture)):this.textureManager.updateTexture(texture,location),location},WebGLRenderer.prototype.unbindTexture=function(texture){var gl=this.gl;texture=texture.baseTexture||texture;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]===texture&&(this.boundTextures[i]=this.emptyTextures[i],gl.activeTexture(gl.TEXTURE0+i),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[i]._glTextures[this.CONTEXT_UID].texture));return this},WebGLRenderer.prototype.createVao=function(){return new _pixiGlCore2.default.VertexArrayObject(this.gl,this.state.attribState)},WebGLRenderer.prototype.bindVao=function(vao){return this._activeVao===vao?this:(vao?vao.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=vao,this)},WebGLRenderer.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.emptyTextures[i];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault()},WebGLRenderer.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},WebGLRenderer.prototype.destroy=function(removeView){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),_SystemRenderer.prototype.destroy.call(this,removeView),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},WebGLRenderer}(_SystemRenderer3.default);exports.default=WebGLRenderer,_utils.pluginTarget.mixin(WebGLRenderer)},{"../../const":66,"../../textures/BaseTexture":132,"../../utils":145,"../SystemRenderer":96,"./TextureGarbageCollector":102,"./TextureManager":103,"./WebGLState":105,"./managers/FilterManager":110,"./managers/MaskManager":111,"./managers/StencilManager":112,"./utils/ObjectRenderer":114,"./utils/RenderTarget":116,"./utils/mapWebGLDrawModesToPixi":119,"./utils/validateContext":120,"pixi-gl-core":49}],105:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_mapWebGLBlendModesToPixi=require("./utils/mapWebGLBlendModesToPixi"),_mapWebGLBlendModesToPixi2=(obj=_mapWebGLBlendModesToPixi)&&obj.__esModule?obj:{default:obj};var WebGLState=function(){function WebGLState(gl){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLState),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=gl,this.maxAttribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,_mapWebGLBlendModesToPixi2.default)(gl),this.nativeVaoExtension=gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object")}return WebGLState.prototype.push=function(){var state=this.stack[this.stackIndex];state||(state=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var i=0;i<this.activeState.length;i++)state[i]=this.activeState[i]},WebGLState.prototype.pop=function(){var state=this.stack[--this.stackIndex];this.setState(state)},WebGLState.prototype.setState=function(state){this.setBlend(state[0]),this.setDepthTest(state[1]),this.setFrontFace(state[2]),this.setCullFace(state[3]),this.setBlendMode(state[4])},WebGLState.prototype.setBlend=function(value){value=value?1:0,this.activeState[0]!==value&&(this.activeState[0]=value,this.gl[value?"enable":"disable"](this.gl.BLEND))},WebGLState.prototype.setBlendMode=function(value){if(value!==this.activeState[4]){this.activeState[4]=value;var mode=this.blendModes[value];2===mode.length?this.gl.blendFunc(mode[0],mode[1]):this.gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3])}},WebGLState.prototype.setDepthTest=function(value){value=value?1:0,this.activeState[1]!==value&&(this.activeState[1]=value,this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST))},WebGLState.prototype.setCullFace=function(value){value=value?1:0,this.activeState[3]!==value&&(this.activeState[3]=value,this.gl[value?"enable":"disable"](this.gl.CULL_FACE))},WebGLState.prototype.setFrontFace=function(value){value=value?1:0,this.activeState[2]!==value&&(this.activeState[2]=value,this.gl.frontFace(this.gl[value?"CW":"CCW"]))},WebGLState.prototype.resetAttributes=function(){for(var i=0;i<this.attribState.tempAttribState.length;i++)this.attribState.tempAttribState[i]=0;for(var _i=0;_i<this.attribState.attribState.length;_i++)this.attribState.attribState[_i]=0;for(var _i2=1;_i2<this.maxAttribs;_i2++)this.gl.disableVertexAttribArray(_i2)},WebGLState.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var i=0;i<this.activeState.length;++i)this.activeState[i]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},WebGLState}();exports.default=WebGLState},{"./utils/mapWebGLBlendModesToPixi":118}],106:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_extractUniformsFromSrc2=_interopRequireDefault(require("./extractUniformsFromSrc")),_utils=require("../../../utils"),_const=require("../../../const"),_settings2=_interopRequireDefault(require("../../../settings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SOURCE_KEY_MAP={},Filter=function(){function Filter(vertexSrc,fragmentSrc,uniforms){for(var i in function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Filter),this.vertexSrc=vertexSrc||Filter.defaultVertexSrc,this.fragmentSrc=fragmentSrc||Filter.defaultFragmentSrc,this._blendMode=_const.BLEND_MODES.NORMAL,this.uniformData=uniforms||(0,_extractUniformsFromSrc2.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[i]=this.uniformData[i].value,this.uniformData[i].type&&(this.uniformData[i].type=this.uniformData[i].type.toLowerCase());this.glShaders={},SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]||(SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc]=(0,_utils.uid)()),this.glShaderKey=SOURCE_KEY_MAP[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=_settings2.default.RESOLUTION,this.enabled=!0,this.autoFit=!0}return Filter.prototype.apply=function(filterManager,input,output,clear,currentState){filterManager.applyFilter(this,input,output,clear)},_createClass(Filter,[{key:"blendMode",get:function(){return this._blendMode},set:function(value){this._blendMode=value}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),Filter}();exports.default=Filter},{"../../../const":66,"../../../settings":121,"../../../utils":145,"./extractUniformsFromSrc":107}],107:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(vertexSrc,fragmentSrc,mask){var vertUniforms=extractUniformsFromString(vertexSrc),fragUniforms=extractUniformsFromString(fragmentSrc);return Object.assign(vertUniforms,fragUniforms)};var obj,_pixiGlCore=require("pixi-gl-core");var defaultValue=((obj=_pixiGlCore)&&obj.__esModule?obj:{default:obj}).default.shader.defaultValue;function extractUniformsFromString(string){for(var maskRegex=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),uniforms={},nameSplit=void 0,lines=string.replace(/\s+/g," ").split(/\s*;\s*/),i=0;i<lines.length;i++){var line=lines[i].trim();if(line.indexOf("uniform")>-1){var splitLine=line.split(" "),type=splitLine[1],name=splitLine[2],size=1;name.indexOf("[")>-1&&(name=(nameSplit=name.split(/\[|]/))[0],size*=Number(nameSplit[1])),name.match(maskRegex)||(uniforms[name]={value:defaultValue(type,size),name:name,type:type})}}return uniforms}},{"pixi-gl-core":49}],108:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.calculateScreenSpaceMatrix=function(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();return mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height),mappedMatrix.scale(textureSize.width,textureSize.height),mappedMatrix},exports.calculateNormalizedScreenSpaceMatrix=function(outputMatrix,filterArea,textureSize){var mappedMatrix=outputMatrix.identity();mappedMatrix.translate(filterArea.x/textureSize.width,filterArea.y/textureSize.height);var translateScaleX=textureSize.width/filterArea.width,translateScaleY=textureSize.height/filterArea.height;return mappedMatrix.scale(translateScaleX,translateScaleY),mappedMatrix},exports.calculateSpriteMatrix=function(outputMatrix,filterArea,textureSize,sprite){var orig=sprite._texture.orig,mappedMatrix=outputMatrix.set(textureSize.width,0,0,textureSize.height,filterArea.x,filterArea.y),worldTransform=sprite.worldTransform.copy(_math.Matrix.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix};var _math=require("../../../math")},{"../../../math":90}],109:[function(require,module,exports){"use strict";exports.__esModule=!0;var _Filter3=_interopRequireDefault(require("../Filter")),_math=require("../../../../math"),_TextureMatrix2=(require("path"),_interopRequireDefault(require("../../../../textures/TextureMatrix")));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SpriteMaskFilter=function(_Filter){function SpriteMaskFilter(sprite){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpriteMaskFilter);var maskMatrix=new _math.Matrix,_this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return sprite.renderable=!1,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SpriteMaskFilter,_Filter),SpriteMaskFilter.prototype.apply=function(filterManager,input,output){var maskSprite=this.maskSprite,tex=this.maskSprite.texture;tex.valid&&(tex.transform||(tex.transform=new _TextureMatrix2.default(tex,0)),tex.transform.update(),this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.transform.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.transform.uClampFrame,filterManager.applyFilter(this,input,output))},SpriteMaskFilter}(_Filter3.default);exports.default=SpriteMaskFilter},{"../../../../math":90,"../../../../textures/TextureMatrix":136,"../Filter":106,path:42}],110:[function(require,module,exports){"use strict";exports.__esModule=!0;var _WebGLManager3=_interopRequireDefault(require("./WebGLManager")),_RenderTarget2=_interopRequireDefault(require("../utils/RenderTarget")),_Quad2=_interopRequireDefault(require("../utils/Quad")),_math=require("../../../math"),_Shader2=_interopRequireDefault(require("../../../Shader")),filterTransforms=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../filters/filterTransforms")),_bitTwiddle2=_interopRequireDefault(require("bit-twiddle"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var FilterState=function FilterState(){_classCallCheck(this,FilterState),this.renderTarget=null,this.sourceFrame=new _math.Rectangle,this.destinationFrame=new _math.Rectangle,this.filters=[],this.target=null,this.resolution=1},FilterManager=function(_WebGLManager){function FilterManager(renderer){_classCallCheck(this,FilterManager);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_WebGLManager.call(this,renderer));return _this.gl=_this.renderer.gl,_this.quad=new _Quad2.default(_this.gl,renderer.state.attribState),_this.shaderCache={},_this.pool={},_this.filterData=null,_this.managedFilters=[],_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(FilterManager,_WebGLManager),FilterManager.prototype.pushFilter=function(target,filters){var renderer=this.renderer,filterData=this.filterData;if(!filterData){filterData=this.renderer._activeRenderTarget.filterStack;var filterState=new FilterState;filterState.sourceFrame=filterState.destinationFrame=this.renderer._activeRenderTarget.size,filterState.renderTarget=renderer._activeRenderTarget,this.renderer._activeRenderTarget.filterData=filterData={index:0,stack:[filterState]},this.filterData=filterData}var currentState=filterData.stack[++filterData.index];currentState||(currentState=filterData.stack[filterData.index]=new FilterState);var resolution=filters[0].resolution,padding=0|filters[0].padding,targetBounds=target.filterArea||target.getBounds(!0),sourceFrame=currentState.sourceFrame,destinationFrame=currentState.destinationFrame;sourceFrame.x=(targetBounds.x*resolution|0)/resolution,sourceFrame.y=(targetBounds.y*resolution|0)/resolution,sourceFrame.width=(targetBounds.width*resolution|0)/resolution,sourceFrame.height=(targetBounds.height*resolution|0)/resolution,filterData.stack[0].renderTarget.transform||filters[0].autoFit&&sourceFrame.fit(filterData.stack[0].destinationFrame),sourceFrame.pad(padding),destinationFrame.width=sourceFrame.width,destinationFrame.height=sourceFrame.height;var renderTarget=this.getPotRenderTarget(renderer.gl,sourceFrame.width,sourceFrame.height,resolution);currentState.target=target,currentState.filters=filters,currentState.resolution=resolution,currentState.renderTarget=renderTarget,renderTarget.setFrame(destinationFrame,sourceFrame),renderer.bindRenderTarget(renderTarget),renderTarget.clear()},FilterManager.prototype.popFilter=function(){var filterData=this.filterData,lastState=filterData.stack[filterData.index-1],currentState=filterData.stack[filterData.index];this.quad.map(currentState.renderTarget.size,currentState.sourceFrame).upload();var filters=currentState.filters;if(1===filters.length)filters[0].apply(this,currentState.renderTarget,lastState.renderTarget,!1,currentState),this.freePotRenderTarget(currentState.renderTarget);else{var flip=currentState.renderTarget,flop=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,currentState.resolution);flop.setFrame(currentState.destinationFrame,currentState.sourceFrame),flop.clear();var i=0;for(i=0;i<filters.length-1;++i){filters[i].apply(this,flip,flop,!0,currentState);var t=flip;flip=flop,flop=t}filters[i].apply(this,flip,lastState.renderTarget,!1,currentState),this.freePotRenderTarget(flip),this.freePotRenderTarget(flop)}filterData.index--,0===filterData.index&&(this.filterData=null)},FilterManager.prototype.applyFilter=function(filter,input,output,clear){var renderer=this.renderer,gl=renderer.gl,shader=filter.glShaders[renderer.CONTEXT_UID];shader||(filter.glShaderKey?(shader=this.shaderCache[filter.glShaderKey])||(shader=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc),filter.glShaders[renderer.CONTEXT_UID]=this.shaderCache[filter.glShaderKey]=shader,this.managedFilters.push(filter)):(shader=filter.glShaders[renderer.CONTEXT_UID]=new _Shader2.default(this.gl,filter.vertexSrc,filter.fragmentSrc),this.managedFilters.push(filter)),renderer.bindVao(null),this.quad.initVao(shader)),renderer.bindVao(this.quad.vao),renderer.bindRenderTarget(output),clear&&(gl.disable(gl.SCISSOR_TEST),renderer.clear(),gl.enable(gl.SCISSOR_TEST)),output===renderer.maskManager.scissorRenderTarget&&renderer.maskManager.pushScissorMask(null,renderer.maskManager.scissorData),renderer.bindShader(shader);var tex=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=tex,this.syncUniforms(shader,filter),renderer.state.setBlendMode(filter.blendMode),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,input.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)},FilterManager.prototype.syncUniforms=function(shader,filter){var uniformData=filter.uniformData,uniforms=filter.uniforms,textureCount=1,currentState=void 0;if(shader.uniforms.filterArea){currentState=this.filterData.stack[this.filterData.index];var filterArea=shader.uniforms.filterArea;filterArea[0]=currentState.renderTarget.size.width,filterArea[1]=currentState.renderTarget.size.height,filterArea[2]=currentState.sourceFrame.x,filterArea[3]=currentState.sourceFrame.y,shader.uniforms.filterArea=filterArea}if(shader.uniforms.filterClamp){currentState=currentState||this.filterData.stack[this.filterData.index];var filterClamp=shader.uniforms.filterClamp;filterClamp[0]=0,filterClamp[1]=0,filterClamp[2]=(currentState.sourceFrame.width-1)/currentState.renderTarget.size.width,filterClamp[3]=(currentState.sourceFrame.height-1)/currentState.renderTarget.size.height,shader.uniforms.filterClamp=filterClamp}for(var i in uniformData){var type=uniformData[i].type;if("sampler2d"===type&&0!==uniforms[i]){if(uniforms[i].baseTexture)shader.uniforms[i]=this.renderer.bindTexture(uniforms[i].baseTexture,textureCount);else{shader.uniforms[i]=textureCount;var gl=this.renderer.gl;this.renderer.boundTextures[textureCount]=this.renderer.emptyTextures[textureCount],gl.activeTexture(gl.TEXTURE0+textureCount),uniforms[i].texture.bind()}textureCount++}else if("mat3"===type)void 0!==uniforms[i].a?shader.uniforms[i]=uniforms[i].toArray(!0):shader.uniforms[i]=uniforms[i];else if("vec2"===type)if(void 0!==uniforms[i].x){var val=shader.uniforms[i]||new Float32Array(2);val[0]=uniforms[i].x,val[1]=uniforms[i].y,shader.uniforms[i]=val}else shader.uniforms[i]=uniforms[i];else"float"===type?shader.uniforms.data[i].value!==uniformData[i]&&(shader.uniforms[i]=uniforms[i]):shader.uniforms[i]=uniforms[i]}},FilterManager.prototype.getRenderTarget=function(clear,resolution){var currentState=this.filterData.stack[this.filterData.index],renderTarget=this.getPotRenderTarget(this.renderer.gl,currentState.sourceFrame.width,currentState.sourceFrame.height,resolution||currentState.resolution);return renderTarget.setFrame(currentState.destinationFrame,currentState.sourceFrame),renderTarget},FilterManager.prototype.returnRenderTarget=function(renderTarget){this.freePotRenderTarget(renderTarget)},FilterManager.prototype.calculateScreenSpaceMatrix=function(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size)},FilterManager.prototype.calculateNormalizedScreenSpaceMatrix=function(outputMatrix){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateNormalizedScreenSpaceMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,currentState.destinationFrame)},FilterManager.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var currentState=this.filterData.stack[this.filterData.index];return filterTransforms.calculateSpriteMatrix(outputMatrix,currentState.sourceFrame,currentState.renderTarget.size,sprite)},FilterManager.prototype.destroy=function(){for(var contextLost=arguments.length>0&&void 0!==arguments[0]&&arguments[0],renderer=this.renderer,filters=this.managedFilters,i=0;i<filters.length;i++)contextLost||filters[i].glShaders[renderer.CONTEXT_UID].destroy(),delete filters[i].glShaders[renderer.CONTEXT_UID];this.shaderCache={},contextLost?this.pool={}:this.emptyPool()},FilterManager.prototype.getPotRenderTarget=function(gl,minWidth,minHeight,resolution){var key=(65535&(minWidth=_bitTwiddle2.default.nextPow2(minWidth*resolution)))<<16|65535&(minHeight=_bitTwiddle2.default.nextPow2(minHeight*resolution));this.pool[key]||(this.pool[key]=[]);var renderTarget=this.pool[key].pop();if(!renderTarget){var tex=this.renderer.boundTextures[0];gl.activeTexture(gl.TEXTURE0),renderTarget=new _RenderTarget2.default(gl,minWidth,minHeight,null,1),gl.bindTexture(gl.TEXTURE_2D,tex._glTextures[this.renderer.CONTEXT_UID].texture)}return renderTarget.resolution=resolution,renderTarget.defaultFrame.width=renderTarget.size.width=minWidth/resolution,renderTarget.defaultFrame.height=renderTarget.size.height=minHeight/resolution,renderTarget},FilterManager.prototype.emptyPool=function(){for(var i in this.pool){var textures=this.pool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0)}this.pool={}},FilterManager.prototype.freePotRenderTarget=function(renderTarget){var key=(65535&renderTarget.size.width*renderTarget.resolution)<<16|65535&renderTarget.size.height*renderTarget.resolution;this.pool[key].push(renderTarget)},FilterManager}(_WebGLManager3.default);exports.default=FilterManager},{"../../../Shader":64,"../../../math":90,"../filters/filterTransforms":108,"../utils/Quad":115,"../utils/RenderTarget":116,"./WebGLManager":113,"bit-twiddle":6}],111:[function(require,module,exports){"use strict";exports.__esModule=!0;var _WebGLManager3=_interopRequireDefault(require("./WebGLManager")),_SpriteMaskFilter2=_interopRequireDefault(require("../filters/spriteMask/SpriteMaskFilter"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MaskManager=function(_WebGLManager){function MaskManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MaskManager);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_WebGLManager.call(this,renderer));return _this.scissor=!1,_this.scissorData=null,_this.scissorRenderTarget=null,_this.enableScissor=!0,_this.alphaMaskPool=[],_this.alphaMaskIndex=0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MaskManager,_WebGLManager),MaskManager.prototype.pushMask=function(target,maskData){if(maskData.texture)this.pushSpriteMask(target,maskData);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&maskData.isFastRect()){var matrix=maskData.worldTransform,rot=Math.atan2(matrix.b,matrix.a);(rot=Math.round(rot*(180/Math.PI)))%90?this.pushStencilMask(maskData):this.pushScissorMask(target,maskData)}else this.pushStencilMask(maskData)},MaskManager.prototype.popMask=function(target,maskData){maskData.texture?this.popSpriteMask(target,maskData):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(target,maskData):this.popStencilMask(target,maskData)},MaskManager.prototype.pushSpriteMask=function(target,maskData){var alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new _SpriteMaskFilter2.default(maskData)]),alphaMaskFilter[0].resolution=this.renderer.resolution,alphaMaskFilter[0].maskSprite=maskData,target.filterArea=maskData.getBounds(!0),this.renderer.filterManager.pushFilter(target,alphaMaskFilter),this.alphaMaskIndex++},MaskManager.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},MaskManager.prototype.pushStencilMask=function(maskData){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(maskData)},MaskManager.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},MaskManager.prototype.pushScissorMask=function(target,maskData){maskData.renderable=!0;var renderTarget=this.renderer._activeRenderTarget,bounds=maskData.getBounds();bounds.fit(renderTarget.size),maskData.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var resolution=this.renderer.resolution;this.renderer.gl.scissor(bounds.x*resolution,(renderTarget.root?renderTarget.size.height-bounds.y-bounds.height:bounds.y)*resolution,bounds.width*resolution,bounds.height*resolution),this.scissorRenderTarget=renderTarget,this.scissorData=maskData,this.scissor=!0},MaskManager.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var gl=this.renderer.gl;gl.disable(gl.SCISSOR_TEST)},MaskManager}(_WebGLManager3.default);exports.default=MaskManager},{"../filters/spriteMask/SpriteMaskFilter":109,"./WebGLManager":113}],112:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_WebGLManager2=require("./WebGLManager"),_WebGLManager3=(obj=_WebGLManager2)&&obj.__esModule?obj:{default:obj};var StencilManager=function(_WebGLManager){function StencilManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StencilManager);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_WebGLManager.call(this,renderer));return _this.stencilMaskStack=null,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(StencilManager,_WebGLManager),StencilManager.prototype.setMaskStack=function(stencilMaskStack){this.stencilMaskStack=stencilMaskStack;var gl=this.renderer.gl;0===stencilMaskStack.length?gl.disable(gl.STENCIL_TEST):gl.enable(gl.STENCIL_TEST)},StencilManager.prototype.pushStencil=function(graphics){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var gl=this.renderer.gl,prevMaskCount=this.stencilMaskStack.length;0===prevMaskCount&&gl.enable(gl.STENCIL_TEST),this.stencilMaskStack.push(graphics),gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),this.renderer.plugins.graphics.render(graphics),this._useCurrent()},StencilManager.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var gl=this.renderer.gl,graphics=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.clearStencil(0)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),this.renderer.plugins.graphics.render(graphics),this._useCurrent())},StencilManager.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},StencilManager.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},StencilManager.prototype.destroy=function(){_WebGLManager3.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},StencilManager}(_WebGLManager3.default);exports.default=StencilManager},{"./WebGLManager":113}],113:[function(require,module,exports){"use strict";exports.__esModule=!0;var WebGLManager=function(){function WebGLManager(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLManager),this.renderer=renderer,this.renderer.on("context",this.onContextChange,this)}return WebGLManager.prototype.onContextChange=function(){},WebGLManager.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},WebGLManager}();exports.default=WebGLManager},{}],114:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_WebGLManager2=require("../managers/WebGLManager");var ObjectRenderer=function(_WebGLManager){function ObjectRenderer(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ObjectRenderer),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_WebGLManager.apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ObjectRenderer,_WebGLManager),ObjectRenderer.prototype.start=function(){},ObjectRenderer.prototype.stop=function(){this.flush()},ObjectRenderer.prototype.flush=function(){},ObjectRenderer.prototype.render=function(object){},ObjectRenderer}(((obj=_WebGLManager2)&&obj.__esModule?obj:{default:obj}).default);exports.default=ObjectRenderer},{"../managers/WebGLManager":113}],115:[function(require,module,exports){"use strict";exports.__esModule=!0;var _pixiGlCore2=_interopRequireDefault(require("pixi-gl-core")),_createIndicesForQuads2=_interopRequireDefault(require("../../../utils/createIndicesForQuads"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Quad=function(){function Quad(gl,state){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Quad),this.gl=gl,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var i=0;i<4;i++)this.interleaved[4*i]=this.vertices[2*i],this.interleaved[4*i+1]=this.vertices[2*i+1],this.interleaved[4*i+2]=this.uvs[2*i],this.interleaved[4*i+3]=this.uvs[2*i+1];this.indices=(0,_createIndicesForQuads2.default)(1),this.vertexBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,this.interleaved,gl.STATIC_DRAW),this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW),this.vao=new _pixiGlCore2.default.VertexArrayObject(gl,state)}return Quad.prototype.initVao=function(shader){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,shader.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,shader.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},Quad.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;return this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y,this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x,this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height,x=destinationFrame.x,y=destinationFrame.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+destinationFrame.width,this.vertices[3]=y,this.vertices[4]=x+destinationFrame.width,this.vertices[5]=y+destinationFrame.height,this.vertices[6]=x,this.vertices[7]=y+destinationFrame.height,this},Quad.prototype.upload=function(){for(var i=0;i<4;i++)this.interleaved[4*i]=this.vertices[2*i],this.interleaved[4*i+1]=this.vertices[2*i+1],this.interleaved[4*i+2]=this.uvs[2*i],this.interleaved[4*i+3]=this.uvs[2*i+1];return this.vertexBuffer.upload(this.interleaved),this},Quad.prototype.destroy=function(){var gl=this.gl;gl.deleteBuffer(this.vertexBuffer),gl.deleteBuffer(this.indexBuffer)},Quad}();exports.default=Quad},{"../../../utils/createIndicesForQuads":143,"pixi-gl-core":49}],116:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_math=require("../../../math"),_const=require("../../../const"),_settings=require("../../../settings"),_settings2=(obj=_settings)&&obj.__esModule?obj:{default:obj},_pixiGlCore=require("pixi-gl-core");var RenderTarget=function(){function RenderTarget(gl,width,height,scaleMode,resolution,root){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RenderTarget),this.gl=gl,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new _math.Rectangle(0,0,1,1),this.resolution=resolution||_settings2.default.RESOLUTION,this.projectionMatrix=new _math.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new _math.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=void 0!==scaleMode?scaleMode:_settings2.default.SCALE_MODE,this.root=root,this.root?(this.frameBuffer=new _pixiGlCore.GLFramebuffer(gl,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=_pixiGlCore.GLFramebuffer.createRGBA(gl,100,100),this.scaleMode===_const.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(width,height)}return RenderTarget.prototype.clear=function(clearColor){var cc=clearColor||this.clearColor;this.frameBuffer.clear(cc[0],cc[1],cc[2],cc[3])},RenderTarget.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},RenderTarget.prototype.setFrame=function(destinationFrame,sourceFrame){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||this.destinationFrame},RenderTarget.prototype.activate=function(){var gl=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(gl.enable(gl.SCISSOR_TEST),gl.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):gl.disable(gl.SCISSOR_TEST),gl.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},RenderTarget.prototype.calculateProjection=function(destinationFrame,sourceFrame){var pm=this.projectionMatrix;sourceFrame=sourceFrame||destinationFrame,pm.identity(),this.root?(pm.a=1/destinationFrame.width*2,pm.d=-1/destinationFrame.height*2,pm.tx=-1-sourceFrame.x*pm.a,pm.ty=1-sourceFrame.y*pm.d):(pm.a=1/destinationFrame.width*2,pm.d=1/destinationFrame.height*2,pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-1-sourceFrame.y*pm.d)},RenderTarget.prototype.resize=function(width,height){if(width|=0,height|=0,this.size.width!==width||this.size.height!==height){this.size.width=width,this.size.height=height,this.defaultFrame.width=width,this.defaultFrame.height=height,this.frameBuffer.resize(width*this.resolution,height*this.resolution);var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame)}},RenderTarget.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},RenderTarget}();exports.default=RenderTarget},{"../../../const":66,"../../../math":90,"../../../settings":121,"pixi-gl-core":49}],117:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(maxIfs,gl){var createTempContext=!gl;if(0===maxIfs)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(createTempContext){var tinyCanvas=document.createElement("canvas");tinyCanvas.width=1,tinyCanvas.height=1,gl=_pixiGlCore2.default.createContext(tinyCanvas)}var shader=gl.createShader(gl.FRAGMENT_SHADER);for(;;){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS))break;maxIfs=maxIfs/2|0}createTempContext&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").loseContext();return maxIfs};var obj,_pixiGlCore=require("pixi-gl-core"),_pixiGlCore2=(obj=_pixiGlCore)&&obj.__esModule?obj:{default:obj};var fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function generateIfTestSrc(maxIfs){for(var src="",i=0;i<maxIfs;++i)i>0&&(src+="\nelse "),i<maxIfs-1&&(src+="if(test == "+i+".0){}");return src}},{"pixi-gl-core":49}],118:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(gl){var array=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return array[_const.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.ADD]=[gl.ONE,gl.DST_ALPHA],array[_const.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR],array[_const.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[_const.BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.DST_ALPHA,gl.ONE,gl.DST_ALPHA],array[_const.BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_COLOR],array};var _const=require("../../../const")},{"../../../const":66}],119:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(gl){var object=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return object[_const.DRAW_MODES.POINTS]=gl.POINTS,object[_const.DRAW_MODES.LINES]=gl.LINES,object[_const.DRAW_MODES.LINE_LOOP]=gl.LINE_LOOP,object[_const.DRAW_MODES.LINE_STRIP]=gl.LINE_STRIP,object[_const.DRAW_MODES.TRIANGLES]=gl.TRIANGLES,object[_const.DRAW_MODES.TRIANGLE_STRIP]=gl.TRIANGLE_STRIP,object[_const.DRAW_MODES.TRIANGLE_FAN]=gl.TRIANGLE_FAN,object};var _const=require("../../../const")},{"../../../const":66}],120:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(gl){gl.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},{}],121:[function(require,module,exports){"use strict";exports.__esModule=!0;var _maxRecommendedTextures2=_interopRequireDefault(require("./utils/maxRecommendedTextures")),_canUploadSameBuffer2=_interopRequireDefault(require("./utils/canUploadSameBuffer"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,_maxRecommendedTextures2.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,_canUploadSameBuffer2.default)(),MESH_CANVAS_PADDING:0}},{"./utils/canUploadSameBuffer":142,"./utils/maxRecommendedTextures":147}],122:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_math=require("../math"),_utils=require("../utils"),_const=require("../const"),_Texture2=_interopRequireDefault(require("../textures/Texture")),_Container3=_interopRequireDefault(require("../display/Container"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var tempPoint=new _math.Point,Sprite=function(_Container){function Sprite(texture){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Sprite);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Container.call(this));return _this._anchor=new _math.ObservablePoint(_this._onAnchorUpdate,_this),_this._texture=null,_this._width=0,_this._height=0,_this._tint=null,_this._tintRGB=null,_this.tint=16777215,_this.blendMode=_const.BLEND_MODES.NORMAL,_this.shader=null,_this.cachedTint=16777215,_this.texture=texture||_Texture2.default.EMPTY,_this.vertexData=new Float32Array(8),_this.vertexTrimmedData=null,_this._transformID=-1,_this._textureID=-1,_this._transformTrimmedID=-1,_this._textureTrimmedID=-1,_this.pluginName="sprite",_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Sprite,_Container),Sprite.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,_utils.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,_utils.sign)(this.scale.y)*this._height/this._texture.orig.height)},Sprite.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},Sprite.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var texture=this._texture,wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,trim=texture.trim,orig=texture.orig,anchor=this._anchor,w0=0,w1=0,h0=0,h1=0;trim?(w0=(w1=trim.x-anchor._x*orig.width)+trim.width,h0=(h1=trim.y-anchor._y*orig.height)+trim.height):(w0=(w1=-anchor._x*orig.width)+orig.width,h0=(h1=-anchor._y*orig.height)+orig.height),vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty}},Sprite.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var texture=this._texture,vertexData=this.vertexTrimmedData,orig=texture.orig,anchor=this._anchor,wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty},Sprite.prototype._renderWebGL=function(renderer){this.calculateVertices(),renderer.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this)},Sprite.prototype._renderCanvas=function(renderer){renderer.plugins[this.pluginName].render(this)},Sprite.prototype._calculateBounds=function(){var trim=this._texture.trim,orig=this._texture.orig;!trim||trim.width===orig.width&&trim.height===orig.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},Sprite.prototype.getLocalBounds=function(rect){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new _math.Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_Container.prototype.getLocalBounds.call(this,rect)},Sprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width,height=this._texture.orig.height,x1=-width*this.anchor.x,y1=0;return tempPoint.x>=x1&&tempPoint.x<x1+width&&(y1=-height*this.anchor.y,tempPoint.y>=y1&&tempPoint.y<y1+height)},Sprite.prototype.destroy=function(options){if(_Container.prototype.destroy.call(this,options),this._anchor=null,"boolean"==typeof options?options:options&&options.texture){var destroyBaseTexture="boolean"==typeof options?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null,this.shader=null},Sprite.from=function(source){return new Sprite(_Texture2.default.from(source))},Sprite.fromFrame=function(frameId){var texture=_utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache');return new Sprite(texture)},Sprite.fromImage=function(imageId,crossorigin,scaleMode){return new Sprite(_Texture2.default.fromImage(imageId,crossorigin,scaleMode))},_createClass(Sprite,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value}},{key:"anchor",get:function(){return this._anchor},set:function(value){this._anchor.copy(value)}},{key:"tint",get:function(){return this._tint},set:function(value){this._tint=value,this._tintRGB=(value>>16)+(65280&value)+((255&value)<<16)}},{key:"texture",get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture=value,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,value&&(value.baseTexture.hasLoaded?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))}}]),Sprite}(_Container3.default);exports.default=Sprite},{"../const":66,"../display/Container":68,"../math":90,"../textures/Texture":135,"../utils":145}],123:[function(require,module,exports){"use strict";exports.__esModule=!0;var _CanvasRenderer2=_interopRequireDefault(require("../../renderers/canvas/CanvasRenderer")),_const=require("../../const"),_math=require("../../math"),_CanvasTinter2=_interopRequireDefault(require("./CanvasTinter"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var canvasRenderWorldTransform=new _math.Matrix,CanvasSpriteRenderer=function(){function CanvasSpriteRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasSpriteRenderer),this.renderer=renderer}return CanvasSpriteRenderer.prototype.render=function(sprite){var texture=sprite._texture,renderer=this.renderer,width=texture._frame.width,height=texture._frame.height,wt=sprite.transform.worldTransform,dx=0,dy=0;if(!(texture.orig.width<=0||texture.orig.height<=0)&&texture.baseTexture.source&&(renderer.setBlendMode(sprite.blendMode),texture.valid)){renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===_const.SCALE_MODES.LINEAR;renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled&&(renderer.context[renderer.smoothProperty]=smoothingEnabled),texture.trim?(dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width,dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height):(dx=(.5-sprite.anchor.x)*texture.orig.width,dy=(.5-sprite.anchor.y)*texture.orig.height),texture.rotate&&(wt.copy(canvasRenderWorldTransform),wt=canvasRenderWorldTransform,_math.GroupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy),dx=0,dy=0),dx-=width/2,dy-=height/2,renderer.roundPixels?(renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution|0,wt.ty*renderer.resolution|0),dx|=0,dy|=0):renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution,wt.ty*renderer.resolution);var resolution=texture.baseTexture.resolution;16777215!==sprite.tint?(sprite.cachedTint===sprite.tint&&sprite.tintedTexture.tintId===sprite._texture._updateID||(sprite.cachedTint=sprite.tint,sprite.tintedTexture=_CanvasTinter2.default.getTintedTexture(sprite,sprite.tint)),renderer.context.drawImage(sprite.tintedTexture,0,0,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)):renderer.context.drawImage(texture.baseTexture.source,texture._frame.x*resolution,texture._frame.y*resolution,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}},CanvasSpriteRenderer.prototype.destroy=function(){this.renderer=null},CanvasSpriteRenderer}();exports.default=CanvasSpriteRenderer,_CanvasRenderer2.default.registerPlugin("sprite",CanvasSpriteRenderer)},{"../../const":66,"../../math":90,"../../renderers/canvas/CanvasRenderer":97,"./CanvasTinter":124}],124:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_utils=require("../../utils"),_canUseNewCanvasBlendModes=require("../../renderers/canvas/utils/canUseNewCanvasBlendModes");var CanvasTinter={getTintedTexture:function(sprite,color){var texture=sprite._texture,stringColor="#"+("00000"+(0|(color=CanvasTinter.roundColor(color))).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var cachedTexture=texture.tintCache[stringColor],canvas=void 0;if(cachedTexture){if(cachedTexture.tintId===texture._updateID)return texture.tintCache[stringColor];canvas=texture.tintCache[stringColor]}else canvas=CanvasTinter.canvas||document.createElement("canvas");if(CanvasTinter.tintMethod(texture,color,canvas),canvas.tintId=texture._updateID,CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas,CanvasTinter.canvas=null;return canvas},tintWithMultiply:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="multiply",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore()},tintWithOverlay:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.globalCompositeOperation="copy",context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore()},tintWithPerPixel:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.globalCompositeOperation="copy",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore();for(var rgbValues=(0,_utils.hex2rgb)(color),r=rgbValues[0],g=rgbValues[1],b=rgbValues[2],pixelData=context.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data,i=0;i<pixels.length;i+=4)pixels[i+0]*=r,pixels[i+1]*=g,pixels[i+2]*=b;context.putImageData(pixelData,0,0)},roundColor:function(color){var step=CanvasTinter.cacheStepsPerColorChannel,rgbValues=(0,_utils.hex2rgb)(color);return rgbValues[0]=Math.min(255,rgbValues[0]/step*step),rgbValues[1]=Math.min(255,rgbValues[1]/step*step),rgbValues[2]=Math.min(255,rgbValues[2]/step*step),(0,_utils.rgb2hex)(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,((obj=_canUseNewCanvasBlendModes)&&obj.__esModule?obj:{default:obj}).default)(),tintMethod:0};CanvasTinter.tintMethod=CanvasTinter.canUseMultiply?CanvasTinter.tintWithMultiply:CanvasTinter.tintWithPerPixel,exports.default=CanvasTinter},{"../../renderers/canvas/utils/canUseNewCanvasBlendModes":100,"../../utils":145}],125:[function(require,module,exports){"use strict";exports.__esModule=!0;var Buffer=function(){function Buffer(size){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Buffer),this.vertices=new ArrayBuffer(size),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return Buffer.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},Buffer}();exports.default=Buffer},{}],126:[function(require,module,exports){"use strict";exports.__esModule=!0;var _ObjectRenderer3=_interopRequireDefault(require("../../renderers/webgl/utils/ObjectRenderer")),_WebGLRenderer2=_interopRequireDefault(require("../../renderers/webgl/WebGLRenderer")),_createIndicesForQuads2=_interopRequireDefault(require("../../utils/createIndicesForQuads")),_generateMultiTextureShader2=_interopRequireDefault(require("./generateMultiTextureShader")),_checkMaxIfStatmentsInShader2=_interopRequireDefault(require("../../renderers/webgl/utils/checkMaxIfStatmentsInShader")),_BatchBuffer2=_interopRequireDefault(require("./BatchBuffer")),_settings2=_interopRequireDefault(require("../../settings")),_utils=require("../../utils"),_pixiGlCore2=_interopRequireDefault(require("pixi-gl-core")),_bitTwiddle2=_interopRequireDefault(require("bit-twiddle"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TICK=0,TEXTURE_TICK=0,SpriteRenderer=function(_ObjectRenderer){function SpriteRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpriteRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_ObjectRenderer.call(this,renderer));_this.vertSize=5,_this.vertByteSize=4*_this.vertSize,_this.size=_settings2.default.SPRITE_BATCH_SIZE,_this.buffers=[];for(var i=1;i<=_bitTwiddle2.default.nextPow2(_this.size);i*=2)_this.buffers.push(new _BatchBuffer2.default(4*i*_this.vertByteSize));_this.indices=(0,_createIndicesForQuads2.default)(_this.size),_this.shader=null,_this.currentIndex=0,_this.groups=[];for(var k=0;k<_this.size;k++)_this.groups[k]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return _this.sprites=[],_this.vertexBuffers=[],_this.vaos=[],_this.vaoMax=2,_this.vertexCount=0,_this.renderer.on("prerender",_this.onPrerender,_this),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SpriteRenderer,_ObjectRenderer),SpriteRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),_settings2.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,_checkMaxIfStatmentsInShader2.default)(this.MAX_TEXTURES,gl)),this.shader=(0,_generateMultiTextureShader2.default)(gl,this.MAX_TEXTURES),this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW),this.renderer.bindVao(null);for(var attrs=this.shader.attributes,i=0;i<this.vaoMax;i++){var vertexBuffer=this.vertexBuffers[i]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW),vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,!1,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,!0,this.vertByteSize,12);attrs.aTextureId&&vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,!1,this.vertByteSize,16),this.vaos[i]=vao}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},SpriteRenderer.prototype.onPrerender=function(){this.vertexCount=0},SpriteRenderer.prototype.render=function(sprite){this.currentIndex>=this.size&&this.flush(),sprite._texture._uvs&&(this.sprites[this.currentIndex++]=sprite)},SpriteRenderer.prototype.flush=function(){if(0!==this.currentIndex){var gl=this.renderer.gl,MAX_TEXTURES=this.MAX_TEXTURES,np2=_bitTwiddle2.default.nextPow2(this.currentIndex),log2=_bitTwiddle2.default.log2(np2),buffer=this.buffers[log2],sprites=this.sprites,groups=this.groups,float32View=buffer.float32View,uint32View=buffer.uint32View,boundTextures=this.boundTextures,rendererBoundTextures=this.renderer.boundTextures,touch=this.renderer.textureGC.count,index=0,nextTexture=void 0,currentTexture=void 0,groupCount=1,textureCount=0,currentGroup=groups[0],vertexData=void 0,uvs=void 0,blendMode=_utils.premultiplyBlendMode[sprites[0]._texture.baseTexture.premultipliedAlpha?1:0][sprites[0].blendMode];currentGroup.textureCount=0,currentGroup.start=0,currentGroup.blend=blendMode,TICK++;var i=void 0;for(i=0;i<MAX_TEXTURES;++i){var bt=rendererBoundTextures[i];bt._enabled!==TICK?(boundTextures[i]=bt,bt._virtalBoundId=i,bt._enabled=TICK):boundTextures[i]=this.renderer.emptyTextures[i]}for(TICK++,i=0;i<this.currentIndex;++i){var sprite=sprites[i];nextTexture=sprite._texture.baseTexture;var spriteBlendMode=_utils.premultiplyBlendMode[Number(nextTexture.premultipliedAlpha)][sprite.blendMode];if(blendMode!==spriteBlendMode&&(blendMode=spriteBlendMode,currentTexture=null,textureCount=MAX_TEXTURES,TICK++),currentTexture!==nextTexture&&(currentTexture=nextTexture,nextTexture._enabled!==TICK)){if(textureCount===MAX_TEXTURES&&(TICK++,currentGroup.size=i-currentGroup.start,textureCount=0,(currentGroup=groups[groupCount++]).blend=blendMode,currentGroup.textureCount=0,currentGroup.start=i),nextTexture.touched=touch,-1===nextTexture._virtalBoundId)for(var j=0;j<MAX_TEXTURES;++j){var tIndex=(j+TEXTURE_TICK)%MAX_TEXTURES,t=boundTextures[tIndex];if(t._enabled!==TICK){TEXTURE_TICK++,t._virtalBoundId=-1,nextTexture._virtalBoundId=tIndex,boundTextures[tIndex]=nextTexture;break}}nextTexture._enabled=TICK,currentGroup.textureCount++,currentGroup.ids[textureCount]=nextTexture._virtalBoundId,currentGroup.textures[textureCount++]=nextTexture}if(vertexData=sprite.vertexData,uvs=sprite._texture._uvs.uvsUint32,this.renderer.roundPixels){var resolution=this.renderer.resolution;float32View[index]=(vertexData[0]*resolution|0)/resolution,float32View[index+1]=(vertexData[1]*resolution|0)/resolution,float32View[index+5]=(vertexData[2]*resolution|0)/resolution,float32View[index+6]=(vertexData[3]*resolution|0)/resolution,float32View[index+10]=(vertexData[4]*resolution|0)/resolution,float32View[index+11]=(vertexData[5]*resolution|0)/resolution,float32View[index+15]=(vertexData[6]*resolution|0)/resolution,float32View[index+16]=(vertexData[7]*resolution|0)/resolution}else float32View[index]=vertexData[0],float32View[index+1]=vertexData[1],float32View[index+5]=vertexData[2],float32View[index+6]=vertexData[3],float32View[index+10]=vertexData[4],float32View[index+11]=vertexData[5],float32View[index+15]=vertexData[6],float32View[index+16]=vertexData[7];uint32View[index+2]=uvs[0],uint32View[index+7]=uvs[1],uint32View[index+12]=uvs[2],uint32View[index+17]=uvs[3];var alpha=Math.min(sprite.worldAlpha,1),argb=alpha<1&&nextTexture.premultipliedAlpha?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(255*alpha<<24);uint32View[index+3]=uint32View[index+8]=uint32View[index+13]=uint32View[index+18]=argb,float32View[index+4]=float32View[index+9]=float32View[index+14]=float32View[index+19]=nextTexture._virtalBoundId,index+=20}if(currentGroup.size=i-currentGroup.start,_settings2.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var attrs=this.shader.attributes,vertexBuffer=this.vertexBuffers[this.vertexCount]=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,null,gl.STREAM_DRAW),vao=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(vertexBuffer,attrs.aVertexPosition,gl.FLOAT,!1,this.vertByteSize,0).addAttribute(vertexBuffer,attrs.aTextureCoord,gl.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(vertexBuffer,attrs.aColor,gl.UNSIGNED_BYTE,!0,this.vertByteSize,12);attrs.aTextureId&&vao.addAttribute(vertexBuffer,attrs.aTextureId,gl.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=vao}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(buffer.vertices,0,!1),this.vertexCount++}for(i=0;i<MAX_TEXTURES;++i)rendererBoundTextures[i]._virtalBoundId=-1;for(i=0;i<groupCount;++i){for(var group=groups[i],groupTextureCount=group.textureCount,_j=0;_j<groupTextureCount;_j++)currentTexture=group.textures[_j],rendererBoundTextures[group.ids[_j]]!==currentTexture&&this.renderer.bindTexture(currentTexture,group.ids[_j],!0),currentTexture._virtalBoundId=-1;this.renderer.state.setBlendMode(group.blend),gl.drawElements(gl.TRIANGLES,6*group.size,gl.UNSIGNED_SHORT,6*group.start*2)}this.currentIndex=0}},SpriteRenderer.prototype.start=function(){this.renderer.bindShader(this.shader),_settings2.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},SpriteRenderer.prototype.stop=function(){this.flush()},SpriteRenderer.prototype.destroy=function(){for(var i=0;i<this.vaoMax;i++)this.vertexBuffers[i]&&this.vertexBuffers[i].destroy(),this.vaos[i]&&this.vaos[i].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),_ObjectRenderer.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var _i=0;_i<this.buffers.length;++_i)this.buffers[_i].destroy()},SpriteRenderer}(_ObjectRenderer3.default);exports.default=SpriteRenderer,_WebGLRenderer2.default.registerPlugin("sprite",SpriteRenderer)},{"../../renderers/webgl/WebGLRenderer":104,"../../renderers/webgl/utils/ObjectRenderer":114,"../../renderers/webgl/utils/checkMaxIfStatmentsInShader":117,"../../settings":121,"../../utils":145,"../../utils/createIndicesForQuads":143,"./BatchBuffer":125,"./generateMultiTextureShader":127,"bit-twiddle":6,"pixi-gl-core":49}],127:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(gl,maxTextures){var fragmentSrc=fragTemplate;fragmentSrc=(fragmentSrc=fragmentSrc.replace(/%count%/gi,maxTextures)).replace(/%forloop%/gi,function(maxTextures){var src="";src+="\n",src+="\n";for(var i=0;i<maxTextures;i++)i>0&&(src+="\nelse "),i<maxTextures-1&&(src+="if(textureId == "+i+".0)"),src+="\n{",src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",src+="\n}";return src+="\n",src+="\n"}(maxTextures));for(var shader=new _Shader2.default(gl,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",fragmentSrc),sampleValues=[],i=0;i<maxTextures;i++)sampleValues[i]=i;return shader.bind(),shader.uniforms.uSamplers=sampleValues,shader};var obj,_Shader=require("../../Shader"),_Shader2=(obj=_Shader)&&obj.__esModule?obj:{default:obj};require("path");var fragTemplate=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n")},{"../../Shader":64,path:42}],128:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Sprite3=_interopRequireDefault(require("../sprites/Sprite")),_Texture2=_interopRequireDefault(require("../textures/Texture")),_math=require("../math"),_utils=require("../utils"),_const=require("../const"),_settings2=_interopRequireDefault(require("../settings")),_TextStyle2=_interopRequireDefault(require("./TextStyle")),_TextMetrics2=_interopRequireDefault(require("./TextMetrics")),_trimCanvas2=_interopRequireDefault(require("../utils/trimCanvas"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=function(_Sprite){function Text(text,style,canvas){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Text),(canvas=canvas||document.createElement("canvas")).width=3,canvas.height=3;var texture=_Texture2.default.fromCanvas(canvas,_settings2.default.SCALE_MODE,"text");texture.orig=new _math.Rectangle,texture.trim=new _math.Rectangle;var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Sprite.call(this,texture));return _Texture2.default.addToCache(_this._texture,_this._texture.baseTexture.textureCacheIds[0]),_this.canvas=canvas,_this.context=_this.canvas.getContext("2d"),_this.resolution=_settings2.default.RESOLUTION,_this._text=null,_this._style=null,_this._styleListener=null,_this._font="",_this.text=text,_this.style=style,_this.localStyleID=-1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Text,_Sprite),Text.prototype.updateText=function(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID&&(this.dirty=!0,this.localStyleID=style.styleID),this.dirty||!respectDirty){this._font=this._style.toFontString();var context=this.context,measured=_TextMetrics2.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),width=measured.width,height=measured.height,lines=measured.lines,lineHeight=measured.lineHeight,lineWidths=measured.lineWidths,maxLineWidth=measured.maxLineWidth,fontProperties=measured.fontProperties;this.canvas.width=Math.ceil((width+2*style.padding)*this.resolution),this.canvas.height=Math.ceil((height+2*style.padding)*this.resolution),context.scale(this.resolution,this.resolution),context.clearRect(0,0,this.canvas.width,this.canvas.height),context.font=this._font,context.strokeStyle=style.stroke,context.lineWidth=style.strokeThickness,context.textBaseline=style.textBaseline,context.lineJoin=style.lineJoin,context.miterLimit=style.miterLimit;var linePositionX=void 0,linePositionY=void 0;if(style.dropShadow){context.fillStyle=style.dropShadowColor,context.globalAlpha=style.dropShadowAlpha,context.shadowBlur=style.dropShadowBlur,style.dropShadowBlur>0&&(context.shadowColor=style.dropShadowColor);for(var xShadowOffset=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,yShadowOffset=Math.sin(style.dropShadowAngle)*style.dropShadowDistance,i=0;i<lines.length;i++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent,"right"===style.align?linePositionX+=maxLineWidth-lineWidths[i]:"center"===style.align&&(linePositionX+=(maxLineWidth-lineWidths[i])/2),style.fill&&(this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding),style.stroke&&style.strokeThickness&&(context.strokeStyle=style.dropShadowColor,this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset+style.padding,linePositionY+yShadowOffset+style.padding,!0),context.strokeStyle=style.stroke))}context.shadowBlur=0,context.globalAlpha=1,context.fillStyle=this._generateFillStyle(style,lines);for(var _i=0;_i<lines.length;_i++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+_i*lineHeight+fontProperties.ascent,"right"===style.align?linePositionX+=maxLineWidth-lineWidths[_i]:"center"===style.align&&(linePositionX+=(maxLineWidth-lineWidths[_i])/2),style.stroke&&style.strokeThickness&&this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding,!0),style.fill&&this.drawLetterSpacing(lines[_i],linePositionX+style.padding,linePositionY+style.padding);this.updateTexture()}},Text.prototype.drawLetterSpacing=function(text,x,y){var isStroke=arguments.length>3&&void 0!==arguments[3]&&arguments[3],letterSpacing=this._style.letterSpacing;if(0!==letterSpacing)for(var characters=String.prototype.split.call(text,""),currentPosition=x,index=0,current="";index<text.length;)current=characters[index++],isStroke?this.context.strokeText(current,currentPosition,y):this.context.fillText(current,currentPosition,y),currentPosition+=this.context.measureText(current).width+letterSpacing;else isStroke?this.context.strokeText(text,x,y):this.context.fillText(text,x,y)},Text.prototype.updateTexture=function(){var canvas=this.canvas;if(this._style.trim){var trimmed=(0,_trimCanvas2.default)(canvas);canvas.width=trimmed.width,canvas.height=trimmed.height,this.context.putImageData(trimmed.data,0,0)}var texture=this._texture,style=this._style,padding=style.trim?0:style.padding,baseTexture=texture.baseTexture;baseTexture.hasLoaded=!0,baseTexture.resolution=this.resolution,baseTexture.realWidth=canvas.width,baseTexture.realHeight=canvas.height,baseTexture.width=canvas.width/this.resolution,baseTexture.height=canvas.height/this.resolution,texture.trim.width=texture._frame.width=canvas.width/this.resolution,texture.trim.height=texture._frame.height=canvas.height/this.resolution,texture.trim.x=-padding,texture.trim.y=-padding,texture.orig.width=texture._frame.width-2*padding,texture.orig.height=texture._frame.height-2*padding,this._onTextureUpdate(),baseTexture.emit("update",baseTexture),this.dirty=!1},Text.prototype.renderWebGL=function(renderer){this.resolution!==renderer.resolution&&(this.resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),_Sprite.prototype.renderWebGL.call(this,renderer)},Text.prototype._renderCanvas=function(renderer){this.resolution!==renderer.resolution&&(this.resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),_Sprite.prototype._renderCanvas.call(this,renderer)},Text.prototype.getLocalBounds=function(rect){return this.updateText(!0),_Sprite.prototype.getLocalBounds.call(this,rect)},Text.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},Text.prototype._onStyleChange=function(){this.dirty=!0},Text.prototype._generateFillStyle=function(style,lines){if(!Array.isArray(style.fill))return style.fill;if(navigator.isCocoonJS)return style.fill[0];var gradient=void 0,totalIterations=void 0,currentIteration=void 0,stop=void 0,width=this.canvas.width/this.resolution,height=this.canvas.height/this.resolution,fill=style.fill.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length)for(var lengthPlus1=fill.length+1,i=1;i<lengthPlus1;++i)fillGradientStops.push(i/lengthPlus1);if(fill.unshift(style.fill[0]),fillGradientStops.unshift(0),fill.push(style.fill[style.fill.length-1]),fillGradientStops.push(1),style.fillGradientType===_const.TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,0,width/2,height),totalIterations=(fill.length+1)*lines.length,currentIteration=0;for(var _i2=0;_i2<lines.length;_i2++){currentIteration+=1;for(var j=0;j<fill.length;j++)stop="number"==typeof fillGradientStops[j]?fillGradientStops[j]/lines.length+_i2/lines.length:currentIteration/totalIterations,gradient.addColorStop(stop,fill[j]),currentIteration++}}else{gradient=this.context.createLinearGradient(0,height/2,width,height/2),totalIterations=fill.length+1,currentIteration=1;for(var _i3=0;_i3<fill.length;_i3++)stop="number"==typeof fillGradientStops[_i3]?fillGradientStops[_i3]:currentIteration/totalIterations,gradient.addColorStop(stop,fill[_i3]),currentIteration++}return gradient},Text.prototype.destroy=function(options){"boolean"==typeof options&&(options={children:options}),options=Object.assign({},defaultDestroyOptions,options),_Sprite.prototype.destroy.call(this,options),this.context=null,this.canvas=null,this._style=null},_createClass(Text,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){this.updateText(!0);var s=(0,_utils.sign)(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){this.updateText(!0);var s=(0,_utils.sign)(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value}},{key:"style",get:function(){return this._style},set:function(style){(style=style||{})instanceof _TextStyle2.default?this._style=style:this._style=new _TextStyle2.default(style),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(text){text=String(""===text||null===text||void 0===text?" ":text),this._text!==text&&(this._text=text,this.dirty=!0)}}]),Text}(_Sprite3.default);exports.default=Text},{"../const":66,"../math":90,"../settings":121,"../sprites/Sprite":122,"../textures/Texture":135,"../utils":145,"../utils/trimCanvas":150,"./TextMetrics":129,"./TextStyle":130}],129:[function(require,module,exports){"use strict";exports.__esModule=!0;var TextMetrics=function(){function TextMetrics(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextMetrics),this.text=text,this.style=style,this.width=width,this.height=height,this.lines=lines,this.lineWidths=lineWidths,this.lineHeight=lineHeight,this.maxLineWidth=maxLineWidth,this.fontProperties=fontProperties}return TextMetrics.measureText=function(text,style,wordWrap){var canvas=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TextMetrics._canvas;wordWrap=wordWrap||style.wordWrap;var font=style.toFontString(),fontProperties=TextMetrics.measureFont(font),context=canvas.getContext("2d");context.font=font;for(var lines=(wordWrap?TextMetrics.wordWrap(text,style,canvas):text).split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length),maxLineWidth=0,i=0;i<lines.length;i++){var lineWidth=context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;style.dropShadow&&(width+=style.dropShadowDistance);var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness,height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness)+(lines.length-1)*(lineHeight+style.leading);return style.dropShadow&&(height+=style.dropShadowDistance),new TextMetrics(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)},TextMetrics.wordWrap=function(text,style){for(var context=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:TextMetrics._canvas).getContext("2d"),result="",firstChar=text.charAt(0),lines=text.split("\n"),wordWrapWidth=style.wordWrapWidth,characterCache={},i=0;i<lines.length;i++){for(var spaceLeft=wordWrapWidth,words=lines[i].split(" "),j=0;j<words.length;j++){var wordWidth=context.measureText(words[j]).width;if(style.breakWords&&wordWidth>wordWrapWidth)for(var characters=words[j].split(""),c=0;c<characters.length;c++){var character=characters[c],characterWidth=characterCache[character];void 0===characterWidth&&(characterWidth=context.measureText(character).width,characterCache[character]=characterWidth),characterWidth>spaceLeft?(result+="\n"+character,spaceLeft=wordWrapWidth-characterWidth):(0===c&&(j>0||" "===firstChar)&&(result+=" "),result+=character,spaceLeft-=characterWidth)}else{var wordWidthWithSpace=wordWidth+context.measureText(" ").width;0===j||wordWidthWithSpace>spaceLeft?(j>0&&(result+="\n"),result+=words[j],spaceLeft=wordWrapWidth-wordWidth):(spaceLeft-=wordWidthWithSpace,result+=" "+words[j])}}i<lines.length-1&&(result+="\n")}return result},TextMetrics.measureFont=function(font){if(TextMetrics._fonts[font])return TextMetrics._fonts[font];var properties={},canvas=TextMetrics._canvas,context=TextMetrics._context;context.font=font;var width=Math.ceil(context.measureText("|MÉq").width),baseline=Math.ceil(context.measureText("M").width),height=2*baseline;baseline=1.4*baseline|0,canvas.width=width,canvas.height=height,context.fillStyle="#f00",context.fillRect(0,0,width,height),context.font=font,context.textBaseline="alphabetic",context.fillStyle="#000",context.fillText("|MÉq",0,baseline);var imagedata=context.getImageData(0,0,width,height).data,pixels=imagedata.length,line=4*width,i=0,idx=0,stop=!1;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx+=line}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;--i){for(var _j=0;_j<line;_j+=4)if(255!==imagedata[idx+_j]){stop=!0;break}if(stop)break;idx-=line}return properties.descent=i-baseline,properties.fontSize=properties.ascent+properties.descent,TextMetrics._fonts[font]=properties,properties},TextMetrics}();exports.default=TextMetrics;var canvas=document.createElement("canvas");canvas.width=canvas.height=10,TextMetrics._canvas=canvas,TextMetrics._context=canvas.getContext("2d"),TextMetrics._fonts={}},{}],130:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_const=require("../const"),_utils=require("../utils");var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:_const.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,wordWrap:!1,wordWrapWidth:100,leading:0},TextStyle=function(){function TextStyle(style){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextStyle),this.styleID=0,this.reset(),deepCopyProperties(this,style,style)}return TextStyle.prototype.clone=function(){var clonedProperties={};return deepCopyProperties(clonedProperties,this,defaultStyle),new TextStyle(clonedProperties)},TextStyle.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},TextStyle.prototype.toFontString=function(){var fontSizeString="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,fontFamilies=this.fontFamily;Array.isArray(this.fontFamily)||(fontFamilies=this.fontFamily.split(","));for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();/([\"\'])[^\'\"]+\1/.test(fontFamily)||(fontFamily='"'+fontFamily+'"'),fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")},_createClass(TextStyle,[{key:"align",get:function(){return this._align},set:function(align){this._align!==align&&(this._align=align,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(breakWords){this._breakWords!==breakWords&&(this._breakWords=breakWords,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(dropShadow){this._dropShadow!==dropShadow&&(this._dropShadow=dropShadow,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(dropShadowAlpha){this._dropShadowAlpha!==dropShadowAlpha&&(this._dropShadowAlpha=dropShadowAlpha,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(dropShadowAngle){this._dropShadowAngle!==dropShadowAngle&&(this._dropShadowAngle=dropShadowAngle,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(dropShadowBlur){this._dropShadowBlur!==dropShadowBlur&&(this._dropShadowBlur=dropShadowBlur,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(dropShadowColor){var outputColor=getColor(dropShadowColor);this._dropShadowColor!==outputColor&&(this._dropShadowColor=outputColor,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(dropShadowDistance){this._dropShadowDistance!==dropShadowDistance&&(this._dropShadowDistance=dropShadowDistance,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(fill){var outputColor=getColor(fill);this._fill!==outputColor&&(this._fill=outputColor,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(fillGradientType){this._fillGradientType!==fillGradientType&&(this._fillGradientType=fillGradientType,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(fillGradientStops){(function(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2))return!1;if(array1.length!==array2.length)return!1;for(var i=0;i<array1.length;++i)if(array1[i]!==array2[i])return!1;return!0})(this._fillGradientStops,fillGradientStops)||(this._fillGradientStops=fillGradientStops,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(fontFamily){this.fontFamily!==fontFamily&&(this._fontFamily=fontFamily,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(fontSize){this._fontSize!==fontSize&&(this._fontSize=fontSize,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(fontStyle){this._fontStyle!==fontStyle&&(this._fontStyle=fontStyle,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(fontVariant){this._fontVariant!==fontVariant&&(this._fontVariant=fontVariant,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(fontWeight){this._fontWeight!==fontWeight&&(this._fontWeight=fontWeight,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(letterSpacing){this._letterSpacing!==letterSpacing&&(this._letterSpacing=letterSpacing,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(lineHeight){this._lineHeight!==lineHeight&&(this._lineHeight=lineHeight,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(leading){this._leading!==leading&&(this._leading=leading,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(lineJoin){this._lineJoin!==lineJoin&&(this._lineJoin=lineJoin,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(miterLimit){this._miterLimit!==miterLimit&&(this._miterLimit=miterLimit,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(padding){this._padding!==padding&&(this._padding=padding,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(stroke){var outputColor=getColor(stroke);this._stroke!==outputColor&&(this._stroke=outputColor,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(strokeThickness){this._strokeThickness!==strokeThickness&&(this._strokeThickness=strokeThickness,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(textBaseline){this._textBaseline!==textBaseline&&(this._textBaseline=textBaseline,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(trim){this._trim!==trim&&(this._trim=trim,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(wordWrap){this._wordWrap!==wordWrap&&(this._wordWrap=wordWrap,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(wordWrapWidth){this._wordWrapWidth!==wordWrapWidth&&(this._wordWrapWidth=wordWrapWidth,this.styleID++)}}]),TextStyle}();function getSingleColor(color){return"number"==typeof color?(0,_utils.hex2string)(color):("string"==typeof color&&0===color.indexOf("0x")&&(color=color.replace("0x","#")),color)}function getColor(color){if(Array.isArray(color)){for(var i=0;i<color.length;++i)color[i]=getSingleColor(color[i]);return color}return getSingleColor(color)}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj)Array.isArray(source[prop])?target[prop]=source[prop].slice():target[prop]=source[prop]}exports.default=TextStyle},{"../const":66,"../utils":145}],131:[function(require,module,exports){"use strict";exports.__esModule=!0;var _BaseTexture3=_interopRequireDefault(require("./BaseTexture")),_settings2=_interopRequireDefault(require("../settings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BaseRenderTexture=function(_BaseTexture){function BaseRenderTexture(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,height=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,scaleMode=arguments[2],resolution=arguments[3];!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseRenderTexture);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_BaseTexture.call(this,null,scaleMode));return _this.resolution=resolution||_settings2.default.RESOLUTION,_this.width=Math.ceil(width),_this.height=Math.ceil(height),_this.realWidth=_this.width*_this.resolution,_this.realHeight=_this.height*_this.resolution,_this.scaleMode=void 0!==scaleMode?scaleMode:_settings2.default.SCALE_MODE,_this.hasLoaded=!0,_this._glRenderTargets={},_this._canvasRenderTarget=null,_this.valid=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BaseRenderTexture,_BaseTexture),BaseRenderTexture.prototype.resize=function(width,height){width=Math.ceil(width),height=Math.ceil(height),width===this.width&&height===this.height||(this.valid=width>0&&height>0,this.width=width,this.height=height,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},BaseRenderTexture.prototype.destroy=function(){_BaseTexture.prototype.destroy.call(this,!0),this.renderer=null},BaseRenderTexture}(_BaseTexture3.default);exports.default=BaseRenderTexture},{"../settings":121,"./BaseTexture":132}],132:[function(require,module,exports){"use strict";exports.__esModule=!0;var _utils=require("../utils"),_settings2=_interopRequireDefault(require("../settings")),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_determineCrossOrigin2=_interopRequireDefault(require("../utils/determineCrossOrigin")),_bitTwiddle2=_interopRequireDefault(require("bit-twiddle"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BaseTexture=function(_EventEmitter){function BaseTexture(source,scaleMode,resolution){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseTexture);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return _this.uid=(0,_utils.uid)(),_this.touched=0,_this.resolution=resolution||_settings2.default.RESOLUTION,_this.width=100,_this.height=100,_this.realWidth=100,_this.realHeight=100,_this.scaleMode=void 0!==scaleMode?scaleMode:_settings2.default.SCALE_MODE,_this.hasLoaded=!1,_this.isLoading=!1,_this.source=null,_this.origSource=null,_this.imageType=null,_this.sourceScale=1,_this.premultipliedAlpha=!0,_this.imageUrl=null,_this.isPowerOfTwo=!1,_this.mipmap=_settings2.default.MIPMAP_TEXTURES,_this.wrapMode=_settings2.default.WRAP_MODE,_this._glTextures={},_this._enabled=0,_this._virtalBoundId=-1,_this._destroyed=!1,_this.textureCacheIds=[],source&&_this.loadSource(source),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BaseTexture,_EventEmitter),BaseTexture.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},BaseTexture.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=_bitTwiddle2.default.isPow2(this.realWidth)&&_bitTwiddle2.default.isPow2(this.realHeight)},BaseTexture.prototype.loadSource=function(source){var wasLoading=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,wasLoading&&this.source&&(this.source.onload=null,this.source.onerror=null);var firstSourceLoaded=!this.source;if(this.source=source,(source.src&&source.complete||source.getContext)&&source.width&&source.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),firstSourceLoaded&&this.emit("loaded",this);else if(!source.getContext){this.isLoading=!0;var scope=this;if(source.onload=function(){scope._updateImageType(),source.onload=null,source.onerror=null,scope.isLoading&&(scope.isLoading=!1,scope._sourceLoaded(),"svg"!==scope.imageType?scope.emit("loaded",scope):scope._loadSvgSource())},source.onerror=function(){source.onload=null,source.onerror=null,scope.isLoading&&(scope.isLoading=!1,scope.emit("error",scope))},source.complete&&source.src){if(source.onload=null,source.onerror=null,"svg"===scope.imageType)return void scope._loadSvgSource();this.isLoading=!1,source.width&&source.height?(this._sourceLoaded(),wasLoading&&this.emit("loaded",this)):wasLoading&&this.emit("error",this)}}},BaseTexture.prototype._updateImageType=function(){if(this.imageUrl){var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl),imageType=void 0;if(dataUri&&"image"===dataUri.mediaType){var firstSubType=dataUri.subType.split("+")[0];if(!(imageType=(0,_utils.getUrlFileExtension)("."+firstSubType)))throw new Error("Invalid image type in data URI.")}else(imageType=(0,_utils.getUrlFileExtension)(this.imageUrl))||(imageType="png");this.imageType=imageType}},BaseTexture.prototype._loadSvgSource=function(){if("svg"===this.imageType){var dataUri=(0,_utils.decomposeDataUri)(this.imageUrl);dataUri?this._loadSvgSourceUsingDataUri(dataUri):this._loadSvgSourceUsingXhr()}},BaseTexture.prototype._loadSvgSourceUsingDataUri=function(dataUri){var svgString=void 0;if("base64"===dataUri.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");svgString=atob(dataUri.data)}else svgString=dataUri.data;this._loadSvgSourceUsingString(svgString)},BaseTexture.prototype._loadSvgSourceUsingXhr=function(){var _this2=this,svgXhr=new XMLHttpRequest;svgXhr.onload=function(){if(svgXhr.readyState!==svgXhr.DONE||200!==svgXhr.status)throw new Error("Failed to load SVG using XHR.");_this2._loadSvgSourceUsingString(svgXhr.response)},svgXhr.onerror=function(){return _this2.emit("error",_this2)},svgXhr.open("GET",this.imageUrl,!0),svgXhr.send()},BaseTexture.prototype._loadSvgSourceUsingString=function(svgString){var svgSize=(0,_utils.getSvgSize)(svgString),svgWidth=svgSize.width,svgHeight=svgSize.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(svgWidth*this.sourceScale),this.realHeight=Math.round(svgHeight*this.sourceScale),this._updateDimensions();var canvas=document.createElement("canvas");canvas.width=this.realWidth,canvas.height=this.realHeight,canvas._pixiId="canvas_"+(0,_utils.uid)(),canvas.getContext("2d").drawImage(this.source,0,0,svgWidth,svgHeight,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=canvas,BaseTexture.addToCache(this,canvas._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},BaseTexture.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},BaseTexture.prototype.destroy=function(){this.imageUrl&&(delete _utils.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),BaseTexture.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},BaseTexture.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture.prototype.updateSourceImage=function(newSrc){this.source.src=newSrc,this.loadSource(this.source)},BaseTexture.fromImage=function(imageUrl,crossorigin,scaleMode,sourceScale){var baseTexture=_utils.BaseTextureCache[imageUrl];if(!baseTexture){var image=new Image;void 0===crossorigin&&0!==imageUrl.indexOf("data:")?image.crossOrigin=(0,_determineCrossOrigin2.default)(imageUrl):crossorigin&&(image.crossOrigin="string"==typeof crossorigin?crossorigin:"anonymous"),(baseTexture=new BaseTexture(image,scaleMode)).imageUrl=imageUrl,sourceScale&&(baseTexture.sourceScale=sourceScale),baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl),image.src=imageUrl,BaseTexture.addToCache(baseTexture,imageUrl)}return baseTexture},BaseTexture.fromCanvas=function(canvas,scaleMode){var origin=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";canvas._pixiId||(canvas._pixiId=origin+"_"+(0,_utils.uid)());var baseTexture=_utils.BaseTextureCache[canvas._pixiId];return baseTexture||(baseTexture=new BaseTexture(canvas,scaleMode),BaseTexture.addToCache(baseTexture,canvas._pixiId)),baseTexture},BaseTexture.from=function(source,scaleMode,sourceScale){if("string"==typeof source)return BaseTexture.fromImage(source,void 0,scaleMode,sourceScale);if(source instanceof HTMLImageElement){var imageUrl=source.src,baseTexture=_utils.BaseTextureCache[imageUrl];return baseTexture||((baseTexture=new BaseTexture(source,scaleMode)).imageUrl=imageUrl,sourceScale&&(baseTexture.sourceScale=sourceScale),baseTexture.resolution=(0,_utils.getResolutionOfUrl)(imageUrl),BaseTexture.addToCache(baseTexture,imageUrl)),baseTexture}return source instanceof HTMLCanvasElement?BaseTexture.fromCanvas(source,scaleMode):source},BaseTexture.addToCache=function(baseTexture,id){id&&(-1===baseTexture.textureCacheIds.indexOf(id)&&baseTexture.textureCacheIds.push(id),_utils.BaseTextureCache[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),_utils.BaseTextureCache[id]=baseTexture)},BaseTexture.removeFromCache=function(baseTexture){if("string"==typeof baseTexture){var baseTextureFromCache=_utils.BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index>-1&&baseTextureFromCache.textureCacheIds.splice(index,1),delete _utils.BaseTextureCache[baseTexture],baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i)delete _utils.BaseTextureCache[baseTexture.textureCacheIds[i]];return baseTexture.textureCacheIds.length=0,baseTexture}return null},BaseTexture}(_eventemitter2.default);exports.default=BaseTexture},{"../settings":121,"../utils":145,"../utils/determineCrossOrigin":144,"bit-twiddle":6,eventemitter3:29}],133:[function(require,module,exports){"use strict";exports.__esModule=!0;var _BaseRenderTexture2=_interopRequireDefault(require("./BaseRenderTexture"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RenderTexture=function(_Texture){function RenderTexture(baseRenderTexture,frame){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RenderTexture);var _legacyRenderer=null;if(!(baseRenderTexture instanceof _BaseRenderTexture2.default)){var width=arguments[1],height=arguments[2],scaleMode=arguments[3],resolution=arguments[4];console.warn("Please use RenderTexture.create("+width+", "+height+") instead of the ctor directly."),_legacyRenderer=arguments[0],frame=null,baseRenderTexture=new _BaseRenderTexture2.default(width,height,scaleMode,resolution)}var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Texture.call(this,baseRenderTexture,frame));return _this.legacyRenderer=_legacyRenderer,_this.valid=!0,_this._updateUvs(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(RenderTexture,_Texture),RenderTexture.prototype.resize=function(width,height,doNotResizeBaseTexture){width=Math.ceil(width),height=Math.ceil(height),this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,doNotResizeBaseTexture||this.baseTexture.resize(width,height),this._updateUvs()},RenderTexture.create=function(width,height,scaleMode,resolution){return new RenderTexture(new _BaseRenderTexture2.default(width,height,scaleMode,resolution))},RenderTexture}(_interopRequireDefault(require("./Texture")).default);exports.default=RenderTexture},{"./BaseRenderTexture":131,"./Texture":135}],134:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_=require("../"),_utils=require("../utils");var Spritesheet=function(){function Spritesheet(baseTexture,data){var resolutionFilename=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Spritesheet),this.baseTexture=baseTexture,this.textures={},this.data=data,this.resolution=this._updateResolution(resolutionFilename||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return _createClass(Spritesheet,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),Spritesheet.prototype._updateResolution=function(resolutionFilename){var scale=this.data.meta.scale,resolution=(0,_utils.getResolutionOfUrl)(resolutionFilename,null);return null===resolution&&(resolution=void 0!==scale?parseFloat(scale):1),1!==resolution&&(this.baseTexture.resolution=resolution,this.baseTexture.update()),resolution},Spritesheet.prototype.parse=function(callback){this._batchIndex=0,this._callback=callback,this._frameKeys.length<=Spritesheet.BATCH_SIZE?(this._processFrames(0),this._parseComplete()):this._nextBatch()},Spritesheet.prototype._processFrames=function(initialFrameIndex){for(var frameIndex=initialFrameIndex,maxFrames=Spritesheet.BATCH_SIZE,sourceScale=this.baseTexture.sourceScale;frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length;){var i=this._frameKeys[frameIndex],data=this._frames[i],rect=data.frame;if(rect){var frame=null,trim=null,sourceSize=!1!==data.trimmed&&data.sourceSize?data.sourceSize:data.frame,orig=new _.Rectangle(0,0,Math.floor(sourceSize.w*sourceScale)/this.resolution,Math.floor(sourceSize.h*sourceScale)/this.resolution);frame=data.rotated?new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution):new _.Rectangle(Math.floor(rect.x*sourceScale)/this.resolution,Math.floor(rect.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution),!1!==data.trimmed&&data.spriteSourceSize&&(trim=new _.Rectangle(Math.floor(data.spriteSourceSize.x*sourceScale)/this.resolution,Math.floor(data.spriteSourceSize.y*sourceScale)/this.resolution,Math.floor(rect.w*sourceScale)/this.resolution,Math.floor(rect.h*sourceScale)/this.resolution)),this.textures[i]=new _.Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0),_.Texture.addToCache(this.textures[i],i)}frameIndex++}},Spritesheet.prototype._parseComplete=function(){var callback=this._callback;this._callback=null,this._batchIndex=0,callback.call(this,this.textures)},Spritesheet.prototype._nextBatch=function(){var _this=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE),this._batchIndex++,setTimeout(function(){_this._batchIndex*Spritesheet.BATCH_SIZE<_this._frameKeys.length?_this._nextBatch():_this._parseComplete()},0)},Spritesheet.prototype.destroy=function(){var destroyBase=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,destroyBase&&this.baseTexture.destroy(),this.baseTexture=null},Spritesheet}();exports.default=Spritesheet},{"../":85,"../utils":145}],135:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_BaseTexture2=_interopRequireDefault(require("./BaseTexture")),_VideoBaseTexture2=_interopRequireDefault(require("./VideoBaseTexture")),_TextureUvs2=_interopRequireDefault(require("./TextureUvs")),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_math=require("../math"),_utils=require("../utils"),_settings2=_interopRequireDefault(require("../settings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Texture=function(_EventEmitter){function Texture(baseTexture,frame,orig,trim,rotate){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Texture);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));if(_this.noFrame=!1,frame||(_this.noFrame=!0,frame=new _math.Rectangle(0,0,1,1)),baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture),_this.baseTexture=baseTexture,_this._frame=frame,_this.trim=trim,_this.valid=!1,_this.requiresUpdate=!1,_this._uvs=null,_this.orig=orig||frame,_this._rotate=Number(rotate||0),!0===rotate)_this._rotate=2;else if(_this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return baseTexture.hasLoaded?(_this.noFrame&&(frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height),baseTexture.on("update",_this.onBaseTextureUpdated,_this)),_this.frame=frame):baseTexture.once("loaded",_this.onBaseTextureLoaded,_this),_this._updateID=0,_this.transform=null,_this.textureCacheIds=[],_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Texture,_EventEmitter),Texture.prototype.update=function(){this.baseTexture.update()},Texture.prototype.onBaseTextureLoaded=function(baseTexture){this._updateID++,this.noFrame?this.frame=new _math.Rectangle(0,0,baseTexture.width,baseTexture.height):this.frame=this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},Texture.prototype.onBaseTextureUpdated=function(baseTexture){this._updateID++,this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.emit("update",this)},Texture.prototype.destroy=function(destroyBase){this.baseTexture&&(destroyBase&&(_utils.TextureCache[this.baseTexture.imageUrl]&&Texture.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null},Texture.prototype.clone=function(){return new Texture(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new _TextureUvs2.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture.fromImage=function(imageUrl,crossorigin,scaleMode,sourceScale){var texture=_utils.TextureCache[imageUrl];return texture||(texture=new Texture(_BaseTexture2.default.fromImage(imageUrl,crossorigin,scaleMode,sourceScale)),Texture.addToCache(texture,imageUrl)),texture},Texture.fromFrame=function(frameId){var texture=_utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache');return texture},Texture.fromCanvas=function(canvas,scaleMode){var origin=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";return new Texture(_BaseTexture2.default.fromCanvas(canvas,scaleMode,origin))},Texture.fromVideo=function(video,scaleMode){return"string"==typeof video?Texture.fromVideoUrl(video,scaleMode):new Texture(_VideoBaseTexture2.default.fromVideo(video,scaleMode))},Texture.fromVideoUrl=function(videoUrl,scaleMode){return new Texture(_VideoBaseTexture2.default.fromUrl(videoUrl,scaleMode))},Texture.from=function(source){if("string"==typeof source){var texture=_utils.TextureCache[source];return texture||(null!==source.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?Texture.fromVideoUrl(source):Texture.fromImage(source))}return source instanceof HTMLImageElement?new Texture(_BaseTexture2.default.from(source)):source instanceof HTMLCanvasElement?Texture.fromCanvas(source,_settings2.default.SCALE_MODE,"HTMLCanvasElement"):source instanceof HTMLVideoElement?Texture.fromVideo(source):source instanceof _BaseTexture2.default?new Texture(source):source},Texture.fromLoader=function(source,imageUrl,name){var baseTexture=new _BaseTexture2.default(source,void 0,(0,_utils.getResolutionOfUrl)(imageUrl)),texture=new Texture(baseTexture);return baseTexture.imageUrl=imageUrl,name||(name=imageUrl),_BaseTexture2.default.addToCache(texture.baseTexture,name),Texture.addToCache(texture,name),name!==imageUrl&&(_BaseTexture2.default.addToCache(texture.baseTexture,imageUrl),Texture.addToCache(texture,imageUrl)),texture},Texture.addToCache=function(texture,id){id&&(-1===texture.textureCacheIds.indexOf(id)&&texture.textureCacheIds.push(id),_utils.TextureCache[id]&&console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),_utils.TextureCache[id]=texture)},Texture.removeFromCache=function(texture){if("string"==typeof texture){var textureFromCache=_utils.TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);return index>-1&&textureFromCache.textureCacheIds.splice(index,1),delete _utils.TextureCache[texture],textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i)_utils.TextureCache[texture.textureCacheIds[i]]===texture&&delete _utils.TextureCache[texture.textureCacheIds[i]];return texture.textureCacheIds.length=0,texture}return null},_createClass(Texture,[{key:"frame",get:function(){return this._frame},set:function(frame){this._frame=frame,this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or",errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width,errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+errorX+" "+relationship+" "+errorY)}this.valid=width&&height&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=frame),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),Texture}(_eventemitter2.default);function removeAllHandlers(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}exports.default=Texture,Texture.EMPTY=new Texture(new _BaseTexture2.default),removeAllHandlers(Texture.EMPTY),removeAllHandlers(Texture.EMPTY.baseTexture),Texture.WHITE=function(){var canvas=document.createElement("canvas");canvas.width=10,canvas.height=10;var context=canvas.getContext("2d");return context.fillStyle="white",context.fillRect(0,0,10,10),new Texture(new _BaseTexture2.default(canvas))}(),removeAllHandlers(Texture.WHITE),removeAllHandlers(Texture.WHITE.baseTexture)},{"../math":90,"../settings":121,"../utils":145,"./BaseTexture":132,"./TextureUvs":137,"./VideoBaseTexture":138,eventemitter3:29}],136:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Matrix=require("../math/Matrix"),_Matrix2=(obj=_Matrix)&&obj.__esModule?obj:{default:obj};var tempMat=new _Matrix2.default,TextureMatrix=function(){function TextureMatrix(texture,clampMargin){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextureMatrix),this._texture=texture,this.mapCoord=new _Matrix2.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin=void 0===clampMargin?.5:clampMargin}return TextureMatrix.prototype.multiplyUvs=function(uvs,out){void 0===out&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx,out[i+1]=x*mat.b+y*mat.d+mat.ty}return out},TextureMatrix.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid)return!1;if(!forceUpdate&&this._lastTextureID===tex._updateID)return!1;this._lastTextureID=tex._updateID;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig,trim=tex.trim;trim&&(tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat));var texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,!0},_createClass(TextureMatrix,[{key:"texture",get:function(){return this._texture},set:function(value){this._texture=value,this._lastTextureID=-1}}]),TextureMatrix}();exports.default=TextureMatrix},{"../math/Matrix":87}],137:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_GroupD=require("../math/GroupD8"),_GroupD2=(obj=_GroupD)&&obj.__esModule?obj:{default:obj};var TextureUvs=function(){function TextureUvs(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextureUvs),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return TextureUvs.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=_GroupD2.default.add(rotate,_GroupD2.default.NW),this.x0=cX+w2*_GroupD2.default.uX(rotate),this.y0=cY+h2*_GroupD2.default.uY(rotate),rotate=_GroupD2.default.add(rotate,2),this.x1=cX+w2*_GroupD2.default.uX(rotate),this.y1=cY+h2*_GroupD2.default.uY(rotate),rotate=_GroupD2.default.add(rotate,2),this.x2=cX+w2*_GroupD2.default.uX(rotate),this.y2=cY+h2*_GroupD2.default.uY(rotate),rotate=_GroupD2.default.add(rotate,2),this.x3=cX+w2*_GroupD2.default.uX(rotate),this.y3=cY+h2*_GroupD2.default.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535},TextureUvs}();exports.default=TextureUvs},{"../math/GroupD8":86}],138:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_BaseTexture3=_interopRequireDefault(require("./BaseTexture")),_utils=require("../utils"),_ticker=require("../ticker"),_const=require("../const"),_determineCrossOrigin2=_interopRequireDefault(require("../utils/determineCrossOrigin"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VideoBaseTexture=function(_BaseTexture){function VideoBaseTexture(source,scaleMode){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VideoBaseTexture),!source)throw new Error("No video source element specified.");(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_BaseTexture.call(this,source,scaleMode));return _this.width=source.videoWidth,_this.height=source.videoHeight,_this._autoUpdate=!0,_this._isAutoUpdating=!1,_this.autoPlay=!0,_this.update=_this.update.bind(_this),_this._onCanPlay=_this._onCanPlay.bind(_this),source.addEventListener("play",_this._onPlayStart.bind(_this)),source.addEventListener("pause",_this._onPlayStop.bind(_this)),_this.hasLoaded=!1,_this.__loaded=!1,_this._isSourceReady()?_this._onCanPlay():(source.addEventListener("canplay",_this._onCanPlay),source.addEventListener("canplaythrough",_this._onCanPlay)),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(VideoBaseTexture,_BaseTexture),VideoBaseTexture.prototype._isSourcePlaying=function(){var source=this.source;return source.currentTime>0&&!1===source.paused&&!1===source.ended&&source.readyState>2},VideoBaseTexture.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},VideoBaseTexture.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},VideoBaseTexture.prototype._onPlayStop=function(){this._isAutoUpdating&&(_ticker.shared.remove(this.update,this),this._isAutoUpdating=!1)},VideoBaseTexture.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},VideoBaseTexture.prototype.destroy=function(){this._isAutoUpdating&&_ticker.shared.remove(this.update,this),this.source&&this.source._pixiId&&(_BaseTexture3.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),_BaseTexture.prototype.destroy.call(this)},VideoBaseTexture.fromVideo=function(video,scaleMode){video._pixiId||(video._pixiId="video_"+(0,_utils.uid)());var baseTexture=_utils.BaseTextureCache[video._pixiId];return baseTexture||(baseTexture=new VideoBaseTexture(video,scaleMode),_BaseTexture3.default.addToCache(baseTexture,video._pixiId)),baseTexture},VideoBaseTexture.fromUrl=function(videoSrc,scaleMode,crossorigin){var video=document.createElement("video");video.setAttribute("webkit-playsinline",""),video.setAttribute("playsinline","");var url=Array.isArray(videoSrc)?videoSrc[0].src||videoSrc[0]:videoSrc.src||videoSrc;if(void 0===crossorigin&&0!==url.indexOf("data:")?video.crossOrigin=(0,_determineCrossOrigin2.default)(url):crossorigin&&(video.crossOrigin="string"==typeof crossorigin?crossorigin:"anonymous"),Array.isArray(videoSrc))for(var i=0;i<videoSrc.length;++i)video.appendChild(createSource(videoSrc[i].src||videoSrc[i],videoSrc[i].mime));else video.appendChild(createSource(url,videoSrc.mime));return video.load(),VideoBaseTexture.fromVideo(video,scaleMode)},_createClass(VideoBaseTexture,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isAutoUpdating?(_ticker.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(_ticker.shared.add(this.update,this,_const.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),VideoBaseTexture}(_BaseTexture3.default);function createSource(path,type){type||(type="video/"+path.substr(path.lastIndexOf(".")+1));var source=document.createElement("source");return source.src=path,source.type=type,source}exports.default=VideoBaseTexture,VideoBaseTexture.fromUrls=VideoBaseTexture.fromUrl},{"../const":66,"../ticker":141,"../utils":145,"../utils/determineCrossOrigin":144,"./BaseTexture":132}],139:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_settings2=_interopRequireDefault(require("../settings")),_const=require("../const"),_TickerListener2=_interopRequireDefault(require("./TickerListener"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Ticker=function(){function Ticker(){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Ticker),this._head=new _TickerListener2.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/_settings2.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&null===_this._requestId&&_this._head.next&&(_this._requestId=requestAnimationFrame(_this._tick)))}}return Ticker.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},Ticker.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker.prototype.add=function(fn,context){var priority=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority))},Ticker.prototype.addOnce=function(fn,context){var priority=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_const.UPDATE_PRIORITY.NORMAL;return this._addListener(new _TickerListener2.default(fn,context,priority,!0))},Ticker.prototype._addListener=function(listener){var current=this._head.next,previous=this._head;if(current){for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}else listener.connect(previous);return this._startIfPossible(),this},Ticker.prototype.remove=function(fn,context){for(var listener=this._head.next;listener;)listener=listener.match(fn,context)?listener.destroy():listener.next;return this._head.next||this._cancelIfNeeded(),this},Ticker.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker.prototype.destroy=function(){this.stop();for(var listener=this._head.next;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null},Ticker.prototype.update=function(){var currentTime=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),elapsedMS=void 0;if(currentTime>this.lastTime){(elapsedMS=this.elapsedMS=currentTime-this.lastTime)>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),this.deltaTime=elapsedMS*_settings2.default.TARGET_FPMS*this.speed;for(var head=this._head,listener=head.next;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=currentTime},_createClass(Ticker,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPMS=Math.min(Math.max(0,fps)/1e3,_settings2.default.TARGET_FPMS);this._maxElapsedMS=1/minFPMS}}]),Ticker}();exports.default=Ticker},{"../const":66,"../settings":121,"./TickerListener":140}],140:[function(require,module,exports){"use strict";exports.__esModule=!0;var TickerListener=function(){function TickerListener(fn){var context=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,priority=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,once=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TickerListener),this.fn=fn,this.context=context,this.priority=priority,this.once=once,this.next=null,this.previous=null,this._destroyed=!1}return TickerListener.prototype.match=function(fn,context){return context=context||null,this.fn===fn&&this.context===context},TickerListener.prototype.emit=function(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));var redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect},TickerListener.prototype.connect=function(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this},TickerListener.prototype.destroy=function(){var hard=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var redirect=this.previous;return this.next=hard?null:redirect,this.previous=null,redirect},TickerListener}();exports.default=TickerListener},{}],141:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.Ticker=exports.shared=void 0;var obj,_Ticker=require("./Ticker"),_Ticker2=(obj=_Ticker)&&obj.__esModule?obj:{default:obj};var shared=new _Ticker2.default;shared.autoStart=!0,shared.destroy=function(){},exports.shared=shared,exports.Ticker=_Ticker2.default},{"./Ticker":139}],142:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(){return!(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}},{}],143:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(size){for(var totalIndices=6*size,indices=new Uint16Array(totalIndices),i=0,j=0;i<totalIndices;i+=6,j+=4)indices[i+0]=j+0,indices[i+1]=j+1,indices[i+2]=j+2,indices[i+3]=j+0,indices[i+4]=j+2,indices[i+5]=j+3;return indices}},{}],144:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(url){var loc=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;if(0===url.indexOf("data:"))return"";loc=loc||window.location,tempAnchor||(tempAnchor=document.createElement("a"));tempAnchor.href=url;var samePort=!(url=_url3.default.parse(tempAnchor.href)).port&&""===loc.port||url.port===loc.port;if(url.hostname!==loc.hostname||!samePort||url.protocol!==loc.protocol)return"anonymous";return""};var obj,_url2=require("url"),_url3=(obj=_url2)&&obj.__esModule?obj:{default:obj};var tempAnchor=void 0},{url:233}],145:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.premultiplyBlendMode=exports.BaseTextureCache=exports.TextureCache=exports.mixins=exports.pluginTarget=exports.EventEmitter=exports.removeItems=exports.isMobile=void 0,exports.uid=function(){return++nextUid},exports.hex2rgb=function(hex,out){return(out=out||[])[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(255&hex)/255,out},exports.hex2string=function(hex){return hex=hex.toString(16),"#"+(hex="000000".substr(0,6-hex.length)+hex)},exports.rgb2hex=function(rgb){return(255*rgb[0]<<16)+(255*rgb[1]<<8)+(255*rgb[2]|0)},exports.getResolutionOfUrl=function(url,defaultValue){var resolution=_settings2.default.RETINA_PREFIX.exec(url);if(resolution)return parseFloat(resolution[1]);return void 0!==defaultValue?defaultValue:1},exports.decomposeDataUri=function(dataUri){var dataUriMatch=_const.DATA_URI.exec(dataUri);if(dataUriMatch)return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,encoding:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,data:dataUriMatch[4]};return},exports.getUrlFileExtension=function(url){var extension=_const.URL_FILE_EXTENSION.exec(url);if(extension)return extension[1].toLowerCase();return},exports.getSvgSize=function(svgString){var sizeMatch=_const.SVG_SIZE.exec(svgString),size={};sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7])));return size},exports.skipHello=function(){saidHello=!0},exports.sayHello=function(type){if(saidHello)return;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS "+_const.VERSION+" - ✰ "+type+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,args)}else window.console&&window.console.log("PixiJS "+_const.VERSION+" - "+type+" - http://www.pixijs.com/");saidHello=!0},exports.isWebGLSupported=function(){var contextOptions={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions),success=!(!gl||!gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e){return!1}},exports.sign=function(n){return 0===n?0:n<0?-1:1},exports.destroyTextureCache=function(){var key=void 0;for(key in TextureCache)TextureCache[key].destroy();for(key in BaseTextureCache)BaseTextureCache[key].destroy()},exports.clearTextureCache=function(){var key=void 0;for(key in TextureCache)delete TextureCache[key];for(key in BaseTextureCache)delete BaseTextureCache[key]},exports.correctBlendMode=function(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]},exports.premultiplyTint=function(tint,alpha){if(1===alpha)return(255*alpha<<24)+tint;if(0===alpha)return 0;var R=tint>>16&255,G=tint>>8&255,B=255&tint;return(255*alpha<<24)+((R=R*alpha+.5|0)<<16)+((G=G*alpha+.5|0)<<8)+(B=B*alpha+.5|0)},exports.premultiplyRgba=function(rgb,alpha,out,premultiply){out=out||new Float32Array(4),premultiply||void 0===premultiply?(out[0]=rgb[0]*alpha,out[1]=rgb[1]*alpha,out[2]=rgb[2]*alpha):(out[0]=rgb[0],out[1]=rgb[1],out[2]=rgb[2]);return out[3]=alpha,out},exports.premultiplyTintToRgba=function(tint,alpha,out,premultiply){(out=out||new Float32Array(4))[0]=(tint>>16&255)/255,out[1]=(tint>>8&255)/255,out[2]=(255&tint)/255,(premultiply||void 0===premultiply)&&(out[0]*=alpha,out[1]*=alpha,out[2]*=alpha);return out[3]=alpha,out};var _const=require("../const"),_settings2=_interopRequireDefault(require("../settings")),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_pluginTarget2=_interopRequireDefault(require("./pluginTarget")),mixins=_interopRequireWildcard(require("./mixin")),isMobile=_interopRequireWildcard(require("ismobilejs")),_removeArrayItems2=_interopRequireDefault(require("remove-array-items")),_mapPremultipliedBlendModes2=_interopRequireDefault(require("./mapPremultipliedBlendModes"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var nextUid=0,saidHello=!1;exports.isMobile=isMobile,exports.removeItems=_removeArrayItems2.default,exports.EventEmitter=_eventemitter2.default,exports.pluginTarget=_pluginTarget2.default,exports.mixins=mixins;var TextureCache=exports.TextureCache=Object.create(null),BaseTextureCache=exports.BaseTextureCache=Object.create(null);var premultiplyBlendMode=exports.premultiplyBlendMode=(0,_mapPremultipliedBlendModes2.default)()},{"../const":66,"../settings":121,"./mapPremultipliedBlendModes":146,"./mixin":148,"./pluginTarget":149,eventemitter3:29,ismobilejs:34,"remove-array-items":214}],146:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(){for(var pm=[],npm=[],i=0;i<32;i++)pm[i]=i,npm[i]=i;pm[_const.BLEND_MODES.NORMAL_NPM]=_const.BLEND_MODES.NORMAL,pm[_const.BLEND_MODES.ADD_NPM]=_const.BLEND_MODES.ADD,pm[_const.BLEND_MODES.SCREEN_NPM]=_const.BLEND_MODES.SCREEN,npm[_const.BLEND_MODES.NORMAL]=_const.BLEND_MODES.NORMAL_NPM,npm[_const.BLEND_MODES.ADD]=_const.BLEND_MODES.ADD_NPM,npm[_const.BLEND_MODES.SCREEN]=_const.BLEND_MODES.SCREEN_NPM;var array=[];return array.push(npm),array.push(pm),array};var _const=require("../const")},{"../const":66}],147:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(max){if(_ismobilejs2.default.tablet||_ismobilejs2.default.phone)return 4;return max};var obj,_ismobilejs=require("ismobilejs"),_ismobilejs2=(obj=_ismobilejs)&&obj.__esModule?obj:{default:obj}},{ismobilejs:34}],148:[function(require,module,exports){"use strict";function mixin(target,source){if(target&&source)for(var keys=Object.keys(source),i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(target,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}}exports.__esModule=!0,exports.mixin=mixin,exports.delayMixin=function(target,source){mixins.push(target,source)},exports.performMixins=function(){for(var i=0;i<mixins.length;i+=2)mixin(mixins[i],mixins[i+1]);mixins.length=0};var mixins=[]},{}],149:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default={mixin:function(obj){!function(obj){obj.__plugins={},obj.registerPlugin=function(pluginName,ctor){obj.__plugins[pluginName]=ctor},obj.prototype.initPlugins=function(){for(var o in this.plugins=this.plugins||{},obj.__plugins)this.plugins[o]=new obj.__plugins[o](this)},obj.prototype.destroyPlugins=function(){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;this.plugins=null}}(obj)}}},{}],150:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(canvas){var width=canvas.width,height=canvas.height,context=canvas.getContext("2d"),pixels=context.getImageData(0,0,width,height).data,len=pixels.length,bound={top:null,left:null,right:null,bottom:null},i=void 0,x=void 0,y=void 0;for(i=0;i<len;i+=4)0!==pixels[i+3]&&(x=i/4%width,y=~~(i/4/width),null===bound.top&&(bound.top=y),null===bound.left?bound.left=x:x<bound.left&&(bound.left=x),null===bound.right?bound.right=x+1:bound.right<x&&(bound.right=x+1),null===bound.bottom?bound.bottom=y:bound.bottom<y&&(bound.bottom=y));width=bound.right-bound.left,height=bound.bottom-bound.top+1;var data=context.getImageData(bound.left,bound.top,width,height);return{height:height,width:width,data:data}}},{}],151:[function(require,module,exports){"use strict";function warn(msg){var stack=(new Error).stack;void 0===stack?console.warn("Deprecation Warning: ",msg):(stack=stack.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",msg),console.warn(stack),console.groupEnd()):(console.warn("Deprecation Warning: ",msg),console.warn(stack)))}exports.__esModule=!0,exports.default=function(core){var mesh=core.mesh,particles=core.particles,extras=core.extras,filters=core.filters,prepare=core.prepare,loaders=core.loaders,interaction=core.interaction;Object.defineProperties(core,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return warn("You do not need to use a PIXI Stage any more, you can simply render any container."),core.Container}},DisplayObjectContainer:{get:function(){return warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),core.Container}},Strip:{get:function(){return warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),mesh.Mesh}},Rope:{get:function(){return warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),mesh.Rope}},ParticleContainer:{get:function(){return warn("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),particles.ParticleContainer}},MovieClip:{get:function(){return warn("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),extras.AnimatedSprite}},TilingSprite:{get:function(){return warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),extras.TilingSprite}},BitmapText:{get:function(){return warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),extras.BitmapText}},blendModes:{get:function(){return warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),core.BLEND_MODES}},scaleModes:{get:function(){return warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),core.SCALE_MODES}},BaseTextureCache:{get:function(){return warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),core.utils.BaseTextureCache}},TextureCache:{get:function(){return warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),core.utils.TextureCache}},math:{get:function(){return warn("The math namespace is deprecated, please access members already accessible on PIXI."),core}},AbstractFilter:{get:function(){return warn("AstractFilter has been renamed to Filter, please use PIXI.Filter"),core.Filter}},TransformManual:{get:function(){return warn("TransformManual has been renamed to TransformBase, please update your pixi-spine"),core.TransformBase}},TARGET_FPMS:{get:function(){return warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),core.settings.TARGET_FPMS},set:function(value){warn("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),core.settings.TARGET_FPMS=value}},FILTER_RESOLUTION:{get:function(){return warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),core.settings.FILTER_RESOLUTION},set:function(value){warn("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),core.settings.FILTER_RESOLUTION=value}},RESOLUTION:{get:function(){return warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),core.settings.RESOLUTION},set:function(value){warn("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),core.settings.RESOLUTION=value}},MIPMAP_TEXTURES:{get:function(){return warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),core.settings.MIPMAP_TEXTURES},set:function(value){warn("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),core.settings.MIPMAP_TEXTURES=value}},SPRITE_BATCH_SIZE:{get:function(){return warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),core.settings.SPRITE_BATCH_SIZE},set:function(value){warn("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),core.settings.SPRITE_BATCH_SIZE=value}},SPRITE_MAX_TEXTURES:{get:function(){return warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),core.settings.SPRITE_MAX_TEXTURES},set:function(value){warn("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),core.settings.SPRITE_MAX_TEXTURES=value}},RETINA_PREFIX:{get:function(){return warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),core.settings.RETINA_PREFIX},set:function(value){warn("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),core.settings.RETINA_PREFIX=value}},DEFAULT_RENDER_OPTIONS:{get:function(){return warn("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),core.settings.RENDER_OPTIONS}}});for(var defaults=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],_loop=function(i){var deprecation=defaults[i];Object.defineProperty(core[deprecation.parent],"DEFAULT",{get:function(){return warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, please use PIXI.settings."+deprecation.target),core.settings[deprecation.target]},set:function(value){warn("PIXI."+deprecation.parent+".DEFAULT has been deprecated, please use PIXI.settings."+deprecation.target),core.settings[deprecation.target]=value}})},i=0;i<defaults.length;i++)_loop(i);Object.defineProperties(core.settings,{PRECISION:{get:function(){return warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),core.settings.PRECISION_FRAGMENT},set:function(value){warn("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),core.settings.PRECISION_FRAGMENT=value}}}),extras.AnimatedSprite&&Object.defineProperties(extras,{MovieClip:{get:function(){return warn("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),extras.AnimatedSprite}}});extras&&Object.defineProperties(extras,{TextureTransform:{get:function(){return warn("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),core.TextureMatrix}}});core.DisplayObject.prototype.generateTexture=function(renderer,scaleMode,resolution){return warn("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),renderer.generateTexture(this,scaleMode,resolution)},core.Graphics.prototype.generateTexture=function(scaleMode,resolution){return warn("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(scaleMode,resolution)},core.GroupD8.isSwapWidthHeight=function(rotation){return warn("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),core.GroupD8.isVertical(rotation)},core.RenderTexture.prototype.render=function(displayObject,matrix,clear,updateTransform){this.legacyRenderer.render(displayObject,this,clear,matrix,!updateTransform),warn("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},core.RenderTexture.prototype.getImage=function(target){return warn("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(target)},core.RenderTexture.prototype.getBase64=function(target){return warn("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(target)},core.RenderTexture.prototype.getCanvas=function(target){return warn("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(target)},core.RenderTexture.prototype.getPixels=function(target){return warn("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(target)},core.Sprite.prototype.setTexture=function(texture){this.texture=texture,warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},extras.BitmapText&&(extras.BitmapText.prototype.setText=function(text){this.text=text,warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")});core.Text.prototype.setText=function(text){this.text=text,warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},core.Text.calculateFontProperties=function(font){return warn("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),core.TextMetrics.measureFont(font)},Object.defineProperties(core.Text,{fontPropertiesCache:{get:function(){return warn("Text.fontPropertiesCache is deprecated"),core.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return warn("Text.fontPropertiesCanvas is deprecated"),core.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return warn("Text.fontPropertiesContext is deprecated"),core.TextMetrics._context}}}),core.Text.prototype.setStyle=function(style){this.style=style,warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},core.Text.prototype.determineFontProperties=function(fontStyle){return warn("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),core.TextMetrics.measureFont(fontStyle)},core.Text.getFontStyle=function(style){return warn("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(style=style||{})instanceof core.TextStyle||(style=new core.TextStyle(style)),style.toFontString()},Object.defineProperties(core.TextStyle.prototype,{font:{get:function(){warn("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");var fontSizeString="number"==typeof this._fontSize?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+fontSizeString+" "+this._fontFamily},set:function(font){warn("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),font.indexOf("italic")>1?this._fontStyle="italic":font.indexOf("oblique")>-1?this._fontStyle="oblique":this._fontStyle="normal",font.indexOf("small-caps")>-1?this._fontVariant="small-caps":this._fontVariant="normal";var splits=font.split(" "),fontSizeIndex=-1;this._fontSize=26;for(var i=0;i<splits.length;++i)if(splits[i].match(/(px|pt|em|%)/)){fontSizeIndex=i,this._fontSize=splits[i];break}this._fontWeight="normal";for(var _i=0;_i<fontSizeIndex;++_i)if(splits[_i].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=splits[_i];break}if(fontSizeIndex>-1&&fontSizeIndex<splits.length-1){this._fontFamily="";for(var _i2=fontSizeIndex+1;_i2<splits.length;++_i2)this._fontFamily+=splits[_i2]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),core.Texture.prototype.setFrame=function(frame){this.frame=frame,warn("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},core.Texture.addTextureToCache=function(texture,id){core.Texture.addToCache(texture,id),warn("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},core.Texture.removeTextureFromCache=function(id){return warn("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),core.BaseTexture.removeFromCache(id),core.Texture.removeFromCache(id)},Object.defineProperties(filters,{AbstractFilter:{get:function(){return warn("AstractFilter has been renamed to Filter, please use PIXI.Filter"),core.AbstractFilter}},SpriteMaskFilter:{get:function(){return warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),core.SpriteMaskFilter}},VoidFilter:{get:function(){return warn("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),filters.AlphaFilter}}}),core.utils.uuid=function(){return warn("utils.uuid() is deprecated, please use utils.uid() from now on."),core.utils.uid()},core.utils.canUseNewCanvasBlendModes=function(){return warn("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),core.CanvasTinter.canUseMultiply};var saidHello=!0;Object.defineProperty(core.utils,"_saidHello",{set:function(bool){bool&&(warn("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),saidHello=bool},get:function(){return saidHello}}),prepare.BasePrepare&&(prepare.BasePrepare.prototype.register=function(addHook,uploadHook){return warn("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),addHook&&this.registerFindHook(addHook),uploadHook&&this.registerUploadHook(uploadHook),this});prepare.canvas&&Object.defineProperty(prepare.canvas,"UPLOADS_PER_FRAME",{set:function(){warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return warn("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}});prepare.webgl&&Object.defineProperty(prepare.webgl,"UPLOADS_PER_FRAME",{set:function(){warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return warn("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}});if(loaders.Loader){var Resource=loaders.Resource,Loader=loaders.Loader;Object.defineProperties(Resource.prototype,{isJson:{get:function(){return warn("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===Resource.TYPE.JSON}},isXml:{get:function(){return warn("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===Resource.TYPE.XML}},isImage:{get:function(){return warn("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===Resource.TYPE.IMAGE}},isAudio:{get:function(){return warn("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===Resource.TYPE.AUDIO}},isVideo:{get:function(){return warn("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===Resource.TYPE.VIDEO}}}),Object.defineProperties(Loader.prototype,{before:{get:function(){return warn("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return warn("The after() method is deprecated, please use use()."),this.use}}})}interaction.interactiveTarget&&Object.defineProperty(interaction.interactiveTarget,"defaultCursor",{set:function(value){warn("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=value},get:function(){return warn("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}});interaction.InteractionManager&&(Object.defineProperty(interaction.InteractionManager,"defaultCursorStyle",{set:function(value){warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=value},get:function(){return warn("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(interaction.InteractionManager,"currentCursorStyle",{set:function(value){warn("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=value},get:function(){return warn("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))}},{}],152:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));var TEMP_RECT=new core.Rectangle,CanvasExtract=function(){function CanvasExtract(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasExtract),this.renderer=renderer,renderer.extract=this}return CanvasExtract.prototype.image=function(target){var image=new Image;return image.src=this.base64(target),image},CanvasExtract.prototype.base64=function(target){return this.canvas(target).toDataURL()},CanvasExtract.prototype.canvas=function(target){var renderer=this.renderer,context=void 0,resolution=void 0,frame=void 0,renderTexture=void 0;target&&(renderTexture=target instanceof core.RenderTexture?target:renderer.generateTexture(target)),renderTexture?(context=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context=renderer.rootContext,(frame=TEMP_RECT).width=this.renderer.width,frame.height=this.renderer.height);var width=frame.width*resolution,height=frame.height*resolution,canvasBuffer=new core.CanvasRenderTarget(width,height),canvasData=context.getImageData(frame.x*resolution,frame.y*resolution,width,height);return canvasBuffer.context.putImageData(canvasData,0,0),canvasBuffer.canvas},CanvasExtract.prototype.pixels=function(target){var renderer=this.renderer,context=void 0,resolution=void 0,frame=void 0,renderTexture=void 0;return target&&(renderTexture=target instanceof core.RenderTexture?target:renderer.generateTexture(target)),renderTexture?(context=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context=renderer.rootContext,(frame=TEMP_RECT).width=renderer.width,frame.height=renderer.height),context.getImageData(0,0,frame.width*resolution,frame.height*resolution).data},CanvasExtract.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},CanvasExtract}();exports.default=CanvasExtract,core.CanvasRenderer.registerPlugin("extract",CanvasExtract)},{"../../core":85}],153:[function(require,module,exports){"use strict";exports.__esModule=!0;var _WebGLExtract=require("./webgl/WebGLExtract");Object.defineProperty(exports,"webgl",{enumerable:!0,get:function(){return _interopRequireDefault(_WebGLExtract).default}});var _CanvasExtract=require("./canvas/CanvasExtract");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"canvas",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasExtract).default}})},{"./canvas/CanvasExtract":152,"./webgl/WebGLExtract":154}],154:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));var TEMP_RECT=new core.Rectangle,WebGLExtract=function(){function WebGLExtract(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLExtract),this.renderer=renderer,renderer.extract=this}return WebGLExtract.prototype.image=function(target){var image=new Image;return image.src=this.base64(target),image},WebGLExtract.prototype.base64=function(target){return this.canvas(target).toDataURL()},WebGLExtract.prototype.canvas=function(target){var renderer=this.renderer,textureBuffer=void 0,resolution=void 0,frame=void 0,flipY=!1,renderTexture=void 0,generated=!1;target&&(target instanceof core.RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=(textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,frame=renderTexture.frame,flipY=!1):(resolution=(textureBuffer=this.renderer.rootRenderTarget).resolution,flipY=!0,(frame=TEMP_RECT).width=textureBuffer.size.width,frame.height=textureBuffer.size.height);var width=frame.width*resolution,height=frame.height*resolution,canvasBuffer=new core.CanvasRenderTarget(width,height);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var webglPixels=new Uint8Array(4*width*height),gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);canvasData.data.set(webglPixels),canvasBuffer.context.putImageData(canvasData,0,0),flipY&&(canvasBuffer.context.scale(1,-1),canvasBuffer.context.drawImage(canvasBuffer.canvas,0,-height))}return generated&&renderTexture.destroy(!0),canvasBuffer.canvas},WebGLExtract.prototype.pixels=function(target){var renderer=this.renderer,textureBuffer=void 0,resolution=void 0,frame=void 0,renderTexture=void 0,generated=!1;target&&(target instanceof core.RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=(textureBuffer=renderTexture.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,frame=renderTexture.frame):(resolution=(textureBuffer=this.renderer.rootRenderTarget).resolution,(frame=TEMP_RECT).width=textureBuffer.size.width,frame.height=textureBuffer.size.height);var width=frame.width*resolution,height=frame.height*resolution,webglPixels=new Uint8Array(4*width*height);if(textureBuffer){renderer.bindRenderTarget(textureBuffer);var gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels)}return generated&&renderTexture.destroy(!0),webglPixels},WebGLExtract.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},WebGLExtract}();exports.default=WebGLExtract,core.WebGLRenderer.registerPlugin("extract",WebGLExtract)},{"../../core":85}],155:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core"));var AnimatedSprite=function(_core$Sprite){function AnimatedSprite(textures,autoUpdate){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AnimatedSprite);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Sprite.call(this,textures[0]instanceof core.Texture?textures[0]:textures[0].texture));return _this._textures=null,_this._durations=null,_this.textures=textures,_this._autoUpdate=!1!==autoUpdate,_this.animationSpeed=1,_this.loop=!0,_this.onComplete=null,_this.onFrameChange=null,_this.onLoop=null,_this._currentTime=0,_this.playing=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(AnimatedSprite,_core$Sprite),AnimatedSprite.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&core.ticker.shared.remove(this.update,this))},AnimatedSprite.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.HIGH))},AnimatedSprite.prototype.gotoAndStop=function(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture()},AnimatedSprite.prototype.gotoAndPlay=function(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture(),this.play()},AnimatedSprite.prototype.update=function(deltaTime){var elapsed=this.animationSpeed*deltaTime,previousFrame=this.currentFrame;if(null!==this._durations){var lag=this._currentTime%1*this._durations[this.currentFrame];for(lag+=elapsed/60*1e3;lag<0;)this._currentTime--,lag+=this._durations[this.currentFrame];var sign=Math.sign(this.animationSpeed*deltaTime);for(this._currentTime=Math.floor(this._currentTime);lag>=this._durations[this.currentFrame];)lag-=this._durations[this.currentFrame]*sign,this._currentTime+=sign;this._currentTime+=lag/this._durations[this.currentFrame]}else this._currentTime+=elapsed;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):previousFrame!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<previousFrame?this.onLoop():this.animationSpeed<0&&this.currentFrame>previousFrame&&this.onLoop()),this.updateTexture())},AnimatedSprite.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.onFrameChange&&this.onFrameChange(this.currentFrame)},AnimatedSprite.prototype.destroy=function(options){this.stop(),_core$Sprite.prototype.destroy.call(this,options)},AnimatedSprite.fromFrames=function(frames){for(var textures=[],i=0;i<frames.length;++i)textures.push(core.Texture.fromFrame(frames[i]));return new AnimatedSprite(textures)},AnimatedSprite.fromImages=function(images){for(var textures=[],i=0;i<images.length;++i)textures.push(core.Texture.fromImage(images[i]));return new AnimatedSprite(textures)},_createClass(AnimatedSprite,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(value){if(value[0]instanceof core.Texture)this._textures=value,this._durations=null;else{this._textures=[],this._durations=[];for(var i=0;i<value.length;i++)this._textures.push(value[i].texture),this._durations.push(value[i].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;return currentFrame<0&&(currentFrame+=this._textures.length),currentFrame}}]),AnimatedSprite}(core.Sprite);exports.default=AnimatedSprite},{"../core":85}],156:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_ObservablePoint2=_interopRequireDefault(require("../core/math/ObservablePoint")),_utils=require("../core/utils"),_settings2=_interopRequireDefault(require("../core/settings"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BitmapText=function(_core$Container){function BitmapText(text){var style=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BitmapText);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Container.call(this));return _this._textWidth=0,_this._textHeight=0,_this._glyphs=[],_this._font={tint:void 0!==style.tint?style.tint:16777215,align:style.align||"left",name:null,size:0},_this.font=style.font,_this._text=text,_this._maxWidth=0,_this._maxLineHeight=0,_this._anchor=new _ObservablePoint2.default(function(){_this.dirty=!0},_this,0,0),_this.dirty=!1,_this.updateText(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BitmapText,_core$Container),BitmapText.prototype.updateText=function(){for(var data=BitmapText.fonts[this._font.name],scale=this._font.size/data.size,pos=new core.Point,chars=[],lineWidths=[],prevCharCode=null,lastLineWidth=0,maxLineWidth=0,line=0,lastSpace=-1,lastSpaceWidth=0,spacesRemoved=0,maxLineHeight=0,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(/(\s)/.test(this.text.charAt(i))&&(lastSpace=i,lastSpaceWidth=lastLineWidth),/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else if(-1!==lastSpace&&this._maxWidth>0&&pos.x*scale>this._maxWidth)core.utils.removeItems(chars,lastSpace-spacesRemoved,i-lastSpace),i=lastSpace,lastSpace=-1,++spacesRemoved,lineWidths.push(lastSpaceWidth),maxLineWidth=Math.max(maxLineWidth,lastSpaceWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new core.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),lastLineWidth=pos.x+(charData.texture.width+charData.xOffset),pos.x+=charData.xAdvance,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode)}}lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth);for(var lineAlignOffsets=[],_i=0;_i<=line;_i++){var alignOffset=0;"right"===this._font.align?alignOffset=maxLineWidth-lineWidths[_i]:"center"===this._font.align&&(alignOffset=(maxLineWidth-lineWidths[_i])/2),lineAlignOffsets.push(alignOffset)}for(var lenChars=chars.length,tint=this.tint,_i2=0;_i2<lenChars;_i2++){var c=this._glyphs[_i2];c?c.texture=chars[_i2].texture:(c=new core.Sprite(chars[_i2].texture),this._glyphs.push(c)),c.position.x=(chars[_i2].position.x+lineAlignOffsets[chars[_i2].line])*scale,c.position.y=chars[_i2].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c)}for(var _i3=lenChars;_i3<this._glyphs.length;++_i3)this.removeChild(this._glyphs[_i3]);if(this._textWidth=maxLineWidth*scale,this._textHeight=(pos.y+data.lineHeight)*scale,0!==this.anchor.x||0!==this.anchor.y)for(var _i4=0;_i4<lenChars;_i4++)this._glyphs[_i4].x-=this._textWidth*this.anchor.x,this._glyphs[_i4].y-=this._textHeight*this.anchor.y;this._maxLineHeight=maxLineHeight*scale},BitmapText.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},BitmapText.prototype.getLocalBounds=function(){return this.validate(),_core$Container.prototype.getLocalBounds.call(this)},BitmapText.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},BitmapText.registerFont=function(xml,texture){var data={},info=xml.getElementsByTagName("info")[0],common=xml.getElementsByTagName("common")[0],fileName=xml.getElementsByTagName("page")[0].getAttribute("file"),res=(0,_utils.getResolutionOfUrl)(fileName,_settings2.default.RESOLUTION);data.font=info.getAttribute("face"),data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10)/res,data.chars={};for(var letters=xml.getElementsByTagName("char"),i=0;i<letters.length;i++){var letter=letters[i],charCode=parseInt(letter.getAttribute("id"),10),textureRect=new core.Rectangle(parseInt(letter.getAttribute("x"),10)/res+texture.frame.x/res,parseInt(letter.getAttribute("y"),10)/res+texture.frame.y/res,parseInt(letter.getAttribute("width"),10)/res,parseInt(letter.getAttribute("height"),10)/res);data.chars[charCode]={xOffset:parseInt(letter.getAttribute("xoffset"),10)/res,yOffset:parseInt(letter.getAttribute("yoffset"),10)/res,xAdvance:parseInt(letter.getAttribute("xadvance"),10)/res,kerning:{},texture:new core.Texture(texture.baseTexture,textureRect)}}for(var kernings=xml.getElementsByTagName("kerning"),_i5=0;_i5<kernings.length;_i5++){var kerning=kernings[_i5],first=parseInt(kerning.getAttribute("first"),10)/res,second=parseInt(kerning.getAttribute("second"),10)/res,amount=parseInt(kerning.getAttribute("amount"),10)/res;data.chars[second]&&(data.chars[second].kerning[first]=amount)}return BitmapText.fonts[data.font]=data,data},_createClass(BitmapText,[{key:"tint",get:function(){return this._font.tint},set:function(value){this._font.tint="number"==typeof value&&value>=0?value:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(value){this._font.align=value||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(value){"number"==typeof value?this._anchor.set(value):this._anchor.copy(value)}},{key:"font",get:function(){return this._font},set:function(value){value&&("string"==typeof value?(value=value.split(" "),this._font.name=1===value.length?value[0]:value.slice(1).join(" "),this._font.size=value.length>=2?parseInt(value[0],10):BitmapText.fonts[this._font.name].size):(this._font.name=value.name,this._font.size="number"==typeof value.size?value.size:parseInt(value.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(value){value=value.toString()||" ",this._text!==value&&(this._text=value,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(value){this._maxWidth!==value&&(this._maxWidth=value,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),BitmapText}(core.Container);exports.default=BitmapText,BitmapText.fonts={}},{"../core":85,"../core/math/ObservablePoint":88,"../core/settings":121,"../core/utils":145}],157:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_CanvasTinter=require("../core/sprites/canvas/CanvasTinter"),_CanvasTinter2=(obj=_CanvasTinter)&&obj.__esModule?obj:{default:obj};var tempPoint=new core.Point,TilingSprite=function(_core$Sprite){function TilingSprite(texture){var width=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,height=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TilingSprite);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Sprite.call(this,texture));return _this.tileTransform=new core.TransformStatic,_this._width=width,_this._height=height,_this._canvasPattern=null,_this.uvTransform=texture.transform||new core.TextureMatrix(texture),_this.pluginName="tilingSprite",_this.uvRespectAnchor=!1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TilingSprite,_core$Sprite),TilingSprite.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},TilingSprite.prototype._renderWebGL=function(renderer){var texture=this._texture;texture&&texture.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),renderer.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this))},TilingSprite.prototype._renderCanvas=function(renderer){var texture=this._texture;if(texture.baseTexture.hasLoaded){var context=renderer.context,transform=this.worldTransform,resolution=renderer.resolution,baseTexture=texture.baseTexture,baseTextureResolution=baseTexture.resolution,modX=this.tilePosition.x/this.tileScale.x%texture._frame.width*baseTextureResolution,modY=this.tilePosition.y/this.tileScale.y%texture._frame.height*baseTextureResolution;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new core.CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);16777215!==this.tint?(this.tintedTexture=_CanvasTinter2.default.getTintedTexture(this,this.tint),tempCanvas.context.drawImage(this.tintedTexture,0,0)):tempCanvas.context.drawImage(baseTexture.source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution),this.cachedTint=this.tint,this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha,context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),renderer.setBlendMode(this.blendMode),context.fillStyle=this._canvasPattern,context.scale(this.tileScale.x/baseTextureResolution,this.tileScale.y/baseTextureResolution);var anchorX=this.anchor.x*-this._width,anchorY=this.anchor.y*-this._height;this.uvRespectAnchor?(context.translate(modX,modY),context.fillRect(-modX+anchorX,-modY+anchorY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution)):(context.translate(modX+anchorX,modY+anchorY),context.fillRect(-modX,-modY,this._width/this.tileScale.x*baseTextureResolution,this._height/this.tileScale.y*baseTextureResolution))}},TilingSprite.prototype._calculateBounds=function(){var minX=this._width*-this._anchor._x,minY=this._height*-this._anchor._y,maxX=this._width*(1-this._anchor._x),maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)},TilingSprite.prototype.getLocalBounds=function(rect){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._x),rect||(this._localBoundsRect||(this._localBoundsRect=new core.Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_core$Sprite.prototype.getLocalBounds.call(this,rect)},TilingSprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._width,height=this._height,x1=-width*this.anchor._x;if(tempPoint.x>=x1&&tempPoint.x<x1+width){var y1=-height*this.anchor._y;if(tempPoint.y>=y1&&tempPoint.y<y1+height)return!0}return!1},TilingSprite.prototype.destroy=function(options){_core$Sprite.prototype.destroy.call(this,options),this.tileTransform=null,this.uvTransform=null},TilingSprite.from=function(source,width,height){return new TilingSprite(core.Texture.from(source),width,height)},TilingSprite.fromFrame=function(frameId,width,height){var texture=core.utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache '+this);return new TilingSprite(texture,width,height)},TilingSprite.fromImage=function(imageId,width,height,crossorigin,scaleMode){return new TilingSprite(core.Texture.fromImage(imageId,crossorigin,scaleMode),width,height)},_createClass(TilingSprite,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(value){this.uvTransform.clampMargin=value,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(value){this.tileTransform.scale.copy(value)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(value){this.tileTransform.position.copy(value)}},{key:"width",get:function(){return this._width},set:function(value){this._width=value}},{key:"height",get:function(){return this._height},set:function(value){this._height=value}}]),TilingSprite}(core.Sprite);exports.default=TilingSprite},{"../core":85,"../core/sprites/canvas/CanvasTinter":124}],158:[function(require,module,exports){"use strict";var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_Texture2=_interopRequireDefault(require("../core/textures/Texture")),_BaseTexture2=_interopRequireDefault(require("../core/textures/BaseTexture")),_utils=require("../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DisplayObject=core.DisplayObject,_tempMatrix=new core.Matrix;DisplayObject.prototype._cacheAsBitmap=!1,DisplayObject.prototype._cacheData=!1;var CacheData=function CacheData(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CacheData),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(value){if(this._cacheAsBitmap!==value){this._cacheAsBitmap=value;var data=void 0;value?(this._cacheData||(this._cacheData=new CacheData),(data=this._cacheData).originalRenderWebGL=this.renderWebGL,data.originalRenderCanvas=this.renderCanvas,data.originalUpdateTransform=this.updateTransform,data.originalCalculateBounds=this._calculateBounds,data.originalGetLocalBounds=this.getLocalBounds,data.originalDestroy=this.destroy,data.originalContainsPoint=this.containsPoint,data.originalMask=this._mask,data.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((data=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=data.originalRenderWebGL,this.renderCanvas=data.originalRenderCanvas,this._calculateBounds=data.originalCalculateBounds,this.getLocalBounds=data.originalGetLocalBounds,this.destroy=data.originalDestroy,this.updateTransform=data.originalUpdateTransform,this.containsPoint=data.originalContainsPoint,this._mask=data.originalMask,this.filterArea=data.originalFilterArea)}}}}),DisplayObject.prototype._renderCachedWebGL=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(renderer),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(renderer))},DisplayObject.prototype._initCachedDisplayObject=function(renderer){if(!this._cacheData||!this._cacheData.sprite){var cacheAlpha=this.alpha;this.alpha=1,renderer.currentRenderer.flush();var bounds=this.getLocalBounds().clone();if(this._filters){var padding=this._filters[0].padding;bounds.pad(padding)}var cachedRenderTarget=renderer._activeRenderTarget,stack=renderer.filterManager.filterStack,renderTexture=core.RenderTexture.create(0|bounds.width,0|bounds.height),textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId,_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId),_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;m.tx=-bounds.x,m.ty=-bounds.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,renderer.render(this,renderTexture,!0,m,!0),renderer.bindRenderTarget(cachedRenderTarget),renderer.filterManager.filterStack=stack,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-bounds.x/bounds.width,cachedSprite.anchor.y=-bounds.y/bounds.height,cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=renderer._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}},DisplayObject.prototype._renderCachedCanvas=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(renderer),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(renderer))},DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){if(!this._cacheData||!this._cacheData.sprite){var bounds=this.getLocalBounds(),cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context,renderTexture=core.RenderTexture.create(0|bounds.width,0|bounds.height),textureCacheId="cacheAsBitmap_"+(0,_utils.uid)();this._cacheData.textureCacheId=textureCacheId,_BaseTexture2.default.addToCache(renderTexture.baseTexture,textureCacheId),_Texture2.default.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copy(m),m.invert(),m.tx-=bounds.x,m.ty-=bounds.y,this.renderCanvas=this._cacheData.originalRenderCanvas,renderer.render(this,renderTexture,!0,m,!1),renderer.context=cachedRenderTarget,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var cachedSprite=new core.Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-bounds.x/bounds.width,cachedSprite.anchor.y=-bounds.y/bounds.height,cachedSprite._bounds=this._bounds,cachedSprite.alpha=cacheAlpha,this.parent?this.updateTransform():(this.parent=renderer._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=cachedSprite,this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}},DisplayObject.prototype._calculateCachedBounds=function(){this._cacheData.sprite._calculateBounds()},DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,_BaseTexture2.default.removeFromCache(this._cacheData.textureCacheId),_Texture2.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},DisplayObject.prototype._cacheAsBitmapDestroy=function(options){this.cacheAsBitmap=!1,this.destroy(options)}},{"../core":85,"../core/textures/BaseTexture":132,"../core/textures/Texture":135,"../core/utils":145}],159:[function(require,module,exports){"use strict";var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core"));core.DisplayObject.prototype.name=null,core.Container.prototype.getChildByName=function(name){for(var i=0;i<this.children.length;i++)if(this.children[i].name===name)return this.children[i];return null}},{"../core":85}],160:[function(require,module,exports){"use strict";var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core"));core.DisplayObject.prototype.getGlobalPosition=function(){var point=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new core.Point,skipUpdate=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.parent?this.parent.toGlobal(this.position,point,skipUpdate):(point.x=this.position.x,point.y=this.position.y),point}},{"../core":85}],161:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.BitmapText=exports.TilingSpriteRenderer=exports.TilingSprite=exports.AnimatedSprite=void 0;var _AnimatedSprite=require("./AnimatedSprite");Object.defineProperty(exports,"AnimatedSprite",{enumerable:!0,get:function(){return _interopRequireDefault(_AnimatedSprite).default}});var _TilingSprite=require("./TilingSprite");Object.defineProperty(exports,"TilingSprite",{enumerable:!0,get:function(){return _interopRequireDefault(_TilingSprite).default}});var _TilingSpriteRenderer=require("./webgl/TilingSpriteRenderer");Object.defineProperty(exports,"TilingSpriteRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_TilingSpriteRenderer).default}});var _BitmapText=require("./BitmapText");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"BitmapText",{enumerable:!0,get:function(){return _interopRequireDefault(_BitmapText).default}}),require("./cacheAsBitmap"),require("./getChildByName"),require("./getGlobalPosition")},{"./AnimatedSprite":155,"./BitmapText":156,"./TilingSprite":157,"./cacheAsBitmap":158,"./getChildByName":159,"./getGlobalPosition":160,"./webgl/TilingSpriteRenderer":162}],162:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_const=require("../../core/const");require("path");var tempMat=new core.Matrix,TilingSpriteRenderer=function(_core$ObjectRenderer){function TilingSpriteRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TilingSpriteRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$ObjectRenderer.call(this,renderer));return _this.shader=null,_this.simpleShader=null,_this.quad=null,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(TilingSpriteRenderer,_core$ObjectRenderer),TilingSpriteRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new core.Quad(gl,this.renderer.state.attribState),this.quad.initVao(this.shader)},TilingSpriteRenderer.prototype.render=function(ts){var renderer=this.renderer,quad=this.quad;renderer.bindVao(quad.vao);var vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x,vertices[1]=vertices[3]=ts._height*-ts.anchor.y,vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x),vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y),ts.uvRespectAnchor&&((vertices=quad.uvs)[0]=vertices[6]=-ts.anchor.x,vertices[1]=vertices[3]=-ts.anchor.y,vertices[2]=vertices[4]=1-ts.anchor.x,vertices[5]=vertices[7]=1-ts.anchor.y),quad.upload();var tex=ts._texture,baseTex=tex.baseTexture,lt=ts.tileTransform.localTransform,uv=ts.uvTransform,isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;isSimple&&(baseTex._glTextures[renderer.CONTEXT_UID]?isSimple=baseTex.wrapMode!==_const.WRAP_MODES.CLAMP:baseTex.wrapMode===_const.WRAP_MODES.CLAMP&&(baseTex.wrapMode=_const.WRAP_MODES.REPEAT));var shader=isSimple?this.simpleShader:this.shader;renderer.bindShader(shader);var w=tex.width,h=tex.height,W=ts._width,H=ts._height;tempMat.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H),tempMat.invert(),isSimple?tempMat.prepend(uv.mapCoord):(shader.uniforms.uMapCoord=uv.mapCoord.toArray(!0),shader.uniforms.uClampFrame=uv.uClampFrame,shader.uniforms.uClampOffset=uv.uClampOffset),shader.uniforms.uTransform=tempMat.toArray(!0),shader.uniforms.uColor=core.utils.premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.premultipliedAlpha),shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(!0),shader.uniforms.uSampler=renderer.bindTexture(tex),renderer.setBlendMode(core.utils.correctBlendMode(ts.blendMode,baseTex.premultipliedAlpha)),quad.vao.draw(this.renderer.gl.TRIANGLES,6,0)},TilingSpriteRenderer}(core.ObjectRenderer);exports.default=TilingSpriteRenderer,core.WebGLRenderer.registerPlugin("tilingSprite",TilingSpriteRenderer)},{"../../core":85,"../../core/const":66,path:42}],163:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));require("path");var AlphaFilter=function(_core$Filter){function AlphaFilter(){var alpha=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AlphaFilter);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return _this.alpha=alpha,_this.glShaderKey="alpha",_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(AlphaFilter,_core$Filter),_createClass(AlphaFilter,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value}}]),AlphaFilter}(core.Filter);exports.default=AlphaFilter},{"../../core":85,path:42}],164:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_BlurXFilter2=_interopRequireDefault(require("./BlurXFilter")),_BlurYFilter2=_interopRequireDefault(require("./BlurYFilter"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BlurFilter=function(_core$Filter){function BlurFilter(strength,quality,resolution,kernelSize){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BlurFilter);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this));return _this.blurXFilter=new _BlurXFilter2.default(strength,quality,resolution,kernelSize),_this.blurYFilter=new _BlurYFilter2.default(strength,quality,resolution,kernelSize),_this.padding=0,_this.resolution=resolution||core.settings.RESOLUTION,_this.quality=quality||4,_this.blur=strength||8,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BlurFilter,_core$Filter),BlurFilter.prototype.apply=function(filterManager,input,output){var renderTarget=filterManager.getRenderTarget(!0);this.blurXFilter.apply(filterManager,input,renderTarget,!0),this.blurYFilter.apply(filterManager,renderTarget,output,!1),filterManager.returnRenderTarget(renderTarget)},_createClass(BlurFilter,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(value){this.blurXFilter.quality=this.blurYFilter.quality=value}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(value){this.blurYFilter._blendMode=value}}]),BlurFilter}(core.Filter);exports.default=BlurFilter},{"../../core":85,"./BlurXFilter":165,"./BlurYFilter":166}],165:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_generateBlurVertSource2=_interopRequireDefault(require("./generateBlurVertSource")),_generateBlurFragSource2=_interopRequireDefault(require("./generateBlurFragSource")),_getMaxBlurKernelSize2=_interopRequireDefault(require("./getMaxBlurKernelSize"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BlurXFilter=function(_core$Filter){function BlurXFilter(strength,quality,resolution,kernelSize){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BlurXFilter),kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,!0),fragSrc=(0,_generateBlurFragSource2.default)(kernelSize),_this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,vertSrc,fragSrc));return _this.resolution=resolution||core.settings.RESOLUTION,_this._quality=0,_this.quality=quality||4,_this.strength=strength||8,_this.firstRun=!0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BlurXFilter,_core$Filter),BlurXFilter.prototype.apply=function(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl,kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,!0),this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize),this.firstRun=!1}if(this.uniforms.strength=1/output.size.width*(output.size.width/input.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)filterManager.applyFilter(this,input,output,clear);else{for(var renderTarget=filterManager.getRenderTarget(!0),flip=input,flop=renderTarget,i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,!0);var temp=flop;flop=flip,flip=temp}filterManager.applyFilter(this,flip,output,clear),filterManager.returnRenderTarget(renderTarget)}},_createClass(BlurXFilter,[{key:"blur",get:function(){return this.strength},set:function(value){this.padding=2*Math.abs(value),this.strength=value}},{key:"quality",get:function(){return this._quality},set:function(value){this._quality=value,this.passes=value}}]),BlurXFilter}(core.Filter);exports.default=BlurXFilter},{"../../core":85,"./generateBlurFragSource":167,"./generateBlurVertSource":168,"./getMaxBlurKernelSize":169}],166:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_generateBlurVertSource2=_interopRequireDefault(require("./generateBlurVertSource")),_generateBlurFragSource2=_interopRequireDefault(require("./generateBlurFragSource")),_getMaxBlurKernelSize2=_interopRequireDefault(require("./getMaxBlurKernelSize"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BlurYFilter=function(_core$Filter){function BlurYFilter(strength,quality,resolution,kernelSize){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BlurYFilter),kernelSize=kernelSize||5;var vertSrc=(0,_generateBlurVertSource2.default)(kernelSize,!1),fragSrc=(0,_generateBlurFragSource2.default)(kernelSize),_this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,vertSrc,fragSrc));return _this.resolution=resolution||core.settings.RESOLUTION,_this._quality=0,_this.quality=quality||4,_this.strength=strength||8,_this.firstRun=!0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(BlurYFilter,_core$Filter),BlurYFilter.prototype.apply=function(filterManager,input,output,clear){if(this.firstRun){var gl=filterManager.renderer.gl,kernelSize=(0,_getMaxBlurKernelSize2.default)(gl);this.vertexSrc=(0,_generateBlurVertSource2.default)(kernelSize,!1),this.fragmentSrc=(0,_generateBlurFragSource2.default)(kernelSize),this.firstRun=!1}if(this.uniforms.strength=1/output.size.height*(output.size.height/input.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)filterManager.applyFilter(this,input,output,clear);else{for(var renderTarget=filterManager.getRenderTarget(!0),flip=input,flop=renderTarget,i=0;i<this.passes-1;i++){filterManager.applyFilter(this,flip,flop,!0);var temp=flop;flop=flip,flip=temp}filterManager.applyFilter(this,flip,output,clear),filterManager.returnRenderTarget(renderTarget)}},_createClass(BlurYFilter,[{key:"blur",get:function(){return this.strength},set:function(value){this.padding=2*Math.abs(value),this.strength=value}},{key:"quality",get:function(){return this._quality},set:function(value){this._quality=value,this.passes=value}}]),BlurYFilter}(core.Filter);exports.default=BlurYFilter},{"../../core":85,"./generateBlurFragSource":167,"./generateBlurVertSource":168,"./getMaxBlurKernelSize":169}],167:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(kernelSize){for(var kernel=GAUSSIAN_VALUES[kernelSize],halfLength=kernel.length,fragSource=fragTemplate,blurLoop="",value=void 0,i=0;i<kernelSize;i++){var blur="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",i);value=i,i>=halfLength&&(value=kernelSize-i-1),blur=blur.replace("%value%",kernel[value]),blurLoop+=blur,blurLoop+="\n"}return fragSource=(fragSource=fragSource.replace("%blur%",blurLoop)).replace("%size%",kernelSize)};var GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n")},{}],168:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(kernelSize,x){var halfLength=Math.ceil(kernelSize/2),vertSource=vertTemplate,blurLoop="",template=void 0;template=x?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i);blur=blur.replace("%sampleIndex%",i-(halfLength-1)+".0"),blurLoop+=blur,blurLoop+="\n"}return vertSource=(vertSource=vertSource.replace("%blur%",blurLoop)).replace("%size%",kernelSize)};var vertTemplate=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n")},{}],169:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(gl){var maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS),kernelSize=15;for(;kernelSize>maxVaryings;)kernelSize-=2;return kernelSize}},{}],170:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));require("path");var ColorMatrixFilter=function(_core$Filter){function ColorMatrixFilter(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ColorMatrixFilter);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return _this.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],_this.alpha=1,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ColorMatrixFilter,_core$Filter),ColorMatrixFilter.prototype._loadMatrix=function(matrix){var newMatrix=matrix;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(newMatrix,this.uniforms.m,matrix),newMatrix=this._colorMatrix(newMatrix)),this.uniforms.m=newMatrix},ColorMatrixFilter.prototype._multiply=function(out,a,b){return out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15],out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16],out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17],out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18],out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4],out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15],out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16],out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17],out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18],out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9],out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15],out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16],out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17],out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18],out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14],out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15],out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16],out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17],out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18],out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19],out},ColorMatrixFilter.prototype._colorMatrix=function(matrix){var m=new Float32Array(matrix);return m[4]/=255,m[9]/=255,m[14]/=255,m[19]/=255,m},ColorMatrixFilter.prototype.brightness=function(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.greyscale=function(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.blackAndWhite=function(multiply){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.hue=function(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation),sinR=Math.sin(rotation),w=1/3,sqrW=(0,Math.sqrt)(w),matrix=[cosR+(1-cosR)*w,w*(1-cosR)-sqrW*sinR,w*(1-cosR)+sqrW*sinR,0,0,w*(1-cosR)+sqrW*sinR,cosR+w*(1-cosR),w*(1-cosR)-sqrW*sinR,0,0,w*(1-cosR)-sqrW*sinR,w*(1-cosR)+sqrW*sinR,cosR+w*(1-cosR),0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.contrast=function(amount,multiply){var v=(amount||0)+1,o=-.5*(v-1),matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.saturate=function(){var amount=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,multiply=arguments[1],x=2*amount/3+1,y=-.5*(x-1),matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.desaturate=function(){this.saturate(-1)},ColorMatrixFilter.prototype.negative=function(multiply){this._loadMatrix([0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.sepia=function(multiply){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.technicolor=function(multiply){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.polaroid=function(multiply){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.toBGR=function(multiply){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.kodachrome=function(multiply){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.browni=function(multiply){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.vintage=function(multiply){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.colorTone=function(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||.2,toned=toned||.15;var lR=((lightColor=lightColor||16770432)>>16&255)/255,lG=(lightColor>>8&255)/255,lB=(255&lightColor)/255,dR=((darkColor=darkColor||3375104)>>16&255)/255,dG=(darkColor>>8&255)/255,dB=(255&darkColor)/255,matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.night=function(intensity,multiply){var matrix=[-2*(intensity=intensity||.1),-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,2*intensity,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.predator=function(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.lsd=function(multiply){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},_createClass(ColorMatrixFilter,[{key:"matrix",get:function(){return this.uniforms.m},set:function(value){this.uniforms.m=value}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value}}]),ColorMatrixFilter}(core.Filter);exports.default=ColorMatrixFilter,ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale},{"../../core":85,path:42}],171:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));require("path");var DisplacementFilter=function(_core$Filter){function DisplacementFilter(sprite,scale){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DisplacementFilter);var maskMatrix=new core.Matrix;sprite.renderable=!1;var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return _this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this.uniforms.mapSampler=sprite._texture,_this.uniforms.filterMatrix=maskMatrix,_this.uniforms.scale={x:1,y:1},null!==scale&&void 0!==scale||(scale=20),_this.scale=new core.Point(scale,scale),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(DisplacementFilter,_core$Filter),DisplacementFilter.prototype.apply=function(filterManager,input,output){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,filterManager.applyFilter(this,input,output)},_createClass(DisplacementFilter,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(value){this.uniforms.mapSampler=value}}]),DisplacementFilter}(core.Filter);exports.default=DisplacementFilter},{"../../core":85,path:42}],172:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));require("path");var FXAAFilter=function(_core$Filter){function FXAAFilter(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FXAAFilter),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(FXAAFilter,_core$Filter),FXAAFilter}(core.Filter);exports.default=FXAAFilter},{"../../core":85,path:42}],173:[function(require,module,exports){"use strict";exports.__esModule=!0;var _FXAAFilter=require("./fxaa/FXAAFilter");Object.defineProperty(exports,"FXAAFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_FXAAFilter).default}});var _NoiseFilter=require("./noise/NoiseFilter");Object.defineProperty(exports,"NoiseFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_NoiseFilter).default}});var _DisplacementFilter=require("./displacement/DisplacementFilter");Object.defineProperty(exports,"DisplacementFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_DisplacementFilter).default}});var _BlurFilter=require("./blur/BlurFilter");Object.defineProperty(exports,"BlurFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_BlurFilter).default}});var _BlurXFilter=require("./blur/BlurXFilter");Object.defineProperty(exports,"BlurXFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_BlurXFilter).default}});var _BlurYFilter=require("./blur/BlurYFilter");Object.defineProperty(exports,"BlurYFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_BlurYFilter).default}});var _ColorMatrixFilter=require("./colormatrix/ColorMatrixFilter");Object.defineProperty(exports,"ColorMatrixFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_ColorMatrixFilter).default}});var _AlphaFilter=require("./alpha/AlphaFilter");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"AlphaFilter",{enumerable:!0,get:function(){return _interopRequireDefault(_AlphaFilter).default}})},{"./alpha/AlphaFilter":163,"./blur/BlurFilter":164,"./blur/BlurXFilter":165,"./blur/BlurYFilter":166,"./colormatrix/ColorMatrixFilter":170,"./displacement/DisplacementFilter":171,"./fxaa/FXAAFilter":172,"./noise/NoiseFilter":174}],174:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core"));require("path");var NoiseFilter=function(_core$Filter){function NoiseFilter(){var noise=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,seed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NoiseFilter);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Filter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return _this.noise=noise,_this.seed=seed,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NoiseFilter,_core$Filter),_createClass(NoiseFilter,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(value){this.uniforms.uNoise=value}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(value){this.uniforms.uSeed=value}}]),NoiseFilter}(core.Filter);exports.default=NoiseFilter},{"../../core":85,path:42}],175:[function(require,module,exports){(function(global){"use strict";exports.__esModule=!0,exports.loader=exports.prepare=exports.particles=exports.mesh=exports.loaders=exports.interaction=exports.filters=exports.extras=exports.extract=exports.accessibility=void 0;var _polyfill=require("./polyfill");Object.keys(_polyfill).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _polyfill[key]}})});var _core=require("./core");Object.keys(_core).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _core[key]}})});var obj,_deprecation=require("./deprecation"),_deprecation2=(obj=_deprecation)&&obj.__esModule?obj:{default:obj},accessibility=_interopRequireWildcard(require("./accessibility")),extract=_interopRequireWildcard(require("./extract")),extras=_interopRequireWildcard(require("./extras")),filters=_interopRequireWildcard(require("./filters")),interaction=_interopRequireWildcard(require("./interaction")),loaders=_interopRequireWildcard(require("./loaders")),mesh=_interopRequireWildcard(require("./mesh")),particles=_interopRequireWildcard(require("./particles")),prepare=_interopRequireWildcard(require("./prepare"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}_core.utils.mixins.performMixins();var loader=loaders.shared||null;exports.accessibility=accessibility,exports.extract=extract,exports.extras=extras,exports.filters=filters,exports.interaction=interaction,exports.loaders=loaders,exports.mesh=mesh,exports.particles=particles,exports.prepare=prepare,exports.loader=loader,"function"==typeof _deprecation2.default&&(0,_deprecation2.default)(exports),global.PIXI=exports}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":62,"./core":85,"./deprecation":151,"./extract":153,"./extras":161,"./filters":173,"./interaction":180,"./loaders":183,"./mesh":192,"./particles":195,"./polyfill":201,"./prepare":205}],176:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core"));var InteractionData=function(){function InteractionData(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InteractionData),this.global=new core.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return InteractionData.prototype.getLocalPosition=function(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)},InteractionData.prototype._copyEvent=function(event){event.isPrimary&&(this.isPrimary=!0),this.button=event.button,this.buttons=event.buttons,this.width=event.width,this.height=event.height,this.tiltX=event.tiltX,this.tiltY=event.tiltY,this.pointerType=event.pointerType,this.pressure=event.pressure,this.rotationAngle=event.rotationAngle,this.twist=event.twist||0,this.tangentialPressure=event.tangentialPressure||0},InteractionData.prototype._reset=function(){this.isPrimary=!1},_createClass(InteractionData,[{key:"pointerId",get:function(){return this.identifier}}]),InteractionData}();exports.default=InteractionData},{"../core":85}],177:[function(require,module,exports){"use strict";exports.__esModule=!0;var InteractionEvent=function(){function InteractionEvent(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InteractionEvent),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return InteractionEvent.prototype.stopPropagation=function(){this.stopped=!0},InteractionEvent.prototype._reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},InteractionEvent}();exports.default=InteractionEvent},{}],178:[function(require,module,exports){"use strict";exports.__esModule=!0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_InteractionData2=_interopRequireDefault(require("./InteractionData")),_InteractionEvent2=_interopRequireDefault(require("./InteractionEvent")),_InteractionTrackingData2=_interopRequireDefault(require("./InteractionTrackingData")),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_interactiveTarget2=_interopRequireDefault(require("./interactiveTarget"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}core.utils.mixins.delayMixin(core.DisplayObject.prototype,_interactiveTarget2.default);var MOUSE_POINTER_ID=1,hitTestEvent={target:null,data:{global:null}},InteractionManager=function(_EventEmitter){function InteractionManager(renderer,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InteractionManager);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_EventEmitter.call(this));return options=options||{},_this.renderer=renderer,_this.autoPreventDefault=void 0===options.autoPreventDefault||options.autoPreventDefault,_this.interactionFrequency=options.interactionFrequency||10,_this.mouse=new _InteractionData2.default,_this.mouse.identifier=MOUSE_POINTER_ID,_this.mouse.global.set(-999999),_this.activeInteractionData={},_this.activeInteractionData[MOUSE_POINTER_ID]=_this.mouse,_this.interactionDataPool=[],_this.eventData=new _InteractionEvent2.default,_this.interactionDOMElement=null,_this.moveWhenInside=!1,_this.eventsAdded=!1,_this.mouseOverRenderer=!1,_this.supportsTouchEvents="ontouchstart"in window,_this.supportsPointerEvents=!!window.PointerEvent,_this.onPointerUp=_this.onPointerUp.bind(_this),_this.processPointerUp=_this.processPointerUp.bind(_this),_this.onPointerCancel=_this.onPointerCancel.bind(_this),_this.processPointerCancel=_this.processPointerCancel.bind(_this),_this.onPointerDown=_this.onPointerDown.bind(_this),_this.processPointerDown=_this.processPointerDown.bind(_this),_this.onPointerMove=_this.onPointerMove.bind(_this),_this.processPointerMove=_this.processPointerMove.bind(_this),_this.onPointerOut=_this.onPointerOut.bind(_this),_this.processPointerOverOut=_this.processPointerOverOut.bind(_this),_this.onPointerOver=_this.onPointerOver.bind(_this),_this.cursorStyles={default:"inherit",pointer:"pointer"},_this.currentCursorMode=null,_this.cursor=null,_this._tempPoint=new core.Point,_this.resolution=1,_this.setTargetElement(_this.renderer.view,_this.renderer.resolution),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(InteractionManager,_EventEmitter),InteractionManager.prototype.hitTest=function(globalPoint,root){return hitTestEvent.target=null,hitTestEvent.data.global=globalPoint,root||(root=this.renderer._lastObjectRendered),this.processInteractive(hitTestEvent,root,null,!0),hitTestEvent.target},InteractionManager.prototype.setTargetElement=function(element){var resolution=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=element,this.resolution=resolution,this.addEvents()},InteractionManager.prototype.addEvents=function(){this.interactionDOMElement&&(core.ticker.shared.add(this.update,this,core.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(core.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},InteractionManager.prototype.update=function(deltaTime){if(this._deltaTime+=deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var k in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&"touch"!==interactionData.pointerType){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},InteractionManager.prototype.setCursorMode=function(mode){if(mode=mode||"default",this.currentCursorMode!==mode){this.currentCursorMode=mode;var style=this.cursorStyles[mode];if(style)switch(void 0===style?"undefined":_typeof(style)){case"string":this.interactionDOMElement.style.cursor=style;break;case"function":style(mode);break;case"object":Object.assign(this.interactionDOMElement.style,style)}else"string"!=typeof mode||Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)||(this.interactionDOMElement.style.cursor=mode)}},InteractionManager.prototype.dispatchEvent=function(displayObject,eventString,eventData){eventData.stopped||(eventData.currentTarget=displayObject,eventData.type=eventString,displayObject.emit(eventString,eventData),displayObject[eventString]&&displayObject[eventString](eventData))},InteractionManager.prototype.mapPositionToPoint=function(point,x,y){var rect=void 0;rect=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var resolutionMultiplier=navigator.isCocoonJS?this.resolution:1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier,point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier},InteractionManager.prototype.processInteractive=function(interactionEvent,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible)return!1;var point=interactionEvent.data.global,hit=!1,interactiveParent=interactive=displayObject.interactive||interactive,hitTestChildren=!0;if(displayObject.hitArea?(hitTest&&(displayObject.worldTransform.applyInverse(point,this._tempPoint),displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?hit=!0:(hitTest=!1,hitTestChildren=!1)),interactiveParent=!1):displayObject._mask&&hitTest&&(displayObject._mask.containsPoint(point)||(hitTest=!1,hitTestChildren=!1)),hitTestChildren&&displayObject.interactiveChildren&&displayObject.children)for(var children=displayObject.children,i=children.length-1;i>=0;i--){var child=children[i],childHit=this.processInteractive(interactionEvent,child,func,hitTest,interactiveParent);if(childHit){if(!child.parent)continue;interactiveParent=!1,childHit&&(interactionEvent.target&&(hitTest=!1),hit=!0)}}return interactive&&(hitTest&&!interactionEvent.target&&!displayObject.hitArea&&displayObject.containsPoint&&displayObject.containsPoint(point)&&(hit=!0),displayObject.interactive&&(hit&&!interactionEvent.target&&(interactionEvent.target=displayObject),func&&func(interactionEvent,displayObject,!!hit))),hit},InteractionManager.prototype.onPointerDown=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var events=this.normalizeToPointerData(originalEvent);this.autoPreventDefault&&events[0].isNormalized&&originalEvent.preventDefault();for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",interactionEvent),"touch"===event.pointerType)this.emit("touchstart",interactionEvent);else if("mouse"===event.pointerType||"pen"===event.pointerType){var isRightButton=2===event.button;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}}},InteractionManager.prototype.processPointerDown=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier;if(hit)if(displayObject.trackedPointers[id]||(displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)),this.dispatchEvent(displayObject,"pointerdown",interactionEvent),"touch"===data.pointerType)this.dispatchEvent(displayObject,"touchstart",interactionEvent);else if("mouse"===data.pointerType||"pen"===data.pointerType){var isRightButton=2===data.button;isRightButton?displayObject.trackedPointers[id].rightDown=!0:displayObject.trackedPointers[id].leftDown=!0,this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}},InteractionManager.prototype.onPointerComplete=function(originalEvent,cancelled,func){for(var events=this.normalizeToPointerData(originalEvent),eventLen=events.length,eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"",i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,func,cancelled||!eventAppend),this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent),"mouse"===event.pointerType||"pen"===event.pointerType){var isRightButton=2===event.button;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else"touch"===event.pointerType&&(this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent),this.releaseInteractionDataForPointerId(event.pointerId,interactionData))}},InteractionManager.prototype.onPointerCancel=function(event){this.supportsTouchEvents&&"touch"===event.pointerType||this.onPointerComplete(event,!0,this.processPointerCancel)},InteractionManager.prototype.processPointerCancel=function(interactionEvent,displayObject){var data=interactionEvent.data,id=interactionEvent.data.identifier;void 0!==displayObject.trackedPointers[id]&&(delete displayObject.trackedPointers[id],this.dispatchEvent(displayObject,"pointercancel",interactionEvent),"touch"===data.pointerType&&this.dispatchEvent(displayObject,"touchcancel",interactionEvent))},InteractionManager.prototype.onPointerUp=function(event){this.supportsTouchEvents&&"touch"===event.pointerType||this.onPointerComplete(event,!1,this.processPointerUp)},InteractionManager.prototype.processPointerUp=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,trackingData=displayObject.trackedPointers[id],isTouch="touch"===data.pointerType;if("mouse"===data.pointerType||"pen"===data.pointerType){var isRightButton=2===data.button,flags=_InteractionTrackingData2.default.FLAGS,test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN,isDown=void 0!==trackingData&&trackingData.flags&test;hit?(this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent),isDown&&this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent)):isDown&&this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent),trackingData&&(isRightButton?trackingData.rightDown=!1:trackingData.leftDown=!1)}hit?(this.dispatchEvent(displayObject,"pointerup",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchend",interactionEvent),trackingData&&(this.dispatchEvent(displayObject,"pointertap",interactionEvent),isTouch&&(this.dispatchEvent(displayObject,"tap",interactionEvent),trackingData.over=!1))):trackingData&&(this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)),trackingData&&trackingData.none&&delete displayObject.trackedPointers[id]},InteractionManager.prototype.onPointerMove=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var events=this.normalizeToPointerData(originalEvent);"mouse"===events[0].pointerType&&(this.didMove=!0,this.cursor=null);for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent;var interactive="touch"!==event.pointerType||this.moveWhenInside;this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerMove,interactive),this.emit("pointermove",interactionEvent),"touch"===event.pointerType&&this.emit("touchmove",interactionEvent),"mouse"!==event.pointerType&&"pen"!==event.pointerType||this.emit("mousemove",interactionEvent)}"mouse"===events[0].pointerType&&this.setCursorMode(this.cursor)}},InteractionManager.prototype.processPointerMove=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,isTouch="touch"===data.pointerType,isMouse="mouse"===data.pointerType||"pen"===data.pointerType;isMouse&&this.processPointerOverOut(interactionEvent,displayObject,hit),this.moveWhenInside&&!hit||(this.dispatchEvent(displayObject,"pointermove",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchmove",interactionEvent),isMouse&&this.dispatchEvent(displayObject,"mousemove",interactionEvent))},InteractionManager.prototype.onPointerOut=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var event=this.normalizeToPointerData(originalEvent)[0];"mouse"===event.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,this.processInteractive(interactionEvent,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",interactionEvent),"mouse"===event.pointerType||"pen"===event.pointerType?this.emit("mouseout",interactionEvent):this.releaseInteractionDataForPointerId(interactionData.identifier)}},InteractionManager.prototype.processPointerOverOut=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,isMouse="mouse"===data.pointerType||"pen"===data.pointerType,trackingData=displayObject.trackedPointers[id];hit&&!trackingData&&(trackingData=displayObject.trackedPointers[id]=new _InteractionTrackingData2.default(id)),void 0!==trackingData&&(hit&&this.mouseOverRenderer?(trackingData.over||(trackingData.over=!0,this.dispatchEvent(displayObject,"pointerover",interactionEvent),isMouse&&this.dispatchEvent(displayObject,"mouseover",interactionEvent)),isMouse&&null===this.cursor&&(this.cursor=displayObject.cursor)):trackingData.over&&(trackingData.over=!1,this.dispatchEvent(displayObject,"pointerout",this.eventData),isMouse&&this.dispatchEvent(displayObject,"mouseout",interactionEvent),trackingData.none&&delete displayObject.trackedPointers[id]))},InteractionManager.prototype.onPointerOver=function(originalEvent){var event=this.normalizeToPointerData(originalEvent)[0],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,"mouse"===event.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",interactionEvent),"mouse"!==event.pointerType&&"pen"!==event.pointerType||this.emit("mouseover",interactionEvent)},InteractionManager.prototype.getInteractionDataForPointerId=function(event){var pointerId=event.pointerId,interactionData=void 0;return pointerId===MOUSE_POINTER_ID||"mouse"===event.pointerType?interactionData=this.mouse:this.activeInteractionData[pointerId]?interactionData=this.activeInteractionData[pointerId]:((interactionData=this.interactionDataPool.pop()||new _InteractionData2.default).identifier=pointerId,this.activeInteractionData[pointerId]=interactionData),interactionData._copyEvent(event),interactionData},InteractionManager.prototype.releaseInteractionDataForPointerId=function(pointerId){var interactionData=this.activeInteractionData[pointerId];interactionData&&(delete this.activeInteractionData[pointerId],interactionData._reset(),this.interactionDataPool.push(interactionData))},InteractionManager.prototype.configureInteractionEventForDOMEvent=function(interactionEvent,pointerEvent,interactionData){return interactionEvent.data=interactionData,this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY),navigator.isCocoonJS&&"touch"===pointerEvent.pointerType&&(interactionData.global.x=interactionData.global.x/this.resolution,interactionData.global.y=interactionData.global.y/this.resolution),"touch"===pointerEvent.pointerType&&(pointerEvent.globalX=interactionData.global.x,pointerEvent.globalY=interactionData.global.y),interactionData.originalEvent=pointerEvent,interactionEvent._reset(),interactionEvent},InteractionManager.prototype.normalizeToPointerData=function(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent)for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];void 0===touch.button&&(touch.button=event.touches.length?1:0),void 0===touch.buttons&&(touch.buttons=event.touches.length?1:0),void 0===touch.isPrimary&&(touch.isPrimary=1===event.touches.length&&"touchstart"===event.type),void 0===touch.width&&(touch.width=touch.radiusX||1),void 0===touch.height&&(touch.height=touch.radiusY||1),void 0===touch.tiltX&&(touch.tiltX=0),void 0===touch.tiltY&&(touch.tiltY=0),void 0===touch.pointerType&&(touch.pointerType="touch"),void 0===touch.pointerId&&(touch.pointerId=touch.identifier||0),void 0===touch.pressure&&(touch.pressure=touch.force||.5),touch.twist=0,touch.tangentialPressure=0,void 0===touch.layerX&&(touch.layerX=touch.offsetX=touch.clientX),void 0===touch.layerY&&(touch.layerY=touch.offsetY=touch.clientY),touch.isNormalized=!0,normalizedEvents.push(touch)}else!(event instanceof MouseEvent)||this.supportsPointerEvents&&event instanceof window.PointerEvent?normalizedEvents.push(event):(void 0===event.isPrimary&&(event.isPrimary=!0),void 0===event.width&&(event.width=1),void 0===event.height&&(event.height=1),void 0===event.tiltX&&(event.tiltX=0),void 0===event.tiltY&&(event.tiltY=0),void 0===event.pointerType&&(event.pointerType="mouse"),void 0===event.pointerId&&(event.pointerId=MOUSE_POINTER_ID),void 0===event.pressure&&(event.pressure=.5),event.twist=0,event.tangentialPressure=0,event.isNormalized=!0,normalizedEvents.push(event));return normalizedEvents},InteractionManager.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},InteractionManager}(_eventemitter2.default);exports.default=InteractionManager,core.WebGLRenderer.registerPlugin("interaction",InteractionManager),core.CanvasRenderer.registerPlugin("interaction",InteractionManager)},{"../core":85,"./InteractionData":176,"./InteractionEvent":177,"./InteractionTrackingData":179,"./interactiveTarget":181,eventemitter3:29}],179:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var InteractionTrackingData=function(){function InteractionTrackingData(pointerId){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,InteractionTrackingData),this._pointerId=pointerId,this._flags=InteractionTrackingData.FLAGS.NONE}return InteractionTrackingData.prototype._doSet=function(flag,yn){this._flags=yn?this._flags|flag:this._flags&~flag},_createClass(InteractionTrackingData,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(flags){this._flags=flags}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(yn){this._doSet(this.constructor.FLAGS.OVER,yn)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(yn){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,yn)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(yn){this._doSet(this.constructor.FLAGS.LEFT_DOWN,yn)}}]),InteractionTrackingData}();exports.default=InteractionTrackingData,InteractionTrackingData.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4})},{}],180:[function(require,module,exports){"use strict";exports.__esModule=!0;var _InteractionData=require("./InteractionData");Object.defineProperty(exports,"InteractionData",{enumerable:!0,get:function(){return _interopRequireDefault(_InteractionData).default}});var _InteractionManager=require("./InteractionManager");Object.defineProperty(exports,"InteractionManager",{enumerable:!0,get:function(){return _interopRequireDefault(_InteractionManager).default}});var _interactiveTarget=require("./interactiveTarget");Object.defineProperty(exports,"interactiveTarget",{enumerable:!0,get:function(){return _interopRequireDefault(_interactiveTarget).default}});var _InteractionTrackingData=require("./InteractionTrackingData");Object.defineProperty(exports,"InteractionTrackingData",{enumerable:!0,get:function(){return _interopRequireDefault(_InteractionTrackingData).default}});var _InteractionEvent=require("./InteractionEvent");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"InteractionEvent",{enumerable:!0,get:function(){return _interopRequireDefault(_InteractionEvent).default}})},{"./InteractionData":176,"./InteractionEvent":177,"./InteractionManager":178,"./InteractionTrackingData":179,"./interactiveTarget":181}],181:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(value){value?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0}},{}],182:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.parse=parse,exports.default=function(){return function(resource,next){if(resource.data&&resource.type===_resourceLoader.Resource.TYPE.XML)if(0!==resource.data.getElementsByTagName("page").length&&0!==resource.data.getElementsByTagName("info").length&&null!==resource.data.getElementsByTagName("info")[0].getAttribute("face")){var xmlUrl=resource.isDataUrl?"":path.dirname(resource.url);resource.isDataUrl&&("."===xmlUrl&&(xmlUrl=""),this.baseUrl&&xmlUrl&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(xmlUrl+="/")),(xmlUrl=xmlUrl.replace(this.baseUrl,""))&&"/"!==xmlUrl.charAt(xmlUrl.length-1)&&(xmlUrl+="/");var textureUrl=xmlUrl+resource.data.getElementsByTagName("page")[0].getAttribute("file");if(_core.utils.TextureCache[textureUrl])parse(resource,_core.utils.TextureCache[textureUrl]),next();else{var loadOptions={crossOrigin:resource.crossOrigin,loadType:_resourceLoader.Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata,parentResource:resource};this.add(resource.name+"_image",textureUrl,loadOptions,function(res){parse(resource,res.texture),next()})}}else next();else next()}};var path=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("path")),_core=require("../core"),_resourceLoader=require("resource-loader"),_extras=require("../extras");function parse(resource,texture){resource.bitmapFont=_extras.BitmapText.registerFont(resource.data,texture)}},{"../core":85,"../extras":161,path:42,"resource-loader":219}],183:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.shared=exports.Resource=exports.textureParser=exports.getResourcePath=exports.spritesheetParser=exports.parseBitmapFontData=exports.bitmapFontParser=exports.Loader=void 0;var _bitmapFontParser=require("./bitmapFontParser");Object.defineProperty(exports,"bitmapFontParser",{enumerable:!0,get:function(){return _interopRequireDefault(_bitmapFontParser).default}}),Object.defineProperty(exports,"parseBitmapFontData",{enumerable:!0,get:function(){return _bitmapFontParser.parse}});var _spritesheetParser=require("./spritesheetParser");Object.defineProperty(exports,"spritesheetParser",{enumerable:!0,get:function(){return _interopRequireDefault(_spritesheetParser).default}}),Object.defineProperty(exports,"getResourcePath",{enumerable:!0,get:function(){return _spritesheetParser.getResourcePath}});var _textureParser=require("./textureParser");Object.defineProperty(exports,"textureParser",{enumerable:!0,get:function(){return _interopRequireDefault(_textureParser).default}});var _resourceLoader=require("resource-loader");Object.defineProperty(exports,"Resource",{enumerable:!0,get:function(){return _resourceLoader.Resource}});var _Application2=_interopRequireDefault(require("../core/Application")),_loader2=_interopRequireDefault(require("./loader"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.Loader=_loader2.default;var shared=new _loader2.default;shared.destroy=function(){},exports.shared=shared;var AppPrototype=_Application2.default.prototype;AppPrototype._loader=null,Object.defineProperty(AppPrototype,"loader",{get:function(){if(!this._loader){var sharedLoader=this._options.sharedLoader;this._loader=sharedLoader?shared:new _loader2.default}return this._loader}}),AppPrototype._parentDestroy=AppPrototype.destroy,AppPrototype.destroy=function(removeView){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(removeView)}},{"../core/Application":63,"./bitmapFontParser":182,"./loader":184,"./spritesheetParser":185,"./textureParser":186,"resource-loader":219}],184:[function(require,module,exports){"use strict";exports.__esModule=!0;var _resourceLoader2=_interopRequireDefault(require("resource-loader")),_blob=require("resource-loader/lib/middlewares/parsing/blob"),_eventemitter2=_interopRequireDefault(require("eventemitter3")),_textureParser2=_interopRequireDefault(require("./textureParser")),_spritesheetParser2=_interopRequireDefault(require("./spritesheetParser")),_bitmapFontParser2=_interopRequireDefault(require("./bitmapFontParser"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Loader=function(_ResourceLoader){function Loader(baseUrl,concurrency){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Loader);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_ResourceLoader.call(this,baseUrl,concurrency));_eventemitter2.default.call(_this);for(var i=0;i<Loader._pixiMiddleware.length;++i)_this.use(Loader._pixiMiddleware[i]());return _this.onStart.add(function(l){return _this.emit("start",l)}),_this.onProgress.add(function(l,r){return _this.emit("progress",l,r)}),_this.onError.add(function(e,l,r){return _this.emit("error",e,l,r)}),_this.onLoad.add(function(l,r){return _this.emit("load",l,r)}),_this.onComplete.add(function(l,r){return _this.emit("complete",l,r)}),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Loader,_ResourceLoader),Loader.addPixiMiddleware=function(fn){Loader._pixiMiddleware.push(fn)},Loader.prototype.destroy=function(){this.removeAllListeners(),this.reset()},Loader}(_resourceLoader2.default);for(var k in exports.default=Loader,_eventemitter2.default.prototype)Loader.prototype[k]=_eventemitter2.default.prototype[k];Loader._pixiMiddleware=[_blob.blobMiddlewareFactory,_textureParser2.default,_spritesheetParser2.default,_bitmapFontParser2.default];var Resource=_resourceLoader2.default.Resource;Resource.setExtensionXhrType("fnt",Resource.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":182,"./spritesheetParser":185,"./textureParser":186,eventemitter3:29,"resource-loader":219,"resource-loader/lib/middlewares/parsing/blob":220}],185:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(){return function(resource,next){var imageResourceName=resource.name+"_image";if(resource.data&&resource.type===_resourceLoader.Resource.TYPE.JSON&&resource.data.frames&&!this.resources[imageResourceName]){var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource},resourcePath=getResourcePath(resource,this.baseUrl);this.add(imageResourceName,resourcePath,loadOptions,function(res){if(res.error)next(res.error);else{var spritesheet=new _core.Spritesheet(res.texture.baseTexture,resource.data,resource.url);spritesheet.parse(function(){resource.spritesheet=spritesheet,resource.textures=spritesheet.textures,next()})}})}else next()}},exports.getResourcePath=getResourcePath;var obj,_resourceLoader=require("resource-loader"),_url=require("url"),_url2=(obj=_url)&&obj.__esModule?obj:{default:obj},_core=require("../core");function getResourcePath(resource,baseUrl){return resource.isDataUrl?resource.data.meta.image:_url2.default.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)}},{"../core":85,"resource-loader":219,url:233}],186:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=function(){return function(resource,next){resource.data&&resource.type===_resourceLoader.Resource.TYPE.IMAGE&&(resource.texture=_Texture2.default.fromLoader(resource.data,resource.url,resource.name)),next()}};var obj,_resourceLoader=require("resource-loader"),_Texture=require("../core/textures/Texture"),_Texture2=(obj=_Texture)&&obj.__esModule?obj:{default:obj}},{"../core/textures/Texture":135,"resource-loader":219}],187:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_Texture=require("../core/textures/Texture"),_Texture2=(obj=_Texture)&&obj.__esModule?obj:{default:obj};var tempPoint=new core.Point,tempPolygon=new core.Polygon,Mesh=function(_core$Container){function Mesh(texture,vertices,uvs,indices,drawMode){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Mesh);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Container.call(this));return _this._texture=texture||_Texture2.default.EMPTY,_this.uvs=uvs||new Float32Array([0,0,1,0,1,1,0,1]),_this.vertices=vertices||new Float32Array([0,0,100,0,100,100,0,100]),_this.indices=indices||new Uint16Array([0,1,3,2]),_this.dirty=0,_this.indexDirty=0,_this.blendMode=core.BLEND_MODES.NORMAL,_this.canvasPadding=core.settings.MESH_CANVAS_PADDING,_this.drawMode=drawMode||Mesh.DRAW_MODES.TRIANGLE_MESH,_this.shader=null,_this.tintRgb=new Float32Array([1,1,1]),_this._glDatas={},_this._uvTransform=new core.TextureMatrix(_this._texture),_this.uploadUvTransform=!1,_this.pluginName="mesh",_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Mesh,_core$Container),Mesh.prototype._renderWebGL=function(renderer){this.refresh(),renderer.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this)},Mesh.prototype._renderCanvas=function(renderer){this.refresh(),renderer.plugins[this.pluginName].render(this)},Mesh.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},Mesh.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},Mesh.prototype.refresh=function(forceUpdate){this._uvTransform.update(forceUpdate)&&this._refresh()},Mesh.prototype._refresh=function(){},Mesh.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},Mesh.prototype.containsPoint=function(point){if(!this.getBounds().contains(point.x,point.y))return!1;this.worldTransform.applyInverse(point,tempPoint);for(var vertices=this.vertices,points=tempPolygon.points,indices=this.indices,len=this.indices.length,step=this.drawMode===Mesh.DRAW_MODES.TRIANGLES?3:1,i=0;i+2<len;i+=step){var ind0=2*indices[i],ind1=2*indices[i+1],ind2=2*indices[i+2];if(points[0]=vertices[ind0],points[1]=vertices[ind0+1],points[2]=vertices[ind1],points[3]=vertices[ind1+1],points[4]=vertices[ind2],points[5]=vertices[ind2+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1},_createClass(Mesh,[{key:"texture",get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture=value,value&&(value.baseTexture.hasLoaded?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return core.utils.rgb2hex(this.tintRgb)},set:function(value){this.tintRgb=core.utils.hex2rgb(value,this.tintRgb)}}]),Mesh}(core.Container);exports.default=Mesh,Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":85,"../core/textures/Texture":135}],188:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Plane2=require("./Plane");var DEFAULT_BORDER_SIZE=10,NineSlicePlane=function(_Plane){function NineSlicePlane(texture,leftWidth,topHeight,rightWidth,bottomHeight){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NineSlicePlane);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Plane.call(this,texture,4,4));return _this._origWidth=texture.orig.width,_this._origHeight=texture.orig.height,_this._width=_this._origWidth,_this._height=_this._origHeight,_this.leftWidth=void 0!==leftWidth?leftWidth:DEFAULT_BORDER_SIZE,_this.rightWidth=void 0!==rightWidth?rightWidth:DEFAULT_BORDER_SIZE,_this.topHeight=void 0!==topHeight?topHeight:DEFAULT_BORDER_SIZE,_this.bottomHeight=void 0!==bottomHeight?bottomHeight:DEFAULT_BORDER_SIZE,_this.refresh(!0),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(NineSlicePlane,_Plane),NineSlicePlane.prototype.updateHorizontalVertices=function(){var vertices=this.vertices;vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight,vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight,vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height},NineSlicePlane.prototype.updateVerticalVertices=function(){var vertices=this.vertices;vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth,vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth,vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width},NineSlicePlane.prototype._renderCanvas=function(renderer){var context=renderer.context;context.globalAlpha=this.worldAlpha,renderer.setBlendMode(this.blendMode);var transform=this.worldTransform,res=renderer.resolution;renderer.roundPixels?context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0):context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res);var base=this._texture.baseTexture,textureSource=base.source,w=base.width*base.resolution,h=base.height*base.resolution;this.drawSegment(context,textureSource,w,h,0,1,10,11),this.drawSegment(context,textureSource,w,h,2,3,12,13),this.drawSegment(context,textureSource,w,h,4,5,14,15),this.drawSegment(context,textureSource,w,h,8,9,18,19),this.drawSegment(context,textureSource,w,h,10,11,20,21),this.drawSegment(context,textureSource,w,h,12,13,22,23),this.drawSegment(context,textureSource,w,h,16,17,26,27),this.drawSegment(context,textureSource,w,h,18,19,28,29),this.drawSegment(context,textureSource,w,h,20,21,30,31)},NineSlicePlane.prototype.drawSegment=function(context,textureSource,w,h,x1,y1,x2,y2){var uvs=this.uvs,vertices=this.vertices,sw=(uvs[x2]-uvs[x1])*w,sh=(uvs[y2]-uvs[y1])*h,dw=vertices[x2]-vertices[x1],dh=vertices[y2]-vertices[y1];sw<1&&(sw=1),sh<1&&(sh=1),dw<1&&(dw=1),dh<1&&(dh=1),context.drawImage(textureSource,uvs[x1]*w,uvs[y1]*h,sw,sh,vertices[x1],vertices[y1],dw,dh)},NineSlicePlane.prototype._refresh=function(){_Plane.prototype._refresh.call(this);var uvs=this.uvs,texture=this._texture;this._origWidth=texture.orig.width,this._origHeight=texture.orig.height;var _uvw=1/this._origWidth,_uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0,uvs[1]=uvs[3]=uvs[5]=uvs[7]=0,uvs[6]=uvs[14]=uvs[22]=uvs[30]=1,uvs[25]=uvs[27]=uvs[29]=uvs[31]=1,uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth,uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth,uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight,uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},_createClass(NineSlicePlane,[{key:"width",get:function(){return this._width},set:function(value){this._width=value,this._refresh()}},{key:"height",get:function(){return this._height},set:function(value){this._height=value,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(value){this._leftWidth=value,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(value){this._rightWidth=value,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(value){this._topHeight=value,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(value){this._bottomHeight=value,this._refresh()}}]),NineSlicePlane}(((obj=_Plane2)&&obj.__esModule?obj:{default:obj}).default);exports.default=NineSlicePlane},{"./Plane":189}],189:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Mesh2=require("./Mesh"),_Mesh3=(obj=_Mesh2)&&obj.__esModule?obj:{default:obj};var Plane=function(_Mesh){function Plane(texture,verticesX,verticesY){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Plane);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Mesh.call(this,texture));return _this._ready=!0,_this.verticesX=verticesX||10,_this.verticesY=verticesY||10,_this.drawMode=_Mesh3.default.DRAW_MODES.TRIANGLES,_this.refresh(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Plane,_Mesh),Plane.prototype._refresh=function(){for(var texture=this._texture,total=this.verticesX*this.verticesY,verts=[],uvs=[],indices=[],segmentsX=this.verticesX-1,segmentsY=this.verticesY-1,sizeX=texture.width/segmentsX,sizeY=texture.height/segmentsY,i=0;i<total;i++){var x=i%this.verticesX,y=i/this.verticesX|0;verts.push(x*sizeX,y*sizeY),uvs.push(x/segmentsX,y/segmentsY)}for(var totalSub=segmentsX*segmentsY,_i=0;_i<totalSub;_i++){var xpos=_i%segmentsX,ypos=_i/segmentsX|0,value=ypos*this.verticesX+xpos,value2=ypos*this.verticesX+xpos+1,value3=(ypos+1)*this.verticesX+xpos,value4=(ypos+1)*this.verticesX+xpos+1;indices.push(value,value2,value3),indices.push(value2,value4,value3)}this.vertices=new Float32Array(verts),this.uvs=new Float32Array(uvs),this.colors=new Float32Array([]),this.indices=new Uint16Array(indices),this.dirty++,this.indexDirty++,this.multiplyUvs()},Plane.prototype._onTextureUpdate=function(){_Mesh3.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},Plane}(_Mesh3.default);exports.default=Plane},{"./Mesh":187}],190:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Mesh2=require("./Mesh");var Rope=function(_Mesh){function Rope(texture,points){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Rope);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Mesh.call(this,texture));return _this.points=points,_this.vertices=new Float32Array(4*points.length),_this.uvs=new Float32Array(4*points.length),_this.colors=new Float32Array(2*points.length),_this.indices=new Uint16Array(2*points.length),_this.autoUpdate=!0,_this.refresh(),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(Rope,_Mesh),Rope.prototype._refresh=function(){var points=this.points;if(!(points.length<1)&&this._texture._uvs){this.vertices.length/4!==points.length&&(this.vertices=new Float32Array(4*points.length),this.uvs=new Float32Array(4*points.length),this.colors=new Float32Array(2*points.length),this.indices=new Uint16Array(2*points.length));var uvs=this.uvs,indices=this.indices,colors=this.colors;uvs[0]=0,uvs[1]=0,uvs[2]=0,uvs[3]=1,colors[0]=1,colors[1]=1,indices[0]=0,indices[1]=1;for(var total=points.length,i=1;i<total;i++){var index=4*i,amount=i/(total-1);uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1,colors[index=2*i]=1,colors[index+1]=1,indices[index=2*i]=index,indices[index+1]=index+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},Rope.prototype.refreshVertices=function(){var points=this.points;if(!(points.length<1))for(var lastPoint=points[0],nextPoint=void 0,perpX=0,perpY=0,vertices=this.vertices,total=points.length,i=0;i<total;i++){var point=points[i],index=4*i;perpY=-((nextPoint=i<points.length-1?points[i+1]:point).x-lastPoint.x),perpX=nextPoint.y-lastPoint.y;var ratio=10*(1-i/(total-1));ratio>1&&(ratio=1);var perpLength=Math.sqrt(perpX*perpX+perpY*perpY),num=this._texture.height/2;perpX/=perpLength,perpY/=perpLength,perpX*=num,perpY*=num,vertices[index]=point.x+perpX,vertices[index+1]=point.y+perpY,vertices[index+2]=point.x-perpX,vertices[index+3]=point.y-perpY,lastPoint=point}},Rope.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},Rope}(((obj=_Mesh2)&&obj.__esModule?obj:{default:obj}).default);exports.default=Rope},{"./Mesh":187}],191:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_Mesh=require("../Mesh"),_Mesh2=(obj=_Mesh)&&obj.__esModule?obj:{default:obj};var MeshSpriteRenderer=function(){function MeshSpriteRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeshSpriteRenderer),this.renderer=renderer}return MeshSpriteRenderer.prototype.render=function(mesh){var renderer=this.renderer,context=renderer.context,transform=mesh.worldTransform,res=renderer.resolution;renderer.roundPixels?context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0):context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res),renderer.context.globalAlpha=mesh.worldAlpha,renderer.setBlendMode(mesh.blendMode),mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(mesh):this._renderTriangles(mesh)},MeshSpriteRenderer.prototype._renderTriangleMesh=function(mesh){for(var length=mesh.vertices.length/2,i=0;i<length-2;i++){var index=2*i;this._renderDrawTriangle(mesh,index,index+2,index+4)}},MeshSpriteRenderer.prototype._renderTriangles=function(mesh){for(var indices=mesh.indices,length=indices.length,i=0;i<length;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];this._renderDrawTriangle(mesh,index0,index1,index2)}},MeshSpriteRenderer.prototype._renderDrawTriangle=function(mesh,index0,index1,index2){var context=this.renderer.context,uvs=mesh.uvs,vertices=mesh.vertices,texture=mesh._texture;if(texture.valid){var base=texture.baseTexture,textureSource=base.source,textureWidth=base.width,textureHeight=base.height,u0=void 0,u1=void 0,u2=void 0,v0=void 0,v1=void 0,v2=void 0;if(mesh.uploadUvTransform){var ut=mesh._uvTransform.mapCoord;u0=(uvs[index0]*ut.a+uvs[index0+1]*ut.c+ut.tx)*base.width,u1=(uvs[index1]*ut.a+uvs[index1+1]*ut.c+ut.tx)*base.width,u2=(uvs[index2]*ut.a+uvs[index2+1]*ut.c+ut.tx)*base.width,v0=(uvs[index0]*ut.b+uvs[index0+1]*ut.d+ut.ty)*base.height,v1=(uvs[index1]*ut.b+uvs[index1+1]*ut.d+ut.ty)*base.height,v2=(uvs[index2]*ut.b+uvs[index2+1]*ut.d+ut.ty)*base.height}else u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index2]*base.width,v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index2+1]*base.height;var x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1],canvasPadding=mesh.canvasPadding/this.renderer.resolution;if(canvasPadding>0){var paddingX=canvasPadding/Math.abs(mesh.worldTransform.a),paddingY=canvasPadding/Math.abs(mesh.worldTransform.d),centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX),y0=centerY+normY/dist*(dist+paddingY),normY=y1-centerY,x1=centerX+(normX=x1-centerX)/(dist=Math.sqrt(normX*normX+normY*normY))*(dist+paddingX),y1=centerY+normY/dist*(dist+paddingY),normY=y2-centerY,x2=centerX+(normX=x2-centerX)/(dist=Math.sqrt(normX*normX+normY*normY))*(dist+paddingX),y2=centerY+normY/dist*(dist+paddingY)}context.save(),context.beginPath(),context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.closePath(),context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight),context.restore(),this.renderer.invalidateBlendMode()}},MeshSpriteRenderer.prototype.renderMeshFlat=function(mesh){var context=this.renderer.context,vertices=mesh.vertices,length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;++i){var index=2*i,x0=vertices[index],y0=vertices[index+1],x1=vertices[index+2],y1=vertices[index+3],x2=vertices[index+4],y2=vertices[index+5];context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2)}context.fillStyle="#FF0000",context.fill(),context.closePath()},MeshSpriteRenderer.prototype.destroy=function(){this.renderer=null},MeshSpriteRenderer}();exports.default=MeshSpriteRenderer,core.CanvasRenderer.registerPlugin("mesh",MeshSpriteRenderer)},{"../../core":85,"../Mesh":187}],192:[function(require,module,exports){"use strict";exports.__esModule=!0;var _Mesh=require("./Mesh");Object.defineProperty(exports,"Mesh",{enumerable:!0,get:function(){return _interopRequireDefault(_Mesh).default}});var _MeshRenderer=require("./webgl/MeshRenderer");Object.defineProperty(exports,"MeshRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_MeshRenderer).default}});var _CanvasMeshRenderer=require("./canvas/CanvasMeshRenderer");Object.defineProperty(exports,"CanvasMeshRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasMeshRenderer).default}});var _Plane=require("./Plane");Object.defineProperty(exports,"Plane",{enumerable:!0,get:function(){return _interopRequireDefault(_Plane).default}});var _NineSlicePlane=require("./NineSlicePlane");Object.defineProperty(exports,"NineSlicePlane",{enumerable:!0,get:function(){return _interopRequireDefault(_NineSlicePlane).default}});var _Rope=require("./Rope");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"Rope",{enumerable:!0,get:function(){return _interopRequireDefault(_Rope).default}})},{"./Mesh":187,"./NineSlicePlane":188,"./Plane":189,"./Rope":190,"./canvas/CanvasMeshRenderer":191,"./webgl/MeshRenderer":193}],193:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_pixiGlCore2=_interopRequireDefault(require("pixi-gl-core")),_Mesh2=_interopRequireDefault(require("../Mesh"));require("path");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var matrixIdentity=core.Matrix.IDENTITY,MeshRenderer=function(_core$ObjectRenderer){function MeshRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MeshRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$ObjectRenderer.call(this,renderer));return _this.shader=null,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(MeshRenderer,_core$ObjectRenderer),MeshRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=new core.Shader(gl,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},MeshRenderer.prototype.render=function(mesh){var renderer=this.renderer,gl=renderer.gl,texture=mesh._texture;if(texture.valid){var glData=mesh._glDatas[renderer.CONTEXT_UID];glData||(renderer.bindVao(null),(glData={shader:this.shader,vertexBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.vertices,gl.STREAM_DRAW),uvBuffer:_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,mesh.uvs,gl.STREAM_DRAW),indexBuffer:_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,mesh.indices,gl.STATIC_DRAW),vao:null,dirty:mesh.dirty,indexDirty:mesh.indexDirty}).vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(glData.indexBuffer).addAttribute(glData.vertexBuffer,glData.shader.attributes.aVertexPosition,gl.FLOAT,!1,8,0).addAttribute(glData.uvBuffer,glData.shader.attributes.aTextureCoord,gl.FLOAT,!1,8,0),mesh._glDatas[renderer.CONTEXT_UID]=glData),renderer.bindVao(glData.vao),mesh.dirty!==glData.dirty&&(glData.dirty=mesh.dirty,glData.uvBuffer.upload(mesh.uvs)),mesh.indexDirty!==glData.indexDirty&&(glData.indexDirty=mesh.indexDirty,glData.indexBuffer.upload(mesh.indices)),glData.vertexBuffer.upload(mesh.vertices),renderer.bindShader(glData.shader),glData.shader.uniforms.uSampler=renderer.bindTexture(texture),renderer.state.setBlendMode(core.utils.correctBlendMode(mesh.blendMode,texture.baseTexture.premultipliedAlpha)),glData.shader.uniforms.uTransform&&(mesh.uploadUvTransform?glData.shader.uniforms.uTransform=mesh._uvTransform.mapCoord.toArray(!0):glData.shader.uniforms.uTransform=matrixIdentity.toArray(!0)),glData.shader.uniforms.translationMatrix=mesh.worldTransform.toArray(!0),glData.shader.uniforms.uColor=core.utils.premultiplyRgba(mesh.tintRgb,mesh.worldAlpha,glData.shader.uniforms.uColor,texture.baseTexture.premultipliedAlpha);var drawMode=mesh.drawMode===_Mesh2.default.DRAW_MODES.TRIANGLE_MESH?gl.TRIANGLE_STRIP:gl.TRIANGLES;glData.vao.draw(drawMode,mesh.indices.length,0)}},MeshRenderer}(core.ObjectRenderer);exports.default=MeshRenderer,core.WebGLRenderer.registerPlugin("mesh",MeshRenderer)},{"../../core":85,"../Mesh":187,path:42,"pixi-gl-core":49}],194:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_utils=require("../core/utils");var ParticleContainer=function(_core$Container){function ParticleContainer(){var maxSize=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,properties=arguments[1],batchSize=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,autoResize=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParticleContainer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$Container.call(this));return batchSize>16384&&(batchSize=16384),batchSize>maxSize&&(batchSize=maxSize),_this._properties=[!1,!0,!1,!1,!1],_this._maxSize=maxSize,_this._batchSize=batchSize,_this._glBuffers={},_this._bufferToUpdate=0,_this.interactiveChildren=!1,_this.blendMode=core.BLEND_MODES.NORMAL,_this.autoResize=autoResize,_this.roundPixels=!0,_this.baseTexture=null,_this.setProperties(properties),_this._tint=0,_this.tintRgb=new Float32Array(4),_this.tint=16777215,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ParticleContainer,_core$Container),ParticleContainer.prototype.setProperties=function(properties){properties&&(this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0],this._properties[1]="position"in properties?!!properties.position:this._properties[1],this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2],this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3],this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4])},ParticleContainer.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},ParticleContainer.prototype.renderWebGL=function(renderer){var _this2=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return _this2.onChildrenChange(0)})),renderer.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))},ParticleContainer.prototype.onChildrenChange=function(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);bufferIndex<this._bufferToUpdate&&(this._bufferToUpdate=bufferIndex)},ParticleContainer.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var context=renderer.context,transform=this.worldTransform,isRotated=!0,positionX=0,positionY=0,finalWidth=0,finalHeight=0;renderer.setBlendMode(this.blendMode),context.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(child.visible){var frame=child._texture.frame;if(context.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(2*Math.PI)==0)isRotated&&(context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx*renderer.resolution,transform.ty*renderer.resolution),isRotated=!1),positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5,positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5,finalWidth=frame.width*child.scale.x,finalHeight=frame.height*child.scale.y;else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderer.roundPixels?context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution|0,childTransform.ty*renderer.resolution|0):context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx*renderer.resolution,childTransform.ty*renderer.resolution),positionX=child.anchor.x*-frame.width+.5,positionY=child.anchor.y*-frame.height+.5,finalWidth=frame.width,finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context.drawImage(child._texture.baseTexture.source,frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}}}},ParticleContainer.prototype.destroy=function(options){if(_core$Container.prototype.destroy.call(this,options),this._buffers)for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._properties=null,this._buffers=null},_createClass(ParticleContainer,[{key:"tint",get:function(){return this._tint},set:function(value){this._tint=value,(0,_utils.hex2rgb)(value,this.tintRgb)}}]),ParticleContainer}(core.Container);exports.default=ParticleContainer},{"../core":85,"../core/utils":145}],195:[function(require,module,exports){"use strict";exports.__esModule=!0;var _ParticleContainer=require("./ParticleContainer");Object.defineProperty(exports,"ParticleContainer",{enumerable:!0,get:function(){return _interopRequireDefault(_ParticleContainer).default}});var _ParticleRenderer=require("./webgl/ParticleRenderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"ParticleRenderer",{enumerable:!0,get:function(){return _interopRequireDefault(_ParticleRenderer).default}})},{"./ParticleContainer":194,"./webgl/ParticleRenderer":197}],196:[function(require,module,exports){"use strict";exports.__esModule=!0;var _pixiGlCore2=_interopRequireDefault(require("pixi-gl-core")),_createIndicesForQuads2=_interopRequireDefault(require("../../core/utils/createIndicesForQuads"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ParticleBuffer=function(){function ParticleBuffer(gl,properties,dynamicPropertyFlags,size){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParticleBuffer),this.gl=gl,this.size=size,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attribute:property.attribute,size:property.size,uploadFunction:property.uploadFunction,unsignedByte:property.unsignedByte,offset:property.offset},dynamicPropertyFlags[i]?this.dynamicProperties.push(property):this.staticProperties.push(property)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.initBuffers()}return ParticleBuffer.prototype.initBuffers=function(){var gl=this.gl,dynamicOffset=0;this.indices=(0,_createIndicesForQuads2.default)(this.size),this.indexBuffer=_pixiGlCore2.default.GLBuffer.createIndexBuffer(gl,this.indices,gl.STATIC_DRAW),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];property.offset=dynamicOffset,dynamicOffset+=property.size,this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer),this.dynamicDataUint32=new Uint32Array(dynBuffer),this.dynamicBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,dynBuffer,gl.STREAM_DRAW);var staticOffset=0;this.staticStride=0;for(var _i=0;_i<this.staticProperties.length;++_i){var _property=this.staticProperties[_i];_property.offset=staticOffset,staticOffset+=_property.size,this.staticStride+=_property.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer),this.staticDataUint32=new Uint32Array(statBuffer),this.staticBuffer=_pixiGlCore2.default.GLBuffer.createVertexBuffer(gl,statBuffer,gl.STATIC_DRAW),this.vao=new _pixiGlCore2.default.VertexArrayObject(gl).addIndex(this.indexBuffer);for(var _i2=0;_i2<this.dynamicProperties.length;++_i2){var _property2=this.dynamicProperties[_i2];_property2.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*_property2.offset):this.vao.addAttribute(this.dynamicBuffer,_property2.attribute,gl.FLOAT,!1,4*this.dynamicStride,4*_property2.offset)}for(var _i3=0;_i3<this.staticProperties.length;++_i3){var _property3=this.staticProperties[_i3];_property3.unsignedByte?this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.UNSIGNED_BYTE,!0,4*this.staticStride,4*_property3.offset):this.vao.addAttribute(this.staticBuffer,_property3.attribute,gl.FLOAT,!1,4*this.staticStride,4*_property3.offset)}},ParticleBuffer.prototype.uploadDynamic=function(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer.upload()},ParticleBuffer.prototype.uploadStatic=function(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer.upload()},ParticleBuffer.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},ParticleBuffer}();exports.default=ParticleBuffer},{"../../core/utils/createIndicesForQuads":143,"pixi-gl-core":49}],197:[function(require,module,exports){"use strict";exports.__esModule=!0;var core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_ParticleShader2=_interopRequireDefault(require("./ParticleShader")),_ParticleBuffer2=_interopRequireDefault(require("./ParticleBuffer")),_utils=require("../../core/utils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ParticleRenderer=function(_core$ObjectRenderer){function ParticleRenderer(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParticleRenderer);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_core$ObjectRenderer.call(this,renderer));return _this.shader=null,_this.indexBuffer=null,_this.properties=null,_this.tempMatrix=new core.Matrix,_this.CONTEXT_UID=0,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ParticleRenderer,_core$ObjectRenderer),ParticleRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new _ParticleShader2.default(gl),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},ParticleRenderer.prototype.start=function(){this.renderer.bindShader(this.shader)},ParticleRenderer.prototype.render=function(container){var children=container.children,maxSize=container._maxSize,batchSize=container._batchSize,renderer=this.renderer,totalChildren=children.length;if(0!==totalChildren){totalChildren>maxSize&&(totalChildren=maxSize);var buffers=container._glBuffers[renderer.CONTEXT_UID];buffers||(buffers=container._glBuffers[renderer.CONTEXT_UID]=this.generateBuffers(container));var baseTexture=children[0]._texture.baseTexture;this.renderer.setBlendMode(core.utils.correctBlendMode(container.blendMode,baseTexture.premultipliedAlpha));var gl=renderer.gl,m=container.worldTransform.copy(this.tempMatrix);m.prepend(renderer._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=m.toArray(!0),this.shader.uniforms.uColor=core.utils.premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.premultipliedAlpha),this.shader.uniforms.uSampler=renderer.bindTexture(baseTexture);for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize&&(amount=batchSize),j>=buffers.length){if(!container.autoResize)break;buffers.push(this._generateOneMoreBuffer(container))}var buffer=buffers[j];buffer.uploadDynamic(children,i,amount),container._bufferToUpdate===j&&(buffer.uploadStatic(children,i,amount),container._bufferToUpdate=j+1),renderer.bindVao(buffer.vao),buffer.vao.draw(gl.TRIANGLES,6*amount)}}},ParticleRenderer.prototype.generateBuffers=function(container){for(var gl=this.renderer.gl,buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties,i=0;i<size;i+=batchSize)buffers.push(new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize));return buffers},ParticleRenderer.prototype._generateOneMoreBuffer=function(container){var gl=this.renderer.gl,batchSize=container._batchSize,dynamicPropertyFlags=container._properties;return new _ParticleBuffer2.default(gl,this.properties,dynamicPropertyFlags,batchSize)},ParticleRenderer.prototype.uploadVertices=function(children,startIndex,amount,array,stride,offset){for(var w0=0,w1=0,h0=0,h1=0,i=0;i<amount;++i){var sprite=children[startIndex+i],texture=sprite._texture,sx=sprite.scale.x,sy=sprite.scale.y,trim=texture.trim,orig=texture.orig;trim?(w0=(w1=trim.x-sprite.anchor.x*orig.width)+trim.width,h0=(h1=trim.y-sprite.anchor.y*orig.height)+trim.height):(w0=orig.width*(1-sprite.anchor.x),w1=orig.width*-sprite.anchor.x,h0=orig.height*(1-sprite.anchor.y),h1=orig.height*-sprite.anchor.y),array[offset]=w1*sx,array[offset+1]=h1*sy,array[offset+stride]=w0*sx,array[offset+stride+1]=h1*sy,array[offset+2*stride]=w0*sx,array[offset+2*stride+1]=h0*sy,array[offset+3*stride]=w1*sx,array[offset+3*stride+1]=h0*sy,offset+=4*stride}},ParticleRenderer.prototype.uploadPosition=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x,array[offset+1]=spritePosition.y,array[offset+stride]=spritePosition.x,array[offset+stride+1]=spritePosition.y,array[offset+2*stride]=spritePosition.x,array[offset+2*stride+1]=spritePosition.y,array[offset+3*stride]=spritePosition.x,array[offset+3*stride+1]=spritePosition.y,offset+=4*stride}},ParticleRenderer.prototype.uploadRotation=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation,array[offset+stride]=spriteRotation,array[offset+2*stride]=spriteRotation,array[offset+3*stride]=spriteRotation,offset+=4*stride}},ParticleRenderer.prototype.uploadUvs=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;textureUvs?(array[offset]=textureUvs.x0,array[offset+1]=textureUvs.y0,array[offset+stride]=textureUvs.x1,array[offset+stride+1]=textureUvs.y1,array[offset+2*stride]=textureUvs.x2,array[offset+2*stride+1]=textureUvs.y2,array[offset+3*stride]=textureUvs.x3,array[offset+3*stride+1]=textureUvs.y3,offset+=4*stride):(array[offset]=0,array[offset+1]=0,array[offset+stride]=0,array[offset+stride+1]=0,array[offset+2*stride]=0,array[offset+2*stride+1]=0,array[offset+3*stride]=0,array[offset+3*stride+1]=0,offset+=4*stride)}},ParticleRenderer.prototype.uploadTint=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i],premultiplied=sprite._texture.baseTexture.premultipliedAlpha,alpha=sprite.alpha,argb=alpha<1&&premultiplied?(0,_utils.premultiplyTint)(sprite._tintRGB,alpha):sprite._tintRGB+(255*alpha<<24);array[offset]=argb,array[offset+stride]=argb,array[offset+2*stride]=argb,array[offset+3*stride]=argb,offset+=4*stride}},ParticleRenderer.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),_core$ObjectRenderer.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},ParticleRenderer}(core.ObjectRenderer);exports.default=ParticleRenderer,core.WebGLRenderer.registerPlugin("particle",ParticleRenderer)},{"../../core":85,"../../core/utils":145,"./ParticleBuffer":196,"./ParticleShader":198}],198:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,_Shader2=require("../../core/Shader");var ParticleShader=function(_Shader){function ParticleShader(gl){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ParticleShader),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_Shader.call(this,gl,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(ParticleShader,_Shader),ParticleShader}(((obj=_Shader2)&&obj.__esModule?obj:{default:obj}).default);exports.default=ParticleShader},{"../../core/Shader":64}],199:[function(require,module,exports){"use strict";Math.sign||(Math.sign=function(x){return 0===(x=Number(x))||isNaN(x)?x:x>0?1:-1})},{}],200:[function(require,module,exports){"use strict";var obj,_objectAssign=require("object-assign"),_objectAssign2=(obj=_objectAssign)&&obj.__esModule?obj:{default:obj};Object.assign||(Object.assign=_objectAssign2.default)},{"object-assign":38}],201:[function(require,module,exports){"use strict";require("./Object.assign"),require("./requestAnimationFrame"),require("./Math.sign"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},{"./Math.sign":199,"./Object.assign":200,"./requestAnimationFrame":202}],202:[function(require,module,exports){(function(global){"use strict";if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!global.performance||!global.performance.now){var startTime=Date.now();global.performance||(global.performance={}),global.performance.now=function(){return Date.now()-startTime}}for(var lastTime=Date.now(),vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!global.requestAnimationFrame;++x){var p=vendors[x];global.requestAnimationFrame=global[p+"RequestAnimationFrame"],global.cancelAnimationFrame=global[p+"CancelAnimationFrame"]||global[p+"CancelRequestAnimationFrame"]}global.requestAnimationFrame||(global.requestAnimationFrame=function(callback){if("function"!=typeof callback)throw new TypeError(callback+"is not a function");var currentTime=Date.now(),delay=16+lastTime-currentTime;return delay<0&&(delay=0),lastTime=currentTime,setTimeout(function(){lastTime=Date.now(),callback(performance.now())},delay)}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(id){return clearTimeout(id)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],203:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../core")),_CountLimiter=require("./limiters/CountLimiter"),_CountLimiter2=(obj=_CountLimiter)&&obj.__esModule?obj:{default:obj};var SharedTicker=core.ticker.shared;core.settings.UPLOADS_PER_FRAME=4;var BasePrepare=function(){function BasePrepare(renderer){var _this=this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BasePrepare),this.limiter=new _CountLimiter2.default(core.settings.UPLOADS_PER_FRAME),this.renderer=renderer,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){_this.queue&&_this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return BasePrepare.prototype.upload=function(item,done){"function"==typeof item&&(done=item,item=null),item&&this.add(item),this.queue.length?(done&&this.completes.push(done),this.ticking||(this.ticking=!0,SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY))):done&&done()},BasePrepare.prototype.tick=function(){setTimeout(this.delayedTick,0)},BasePrepare.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var item=this.queue[0],uploaded=!1;if(item&&!item._destroyed)for(var i=0,len=this.uploadHooks.length;i<len;i++)if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift(),uploaded=!0;break}uploaded||this.queue.shift()}if(this.queue.length)SharedTicker.addOnce(this.tick,this,core.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var completes=this.completes.slice(0);this.completes.length=0;for(var _i=0,_len=completes.length;_i<_len;_i++)completes[_i]()}},BasePrepare.prototype.registerFindHook=function(addHook){return addHook&&this.addHooks.push(addHook),this},BasePrepare.prototype.registerUploadHook=function(uploadHook){return uploadHook&&this.uploadHooks.push(uploadHook),this},BasePrepare.prototype.add=function(item){for(var i=0,len=this.addHooks.length;i<len&&!this.addHooks[i](item,this.queue);i++);if(item instanceof core.Container)for(var _i2=item.children.length-1;_i2>=0;_i2--)this.add(item.children[_i2]);return this},BasePrepare.prototype.destroy=function(){this.ticking&&SharedTicker.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},BasePrepare}();function findMultipleBaseTextures(item,queue){var result=!1;if(item&&item._textures&&item._textures.length)for(var i=0;i<item._textures.length;i++)if(item._textures[i]instanceof core.Texture){var baseTexture=item._textures[i].baseTexture;-1===queue.indexOf(baseTexture)&&(queue.push(baseTexture),result=!0)}return result}function findBaseTexture(item,queue){return item instanceof core.BaseTexture&&(-1===queue.indexOf(item)&&queue.push(item),!0)}function findTexture(item,queue){if(item._texture&&item._texture instanceof core.Texture){var texture=item._texture.baseTexture;return-1===queue.indexOf(texture)&&queue.push(texture),!0}return!1}function drawText(helper,item){return item instanceof core.Text&&(item.updateText(!0),!0)}function calculateTextStyle(helper,item){if(item instanceof core.TextStyle){var font=item.toFontString();return core.TextMetrics.measureFont(font),!0}return!1}function findText(item,queue){if(item instanceof core.Text){-1===queue.indexOf(item.style)&&queue.push(item.style),-1===queue.indexOf(item)&&queue.push(item);var texture=item._texture.baseTexture;return-1===queue.indexOf(texture)&&queue.push(texture),!0}return!1}function findTextStyle(item,queue){return item instanceof core.TextStyle&&(-1===queue.indexOf(item)&&queue.push(item),!0)}exports.default=BasePrepare},{"../core":85,"./limiters/CountLimiter":206}],204:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_BasePrepare2=require("../BasePrepare");var CANVAS_START_SIZE=16,CanvasPrepare=function(_BasePrepare){function CanvasPrepare(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CanvasPrepare);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_BasePrepare.call(this,renderer));return _this.uploadHookHelper=_this,_this.canvas=document.createElement("canvas"),_this.canvas.width=CANVAS_START_SIZE,_this.canvas.height=CANVAS_START_SIZE,_this.ctx=_this.canvas.getContext("2d"),_this.registerUploadHook(uploadBaseTextures),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(CanvasPrepare,_BasePrepare),CanvasPrepare.prototype.destroy=function(){_BasePrepare.prototype.destroy.call(this),this.ctx=null,this.canvas=null},CanvasPrepare}(((obj=_BasePrepare2)&&obj.__esModule?obj:{default:obj}).default);function uploadBaseTextures(prepare,item){if(item instanceof core.BaseTexture){var image=item.source,imageWidth=0===image.width?prepare.canvas.width:Math.min(prepare.canvas.width,image.width),imageHeight=0===image.height?prepare.canvas.height:Math.min(prepare.canvas.height,image.height);return prepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,prepare.canvas.width,prepare.canvas.height),!0}return!1}exports.default=CanvasPrepare,core.CanvasRenderer.registerPlugin("prepare",CanvasPrepare)},{"../../core":85,"../BasePrepare":203}],205:[function(require,module,exports){"use strict";exports.__esModule=!0;var _WebGLPrepare=require("./webgl/WebGLPrepare");Object.defineProperty(exports,"webgl",{enumerable:!0,get:function(){return _interopRequireDefault(_WebGLPrepare).default}});var _CanvasPrepare=require("./canvas/CanvasPrepare");Object.defineProperty(exports,"canvas",{enumerable:!0,get:function(){return _interopRequireDefault(_CanvasPrepare).default}});var _BasePrepare=require("./BasePrepare");Object.defineProperty(exports,"BasePrepare",{enumerable:!0,get:function(){return _interopRequireDefault(_BasePrepare).default}});var _CountLimiter=require("./limiters/CountLimiter");Object.defineProperty(exports,"CountLimiter",{enumerable:!0,get:function(){return _interopRequireDefault(_CountLimiter).default}});var _TimeLimiter=require("./limiters/TimeLimiter");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"TimeLimiter",{enumerable:!0,get:function(){return _interopRequireDefault(_TimeLimiter).default}})},{"./BasePrepare":203,"./canvas/CanvasPrepare":204,"./limiters/CountLimiter":206,"./limiters/TimeLimiter":207,"./webgl/WebGLPrepare":208}],206:[function(require,module,exports){"use strict";exports.__esModule=!0;var CountLimiter=function(){function CountLimiter(maxItemsPerFrame){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CountLimiter),this.maxItemsPerFrame=maxItemsPerFrame,this.itemsLeft=0}return CountLimiter.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},CountLimiter.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},CountLimiter}();exports.default=CountLimiter},{}],207:[function(require,module,exports){"use strict";exports.__esModule=!0;var TimeLimiter=function(){function TimeLimiter(maxMilliseconds){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TimeLimiter),this.maxMilliseconds=maxMilliseconds,this.frameStart=0}return TimeLimiter.prototype.beginFrame=function(){this.frameStart=Date.now()},TimeLimiter.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},TimeLimiter}();exports.default=TimeLimiter},{}],208:[function(require,module,exports){"use strict";exports.__esModule=!0;var obj,core=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("../../core")),_BasePrepare2=require("../BasePrepare");var WebGLPrepare=function(_BasePrepare){function WebGLPrepare(renderer){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebGLPrepare);var _this=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_BasePrepare.call(this,renderer));return _this.uploadHookHelper=_this.renderer,_this.registerFindHook(findGraphics),_this.registerUploadHook(uploadBaseTextures),_this.registerUploadHook(uploadGraphics),_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WebGLPrepare,_BasePrepare),WebGLPrepare}(((obj=_BasePrepare2)&&obj.__esModule?obj:{default:obj}).default);function uploadBaseTextures(renderer,item){return item instanceof core.BaseTexture&&(item._glTextures[renderer.CONTEXT_UID]||renderer.textureManager.updateTexture(item),!0)}function uploadGraphics(renderer,item){return item instanceof core.Graphics&&((item.dirty||item.clearDirty||!item._webGL[renderer.plugins.graphics.CONTEXT_UID])&&renderer.plugins.graphics.updateGraphics(item),!0)}function findGraphics(item,queue){return item instanceof core.Graphics&&(queue.push(item),!0)}exports.default=WebGLPrepare,core.WebGLRenderer.registerPlugin("prepare",WebGLPrepare)},{"../../core":85,"../BasePrepare":203}],209:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],210:[function(require,module,exports){(function(global){!function(root){var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for((basic=input.lastIndexOf(delimiter))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base)>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)w>floor(maxInt/(baseMinusT=base-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}if(punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],211:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],212:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],213:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":211,"./encode":212}],214:[function(require,module,exports){"use strict";module.exports=function(arr,startIdx,removeCount){var i,length=arr.length;if(!(startIdx>=length||0===removeCount)){var len=length-(removeCount=startIdx+removeCount>length?length-startIdx:removeCount);for(i=startIdx;i<len;++i)arr[i]=arr[i+removeCount];arr.length=len}}},{}],215:[function(require,module,exports){"use strict";exports.__esModule=!0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_miniSignals2=_interopRequireDefault(require("mini-signals")),_parseUri2=_interopRequireDefault(require("parse-uri")),async=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("./async")),_Resource2=_interopRequireDefault(require("./Resource"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function Loader(){var _this=this,baseUrl=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",concurrency=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Loader),this.baseUrl=baseUrl,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(r,d){return _this._loadResource(r,d)},this._queue=async.queue(this._boundLoadResource,concurrency),this._queue.pause(),this.resources={},this.onProgress=new _miniSignals2.default,this.onError=new _miniSignals2.default,this.onLoad=new _miniSignals2.default,this.onStart=new _miniSignals2.default,this.onComplete=new _miniSignals2.default}return Loader.prototype.add=function(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i)this.add(name[i]);return this}if("object"===(void 0===name?"undefined":_typeof(name))&&(cb=url||name.callback||name.onComplete,options=name,url=name.url,name=name.name||name.key||name.url),"string"!=typeof url&&(cb=options,options=url,url=name),"string"!=typeof url)throw new Error("No url passed to add resource to loader.");if("function"==typeof options&&(cb=options,options=null),this.loading&&(!options||!options.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[name])throw new Error('Resource named "'+name+'" already exists.');if(url=this._prepareUrl(url),this.resources[name]=new _Resource2.default(name,url,options),"function"==typeof cb&&this.resources[name].onAfterMiddleware.once(cb),this.loading){for(var parent=options.parentResource,incompleteChildren=[],_i=0;_i<parent.children.length;++_i)parent.children[_i].isComplete||incompleteChildren.push(parent.children[_i]);var eachChunk=parent.progressChunk*(incompleteChildren.length+1)/(incompleteChildren.length+2);parent.children.push(this.resources[name]),parent.progressChunk=eachChunk;for(var _i2=0;_i2<incompleteChildren.length;++_i2)incompleteChildren[_i2].progressChunk=eachChunk;this.resources[name].progressChunk=eachChunk}return this._queue.push(this.resources[name]),this},Loader.prototype.pre=function(fn){return this._beforeMiddleware.push(fn),this},Loader.prototype.use=function(fn){return this._afterMiddleware.push(fn),this},Loader.prototype.reset=function(){for(var k in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var res=this.resources[k];res._onLoadBinding&&res._onLoadBinding.detach(),res.isLoading&&res.abort()}return this.resources={},this},Loader.prototype.load=function(cb){if("function"==typeof cb&&this.onComplete.once(cb),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var chunk=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=chunk;this._onStart(),this._queue.resume()}return this},Loader.prototype._prepareUrl=function(url){var parsedUrl=(0,_parseUri2.default)(url,{strictMode:!0}),result=void 0;if(result=parsedUrl.protocol||!parsedUrl.path||0===url.indexOf("//")?url:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==url.charAt(0)?this.baseUrl+"/"+url:this.baseUrl+url,this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];-1!==(result=result.substr(0,result.length-hash.length)).indexOf("?")?result+="&"+this.defaultQueryString:result+="?"+this.defaultQueryString,result+=hash}return result},Loader.prototype._loadResource=function(resource,dequeue){var _this2=this;resource._dequeue=dequeue,async.eachSeries(this._beforeMiddleware,function(fn,next){fn.call(_this2,resource,function(){next(resource.isComplete?{}:null)})},function(){resource.isComplete?_this2._onLoad(resource):(resource._onLoadBinding=resource.onComplete.once(_this2._onLoad,_this2),resource.load())},!0)},Loader.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},Loader.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},Loader.prototype._onLoad=function(resource){var _this3=this;resource._onLoadBinding=null,this._resourcesParsing.push(resource),resource._dequeue(),async.eachSeries(this._afterMiddleware,function(fn,next){fn.call(_this3,resource,next)},function(){resource.onAfterMiddleware.dispatch(resource),_this3.progress+=resource.progressChunk,_this3.onProgress.dispatch(_this3,resource),resource.error?_this3.onError.dispatch(resource.error,_this3,resource):_this3.onLoad.dispatch(_this3,resource),_this3._resourcesParsing.splice(_this3._resourcesParsing.indexOf(resource),1),_this3._queue.idle()&&0===_this3._resourcesParsing.length&&_this3._onComplete()},!0)},_createClass(Loader,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(concurrency){this._queue.concurrency=concurrency}}]),Loader}();exports.default=Loader},{"./Resource":216,"./async":217,"mini-signals":36,"parse-uri":39}],216:[function(require,module,exports){"use strict";exports.__esModule=!0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_parseUri2=_interopRequireDefault(require("parse-uri")),_miniSignals2=_interopRequireDefault(require("mini-signals"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var useXdr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),tempAnchor=null;function _noop(){}var Resource=function(){function Resource(name,url,options){if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Resource),"string"!=typeof name||"string"!=typeof url)throw new Error("Both name and url are required for constructing a resource.");options=options||{},this._flags=0,this._setFlag(Resource.STATUS_FLAGS.DATA_URL,0===url.indexOf("data:")),this.name=name,this.url=url,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===options.crossOrigin?"anonymous":options.crossOrigin,this.loadType=options.loadType||this._determineLoadType(),this.xhrType=options.xhrType,this.metadata=options.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=Resource.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop,this._onLoadBinding=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this),this.onStart=new _miniSignals2.default,this.onProgress=new _miniSignals2.default,this.onComplete=new _miniSignals2.default,this.onAfterMiddleware=new _miniSignals2.default}return Resource.setExtensionLoadType=function(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)},Resource.setExtensionXhrType=function(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)},Resource.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(Resource.STATUS_FLAGS.COMPLETE,!0),this._setFlag(Resource.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},Resource.prototype.abort=function(message){if(!this.error){if(this.error=new Error(message),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=Resource.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},Resource.prototype.load=function(cb){var _this=this;if(!this.isLoading)if(this.isComplete)cb&&setTimeout(function(){return cb(_this)},1);else switch(cb&&this.onComplete.once(cb),this._setFlag(Resource.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case Resource.LOAD_TYPE.IMAGE:this.type=Resource.TYPE.IMAGE,this._loadElement("image");break;case Resource.LOAD_TYPE.AUDIO:this.type=Resource.TYPE.AUDIO,this._loadSourceElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this.type=Resource.TYPE.VIDEO,this._loadSourceElement("video");break;case Resource.LOAD_TYPE.XHR:default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},Resource.prototype._hasFlag=function(flag){return!!(this._flags&flag)},Resource.prototype._setFlag=function(flag,value){this._flags=value?this._flags|flag:this._flags&~flag},Resource.prototype._loadElement=function(type){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===type&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(type),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},Resource.prototype._loadSourceElement=function(type){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===type&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(type),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var mimeTypes=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes));else{var _mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(_mimeTypes)?_mimeTypes[0]:_mimeTypes))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element: "+type)},Resource.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,!0),this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT?xhr.responseType=Resource.XHR_RESPONSE_TYPE.TEXT:xhr.responseType=this.xhrType,xhr.addEventListener("error",this._boundXhrOnError,!1),xhr.addEventListener("abort",this._boundXhrOnAbort,!1),xhr.addEventListener("progress",this._boundOnProgress,!1),xhr.addEventListener("load",this._boundXhrOnLoad,!1),xhr.send()},Resource.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xdr=this.xhr=new XDomainRequest;xdr.timeout=5e3,xdr.onerror=this._boundXhrOnError,xdr.ontimeout=this._boundXdrOnTimeout,xdr.onprogress=this._boundOnProgress,xdr.onload=this._boundXhrOnLoad,xdr.open("GET",this.url,!0),setTimeout(function(){return xdr.send()},1)},Resource.prototype._createSource=function(type,url,mime){mime||(mime=type+"/"+this._getExtension(url));var source=document.createElement("source");return source.src=url,source.type=mime,source},Resource.prototype._onError=function(event){this.abort("Failed to load element using: "+event.target.nodeName)},Resource.prototype._onProgress=function(event){event&&event.lengthComputable&&this.onProgress.dispatch(this,event.loaded/event.total)},Resource.prototype._xhrOnError=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')},Resource.prototype._xhrOnAbort=function(){this.abort(reqType(this.xhr)+" Request was aborted by the user.")},Resource.prototype._xdrOnTimeout=function(){this.abort(reqType(this.xhr)+" Request timed out.")},Resource.prototype._xhrOnLoad=function(){var xhr=this.xhr,text="",status=void 0===xhr.status?200:xhr.status;if(""!==xhr.responseType&&"text"!==xhr.responseType&&void 0!==xhr.responseType||(text=xhr.responseText),0===status&&(text.length>0||xhr.responseType===Resource.XHR_RESPONSE_TYPE.BUFFER)?status=200:1223===status&&(status=204),2===(status/100|0)){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT)this.data=text,this.type=Resource.TYPE.TEXT;else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(text),this.type=Resource.TYPE.JSON}catch(e){return void this.abort("Error trying to parse loaded json: "+e)}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text,this.data=div}this.type=Resource.TYPE.XML}catch(e){return void this.abort("Error trying to parse loaded xml: "+e)}else this.data=xhr.response||text;this.complete()}else this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL)},Resource.prototype._determineCrossOrigin=function(url,loc){if(0===url.indexOf("data:"))return"";loc=loc||window.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=url;var samePort=!(url=(0,_parseUri2.default)(tempAnchor.href,{strictMode:!0})).port&&""===loc.port||url.port===loc.port,protocol=url.protocol?url.protocol+":":"";return url.host===loc.hostname&&samePort&&protocol===loc.protocol?"":"anonymous"},Resource.prototype._determineXhrType=function(){return Resource._xhrTypeMap[this.extension]||Resource.XHR_RESPONSE_TYPE.TEXT},Resource.prototype._determineLoadType=function(){return Resource._loadTypeMap[this.extension]||Resource.LOAD_TYPE.XHR},Resource.prototype._getExtension=function(){var url=this.url,ext="";if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?"),hashStart=url.indexOf("#"),index=Math.min(queryStart>-1?queryStart:url.length,hashStart>-1?hashStart:url.length);ext=(url=url.substring(0,index)).substring(url.lastIndexOf(".")+1)}return ext.toLowerCase()},Resource.prototype._getMimeFromXhrType=function(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},_createClass(Resource,[{key:"isDataUrl",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(Resource.STATUS_FLAGS.LOADING)}}]),Resource}();function setExtMap(map,extname,val){extname&&0===extname.indexOf(".")&&(extname=extname.substring(1)),extname&&(map[extname]=val)}function reqType(xhr){return xhr.toString().replace("object ","")}exports.default=Resource,Resource.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Resource.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Resource.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Resource.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Resource._loadTypeMap={gif:Resource.LOAD_TYPE.IMAGE,png:Resource.LOAD_TYPE.IMAGE,bmp:Resource.LOAD_TYPE.IMAGE,jpg:Resource.LOAD_TYPE.IMAGE,jpeg:Resource.LOAD_TYPE.IMAGE,tif:Resource.LOAD_TYPE.IMAGE,tiff:Resource.LOAD_TYPE.IMAGE,webp:Resource.LOAD_TYPE.IMAGE,tga:Resource.LOAD_TYPE.IMAGE,svg:Resource.LOAD_TYPE.IMAGE,"svg+xml":Resource.LOAD_TYPE.IMAGE,mp3:Resource.LOAD_TYPE.AUDIO,ogg:Resource.LOAD_TYPE.AUDIO,wav:Resource.LOAD_TYPE.AUDIO,mp4:Resource.LOAD_TYPE.VIDEO,webm:Resource.LOAD_TYPE.VIDEO},Resource._xhrTypeMap={xhtml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource.XHR_RESPONSE_TYPE.BLOB,png:Resource.XHR_RESPONSE_TYPE.BLOB,bmp:Resource.XHR_RESPONSE_TYPE.BLOB,jpg:Resource.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource.XHR_RESPONSE_TYPE.BLOB,tif:Resource.XHR_RESPONSE_TYPE.BLOB,tiff:Resource.XHR_RESPONSE_TYPE.BLOB,webp:Resource.XHR_RESPONSE_TYPE.BLOB,tga:Resource.XHR_RESPONSE_TYPE.BLOB,json:Resource.XHR_RESPONSE_TYPE.JSON,text:Resource.XHR_RESPONSE_TYPE.TEXT,txt:Resource.XHR_RESPONSE_TYPE.TEXT,ttf:Resource.XHR_RESPONSE_TYPE.BUFFER,otf:Resource.XHR_RESPONSE_TYPE.BUFFER},Resource.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},{"mini-signals":36,"parse-uri":39}],217:[function(require,module,exports){"use strict";function _noop(){}function onlyOnce(fn){return function(){if(null===fn)throw new Error("Callback was already called.");var callFn=fn;fn=null,callFn.apply(this,arguments)}}exports.__esModule=!0,exports.eachSeries=function(array,iterator,callback,deferNext){var i=0,len=array.length;!function next(err){err||i===len?callback&&callback(err):deferNext?setTimeout(function(){iterator(array[i++],next)},1):iterator(array[i++],next)}()},exports.queue=function(worker,concurrency){if(null==concurrency)concurrency=1;else if(0===concurrency)throw new Error("Concurrency must not be zero");var workers=0,q={_tasks:[],concurrency:concurrency,saturated:_noop,unsaturated:_noop,buffer:concurrency/4,empty:_noop,drain:_noop,error:_noop,started:!1,paused:!1,push:function(data,callback){_insert(data,!1,callback)},kill:function(){workers=0,q.drain=_noop,q.started=!1,q._tasks=[]},unshift:function(data,callback){_insert(data,!0,callback)},process:function(){for(;!q.paused&&workers<q.concurrency&&q._tasks.length;){var task=q._tasks.shift();0===q._tasks.length&&q.empty(),(workers+=1)===q.concurrency&&q.saturated(),worker(task.data,onlyOnce(_next(task)))}},length:function(){return q._tasks.length},running:function(){return workers},idle:function(){return q._tasks.length+workers===0},pause:function(){!0!==q.paused&&(q.paused=!0)},resume:function(){if(!1!==q.paused){q.paused=!1;for(var w=1;w<=q.concurrency;w++)q.process()}}};function _insert(data,insertAtFront,callback){if(null!=callback&&"function"!=typeof callback)throw new Error("task callback must be a function");if(q.started=!0,null==data&&q.idle())setTimeout(function(){return q.drain()},1);else{var item={data:data,callback:"function"==typeof callback?callback:_noop};insertAtFront?q._tasks.unshift(item):q._tasks.push(item),setTimeout(function(){return q.process()},1)}}function _next(task){return function(){workers-=1,task.callback.apply(task,arguments),null!=arguments[0]&&q.error(arguments[0],task.data),workers<=q.concurrency-q.buffer&&q.unsaturated(),q.idle()&&q.drain(),q.process()}}return q}},{}],218:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.encodeBinary=function(input){var output="",inx=0;for(;inx<input.length;){for(var bytebuffer=[0,0,0],encodedCharIndexes=[0,0,0,0],jnx=0;jnx<bytebuffer.length;++jnx)inx<input.length?bytebuffer[jnx]=255&input.charCodeAt(inx++):bytebuffer[jnx]=0;encodedCharIndexes[0]=bytebuffer[0]>>2,encodedCharIndexes[1]=(3&bytebuffer[0])<<4|bytebuffer[1]>>4,encodedCharIndexes[2]=(15&bytebuffer[1])<<2|bytebuffer[2]>>6,encodedCharIndexes[3]=63&bytebuffer[2];var paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64,encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64}for(var _jnx=0;_jnx<encodedCharIndexes.length;++_jnx)output+=_keyStr.charAt(encodedCharIndexes[_jnx])}return output};var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},{}],219:[function(require,module,exports){"use strict";var Loader=require("./Loader").default,Resource=require("./Resource").default,async=require("./async"),b64=require("./b64");Loader.Resource=Resource,Loader.async=async,Loader.base64=b64,module.exports=Loader,module.exports.default=Loader},{"./Loader":215,"./Resource":216,"./async":217,"./b64":218}],220:[function(require,module,exports){"use strict";exports.__esModule=!0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.blobMiddlewareFactory=function(){return function(resource,next){if(resource.data){if(resource.xhr&&resource.xhrType===_Resource2.default.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof resource.data){if(0===resource.data.type.indexOf("image")){var _ret=(src=Url.createObjectURL(resource.data),resource.blob=resource.data,resource.data=new Image,resource.data.src=src,resource.type=_Resource2.default.TYPE.IMAGE,resource.data.onload=function(){Url.revokeObjectURL(src),resource.data.onload=null,next()},{v:void 0});if("object"===(void 0===_ret?"undefined":_typeof(_ret)))return _ret.v}}else{var type=resource.xhr.getResponseHeader("content-type");if(type&&0===type.indexOf("image"))return resource.data=new Image,resource.data.src="data:"+type+";base64,"+_b2.default.encodeBinary(resource.xhr.responseText),resource.type=_Resource2.default.TYPE.IMAGE,void(resource.data.onload=function(){resource.data.onload=null,next()})}var src;next()}else next()}};var _Resource2=_interopRequireDefault(require("../../Resource")),_b2=_interopRequireDefault(require("../../b64"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Url=window.URL||window.webkitURL},{"../../Resource":216,"../../b64":218}],221:[function(require,module,exports){var url=require("./url"),parser=require("socket.io-parser"),Manager=require("./manager"),debug=require("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{};var io,parsed=url(uri),source=parsed.source,id=parsed.id,path=parsed.path,sameNamespace=cache[id]&&path in cache[id].nsps;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex||sameNamespace?(debug("ignoring socket cache for %s",source),io=Manager(source,opts)):(cache[id]||(debug("new io instance for %s",source),cache[id]=Manager(source,opts)),io=cache[id]),parsed.query&&!opts.query&&(opts.query=parsed.query),io.socket(parsed.path,opts)}exports.protocol=parser.protocol,exports.connect=lookup,exports.Manager=require("./manager"),exports.Socket=require("./socket")},{"./manager":222,"./socket":224,"./url":225,debug:12,"socket.io-parser":227}],222:[function(require,module,exports){var eio=require("engine.io-client"),Socket=require("./socket"),Emitter=require("component-emitter"),parser=require("socket.io-parser"),on=require("./on"),bind=require("component-bind"),debug=require("debug")("socket.io-client:manager"),indexOf=require("indexof"),Backoff=require("backo2"),has=Object.prototype.hasOwnProperty;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);uri&&"object"==typeof uri&&(opts=uri,uri=void 0),(opts=opts||{}).path=opts.path||"/socket.io",this.nsps={},this.subs=[],this.opts=opts,this.reconnection(!1!==opts.reconnection),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.randomizationFactor(opts.randomizationFactor||.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==opts.timeout?2e4:opts.timeout),this.readyState="closed",this.uri=uri,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var _parser=opts.parser||parser;this.encoder=new _parser.Encoder,this.decoder=new _parser.Decoder,this.autoConnect=!1!==opts.autoConnect,this.autoConnect&&this.open()}module.exports=Manager,Manager.prototype.emitAll=function(){for(var nsp in this.emit.apply(this,arguments),this.nsps)has.call(this.nsps,nsp)&&this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)},Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps)has.call(this.nsps,nsp)&&(this.nsps[nsp].id=this.generateId(nsp))},Manager.prototype.generateId=function(nsp){return("/"===nsp?"":nsp+"#")+this.engine.id},Emitter(Manager.prototype),Manager.prototype.reconnection=function(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(v){return arguments.length?(this._reconnectionAttempts=v,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(v){return arguments.length?(this._reconnectionDelay=v,this.backoff&&this.backoff.setMin(v),this):this._reconnectionDelay},Manager.prototype.randomizationFactor=function(v){return arguments.length?(this._randomizationFactor=v,this.backoff&&this.backoff.setJitter(v),this):this._randomizationFactor},Manager.prototype.reconnectionDelayMax=function(v){return arguments.length?(this._reconnectionDelayMax=v,this.backoff&&this.backoff.setMax(v),this):this._reconnectionDelayMax},Manager.prototype.timeout=function(v){return arguments.length?(this._timeout=v,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Manager.prototype.open=Manager.prototype.connect=function(fn,opts){if(debug("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=eio(this.uri,this.opts);var socket=this.engine,self=this;this.readyState="opening",this.skipReconnect=!1;var openSub=on(socket,"open",function(){self.onopen(),fn&&fn()}),errorSub=on(socket,"error",function(data){if(debug("connect_error"),self.cleanup(),self.readyState="closed",self.emitAll("connect_error",data),fn){var err=new Error("Connection error");err.data=data,fn(err)}else self.maybeReconnectOnOpen()});if(!1!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout),openSub.destroy(),socket.close(),socket.emit("error","timeout"),self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}return this.subs.push(openSub),this.subs.push(errorSub),this},Manager.prototype.onopen=function(){debug("open"),this.cleanup(),this.readyState="open",this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata"))),this.subs.push(on(socket,"ping",bind(this,"onping"))),this.subs.push(on(socket,"pong",bind(this,"onpong"))),this.subs.push(on(socket,"error",bind(this,"onerror"))),this.subs.push(on(socket,"close",bind(this,"onclose"))),this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")))},Manager.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Manager.prototype.ondata=function(data){this.decoder.add(data)},Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)},Manager.prototype.onerror=function(err){debug("error",err),this.emitAll("error",err)},Manager.prototype.socket=function(nsp,opts){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp,opts),this.nsps[nsp]=socket;var self=this;socket.on("connecting",onConnecting),socket.on("connect",function(){socket.id=self.generateId(nsp)}),this.autoConnect&&onConnecting()}function onConnecting(){~indexOf(self.connecting,socket)||self.connecting.push(socket)}return socket},Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);~index&&this.connecting.splice(index,1),this.connecting.length||this.close()},Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;packet.query&&0===packet.type&&(packet.nsp+="?"+packet.query),self.encoding?self.packetBuffer.push(packet):(self.encoding=!0,this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++)self.engine.write(encodedPackets[i],packet.options);self.encoding=!1,self.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}},Manager.prototype.cleanup=function(){debug("cleanup");for(var subsLength=this.subs.length,i=0;i<subsLength;i++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){debug("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Manager.prototype.onclose=function(reason){debug("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",reason),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay),this.reconnecting=!0;var timer=setTimeout(function(){self.skipReconnect||(debug("attempting reconnect"),self.emitAll("reconnect_attempt",self.backoff.attempts),self.emitAll("reconnecting",self.backoff.attempts),self.skipReconnect||self.open(function(err){err?(debug("reconnect attempt error"),self.reconnecting=!1,self.reconnect(),self.emitAll("reconnect_error",err.data)):(debug("reconnect success"),self.onreconnect())}))},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}},Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",attempt)}},{"./on":223,"./socket":224,backo2:4,"component-bind":9,"component-emitter":10,debug:12,"engine.io-client":15,indexof:32,"socket.io-parser":227}],223:[function(require,module,exports){module.exports=function(obj,ev,fn){return obj.on(ev,fn),{destroy:function(){obj.removeListener(ev,fn)}}}},{}],224:[function(require,module,exports){var parser=require("socket.io-parser"),Emitter=require("component-emitter"),toArray=require("to-array"),on=require("./on"),bind=require("component-bind"),debug=require("debug")("socket.io-client:socket"),parseqs=require("parseqs");module.exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},emit=Emitter.prototype.emit;function Socket(io,nsp,opts){this.io=io,this.nsp=nsp,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,opts&&opts.query&&(this.query=opts.query),this.io.autoConnect&&this.open()}Emitter(Socket.prototype),Socket.prototype.subEvents=function(){if(!this.subs){var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]}},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},Socket.prototype.send=function(){var args=toArray(arguments);return args.unshift("message"),this.emit.apply(this,args),this},Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev))return emit.apply(this,arguments),this;var args=toArray(arguments),packet={type:parser.EVENT,data:args,options:{}};return packet.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof args[args.length-1]&&(debug("emitting packet with ack id %d",this.ids),this.acks[this.ids]=args.pop(),packet.id=this.ids++),this.connected?this.packet(packet):this.sendBuffer.push(packet),delete this.flags,this},Socket.prototype.packet=function(packet){packet.nsp=this.nsp,this.io.packet(packet)},Socket.prototype.onopen=function(){if(debug("transport is open - connecting"),"/"!==this.nsp)if(this.query){var query="object"==typeof this.query?parseqs.encode(this.query):this.query;debug("sending connect packet with query %s",query),this.packet({type:parser.CONNECT,query:query})}else this.packet({type:parser.CONNECT})},Socket.prototype.onclose=function(reason){debug("close (%s)",reason),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",reason)},Socket.prototype.onpacket=function(packet){if(packet.nsp===this.nsp)switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data)}},Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args),null!=packet.id&&(debug("attaching ack callback to event"),args.push(this.ack(packet.id))),this.connected?emit.apply(this,args):this.receiveBuffer.push(args)},Socket.prototype.ack=function(id){var self=this,sent=!1;return function(){if(!sent){sent=!0;var args=toArray(arguments);debug("sending ack %j",args),self.packet({type:parser.ACK,id:id,data:args})}}},Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];"function"==typeof ack?(debug("calling ack %s with %j",packet.id,packet.data),ack.apply(this,packet.data),delete this.acks[packet.id]):debug("bad ack %s",packet.id)},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++)emit.apply(this,this.receiveBuffer[i]);for(this.receiveBuffer=[],i=0;i<this.sendBuffer.length;i++)this.packet(this.sendBuffer[i]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++)this.subs[i].destroy();this.subs=null}this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected&&(debug("performing disconnect (%s)",this.nsp),this.packet({type:parser.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},Socket.prototype.compress=function(compress){return this.flags=this.flags||{},this.flags.compress=compress,this}},{"./on":223,"component-bind":9,"component-emitter":10,debug:12,parseqs:40,"socket.io-parser":227,"to-array":231}],225:[function(require,module,exports){(function(global){var parseuri=require("parseuri"),debug=require("debug")("socket.io-client:url");module.exports=function(uri,loc){var obj=uri;loc=loc||global.location,null==uri&&(uri=loc.protocol+"//"+loc.host);"string"==typeof uri&&("/"===uri.charAt(0)&&(uri="/"===uri.charAt(1)?loc.protocol+uri:loc.host+uri),/^(https?|wss?):\/\//.test(uri)||(debug("protocol-less url %s",uri),uri=void 0!==loc?loc.protocol+"//"+uri:"https://"+uri),debug("parse %s",uri),obj=parseuri(uri));obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443"));obj.path=obj.path||"/";var host=-1!==obj.host.indexOf(":")?"["+obj.host+"]":obj.host;return obj.id=obj.protocol+"://"+host+":"+obj.port,obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port),obj}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:12,parseuri:41}],226:[function(require,module,exports){(function(global){var isArray=require("isarray"),isBuf=require("./is-buffer"),toString=Object.prototype.toString,withNativeBlob="function"==typeof global.Blob||"[object BlobConstructor]"===toString.call(global.Blob),withNativeFile="function"==typeof global.File||"[object FileConstructor]"===toString.call(global.File);exports.deconstructPacket=function(packet){var buffers=[],packetData=packet.data,pack=packet;return pack.data=function _deconstructPacket(data,buffers){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(isArray(data)){for(var newData=new Array(data.length),i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i],buffers);return newData}if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data)newData[key]=_deconstructPacket(data[key],buffers);return newData}return data}(packetData,buffers),pack.attachments=buffers.length,{packet:pack,buffers:buffers}},exports.reconstructPacket=function(packet,buffers){return packet.data=function _reconstructPacket(data,buffers){if(!data)return data;if(data&&data._placeholder)return buffers[data.num];if(isArray(data))for(var i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i],buffers);else if("object"==typeof data)for(var key in data)data[key]=_reconstructPacket(data[key],buffers);return data}(packet.data,buffers),packet.attachments=void 0,packet},exports.removeBlobs=function(data,callback){var pendingBlobs=0,bloblessData=data;!function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(withNativeBlob&&obj instanceof Blob||withNativeFile&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){containingObject?containingObject[curKey]=this.result:bloblessData=this.result,--pendingBlobs||callback(bloblessData)},fileReader.readAsArrayBuffer(obj)}else if(isArray(obj))for(var i=0;i<obj.length;i++)_removeBlobs(obj[i],i,obj);else if("object"==typeof obj&&!isBuf(obj))for(var key in obj)_removeBlobs(obj[key],key,obj)}(bloblessData),pendingBlobs||callback(bloblessData)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":228,isarray:33}],227:[function(require,module,exports){var debug=require("debug")("socket.io-parser"),Emitter=require("component-emitter"),hasBin=require("has-binary2"),binary=require("./binary"),isArray=require("isarray"),isBuf=require("./is-buffer");function Encoder(){}function encodeAsString(obj){var str=""+obj.type;return exports.BINARY_EVENT!==obj.type&&exports.BINARY_ACK!==obj.type||(str+=obj.attachments+"-"),obj.nsp&&"/"!==obj.nsp&&(str+=obj.nsp+","),null!=obj.id&&(str+=obj.id),null!=obj.data&&(str+=JSON.stringify(obj.data)),debug("encoded %j as %s",obj,str),str}function Decoder(){this.reconstructor=null}function BinaryReconstructor(packet){this.reconPack=packet,this.buffers=[]}function error(msg){return{type:exports.ERROR,data:"parser error: "+msg}}exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=Encoder,exports.Decoder=Decoder,Encoder.prototype.encode=function(obj,callback){(obj.type!==exports.EVENT&&obj.type!==exports.ACK||!hasBin(obj.data)||(obj.type=obj.type===exports.EVENT?exports.BINARY_EVENT:exports.BINARY_ACK),debug("encoding packet %j",obj),exports.BINARY_EVENT===obj.type||exports.BINARY_ACK===obj.type)?function(obj,callback){binary.removeBlobs(obj,function(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData),pack=encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;buffers.unshift(pack),callback(buffers)})}(obj,callback):callback([encodeAsString(obj)])},Emitter(Decoder.prototype),Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj)packet=function(str){var i=0,p={type:Number(str.charAt(0))};if(null==exports.types[p.type])return error("unknown packet type "+p.type);if(exports.BINARY_EVENT===p.type||exports.BINARY_ACK===p.type){for(var buf="";"-"!==str.charAt(++i)&&(buf+=str.charAt(i),i!=str.length););if(buf!=Number(buf)||"-"!==str.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(buf)}if("/"===str.charAt(i+1))for(p.nsp="";++i;){var c=str.charAt(i);if(","===c)break;if(p.nsp+=c,i===str.length)break}else p.nsp="/";var next=str.charAt(i+1);if(""!==next&&Number(next)==next){for(p.id="";++i;){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(p.id+=str.charAt(i),i===str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){var payload=function(str){try{return JSON.parse(str)}catch(e){return!1}}(str.substr(i)),isPayloadValid=!1!==payload&&(p.type===exports.ERROR||isArray(payload));if(!isPayloadValid)return error("invalid payload");p.data=payload}return debug("decoded %s as %j",str,p),p}(obj),exports.BINARY_EVENT===packet.type||exports.BINARY_ACK===packet.type?(this.reconstructor=new BinaryReconstructor(packet),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",packet)):this.emit("decoded",packet);else{if(!isBuf(obj)&&!obj.base64)throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(packet=this.reconstructor.takeBinaryData(obj))&&(this.reconstructor=null,this.emit("decoded",packet))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(binData){if(this.buffers.push(binData),this.buffers.length===this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":226,"./is-buffer":228,"component-emitter":10,debug:229,"has-binary2":30,isarray:33}],228:[function(require,module,exports){(function(global){module.exports=function(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&(obj instanceof ArrayBuffer||ArrayBuffer.isView(obj))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],229:[function(require,module,exports){arguments[4][24][0].apply(exports,arguments)},{"./debug":230,_process:209,dup:24}],230:[function(require,module,exports){arguments[4][25][0].apply(exports,arguments)},{dup:25,ms:37}],231:[function(require,module,exports){module.exports=function(list,index){for(var array=[],i=(index=index||0)||0;i<list.length;i++)array[i-index]=list[i];return array}},{}],232:[function(require,module,exports){var root,factory;root=this,factory=function(){"use strict";var Tone,func;function Module(func){func(Tone)}return func=function(){var Tone=function(){};Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/),sameConstructor=Tone[className]===this.constructor;if(Tone.isFunction(Tone[className])&&isLetter&&sameConstructor)return className}return"Tone"},Tone.prototype.dispose=function(){return this},Tone.prototype.set=function(params,value,rampTime){if(Tone.isObject(params))rampTime=value;else if(Tone.isString(params)){var tmpObj={};tmpObj[params]=value,params=tmpObj}paramLoop:for(var attr in params){value=params[attr];var parent=this;if(-1!==attr.indexOf(".")){for(var attrSplit=attr.split("."),i=0;i<attrSplit.length-1;i++)if((parent=parent[attrSplit[i]])instanceof Tone){attrSplit.splice(0,i+1);var innerParam=attrSplit.join(".");parent.set(innerParam,value);continue paramLoop}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];Tone.isUndef(param)||(Tone.Signal&&param instanceof Tone.Signal||Tone.Param&&param instanceof Tone.Param?param.value!==value&&(Tone.isUndef(rampTime)?param.value=value:param.rampTo(value,rampTime)):param instanceof AudioParam?param.value!==value&&(param.value=value):param instanceof Tone?param.set(value):param!==value&&(parent[attr]=value))}return this},Tone.prototype.get=function(params){Tone.isUndef(params)?params=this._collectDefaults(this.constructor):Tone.isString(params)&&(params=[params]);for(var ret={},i=0;i<params.length;i++){var attr=params[i],parent=this,subRet=ret;if(-1!==attr.indexOf(".")){for(var attrSplit=attr.split("."),j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{},subRet=subRet[subAttr],parent=parent[subAttr]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];Tone.isObject(params[attr])?subRet[attr]=param.get():Tone.Signal&&param instanceof Tone.Signal?subRet[attr]=param.value:Tone.Param&&param instanceof Tone.Param?subRet[attr]=param.value:param instanceof AudioParam?subRet[attr]=param.value:param instanceof Tone?subRet[attr]=param.get():Tone.isFunction(param)||Tone.isUndef(param)||(subRet[attr]=param)}return ret},Tone.prototype._collectDefaults=function(constr){var ret=[];if(Tone.isUndef(constr.defaults)||(ret=Object.keys(constr.defaults)),!Tone.isUndef(constr._super))for(var superDefs=this._collectDefaults(constr._super),i=0;i<superDefs.length;i++)-1===ret.indexOf(superDefs[i])&&ret.push(superDefs[i]);return ret},Tone.defaults=function(values,keys,constr){var options={};if(1===values.length&&Tone.isObject(values[0]))options=values[0];else for(var i=0;i<keys.length;i++)options[keys[i]]=values[i];return Tone.isUndef(constr.defaults)?Tone.isObject(constr)?Tone.defaultArg(options,constr):options:Tone.defaultArg(options,constr.defaults)},Tone.defaultArg=function(given,fallback){if(Tone.isObject(given)&&Tone.isObject(fallback)){var ret={};for(var givenProp in given)ret[givenProp]=Tone.defaultArg(fallback[givenProp],given[givenProp]);for(var fallbackProp in fallback)ret[fallbackProp]=Tone.defaultArg(given[fallbackProp],fallback[fallbackProp]);return ret}return Tone.isUndef(given)?fallback:given},Tone.connectSeries=function(){for(var currentUnit=arguments[0],i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}return Tone},Tone.isUndef=function(val){return void 0===val},Tone.isFunction=function(val){return"function"==typeof val},Tone.isNumber=function(arg){return"number"==typeof arg},Tone.isObject=function(arg){return"[object Object]"===Object.prototype.toString.call(arg)&&arg.constructor===Object},Tone.isBoolean=function(arg){return"boolean"==typeof arg},Tone.isArray=function(arg){return Array.isArray(arg)},Tone.isString=function(arg){return"string"==typeof arg},Tone.isNote=function(arg){return Tone.isString(arg)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(arg)},Tone.noOp=function(){},Tone.prototype._readOnly=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._readOnly(property[i]);else Object.defineProperty(this,property,{writable:!1,enumerable:!0})},Tone.prototype._writable=function(property){if(Array.isArray(property))for(var i=0;i<property.length;i++)this._writable(property[i]);else Object.defineProperty(this,property,{writable:!0})},Tone.State={Started:"started",Stopped:"stopped",Paused:"paused"},Tone.equalPowerScale=function(percent){var piFactor=.5*Math.PI;return Math.sin(percent*piFactor)},Tone.dbToGain=function(db){return Math.pow(2,db/6)},Tone.gainToDb=function(gain){return Math.log(gain)/Math.LN10*20},Tone.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)},Tone.prototype.now=function(){return Tone.context.now()},Tone.now=function(){return Tone.context.now()},Tone.isPast=function(time){time<Tone.context.currentTime&&console.warn("Time '"+time+"' is in the past. Scheduled time must be ≥ AudioContext.currentTime")},Tone.extend=function(child,parent){function TempConstructor(){}Tone.isUndef(parent)&&(parent=Tone),TempConstructor.prototype=parent.prototype,child.prototype=new TempConstructor,child.prototype.constructor=child,child._super=parent};var audioContext=null;return Object.defineProperty(Tone,"context",{get:function(){return audioContext},set:function(context){audioContext=Tone.Context&&context instanceof Tone.Context?context:new Tone.Context(context),Tone.Context.emit("init",audioContext)}}),Object.defineProperty(Tone.prototype,"context",{get:function(){return Tone.context}}),Tone.setContext=function(ctx){Tone.context=ctx},Object.defineProperty(Tone.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(Tone.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(Tone,"supported",{get:function(){var hasAudioContext=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),hasPromises=window.hasOwnProperty("Promise"),hasWorkers=window.hasOwnProperty("Worker");return hasAudioContext&&hasPromises&&hasWorkers}}),Object.defineProperty(Tone,"initialized",{get:function(){return null!==audioContext}}),Tone.getContext=function(resolve){if(Tone.initialized)resolve(Tone.context);else{var resCallback=function(){resolve(Tone.context),Tone.Context.off("init",resCallback)};Tone.Context.on("init",resCallback)}return Tone},Tone.version="r11",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+Tone.version+" * ","background: #000; color: #fff"),Tone},Tone=func(),Module(function(Tone){return Tone.Emitter=function(){Tone.call(this),this._events={}},Tone.extend(Tone.Emitter),Tone.Emitter.prototype.on=function(event,callback){for(var events=event.split(/\W+/),i=0;i<events.length;i++){var eventName=events[i];this._events.hasOwnProperty(eventName)||(this._events[eventName]=[]),this._events[eventName].push(callback)}return this},Tone.Emitter.prototype.off=function(event,callback){for(var events=event.split(/\W+/),ev=0;ev<events.length;ev++)if(event=events[ev],this._events.hasOwnProperty(event))if(Tone.isUndef(callback))this._events[event]=[];else for(var eventList=this._events[event],i=0;i<eventList.length;i++)eventList[i]===callback&&eventList.splice(i,1);return this},Tone.Emitter.prototype.emit=function(event){if(this._events){var args=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(event))for(var eventList=this._events[event],i=0,len=eventList.length;i<len;i++)eventList[i].apply(this,args)}return this},Tone.Emitter.mixin=function(object){var functions=["on","off","emit"];object._events={};for(var i=0;i<functions.length;i++){var func=functions[i],emitterFunc=Tone.Emitter.prototype[func];object[func]=emitterFunc}return Tone.Emitter},Tone.Emitter.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._events=null,this},Tone.Emitter}),Module(function(Tone){return Tone.Timeline=function(){var options=Tone.defaults(arguments,["memory"],Tone.Timeline);Tone.call(this),this._timeline=[],this._toRemove=[],this._toAdd=[],this._iterating=!1,this.memory=options.memory},Tone.extend(Tone.Timeline),Tone.Timeline.defaults={memory:1/0},Object.defineProperty(Tone.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),Tone.Timeline.prototype.add=function(event){if(Tone.isUndef(event.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._iterating)this._toAdd.push(event);else{var index=this._search(event.time);if(this._timeline.splice(index+1,0,event),this.length>this.memory){var diff=this.length-this.memory;this._timeline.splice(0,diff)}}return this},Tone.Timeline.prototype.remove=function(event){if(this._iterating)this._toRemove.push(event);else{var index=this._timeline.indexOf(event);-1!==index&&this._timeline.splice(index,1)}return this},Tone.Timeline.prototype.get=function(time,comparator){comparator=Tone.defaultArg(comparator,"time");var index=this._search(time,comparator);return-1!==index?this._timeline[index]:null},Tone.Timeline.prototype.peek=function(){return this._timeline[0]},Tone.Timeline.prototype.shift=function(){return this._timeline.shift()},Tone.Timeline.prototype.getAfter=function(time,comparator){comparator=Tone.defaultArg(comparator,"time");var index=this._search(time,comparator);return index+1<this._timeline.length?this._timeline[index+1]:null},Tone.Timeline.prototype.getBefore=function(time,comparator){comparator=Tone.defaultArg(comparator,"time");var len=this._timeline.length;if(len>0&&this._timeline[len-1][comparator]<time)return this._timeline[len-1];var index=this._search(time,comparator);return index-1>=0?this._timeline[index-1]:null},Tone.Timeline.prototype.cancel=function(after){if(this._timeline.length>1){var index=this._search(after);if(index>=0)if(this._timeline[index].time===after){for(var i=index;i>=0&&this._timeline[i].time===after;i--)index=i;this._timeline=this._timeline.slice(0,index)}else this._timeline=this._timeline.slice(0,index+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=after&&(this._timeline=[]);return this},Tone.Timeline.prototype.cancelBefore=function(time){var index=this._search(time);return index>=0&&(this._timeline=this._timeline.slice(index+1)),this},Tone.Timeline.prototype.previousEvent=function(event){var index=this._timeline.indexOf(event);return index>0?this._timeline[index-1]:null},Tone.Timeline.prototype._search=function(time,comparator){if(0===this._timeline.length)return-1;comparator=Tone.defaultArg(comparator,"time");var beginning=0,len=this._timeline.length,end=len;if(len>0&&this._timeline[len-1][comparator]<=time)return len-1;for(;beginning<end;){var midPoint=Math.floor(beginning+(end-beginning)/2),event=this._timeline[midPoint],nextEvent=this._timeline[midPoint+1];if(event[comparator]===time){for(var i=midPoint;i<this._timeline.length;i++){this._timeline[i][comparator]===time&&(midPoint=i)}return midPoint}if(event[comparator]<time&&nextEvent[comparator]>time)return midPoint;event[comparator]>time?end=midPoint:beginning=midPoint+1}return-1},Tone.Timeline.prototype._iterate=function(callback,lowerBound,upperBound){this._iterating=!0,lowerBound=Tone.defaultArg(lowerBound,0),upperBound=Tone.defaultArg(upperBound,this._timeline.length-1);for(var i=lowerBound;i<=upperBound;i++)callback.call(this,this._timeline[i]);this._iterating=!1,this._toRemove.forEach(function(event){this.remove(event)}.bind(this)),this._toRemove=[],this._toAdd.forEach(function(event){this.add(event)}.bind(this)),this._toAdd=[]},Tone.Timeline.prototype.forEach=function(callback){return this._iterate(callback),this},Tone.Timeline.prototype.forEachBefore=function(time,callback){var upperBound=this._search(time);return-1!==upperBound&&this._iterate(callback,0,upperBound),this},Tone.Timeline.prototype.forEachAfter=function(time,callback){var lowerBound=this._search(time);return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachFrom=function(time,callback){for(var lowerBound=this._search(time);lowerBound>=0&&this._timeline[lowerBound].time>=time;)lowerBound--;return this._iterate(callback,lowerBound+1),this},Tone.Timeline.prototype.forEachAtTime=function(time,callback){var upperBound=this._search(time);return-1!==upperBound&&this._iterate(function(event){event.time===time&&callback.call(this,event)},0,upperBound),this},Tone.Timeline.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._timeline=null,this._toRemove=null,this._toAdd=null,this},Tone.Timeline}),Module(function(Tone){!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),Tone.Context=function(){Tone.Emitter.call(this);var options=Tone.defaults(arguments,["context"],Tone.Context);for(var prop in options.context||(options.context=new window.AudioContext),this._context=options.context,this._context)this._defineProperty(this._context,prop);this._latencyHint=options.latencyHint,this._constants={},this.lookAhead=options.lookAhead,this._computedUpdateInterval=0,this._ticker=new Ticker(this.emit.bind(this,"tick"),options.clockSource,options.updateInterval),this._timeouts=new Tone.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this))},Tone.extend(Tone.Context,Tone.Emitter),Tone.Emitter.mixin(Tone.Context),Tone.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},Tone.Context.prototype._defineProperty=function(context,prop){Tone.isUndef(this[prop])&&Object.defineProperty(this,prop,{get:function(){return"function"==typeof context[prop]?context[prop].bind(context):context[prop]},set:function(val){context[prop]=val}})},Tone.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},Tone.Context.prototype.getConstant=function(val){if(this._constants[val])return this._constants[val];for(var buffer=this._context.createBuffer(1,128,this._context.sampleRate),arr=buffer.getChannelData(0),i=0;i<arr.length;i++)arr[i]=val;var constant=this._context.createBufferSource();return constant.channelCount=1,constant.channelCountMode="explicit",constant.buffer=buffer,constant.loop=!0,constant.start(0),this._constants[val]=constant,constant},Tone.Context.prototype._timeoutLoop=function(){for(var now=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=now;)this._timeouts.shift().callback()},Tone.Context.prototype.setTimeout=function(fn,timeout){this._timeoutIds++;var now=this.now();return this._timeouts.add({callback:fn,time:now+timeout,id:this._timeoutIds}),this._timeoutIds},Tone.Context.prototype.clearTimeout=function(id){return this._timeouts.forEach(function(event){event.id===id&&this.remove(event)}),this},Object.defineProperty(Tone.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(interval){this._ticker.updateInterval=interval}}),Object.defineProperty(Tone.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(type){this._ticker.type=type}}),Object.defineProperty(Tone.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(hint){var lookAhead=hint;if(this._latencyHint=hint,Tone.isString(hint))switch(hint){case"interactive":lookAhead=.1,this._context.latencyHint=hint;break;case"playback":lookAhead=.8,this._context.latencyHint=hint;break;case"balanced":lookAhead=.25,this._context.latencyHint=hint;break;case"fastest":this._context.latencyHint="interactive",lookAhead=.01}this.lookAhead=lookAhead,this.updateInterval=lookAhead/3}}),Tone.Context.prototype.dispose=function(){for(var con in Tone.Context.emit("close",this),Tone.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null,this._constants)this._constants[con].disconnect();return this._constants=null,this.close(),this};var Ticker=function(callback,type,updateInterval){this._type=type,this._updateInterval=updateInterval,this._callback=Tone.defaultArg(callback,Tone.noOp),this._createClock()};return Ticker.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},Ticker.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var blob=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),blobUrl=URL.createObjectURL(blob),worker=new Worker(blobUrl);worker.onmessage=this._callback.bind(this),this._worker=worker},Ticker.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},Ticker.prototype._createClock=function(){if(this._type===Ticker.Type.Worker)try{this._createWorker()}catch(e){this._type=Ticker.Type.Timeout,this._createClock()}else this._type===Ticker.Type.Timeout&&this._createTimeout()},Object.defineProperty(Ticker.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(interval){this._updateInterval=Math.max(interval,128/44100),this._type===Ticker.Type.Worker&&this._worker.postMessage(Math.max(1e3*interval,1))}}),Object.defineProperty(Ticker.prototype,"type",{get:function(){return this._type},set:function(type){this._disposeClock(),this._type=type,this._createClock()}}),Ticker.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},Ticker.prototype.dispose=function(){this._disposeClock(),this._callback=null},Tone.getContext(function(){var nativeConnect=AudioNode.prototype.connect,nativeDisconnect=AudioNode.prototype.disconnect;function toneConnect(B,outNum,inNum){if(B.input)inNum=Tone.defaultArg(inNum,0),Tone.isArray(B.input)?this.connect(B.input[inNum]):this.connect(B.input,outNum,inNum);else try{B instanceof AudioNode?nativeConnect.call(this,B,outNum,inNum):nativeConnect.call(this,B,outNum)}catch(e){throw new Error("error connecting to node: "+B+"\n"+e)}}AudioNode.prototype.connect!==toneConnect&&(AudioNode.prototype.connect=toneConnect,AudioNode.prototype.disconnect=function(B,outNum,inNum){if(B&&B.input&&Tone.isArray(B.input))inNum=Tone.defaultArg(inNum,0),this.disconnect(B.input[inNum],outNum,0);else if(B&&B.input)this.disconnect(B.input,outNum,inNum);else try{nativeDisconnect.apply(this,arguments)}catch(e){throw new Error("error disconnecting node: "+B+"\n"+e)}})}),Tone.supported?Tone.context=new Tone.Context:console.warn("This browser does not support Tone.js"),Tone.Context}),Module(function(Tone){return Tone.AudioNode=function(){Tone.call(this);var options=Tone.defaults(arguments,["context"],{context:Tone.context});this._context=options.context},Tone.extend(Tone.AudioNode),Object.defineProperty(Tone.AudioNode.prototype,"context",{get:function(){return this._context}}),Tone.AudioNode.prototype.createInsOuts=function(inputs,outputs){1===inputs?this.input=this.context.createGain():inputs>1&&(this.input=new Array(inputs)),1===outputs?this.output=this.context.createGain():outputs>1&&(this.output=new Array(outputs))},Object.defineProperty(Tone.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?Tone.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(Tone.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?Tone.isArray(this.output)?this.output.length:1:0}}),Tone.AudioNode.prototype.connect=function(unit,outputNum,inputNum){return Tone.isArray(this.output)?(outputNum=Tone.defaultArg(outputNum,0),this.output[outputNum].connect(unit,0,inputNum)):this.output.connect(unit,outputNum,inputNum),this},Tone.AudioNode.prototype.disconnect=function(destination,outputNum,inputNum){Tone.isArray(this.output)?Tone.isNumber(destination)?this.output[destination].disconnect():(outputNum=Tone.defaultArg(outputNum,0),this.output[outputNum].disconnect(destination,0,inputNum)):this.output.disconnect.apply(this.output,arguments)},Tone.AudioNode.prototype.chain=function(){for(var currentUnit=this,i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit),currentUnit=toUnit}return this},Tone.AudioNode.prototype.fan=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return this},window.AudioNode&&(AudioNode.prototype.chain=Tone.AudioNode.prototype.chain,AudioNode.prototype.fan=Tone.AudioNode.prototype.fan),Tone.AudioNode.prototype.dispose=function(){return Tone.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),Tone.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this},Tone.AudioNode}),Module(function(Tone){return Tone.SignalBase=function(){Tone.AudioNode.call(this)},Tone.extend(Tone.SignalBase,Tone.AudioNode),Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){return Tone.Signal&&Tone.Signal===node.constructor||Tone.Param&&Tone.Param===node.constructor||Tone.TimelineSignal&&Tone.TimelineSignal===node.constructor?(node._param.cancelScheduledValues(0),node._param.value=0,node.overridden=!0):node instanceof AudioParam&&(node.cancelScheduledValues(0),node.value=0),Tone.AudioNode.prototype.connect.call(this,node,outputNumber,inputNumber),this},Tone.SignalBase}),Module(function(Tone){return Tone.WaveShaper=function(mapping,bufferLen){Tone.SignalBase.call(this),this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(mapping)?this.curve=mapping:isFinite(mapping)||Tone.isUndef(mapping)?this._curve=new Float32Array(Tone.defaultArg(mapping,1024)):Tone.isFunction(mapping)&&(this._curve=new Float32Array(Tone.defaultArg(bufferLen,1024)),this.setMap(mapping))},Tone.extend(Tone.WaveShaper,Tone.SignalBase),Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/(len-1)*2-1;this._curve[i]=mapping(normalized,i)}return this._shaper.curve=this._curve,this},Object.defineProperty(Tone.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(mapping){this._curve=new Float32Array(mapping),this._shaper.curve=this._curve}}),Object.defineProperty(Tone.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){if(-1===["none","2x","4x"].indexOf(oversampling))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=oversampling}}),Tone.WaveShaper.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},Tone.WaveShaper}),Module(function(Tone){return Tone.TimeBase=function(val,units){if(!(this instanceof Tone.TimeBase))return new Tone.TimeBase(val,units);if(this._expr=this._noOp,val instanceof Tone.TimeBase)this.copy(val);else if(!Tone.isUndef(units)||Tone.isNumber(val)){units=Tone.defaultArg(units,this._defaultUnits);var method=this._primaryExpressions[units].method;this._expr=method.bind(this,val)}else Tone.isString(val)?this.set(val):Tone.isUndef(val)&&(this._expr=this._defaultExpr())},Tone.extend(Tone.TimeBase),Tone.TimeBase.prototype.set=function(exprString){return this._expr=this._parseExprString(exprString),this},Tone.TimeBase.prototype.clone=function(){var instance=new this.constructor;return instance.copy(this),instance},Tone.TimeBase.prototype.copy=function(time){var val=time._expr();return this.set(val)},Tone.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(value){return 1===(value=parseInt(value))?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/value)}},t:{regexp:/^(\d+)t/i,method:function(value){return value=parseInt(value),this._beatsToUnits(8/(3*parseInt(value)))}},m:{regexp:/^(\d+)m/i,method:function(value){return this._beatsToUnits(parseInt(value)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(value){return this._ticksToUnits(parseInt(value))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(value){return this._frequencyToUnits(parseFloat(value))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(m,q,s){var total=0;return m&&"0"!==m&&(total+=this._beatsToUnits(this._timeSignature()*parseFloat(m))),q&&"0"!==q&&(total+=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(total+=this._beatsToUnits(parseFloat(s)/4)),total}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(value){return this._secondsToUnits(parseFloat(value))}},samples:{regexp:/^(\d+)samples/,method:function(value){return parseInt(value)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(value){return this._primaryExpressions[this._defaultUnits].method.call(this,value)}}},Tone.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(lh,rh){return lh()+rh()}},"-":{regexp:/^\-/,precedence:2,method:function(lh,rh){return lh()-rh()}},"*":{regexp:/^\*/,precedence:1,method:function(lh,rh){return lh()*rh()}},"/":{regexp:/^\//,precedence:1,method:function(lh,rh){return lh()/rh()}}},Tone.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(lh){return-lh()}}},Tone.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},Tone.TimeBase.prototype._tokenize=function(expr){for(var position=-1,tokens=[];expr.length>0;){var token=getNextToken(expr=expr.trim(),this);tokens.push(token),expr=expr.substr(token.value.length)}function getNextToken(expr,context){for(var expressions=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],i=0;i<expressions.length;i++){var group=context[expressions[i]];for(var opName in group){var op=group[opName],reg=op.regexp,match=expr.match(reg);if(null!==match)return{method:op.method,precedence:op.precedence,regexp:op.regexp,value:match[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}},Tone.TimeBase.prototype._matchGroup=function(token,group,prec){if(!Tone.isUndef(token))for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(Tone.isUndef(prec))return op;if(op.precedence===prec)return op}}return!1},Tone.TimeBase.prototype._parseBinary=function(lexer,precedence){var expr;Tone.isUndef(precedence)&&(precedence=2),expr=precedence<0?this._parseUnary(lexer):this._parseBinary(lexer,precedence-1);for(var token=lexer.peek();token&&this._matchGroup(token,this._binaryExpressions,precedence);)expr=(token=lexer.next()).method.bind(this,expr,this._parseBinary(lexer,precedence-1)),token=lexer.peek();return expr},Tone.TimeBase.prototype._parseUnary=function(lexer){var token,expr;token=lexer.peek();var op=this._matchGroup(token,this._unaryExpressions);return op?(token=lexer.next(),expr=this._parseUnary(lexer),op.method.bind(this,expr)):this._parsePrimary(lexer)},Tone.TimeBase.prototype._parsePrimary=function(lexer){var token,expr;if(token=lexer.peek(),Tone.isUndef(token))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(token,this._primaryExpressions)){var matching=(token=lexer.next()).value.match(token.regexp);return token.method.bind(this,matching[1],matching[2],matching[3])}if(token&&"("===token.value){if(lexer.next(),expr=this._parseBinary(lexer),!(token=lexer.next())||")"!==token.value)throw new SyntaxError("Expected )");return expr}throw new SyntaxError("Tone.TimeBase: Cannot process token "+token.value)},Tone.TimeBase.prototype._parseExprString=function(exprString){Tone.isString(exprString)||(exprString=exprString.toString());var lexer=this._tokenize(exprString);return this._parseBinary(lexer)},Tone.TimeBase.prototype._noOp=function(){return 0},Tone.TimeBase.prototype._defaultExpr=function(){return this._noOp},Tone.TimeBase.prototype._defaultUnits="s",Tone.TimeBase.prototype._frequencyToUnits=function(freq){return 1/freq},Tone.TimeBase.prototype._beatsToUnits=function(beats){return 60/Tone.Transport.bpm.value*beats},Tone.TimeBase.prototype._secondsToUnits=function(seconds){return seconds},Tone.TimeBase.prototype._ticksToUnits=function(ticks){return ticks*(this._beatsToUnits(1)/Tone.Transport.PPQ)},Tone.TimeBase.prototype._timeSignature=function(){return Tone.Transport.timeSignature},Tone.TimeBase.prototype._pushExpr=function(val,name,units){return val instanceof Tone.TimeBase||(val=new this.constructor(val,units)),this._expr=this._binaryExpressions[name].method.bind(this,this._expr,val._expr),this},Tone.TimeBase.prototype.add=function(val,units){return this._pushExpr(val,"+",units)},Tone.TimeBase.prototype.sub=function(val,units){return this._pushExpr(val,"-",units)},Tone.TimeBase.prototype.mult=function(val,units){return this._pushExpr(val,"*",units)},Tone.TimeBase.prototype.div=function(val,units){return this._pushExpr(val,"/",units)},Tone.TimeBase.prototype.valueOf=function(){return this._expr()},Tone.TimeBase.prototype.dispose=function(){this._expr=null},Tone.TimeBase}),Module(function(Tone){return Tone.Time=function(val,units){if(!(this instanceof Tone.Time))return new Tone.Time(val,units);this._plusNow=!1,Tone.TimeBase.call(this,val,units)},Tone.extend(Tone.Time,Tone.TimeBase),Tone.Time.prototype._unaryExpressions=Object.create(Tone.TimeBase.prototype._unaryExpressions),Tone.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(rh){return Tone.Transport.nextSubdivision(rh())}},Tone.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(lh){return this._plusNow=!0,lh()}},Tone.Time.prototype.quantize=function(subdiv,percent){return percent=Tone.defaultArg(percent,1),this._expr=function(expr,subdivision,percent){return expr=expr(),subdivision=subdivision.toSeconds(),expr+(Math.round(expr/subdivision)*subdivision-expr)*percent}.bind(this,this._expr,new this.constructor(subdiv),percent),this},Tone.Time.prototype.addNow=function(){return this._plusNow=!0,this},Tone.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},Tone.Time.prototype.copy=function(time){return Tone.TimeBase.prototype.copy.call(this,time),this._plusNow=time._plusNow,this},Tone.Time.prototype.toNotation=function(){var time=this.toSeconds(),retNotation=this._toNotationHelper(time,["1m","2n","4n","8n","16n","32n","64n","128n"]),retTripletNotation=this._toNotationHelper(time,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return retTripletNotation.split("+").length<retNotation.split("+").length?retTripletNotation:retNotation},Tone.Time.prototype._toNotationHelper=function(units,testNotations){for(var threshold=this._notationToUnits(testNotations[testNotations.length-1]),retNotation="",i=0;i<testNotations.length;i++){var notationTime=this._notationToUnits(testNotations[i]),multiple=units/notationTime;if(1-multiple%1<1e-6&&(multiple+=1e-6),(multiple=Math.floor(multiple))>0){if(retNotation+=1===multiple?testNotations[i]:multiple.toString()+"*"+testNotations[i],(units-=multiple*notationTime)<threshold)break;retNotation+=" + "}}return""===retNotation&&(retNotation="0"),retNotation},Tone.Time.prototype._notationToUnits=function(notation){for(var primaryExprs=this._primaryExpressions,notationExprs=[primaryExprs.n,primaryExprs.t,primaryExprs.m],i=0;i<notationExprs.length;i++){var expr=notationExprs[i],match=notation.match(expr.regexp);if(match)return expr.method.call(this,match[1])}},Tone.Time.prototype.toBarsBeatsSixteenths=function(){var quarterTime=this._beatsToUnits(1),quarters=this.toSeconds()/quarterTime,measures=Math.floor(quarters/this._timeSignature()),sixteenths=quarters%1*4;return quarters=Math.floor(quarters)%this._timeSignature(),(sixteenths=sixteenths.toString()).length>3&&(sixteenths=parseFloat(parseFloat(sixteenths).toFixed(3))),[measures,quarters,sixteenths].join(":")},Tone.Time.prototype.toTicks=function(){var quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.floor(quarters*Tone.Transport.PPQ)},Tone.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},Tone.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},Tone.Time.prototype.toSeconds=function(){return this.valueOf()},Tone.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},Tone.Time.prototype.valueOf=function(){return this._expr()+(this._plusNow?this.now():0)},Tone.Time}),Module(function(Tone){Tone.Frequency=function(val,units){if(!(this instanceof Tone.Frequency))return new Tone.Frequency(val,units);Tone.TimeBase.call(this,val,units)},Tone.extend(Tone.Frequency,Tone.TimeBase),Tone.Frequency.prototype._primaryExpressions=Object.create(Tone.TimeBase.prototype._primaryExpressions),Tone.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(value){return this.midiToFrequency(value)}},Tone.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(pitch,octave){var noteNumber=noteToScaleIndex[pitch.toLowerCase()]+12*(parseInt(octave)+1);return this.midiToFrequency(noteNumber)}},Tone.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(m,q,s){var total=1;return m&&"0"!==m&&(total*=this._beatsToUnits(this._timeSignature()*parseFloat(m))),q&&"0"!==q&&(total*=this._beatsToUnits(parseFloat(q))),s&&"0"!==s&&(total*=this._beatsToUnits(parseFloat(s)/4)),total}},Tone.Frequency.prototype.transpose=function(interval){return this._expr=function(expr,interval){return expr()*Tone.intervalToFrequencyRatio(interval)}.bind(this,this._expr,interval),this},Tone.Frequency.prototype.harmonize=function(intervals){return this._expr=function(expr,intervals){for(var val=expr(),ret=[],i=0;i<intervals.length;i++)ret[i]=val*Tone.intervalToFrequencyRatio(intervals[i]);return ret}.bind(this,this._expr,intervals),this},Tone.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},Tone.Frequency.prototype.toNote=function(){var freq=this.valueOf(),log=Math.log(freq/Tone.Frequency.A4)/Math.LN2,noteNumber=Math.round(12*log)+57,octave=Math.floor(noteNumber/12);return octave<0&&(noteNumber+=-12*octave),scaleIndexToNote[noteNumber%12]+octave.toString()},Tone.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},Tone.Frequency.prototype.toFrequency=function(){return this.valueOf()},Tone.Frequency.prototype.toTicks=function(){var quarterTime=this._beatsToUnits(1),quarters=this.valueOf()/quarterTime;return Math.floor(quarters*Tone.Transport.PPQ)},Tone.Frequency.prototype._frequencyToUnits=function(freq){return freq},Tone.Frequency.prototype._ticksToUnits=function(ticks){return 1/(60*ticks/(Tone.Transport.bpm.value*Tone.Transport.PPQ))},Tone.Frequency.prototype._beatsToUnits=function(beats){return 1/Tone.TimeBase.prototype._beatsToUnits.call(this,beats)},Tone.Frequency.prototype._secondsToUnits=function(seconds){return 1/seconds},Tone.Frequency.prototype._defaultUnits="hz";var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.Frequency.A4=440,Tone.Frequency.prototype.midiToFrequency=function(midi){return Tone.Frequency.A4*Math.pow(2,(midi-69)/12)},Tone.Frequency.prototype.frequencyToMidi=function(frequency){return 69+Math.round(12*Math.log(frequency/Tone.Frequency.A4)/Math.LN2)},Tone.Frequency}),Module(function(Tone){return Tone.TransportTime=function(val,units){if(!(this instanceof Tone.TransportTime))return new Tone.TransportTime(val,units);Tone.Time.call(this,val,units)},Tone.extend(Tone.TransportTime,Tone.Time),Tone.TransportTime.prototype._unaryExpressions=Object.create(Tone.Time.prototype._unaryExpressions),Tone.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(rh){var subdivision=this._secondsToTicks(rh()),multiple=Math.ceil(Tone.Transport.ticks/subdivision);return this._ticksToUnits(multiple*subdivision)}},Tone.TransportTime.prototype._secondsToTicks=function(seconds){var quarters=seconds/this._beatsToUnits(1);return Math.round(quarters*Tone.Transport.PPQ)},Tone.TransportTime.prototype.valueOf=function(){return this._secondsToTicks(this._expr())+(this._plusNow?Tone.Transport.ticks:0)},Tone.TransportTime.prototype.toTicks=function(){return this.valueOf()},Tone.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?Tone.Transport.seconds:0)},Tone.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},Tone.TransportTime}),Module(function(Tone){return Tone.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},Tone.prototype.toSeconds=function(time){return Tone.isNumber(time)?time:Tone.isUndef(time)?this.now():Tone.isString(time)?new Tone.Time(time).toSeconds():time instanceof Tone.TimeBase?time.toSeconds():void 0},Tone.prototype.toFrequency=function(freq){return Tone.isNumber(freq)?freq:Tone.isString(freq)||Tone.isUndef(freq)?new Tone.Frequency(freq).valueOf():freq instanceof Tone.TimeBase?freq.toFrequency():void 0},Tone.prototype.toTicks=function(time){return Tone.isNumber(time)||Tone.isString(time)?new Tone.TransportTime(time).toTicks():Tone.isUndef(time)?Tone.Transport.ticks:time instanceof Tone.TimeBase?time.toTicks():void 0},Tone}),Module(function(Tone){return Tone.Param=function(){var options=Tone.defaults(arguments,["param","units","convert"],Tone.Param);Tone.AudioNode.call(this),this._param=this.input=options.param,this.units=options.units,this.convert=options.convert,this.overridden=!1,this._lfo=null,Tone.isObject(options.lfo)?this.value=options.lfo:Tone.isUndef(options.value)||(this.value=options.value)},Tone.extend(Tone.Param,Tone.AudioNode),Tone.Param.defaults={units:Tone.Type.Default,convert:!0,param:void 0},Object.defineProperty(Tone.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){if(Tone.isObject(value)){if(Tone.isUndef(Tone.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new Tone.LFO(value).start(),this._lfo.connect(this.input)}else{var convertedVal=this._fromUnits(value);this._param.cancelScheduledValues(0),this._param.value=convertedVal}}}),Tone.Param.prototype._fromUnits=function(val){if(!this.convert&&!Tone.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return Tone.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}},Tone.Param.prototype._toUnits=function(val){if(!this.convert&&!Tone.isUndef(this.convert))return val;switch(this.units){case Tone.Type.Decibels:return Tone.gainToDb(val);default:return val}},Tone.Param.prototype._minOutput=1e-5,Tone.Param.prototype.setValueAtTime=function(value,time){return time=this.toSeconds(time),Tone.isPast(time),this._param.setValueAtTime(this._fromUnits(value),time),this},Tone.Param.prototype.setRampPoint=function(now){now=Tone.defaultArg(now,this.now()),this.cancelAndHoldAtTime(this.context.currentTime);var currentVal=this._param.value;return 0===currentVal&&(currentVal=this._minOutput),this._param.setValueAtTime(currentVal,now),this},Tone.Param.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),endTime=this.toSeconds(endTime),Tone.isPast(endTime),this._param.linearRampToValueAtTime(value,endTime),this},Tone.Param.prototype.exponentialRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),endTime=this.toSeconds(endTime),Tone.isPast(endTime),this._param.exponentialRampToValueAtTime(value,endTime),this},Tone.Param.prototype.exponentialRampTo=function(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.exponentialRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this},Tone.Param.prototype.linearRampTo=function(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.linearRampToValueAtTime(value,startTime+this.toSeconds(rampTime)),this},Tone.Param.prototype.getTimeConstant=function(time){return Math.log(this.toSeconds(time)+1)/Math.log(200)},Tone.Param.prototype.targetRampTo=function(value,rampTime,startTime){return startTime=this.toSeconds(startTime),this.setRampPoint(startTime),this.setTargetAtTime(value,startTime,this.getTimeConstant(rampTime)),this},Tone.Param.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),this._param.setTargetAtTime(value,this.toSeconds(startTime),timeConstant),this},Tone.Param.prototype.setValueCurveAtTime=function(values,startTime,duration){duration=this.toSeconds(duration),startTime=this.toSeconds(startTime),this.setValueAtTime(values[0],startTime);for(var segTime=duration/(values.length-1),i=1;i<values.length;i++)this._param.linearRampToValueAtTime(this._fromUnits(values[i]),startTime+i*segTime);return this},Tone.Param.prototype.cancelScheduledValues=function(startTime){return this._param.cancelScheduledValues(this.toSeconds(startTime)),this},Tone.Param.prototype.cancelAndHoldAtTime=function(cancelTime){if(cancelTime=this.toSeconds(cancelTime),this._param.cancelAndHoldAtTime)this._param.cancelAndHoldAtTime(cancelTime);else{var now=this.context.currentTime;this._param.cancelScheduledValues(now);var currentVal=this._param.value;0===currentVal&&(currentVal=this._minOutput),this._param.setValueAtTime(currentVal,now+this.sampleTime)}return this},Tone.Param.prototype.rampTo=function(value,rampTime,startTime){return rampTime=Tone.defaultArg(rampTime,.1),this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM||this.units===Tone.Type.Decibels?this.exponentialRampTo(value,rampTime,startTime):this.linearRampTo(value,rampTime,startTime),this},Object.defineProperty(Tone.Param.prototype,"lfo",{get:function(){return this._lfo}}),Tone.Param.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},Tone.Param}),Module(function(Tone){return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),Tone.Gain=function(){var options=Tone.defaults(arguments,["gain","units"],Tone.Gain);Tone.AudioNode.call(this),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new Tone.Param({param:this._gainNode.gain,units:options.units,value:options.gain,convert:options.convert}),this._readOnly("gain")},Tone.extend(Tone.Gain,Tone.AudioNode),Tone.Gain.defaults={gain:1,convert:!0},Tone.Gain.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},Tone.Gain}),Module(function(Tone){return Tone.Signal=function(){var options=Tone.defaults(arguments,["value","units"],Tone.Signal),gainNode=Tone.context.createGain();options.param=gainNode.gain,Tone.Param.call(this,options),this.output=gainNode,this.input=this._param=this.output.gain,this.context.getConstant(1).connect(this.output)},Tone.extend(Tone.Signal,Tone.Param),Tone.Signal.defaults={value:0,units:Tone.Type.Default,convert:!0},Tone.Signal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.Signal.prototype.dispose=function(){return Tone.Param.prototype.dispose.call(this),this},Tone.Signal}),Module(function(Tone){return Tone.TimelineSignal=function(){var options=Tone.defaults(arguments,["value","units"],Tone.Signal);Tone.Signal.call(this,options),this._events=new Tone.Timeline(100),this._initial=this._fromUnits(this._param.value),this.value=options.value,delete this.input},Tone.extend(Tone.TimelineSignal,Tone.Signal),Tone.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(Tone.TimelineSignal.prototype,"value",{get:function(){var now=this.now(),val=this.getValueAtTime(now);return this._toUnits(val)},set:function(value){if(this._events){var convertedVal=this._fromUnits(value);this._initial=convertedVal,this.cancelScheduledValues(),this._param.value=convertedVal}}}),Tone.TimelineSignal.prototype.setValueAtTime=function(value,startTime){return value=this._fromUnits(value),startTime=this.toSeconds(startTime),this._events.add({type:Tone.TimelineSignal.Type.Set,value:value,time:startTime}),this._param.setValueAtTime(value,startTime),this},Tone.TimelineSignal.prototype.linearRampToValueAtTime=function(value,endTime){return value=this._fromUnits(value),endTime=this.toSeconds(endTime),this._events.add({type:Tone.TimelineSignal.Type.Linear,value:value,time:endTime}),this._param.linearRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.exponentialRampToValueAtTime=function(value,endTime){endTime=this.toSeconds(endTime);var beforeEvent=this._searchBefore(endTime);beforeEvent&&0===beforeEvent.value&&this.setValueAtTime(this._minOutput,beforeEvent.time),value=this._fromUnits(value);var setValue=Math.max(value,this._minOutput);return this._events.add({type:Tone.TimelineSignal.Type.Exponential,value:setValue,time:endTime}),value<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,endTime-this.sampleTime),this.setValueAtTime(0,endTime)):this._param.exponentialRampToValueAtTime(value,endTime),this},Tone.TimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){return value=this._fromUnits(value),value=Math.max(this._minOutput,value),timeConstant=Math.max(this._minOutput,timeConstant),startTime=this.toSeconds(startTime),this._events.add({type:Tone.TimelineSignal.Type.Target,value:value,time:startTime,constant:timeConstant}),this._param.setTargetAtTime(value,startTime,timeConstant),this},Tone.TimelineSignal.prototype.setValueCurveAtTime=function(values,startTime,duration,scaling){scaling=Tone.defaultArg(scaling,1),duration=this.toSeconds(duration),startTime=this.toSeconds(startTime);var segTime=duration/(values.length-1);this.setValueAtTime(values[0]*scaling,startTime);for(var i=1;i<values.length;i++)this.linearRampToValueAtTime(values[i]*scaling,startTime+i*segTime);return this},Tone.TimelineSignal.prototype.cancelScheduledValues=function(after){return after=this.toSeconds(after),this._events.cancel(after),this._param.cancelScheduledValues(after),this},Tone.TimelineSignal.prototype.cancelAndHoldAtTime=function(cancelTime){return this.setRampPoint(this.toSeconds(cancelTime)),this},Tone.TimelineSignal.prototype.setRampPoint=function(time){time=this.toSeconds(time);var val=this._toUnits(this.getValueAtTime(time)),before=this._searchBefore(time);if(before&&before.time===time)this.cancelScheduledValues(time+this.sampleTime);else{var after=this._searchAfter(time);after&&(this.cancelScheduledValues(time),after.type===Tone.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(val,time):after.type===Tone.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(val,time))}return this.setValueAtTime(val,time),this},Tone.TimelineSignal.prototype.linearRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.linearRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype.exponentialRampToValueBetween=function(value,start,finish){return this.setRampPoint(start),this.exponentialRampToValueAtTime(value,finish),this},Tone.TimelineSignal.prototype._searchBefore=function(time){return this._events.get(time)},Tone.TimelineSignal.prototype._searchAfter=function(time){return this._events.getAfter(time)},Tone.TimelineSignal.prototype.getValueAtTime=function(time){time=this.toSeconds(time);var after=this._searchAfter(time),before=this._searchBefore(time),value=this._initial;if(null===before)value=this._initial;else if(before.type===Tone.TimelineSignal.Type.Target){var previousVal,previous=this._events.getBefore(before.time);previousVal=null===previous?this._initial:previous.value,value=this._exponentialApproach(before.time,previousVal,before.value,before.constant,time)}else value=null===after?before.value:after.type===Tone.TimelineSignal.Type.Linear?this._linearInterpolate(before.time,before.value,after.time,after.value,time):after.type===Tone.TimelineSignal.Type.Exponential?this._exponentialInterpolate(before.time,before.value,after.time,after.value,time):before.value;return value},Tone.TimelineSignal.prototype.connect=Tone.SignalBase.prototype.connect,Tone.TimelineSignal.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)},Tone.TimelineSignal.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(t-t0)/(t1-t0)*(v1-v0)},Tone.TimelineSignal.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){return(v0=Math.max(this._minOutput,v0))*Math.pow(v1/v0,(t-t0)/(t1-t0))},Tone.TimelineSignal.prototype.dispose=function(){Tone.Signal.prototype.dispose.call(this),this._events.dispose(),this._events=null},Tone.TimelineSignal}),Module(function(Tone){return Tone.Pow=function(exp){Tone.SignalBase.call(this),this._exp=Tone.defaultArg(exp,1),this._expScaler=this.input=this.output=new Tone.WaveShaper(this._expFunc(this._exp),8192)},Tone.extend(Tone.Pow,Tone.SignalBase),Object.defineProperty(Tone.Pow.prototype,"value",{get:function(){return this._exp},set:function(exp){this._exp=exp,this._expScaler.setMap(this._expFunc(this._exp))}}),Tone.Pow.prototype._expFunc=function(exp){return function(val){return Math.pow(Math.abs(val),exp)}},Tone.Pow.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},Tone.Pow}),Module(function(Tone){return Tone.Envelope=function(){var options=Tone.defaults(arguments,["attack","decay","sustain","release"],Tone.Envelope);Tone.AudioNode.call(this),this.attack=options.attack,this.decay=options.decay,this.sustain=options.sustain,this.release=options.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new Tone.TimelineSignal,this._sig.setValueAtTime(0,0),this.attackCurve=options.attackCurve,this.releaseCurve=options.releaseCurve},Tone.extend(Tone.Envelope,Tone.AudioNode),Tone.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(Tone.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(Tone.Envelope.prototype,"attackCurve",{get:function(){if(Tone.isString(this._attackCurve))return this._attackCurve;if(Tone.isArray(this._attackCurve)){for(var type in Tone.Envelope.Type)if(Tone.Envelope.Type[type].In===this._attackCurve)return type;return this._attackCurve}},set:function(curve){if(Tone.Envelope.Type.hasOwnProperty(curve)){var curveDef=Tone.Envelope.Type[curve];Tone.isObject(curveDef)?this._attackCurve=curveDef.In:this._attackCurve=curveDef}else{if(!Tone.isArray(curve))throw new Error("Tone.Envelope: invalid curve: "+curve);this._attackCurve=curve}}}),Object.defineProperty(Tone.Envelope.prototype,"releaseCurve",{get:function(){if(Tone.isString(this._releaseCurve))return this._releaseCurve;if(Tone.isArray(this._releaseCurve)){for(var type in Tone.Envelope.Type)if(Tone.Envelope.Type[type].Out===this._releaseCurve)return type;return this._releaseCurve}},set:function(curve){if(Tone.Envelope.Type.hasOwnProperty(curve)){var curveDef=Tone.Envelope.Type[curve];Tone.isObject(curveDef)?this._releaseCurve=curveDef.Out:this._releaseCurve=curveDef}else{if(!Tone.isArray(curve))throw new Error("Tone.Envelope: invalid curve: "+curve);this._releaseCurve=curve}}}),Tone.Envelope.prototype.triggerAttack=function(time,velocity){time=this.toSeconds(time);var originalAttack=this.toSeconds(this.attack),attack=originalAttack,decay=this.toSeconds(this.decay);velocity=Tone.defaultArg(velocity,1);var currentValue=this.getValueAtTime(time);currentValue>0&&(attack=(1-currentValue)/(1/attack));if("linear"===this._attackCurve)this._sig.linearRampTo(velocity,attack,time);else if("exponential"===this._attackCurve)this._sig.targetRampTo(velocity,attack,time);else if(attack>0){this._sig.setRampPoint(time);var curve=this._attackCurve;if(attack<originalAttack){var percentComplete=1-attack/originalAttack,sliceIndex=Math.floor(percentComplete*this._attackCurve.length);(curve=this._attackCurve.slice(sliceIndex))[0]=currentValue}this._sig.setValueCurveAtTime(curve,time,attack,velocity)}return this._sig.targetRampTo(velocity*this.sustain,decay,attack+time),this},Tone.Envelope.prototype.triggerRelease=function(time){time=this.toSeconds(time);var currentValue=this.getValueAtTime(time);if(currentValue>0){var release=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampTo(0,release,time);else if("exponential"===this._releaseCurve)this._sig.targetRampTo(0,release,time);else{var curve=this._releaseCurve;Tone.isArray(curve)&&(this._sig.setRampPoint(time),this._sig.setValueCurveAtTime(curve,time,release,currentValue))}}return this},Tone.Envelope.prototype.getValueAtTime=function(time){return this._sig.getValueAtTime(time)},Tone.Envelope.prototype.triggerAttackRelease=function(duration,time,velocity){return time=this.toSeconds(time),this.triggerAttack(time,velocity),this.triggerRelease(time+this.toSeconds(duration)),this},Tone.Envelope.prototype.cancel=function(after){return this._sig.cancelScheduledValues(after),this},Tone.Envelope.prototype.connect=Tone.Signal.prototype.connect,function(){var i,k,cosineCurve=[];for(i=0;i<128;i++)cosineCurve[i]=Math.sin(i/127*(Math.PI/2));var rippleCurve=[];for(i=0;i<127;i++){k=i/127;var sineWave=Math.sin(k*(2*Math.PI)*6.4-Math.PI/2)+1;rippleCurve[i]=sineWave/10+.83*k}rippleCurve[127]=1;var stairsCurve=[];for(i=0;i<128;i++)stairsCurve[i]=Math.ceil(i/127*5)/5;var sineCurve=[];for(i=0;i<128;i++)k=i/127,sineCurve[i]=.5*(1-Math.cos(Math.PI*k));var curve,bounceCurve=[];for(i=0;i<128;i++){k=i/127;var freq=4*Math.pow(k,3)+.2,val=Math.cos(freq*Math.PI*2*k);bounceCurve[i]=Math.abs(val*(1-k))}function invertCurve(curve){for(var out=new Array(curve.length),j=0;j<curve.length;j++)out[j]=1-curve[j];return out}Tone.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:invertCurve(bounceCurve),Out:bounceCurve},cosine:{In:cosineCurve,Out:(curve=cosineCurve,curve.slice(0).reverse())},step:{In:stairsCurve,Out:invertCurve(stairsCurve)},ripple:{In:rippleCurve,Out:invertCurve(rippleCurve)},sine:{In:sineCurve,Out:invertCurve(sineCurve)}}}(),Tone.Envelope.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},Tone.Envelope}),Module(function(Tone){return Tone.AmplitudeEnvelope=function(){Tone.Envelope.apply(this,arguments),this.input=this.output=new Tone.Gain,this._sig.connect(this.output.gain)},Tone.extend(Tone.AmplitudeEnvelope,Tone.Envelope),Tone.AmplitudeEnvelope.prototype.dispose=function(){return Tone.Envelope.prototype.dispose.call(this),this},Tone.AmplitudeEnvelope}),Module(function(Tone){return window.AnalyserNode&&!AnalyserNode.prototype.getFloatTimeDomainData&&(AnalyserNode.prototype.getFloatTimeDomainData=function(array){var uint8=new Uint8Array(array.length);this.getByteTimeDomainData(uint8);for(var i=0;i<uint8.length;i++)array[i]=(uint8[i]-128)/128}),Tone.Analyser=function(){var options=Tone.defaults(arguments,["type","size"],Tone.Analyser);Tone.AudioNode.call(this),this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=options.type,this._buffer=null,this.size=options.size,this.type=options.type},Tone.extend(Tone.Analyser,Tone.AudioNode),Tone.Analyser.defaults={size:1024,type:"fft",smoothing:.8},Tone.Analyser.Type={Waveform:"waveform",FFT:"fft"},Tone.Analyser.prototype.getValue=function(){return this._type===Tone.Analyser.Type.FFT?this._analyser.getFloatFrequencyData(this._buffer):this._type===Tone.Analyser.Type.Waveform&&this._analyser.getFloatTimeDomainData(this._buffer),this._buffer},Object.defineProperty(Tone.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(size){this._analyser.fftSize=2*size,this._buffer=new Float32Array(size)}}),Object.defineProperty(Tone.Analyser.prototype,"type",{get:function(){return this._type},set:function(type){if(type!==Tone.Analyser.Type.Waveform&&type!==Tone.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+type);this._type=type}}),Object.defineProperty(Tone.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(val){this._analyser.smoothingTimeConstant=val}}),Tone.Analyser.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},Tone.Analyser}),Module(function(Tone){return Tone.Compressor=function(){var options=Tone.defaults(arguments,["threshold","ratio"],Tone.Compressor);Tone.AudioNode.call(this),this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new Tone.Param({param:this._compressor.threshold,units:Tone.Type.Decibels,convert:!1}),this.attack=new Tone.Param(this._compressor.attack,Tone.Type.Time),this.release=new Tone.Param(this._compressor.release,Tone.Type.Time),this.knee=new Tone.Param({param:this._compressor.knee,units:Tone.Type.Decibels,convert:!1}),this.ratio=new Tone.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(options)},Tone.extend(Tone.Compressor,Tone.AudioNode),Tone.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},Tone.Compressor.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},Tone.Compressor}),Module(function(Tone){return Tone.Add=function(value){Tone.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new Tone.Gain,this._param=this.input[1]=new Tone.Signal(value),this._param.connect(this._sum)},Tone.extend(Tone.Add,Tone.Signal),Tone.Add.prototype.dispose=function(){return Tone.Signal.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this},Tone.Add}),Module(function(Tone){return Tone.Multiply=function(value){Tone.Signal.call(this),this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new Tone.Gain,this._param=this.input[1]=this.output.gain,this._param.value=Tone.defaultArg(value,0)},Tone.extend(Tone.Multiply,Tone.Signal),Tone.Multiply.prototype.dispose=function(){return Tone.Signal.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},Tone.Multiply}),Module(function(Tone){return Tone.Negate=function(){Tone.SignalBase.call(this),this._multiply=this.input=this.output=new Tone.Multiply(-1)},Tone.extend(Tone.Negate,Tone.SignalBase),Tone.Negate.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},Tone.Negate}),Module(function(Tone){return Tone.Subtract=function(value){Tone.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new Tone.Gain,this._neg=new Tone.Negate,this._param=this.input[1]=new Tone.Signal(value),this._param.chain(this._neg,this._sum)},Tone.extend(Tone.Subtract,Tone.Signal),Tone.Subtract.prototype.dispose=function(){return Tone.Signal.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this},Tone.Subtract}),Module(function(Tone){return Tone.GreaterThanZero=function(){Tone.SignalBase.call(this),this._thresh=this.output=new Tone.WaveShaper(function(val){return val<=0?0:1},127),this._scale=this.input=new Tone.Multiply(1e4),this._scale.connect(this._thresh)},Tone.extend(Tone.GreaterThanZero,Tone.SignalBase),Tone.GreaterThanZero.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},Tone.GreaterThanZero}),Module(function(Tone){return Tone.GreaterThan=function(value){Tone.Signal.call(this),this.createInsOuts(2,0),this._param=this.input[0]=new Tone.Subtract(value),this.input[1]=this._param.input[1],this._gtz=this.output=new Tone.GreaterThanZero,this._param.connect(this._gtz)},Tone.extend(Tone.GreaterThan,Tone.Signal),Tone.GreaterThan.prototype.dispose=function(){return Tone.Signal.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this},Tone.GreaterThan}),Module(function(Tone){return Tone.Abs=function(){Tone.SignalBase.call(this),this._abs=this.input=this.output=new Tone.WaveShaper(function(val){return 0===val?0:Math.abs(val)},127)},Tone.extend(Tone.Abs,Tone.SignalBase),Tone.Abs.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},Tone.Abs}),Module(function(Tone){return Tone.Modulo=function(modulus){Tone.SignalBase.call(this),this.createInsOuts(1,0),this._shaper=new Tone.WaveShaper(Math.pow(2,16)),this._multiply=new Tone.Multiply,this._subtract=this.output=new Tone.Subtract,this._modSignal=new Tone.Signal(modulus),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(modulus)},Tone.extend(Tone.Modulo,Tone.SignalBase),Tone.Modulo.prototype._setWaveShaper=function(mod){this._shaper.setMap(function(val){return Math.floor((val+1e-4)/mod)})},Object.defineProperty(Tone.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(mod){this._modSignal.value=mod,this._setWaveShaper(mod)}}),Tone.Modulo.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},Tone.Modulo}),Module(function(Tone){return Tone.AudioToGain=function(){Tone.SignalBase.call(this),this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return(x+1)/2})},Tone.extend(Tone.AudioToGain,Tone.SignalBase),Tone.AudioToGain.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},Tone.AudioToGain}),Module(function(Tone){function applyBinary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),self._eval(args[1]).connect(op,0,1),op}function applyUnary(Constructor,args,self){var op=new Constructor;return self._eval(args[0]).connect(op,0,0),op}function getNumber(arg){return arg?parseFloat(arg):void 0}function literalNumber(arg){return arg&&arg.args?parseFloat(arg.args):void 0}return Tone.Expr=function(){Tone.SignalBase.call(this);var expr=this._replacements(Array.prototype.slice.call(arguments)),inputCount=this._parseInputs(expr);this._nodes=[],this.input=new Array(inputCount);for(var i=0;i<inputCount;i++)this.input[i]=this.context.createGain();var result,tree=this._parseTree(expr);try{result=this._eval(tree)}catch(e){throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+expr)}this.output=result},Tone.extend(Tone.Expr,Tone.SignalBase),Tone.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(arg){return new Tone.Signal(getNumber(arg))}},input:{regexp:/^\$\d/,method:function(arg,self){return self.input[getNumber(arg.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:applyUnary.bind(this,Tone.Abs)},mod:{regexp:/^mod/,method:function(args,self){var modulus=literalNumber(args[1]),op=new Tone.Modulo(modulus);return self._eval(args[0]).connect(op),op}},pow:{regexp:/^pow/,method:function(args,self){var exp=literalNumber(args[1]),op=new Tone.Pow(exp);return self._eval(args[0]).connect(op),op}},a2g:{regexp:/^a2g/,method:function(args,self){var op=new Tone.AudioToGain;return self._eval(args[0]).connect(op),op}}},binary:{"+":{regexp:/^\+/,precedence:1,method:applyBinary.bind(this,Tone.Add)},"-":{regexp:/^\-/,precedence:1,method:function(args,self){return 1===args.length?applyUnary(Tone.Negate,args,self):applyBinary(Tone.Subtract,args,self)}},"*":{regexp:/^\*/,precedence:0,method:applyBinary.bind(this,Tone.Multiply)}},unary:{"-":{regexp:/^\-/,method:applyUnary.bind(this,Tone.Negate)},"!":{regexp:/^\!/,method:applyUnary.bind(this,Tone.NOT)}}},Tone.Expr.prototype._parseInputs=function(expr){var inputArray=expr.match(/\$\d/g),inputMax=0;if(null!==inputArray)for(var i=0;i<inputArray.length;i++){var inputNum=parseInt(inputArray[i].substr(1))+1;inputMax=Math.max(inputMax,inputNum)}return inputMax},Tone.Expr.prototype._replacements=function(args){for(var expr=args.shift(),i=0;i<args.length;i++)expr=expr.replace(/\%/i,args[i]);return expr},Tone.Expr.prototype._tokenize=function(expr){for(var position=-1,tokens=[];expr.length>0;){var token=getNextToken(expr=expr.trim());tokens.push(token),expr=expr.substr(token.value.length)}function getNextToken(expr){for(var type in Tone.Expr._Expressions){var group=Tone.Expr._Expressions[type];for(var opName in group){var op=group[opName],reg=op.regexp,match=expr.match(reg);if(null!==match)return{type:type,value:match[0],method:op.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}},Tone.Expr.prototype._parseTree=function(expr){var lexer=this._tokenize(expr),isUndef=Tone.isUndef.bind(this);function matchSyntax(token,syn){return!isUndef(token)&&"glue"===token.type&&token.value===syn}function matchGroup(token,groupName,prec){var group=Tone.Expr._Expressions[groupName];if(!isUndef(token))for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(isUndef(prec))return!0;if(op.precedence===prec)return!0}}return!1}function parseExpression(precedence){var expr;isUndef(precedence)&&(precedence=5),expr=precedence<0?function parseUnary(){var token,expr;token=lexer.peek();if(matchGroup(token,"unary"))return token=lexer.next(),expr=parseUnary(),{operator:token.value,method:token.method,args:[expr]};return function(){var token,expr;if(token=lexer.peek(),isUndef(token))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if("func"===token.type)return function(func){var args=[];if(!matchSyntax(lexer.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+func.value+'"');matchSyntax(lexer.peek(),")")||(args=function(){var expr,args=[];for(;expr=parseExpression(),!isUndef(expr)&&(args.push(expr),matchSyntax(lexer.peek(),","));)lexer.next();return args}());if(!matchSyntax(lexer.next(),")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+func.value+'"');return{method:func.method,args:args,name:name}}(token=lexer.next());if("value"===token.type)return{method:(token=lexer.next()).method,args:token.value};if(matchSyntax(token,"(")){if(lexer.next(),expr=parseExpression(),!matchSyntax(token=lexer.next(),")"))throw new SyntaxError("Expected )");return expr}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+token.value)}()}():parseExpression(precedence-1);for(var token=lexer.peek();matchGroup(token,"binary",precedence);)expr={operator:(token=lexer.next()).value,method:token.method,args:[expr,parseExpression(precedence-1)]},token=lexer.peek();return expr}return parseExpression()},Tone.Expr.prototype._eval=function(tree){if(!Tone.isUndef(tree)){var node=tree.method(tree.args,this);return this._nodes.push(node),node}},Tone.Expr.prototype._disposeNodes=function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];Tone.isFunction(node.dispose)?node.dispose():Tone.isFunction(node.disconnect)&&node.disconnect(),node=null,this._nodes[i]=null}this._nodes=null},Tone.Expr.prototype.dispose=function(){Tone.SignalBase.prototype.dispose.call(this),this._disposeNodes()},Tone.Expr}),Module(function(Tone){return Tone.EqualPowerGain=function(){Tone.SignalBase.call(this),this._eqPower=this.input=this.output=new Tone.WaveShaper(function(val){return Math.abs(val)<.001?0:Tone.equalPowerScale(val)}.bind(this),4096)},Tone.extend(Tone.EqualPowerGain,Tone.SignalBase),Tone.EqualPowerGain.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},Tone.EqualPowerGain}),Module(function(Tone){return Tone.CrossFade=function(initialFade){Tone.AudioNode.call(this),this.createInsOuts(2,1),this.a=this.input[0]=new Tone.Gain,this.b=this.input[1]=new Tone.Gain,this.fade=new Tone.Signal(Tone.defaultArg(initialFade,.5),Tone.Type.NormalRange),this._equalPowerA=new Tone.EqualPowerGain,this._equalPowerB=new Tone.EqualPowerGain,this._invert=new Tone.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},Tone.extend(Tone.CrossFade,Tone.AudioNode),Tone.CrossFade.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},Tone.CrossFade}),Module(function(Tone){return Tone.Filter=function(){var options=Tone.defaults(arguments,["frequency","type","rolloff"],Tone.Filter);Tone.AudioNode.call(this),this.createInsOuts(1,1),this._filters=[],this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(0,Tone.Type.Cents),this.gain=new Tone.Signal({value:options.gain,convert:!1}),this.Q=new Tone.Signal(options.Q),this._type=options.type,this._rolloff=options.rolloff,this.rolloff=options.rolloff,this._readOnly(["detune","frequency","gain","Q"])},Tone.extend(Tone.Filter,Tone.AudioNode),Tone.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(Tone.Filter.prototype,"type",{get:function(){return this._type},set:function(type){if(-1===["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(type))throw new TypeError("Tone.Filter: invalid type "+type);this._type=type;for(var i=0;i<this._filters.length;i++)this._filters[i].type=type}}),Object.defineProperty(Tone.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(rolloff){rolloff=parseInt(rolloff,10);var cascadingCount=[-12,-24,-48,-96].indexOf(rolloff);if(-1===cascadingCount)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");cascadingCount+=1,this._rolloff=rolloff,this.input.disconnect();for(var i=0;i<this._filters.length;i++)this._filters[i].disconnect(),this._filters[i]=null;this._filters=new Array(cascadingCount);for(var count=0;count<cascadingCount;count++){var filter=this.context.createBiquadFilter();filter.type=this._type,this.frequency.connect(filter.frequency),this.detune.connect(filter.detune),this.Q.connect(filter.Q),this.gain.connect(filter.gain),this._filters[count]=filter}var connectionChain=[this.input].concat(this._filters).concat([this.output]);Tone.connectSeries.apply(Tone,connectionChain)}}),Tone.Filter.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this);for(var i=0;i<this._filters.length;i++)this._filters[i].disconnect(),this._filters[i]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},Tone.Filter}),Module(function(Tone){return Tone.MultibandSplit=function(){var options=Tone.defaults(arguments,["lowFrequency","highFrequency"],Tone.MultibandSplit);Tone.AudioNode.call(this),this.input=new Tone.Gain,this.output=new Array(3),this.low=this.output[0]=new Tone.Filter(0,"lowpass"),this._lowMidFilter=new Tone.Filter(0,"highpass"),this.mid=this.output[1]=new Tone.Filter(0,"lowpass"),this.high=this.output[2]=new Tone.Filter(0,"highpass"),this.lowFrequency=new Tone.Signal(options.lowFrequency,Tone.Type.Frequency),this.highFrequency=new Tone.Signal(options.highFrequency,Tone.Type.Frequency),this.Q=new Tone.Signal(options.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},Tone.extend(Tone.MultibandSplit,Tone.AudioNode),Tone.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},Tone.MultibandSplit.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},Tone.MultibandSplit}),Module(function(Tone){return Tone.EQ3=function(){var options=Tone.defaults(arguments,["low","mid","high"],Tone.EQ3);Tone.AudioNode.call(this),this.output=new Tone.Gain,this._multibandSplit=this.input=new Tone.MultibandSplit({lowFrequency:options.lowFrequency,highFrequency:options.highFrequency}),this._lowGain=new Tone.Gain(options.low,Tone.Type.Decibels),this._midGain=new Tone.Gain(options.mid,Tone.Type.Decibels),this._highGain=new Tone.Gain(options.high,Tone.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},Tone.extend(Tone.EQ3,Tone.AudioNode),Tone.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},Tone.EQ3.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},Tone.EQ3}),Module(function(Tone){return Tone.Scale=function(outputMin,outputMax){Tone.SignalBase.call(this),this._outputMin=Tone.defaultArg(outputMin,0),this._outputMax=Tone.defaultArg(outputMax,1),this._scale=this.input=new Tone.Multiply(1),this._add=this.output=new Tone.Add(0),this._scale.connect(this._add),this._setRange()},Tone.extend(Tone.Scale,Tone.SignalBase),Object.defineProperty(Tone.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(min){this._outputMin=min,this._setRange()}}),Object.defineProperty(Tone.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(max){this._outputMax=max,this._setRange()}}),Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},Tone.Scale.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},Tone.Scale}),Module(function(Tone){return Tone.ScaleExp=function(outputMin,outputMax,exponent){Tone.SignalBase.call(this),this._scale=this.output=new Tone.Scale(outputMin,outputMax),this._exp=this.input=new Tone.Pow(Tone.defaultArg(exponent,2)),this._exp.connect(this._scale)},Tone.extend(Tone.ScaleExp,Tone.SignalBase),Object.defineProperty(Tone.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}}),Object.defineProperty(Tone.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(min){this._scale.min=min}}),Object.defineProperty(Tone.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(max){this._scale.max=max}}),Tone.ScaleExp.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},Tone.ScaleExp}),Module(function(Tone){return window.DelayNode&&!AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),Tone.Delay=function(){var options=Tone.defaults(arguments,["delayTime","maxDelay"],Tone.Delay);Tone.AudioNode.call(this),this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(options.maxDelay)),this.delayTime=new Tone.Param({param:this._delayNode.delayTime,units:Tone.Type.Time,value:options.delayTime}),this._readOnly("delayTime")},Tone.extend(Tone.Delay,Tone.AudioNode),Tone.Delay.defaults={maxDelay:1,delayTime:0},Tone.Delay.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},Tone.Delay}),Module(function(Tone){return Tone.FeedbackCombFilter=function(){var options=Tone.defaults(arguments,["delayTime","resonance"],Tone.FeedbackCombFilter);Tone.AudioNode.call(this),this._delay=this.input=this.output=new Tone.Delay(options.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new Tone.Gain(options.resonance,Tone.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},Tone.extend(Tone.FeedbackCombFilter,Tone.AudioNode),Tone.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},Tone.FeedbackCombFilter.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},Tone.FeedbackCombFilter}),Module(function(Tone){return Tone.FFT=function(){var options=Tone.defaults(arguments,["size"],Tone.FFT);options.type=Tone.Analyser.Type.FFT,Tone.AudioNode.call(this),this._analyser=this.input=this.output=new Tone.Analyser(options)},Tone.extend(Tone.FFT,Tone.AudioNode),Tone.FFT.defaults={size:1024},Tone.FFT.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(Tone.FFT.prototype,"size",{get:function(){return this._analyser.size},set:function(size){this._analyser.size=size}}),Tone.FFT.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},Tone.FFT}),Module(function(Tone){return Tone.Follower=function(){var options=Tone.defaults(arguments,["attack","release"],Tone.Follower);Tone.AudioNode.call(this),this.createInsOuts(1,1),this._abs=new Tone.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new Tone.WaveShaper,this._sub=new Tone.Subtract,this._delay=new Tone.Delay(this.blockTime),this._mult=new Tone.Multiply(1e4),this._attack=options.attack,this._release=options.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},Tone.extend(Tone.Follower,Tone.AudioNode),Tone.Follower.defaults={attack:.05,release:.5},Tone.Follower.prototype._setAttackRelease=function(attack,release){var minTime=this.blockTime;attack=Tone.Time(attack).toFrequency(),release=Tone.Time(release).toFrequency(),attack=Math.max(attack,minTime),release=Math.max(release,minTime),this._frequencyValues.setMap(function(val){return val<=0?attack:release})},Object.defineProperty(Tone.Follower.prototype,"attack",{get:function(){return this._attack},set:function(attack){this._attack=attack,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(Tone.Follower.prototype,"release",{get:function(){return this._release},set:function(release){this._release=release,this._setAttackRelease(this._attack,this._release)}}),Tone.Follower.prototype.connect=Tone.Signal.prototype.connect,Tone.Follower.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},Tone.Follower}),Module(function(Tone){return Tone.ScaledEnvelope=function(){var options=Tone.defaults(arguments,["attack","decay","sustain","release"],Tone.Envelope);Tone.Envelope.call(this,options),options=Tone.defaultArg(options,Tone.ScaledEnvelope.defaults),this._exp=this.output=new Tone.Pow(options.exponent),this._scale=this.output=new Tone.Scale(options.min,options.max),this._sig.chain(this._exp,this._scale)},Tone.extend(Tone.ScaledEnvelope,Tone.Envelope),Tone.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(Tone.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(min){this._scale.min=min}}),Object.defineProperty(Tone.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(max){this._scale.max=max}}),Object.defineProperty(Tone.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}}),Tone.ScaledEnvelope.prototype.dispose=function(){return Tone.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},Tone.ScaledEnvelope}),Module(function(Tone){return Tone.FrequencyEnvelope=function(){var options=Tone.defaults(arguments,["attack","decay","sustain","release"],Tone.Envelope);Tone.ScaledEnvelope.call(this,options),options=Tone.defaultArg(options,Tone.FrequencyEnvelope.defaults),this._octaves=options.octaves,this.baseFrequency=options.baseFrequency,this.octaves=options.octaves},Tone.extend(Tone.FrequencyEnvelope,Tone.Envelope),Tone.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(Tone.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(min){this._scale.min=this.toFrequency(min),this.octaves=this._octaves}}),Object.defineProperty(Tone.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves,this._scale.max=this.baseFrequency*Math.pow(2,octaves)}}),Object.defineProperty(Tone.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}}),Tone.FrequencyEnvelope.prototype.dispose=function(){return Tone.ScaledEnvelope.prototype.dispose.call(this),this},Tone.FrequencyEnvelope}),Module(function(Tone){return Tone.Gate=function(){var options=Tone.defaults(arguments,["threshold","attack","release"],Tone.Gate);Tone.AudioNode.call(this),this.createInsOuts(1,1),this._follower=new Tone.Follower(options.attack,options.release),this._gt=new Tone.GreaterThan(Tone.dbToGain(options.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},Tone.extend(Tone.Gate,Tone.AudioNode),Tone.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(Tone.Gate.prototype,"threshold",{get:function(){return Tone.gainToDb(this._gt.value)},set:function(thresh){this._gt.value=Tone.dbToGain(thresh)}}),Object.defineProperty(Tone.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(attackTime){this._follower.attack=attackTime}}),Object.defineProperty(Tone.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(releaseTime){this._follower.release=releaseTime}}),Tone.Gate.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},Tone.Gate}),Module(function(Tone){function _wrapScheduleMethods(method){return function(value,time){time=this.toSeconds(time),method.apply(this,arguments);var event=this._events.get(time),previousEvent=this._events.previousEvent(event),ticksUntilTime=this._getTickUntilEvent(previousEvent,time-this.sampleTime);return event.ticks=Math.max(ticksUntilTime,0),this}}return Tone.TickSignal=function(value){value=Tone.defaultArg(value,1),Tone.TimelineSignal.call(this,{units:Tone.Type.Ticks,value:value}),this._events.memory=1/0},Tone.extend(Tone.TickSignal,Tone.TimelineSignal),Tone.TickSignal.prototype.setValueAtTime=_wrapScheduleMethods(Tone.TimelineSignal.prototype.setValueAtTime),Tone.TickSignal.prototype.linearRampToValueAtTime=_wrapScheduleMethods(Tone.TimelineSignal.prototype.linearRampToValueAtTime),Tone.TickSignal.prototype.setTargetAtTime=function(value,time,constant){time=this.toSeconds(time),this.setRampPoint(time),value=this._fromUnits(value);for(var prevEvent=this._events.get(time),i=0;i<=5;i++){var segTime=constant*i+time,rampVal=this._exponentialApproach(prevEvent.time,prevEvent.value,value,constant,segTime);this.linearRampToValueAtTime(this._toUnits(rampVal),segTime)}return this},Tone.TickSignal.prototype.exponentialRampToValueAtTime=function(value,time){time=this.toSeconds(time),value=this._fromUnits(value);var prevEvent=this._events.get(time);null===prevEvent&&(prevEvent={value:this._initial,time:0});for(var segmentDur=(time-prevEvent.time)/5,i=0;i<=5;i++){var segTime=segmentDur*i+prevEvent.time,rampVal=this._exponentialInterpolate(prevEvent.time,prevEvent.value,time,value,segTime);this.linearRampToValueAtTime(this._toUnits(rampVal),segTime)}return this},Tone.TickSignal.prototype._getTickUntilEvent=function(event,time){null===event&&(event={ticks:0,time:0});var val0=this.getValueAtTime(event.time),val1=this.getValueAtTime(time);return.5*(time-event.time)*(val0+val1)+event.ticks},Tone.TickSignal.prototype.getTickAtTime=function(time){time=this.toSeconds(time);var event=this._events.get(time);return this._getTickUntilEvent(event,time)},Tone.TickSignal.prototype.getDurationOfTicks=function(ticks,time){time=this.toSeconds(time);var currentTick=this.getTickAtTime(time);return this.getTimeOfTick(currentTick+ticks)-time},Tone.TickSignal.prototype.getTimeOfTick=function(tick){var before=this._events.get(tick,"ticks"),after=this._events.getAfter(tick,"ticks");if(before&&before.ticks===tick)return before.time;if(before&&after&&after.type===Tone.TimelineSignal.Type.Linear&&before.value!==after.value){var val0=this.getValueAtTime(before.time),delta=(this.getValueAtTime(after.time)-val0)/(after.time-before.time),k=Math.sqrt(Math.pow(val0,2)-2*delta*(before.ticks-tick)),sol1=(-val0+k)/delta;return(sol1>0?sol1:(-val0-k)/delta)+before.time}return before?0===before.value?1/0:before.time+(tick-before.ticks)/before.value:tick/this._initial},Tone.TickSignal}),Module(function(Tone){return Tone.TimelineState=function(initial){Tone.Timeline.call(this),this._initial=initial},Tone.extend(Tone.TimelineState,Tone.Timeline),Tone.TimelineState.prototype.getValueAtTime=function(time){var event=this.get(time);return null!==event?event.state:this._initial},Tone.TimelineState.prototype.setStateAtTime=function(state,time){return this.add({state:state,time:time}),this},Tone.TimelineState}),Module(function(Tone){return Tone.Clock=function(){var options=Tone.defaults(arguments,["callback","frequency"],Tone.Clock);Tone.Emitter.call(this),this.callback=options.callback,this._nextTick=0,this._lastState=Tone.State.Stopped,this.frequency=new Tone.TickSignal(options.frequency,Tone.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new Tone.TimelineState(Tone.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},Tone.extend(Tone.Clock,Tone.Emitter),Tone.Clock.defaults={callback:Tone.noOp,frequency:1},Object.defineProperty(Tone.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),Tone.Clock.prototype.start=function(time,offset){return time=this.toSeconds(time),this._state.getValueAtTime(time)!==Tone.State.Started&&(this._state.setStateAtTime(Tone.State.Started,time),this._state.get(time).offset=offset),this},Tone.Clock.prototype.stop=function(time){return time=this.toSeconds(time),this._state.cancel(time),this._state.setStateAtTime(Tone.State.Stopped,time),this},Tone.Clock.prototype.pause=function(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)===Tone.State.Started&&this._state.setStateAtTime(Tone.State.Paused,time),this},Tone.Clock.prototype._loop=function(){var endTime=this.now()+this.context.updateInterval,event=this._state.get(endTime);if(event){if(event.state!==this._lastState)switch(this._lastState=event.state,event.state){case Tone.State.Started:Tone.isUndef(event.offset)||(this.ticks=event.offset),this._nextTick=event.time,this.emit("start",event.time,this.ticks);break;case Tone.State.Stopped:this.ticks=0,this.emit("stop",event.time);break;case Tone.State.Paused:this.emit("pause",event.time)}for(;endTime>this._nextTick&&this._state;){var tickTime=this._nextTick;if(this.frequency&&(this._nextTick+=this.frequency.getDurationOfTicks(1,this._nextTick),event.state===Tone.State.Started))try{this.callback(tickTime),this.ticks++}catch(e){throw this.ticks++,e}}}},Tone.Clock.prototype.getStateAtTime=function(time){return time=this.toSeconds(time),this._state.getValueAtTime(time)},Tone.Clock.prototype.dispose=function(){Tone.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},Tone.Clock}),Module(function(Tone){Tone.IntervalTimeline=function(){Tone.call(this),this._root=null,this._length=0},Tone.extend(Tone.IntervalTimeline),Tone.IntervalTimeline.prototype.add=function(event){if(Tone.isUndef(event.time)||Tone.isUndef(event.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");var node=new IntervalNode(event.time,event.time+event.duration,event);for(null===this._root?this._root=node:this._root.insert(node),this._length++;null!==node;)node.updateHeight(),node.updateMax(),this._rebalance(node),node=node.parent;return this},Tone.IntervalTimeline.prototype.remove=function(event){if(null!==this._root){var results=[];this._root.search(event.time,results);for(var i=0;i<results.length;i++){var node=results[i];if(node.event===event){this._removeNode(node),this._length--;break}}}return this},Object.defineProperty(Tone.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),Tone.IntervalTimeline.prototype.cancel=function(after){return this.forEachAfter(after,function(event){this.remove(event)}.bind(this)),this},Tone.IntervalTimeline.prototype._setRoot=function(node){this._root=node,null!==this._root&&(this._root.parent=null)},Tone.IntervalTimeline.prototype._replaceNodeInParent=function(node,replacement){null!==node.parent?(node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement,this._rebalance(node.parent)):this._setRoot(replacement)},Tone.IntervalTimeline.prototype._removeNode=function(node){if(null===node.left&&null===node.right)this._replaceNodeInParent(node,null);else if(null===node.right)this._replaceNodeInParent(node,node.left);else if(null===node.left)this._replaceNodeInParent(node,node.right);else{var replacement,temp;if(node.getBalance()>0)if(null===node.left.right)(replacement=node.left).right=node.right,temp=replacement;else{for(replacement=node.left.right;null!==replacement.right;)replacement=replacement.right;replacement.parent.right=replacement.left,temp=replacement.parent,replacement.left=node.left,replacement.right=node.right}else if(null===node.right.left)(replacement=node.right).left=node.left,temp=replacement;else{for(replacement=node.right.left;null!==replacement.left;)replacement=replacement.left;replacement.parent=replacement.parent,replacement.parent.left=replacement.right,temp=replacement.parent,replacement.left=node.left,replacement.right=node.right}null!==node.parent?node.isLeftChild()?node.parent.left=replacement:node.parent.right=replacement:this._setRoot(replacement),this._rebalance(temp)}node.dispose()},Tone.IntervalTimeline.prototype._rotateLeft=function(node){var parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.right;node.right=pivotNode.left,pivotNode.left=node,null!==parent?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)},Tone.IntervalTimeline.prototype._rotateRight=function(node){var parent=node.parent,isLeftChild=node.isLeftChild(),pivotNode=node.left;node.left=pivotNode.right,pivotNode.right=node,null!==parent?isLeftChild?parent.left=pivotNode:parent.right=pivotNode:this._setRoot(pivotNode)},Tone.IntervalTimeline.prototype._rebalance=function(node){var balance=node.getBalance();balance>1?node.left.getBalance()<0?this._rotateLeft(node.left):this._rotateRight(node):balance<-1&&(node.right.getBalance()>0?this._rotateRight(node.right):this._rotateLeft(node))},Tone.IntervalTimeline.prototype.get=function(time){if(null!==this._root){var results=[];if(this._root.search(time,results),results.length>0){for(var max=results[0],i=1;i<results.length;i++)results[i].low>max.low&&(max=results[i]);return max.event}}return null},Tone.IntervalTimeline.prototype.forEach=function(callback){if(null!==this._root){var allNodes=[];this._root.traverse(function(node){allNodes.push(node)});for(var i=0;i<allNodes.length;i++){var ev=allNodes[i].event;ev&&callback(ev)}}return this},Tone.IntervalTimeline.prototype.forEachAtTime=function(time,callback){if(null!==this._root){var results=[];this._root.search(time,results);for(var i=results.length-1;i>=0;i--){var ev=results[i].event;ev&&callback(ev)}}return this},Tone.IntervalTimeline.prototype.forEachAfter=function(time,callback){if(null!==this._root){var results=[];this._root.searchAfter(time,results);for(var i=results.length-1;i>=0;i--){callback(results[i].event)}}return this},Tone.IntervalTimeline.prototype.dispose=function(){var allNodes=[];null!==this._root&&this._root.traverse(function(node){allNodes.push(node)});for(var i=0;i<allNodes.length;i++)allNodes[i].dispose();return allNodes=null,this._root=null,this};var IntervalNode=function(low,high,event){this.event=event,this.low=low,this.high=high,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return IntervalNode.prototype.insert=function(node){node.low<=this.low?null===this.left?this.left=node:this.left.insert(node):null===this.right?this.right=node:this.right.insert(node)},IntervalNode.prototype.search=function(point,results){point>this.max||(null!==this.left&&this.left.search(point,results),this.low<=point&&this.high>point&&results.push(this),this.low>point||null!==this.right&&this.right.search(point,results))},IntervalNode.prototype.searchAfter=function(point,results){this.low>=point&&(results.push(this),null!==this.left&&this.left.searchAfter(point,results)),null!==this.right&&this.right.searchAfter(point,results)},IntervalNode.prototype.traverse=function(callback){callback(this),null!==this.left&&this.left.traverse(callback),null!==this.right&&this.right.traverse(callback)},IntervalNode.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},IntervalNode.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},IntervalNode.prototype.getBalance=function(){var balance=0;return null!==this.left&&null!==this.right?balance=this.left.height-this.right.height:null!==this.left?balance=this.left.height+1:null!==this.right&&(balance=-(this.right.height+1)),balance},IntervalNode.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(IntervalNode.prototype,"left",{get:function(){return this._left},set:function(node){this._left=node,null!==node&&(node.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(IntervalNode.prototype,"right",{get:function(){return this._right},set:function(node){this._right=node,null!==node&&(node.parent=this),this.updateHeight(),this.updateMax()}}),IntervalNode.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},Tone.IntervalTimeline}),Module(function(Tone){return Tone.TransportEvent=function(Transport,options){options=Tone.defaultArg(options,Tone.TransportEvent.defaults),Tone.call(this),this.Transport=Transport,this.id=Tone.TransportEvent._eventId++,this.time=options.time,this.callback=options.callback,this._once=options.once},Tone.extend(Tone.TransportEvent),Tone.TransportEvent.defaults={once:!1,callback:Tone.noOp},Tone.TransportEvent._eventId=0,Tone.TransportEvent.prototype.invoke=function(time){this.callback&&(this.callback(time),this._once&&this.Transport&&this.Transport.clear(this.id))},Tone.TransportEvent.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this.Transport=null,this.callback=null,this},Tone.TransportEvent}),Module(function(Tone){return Tone.TransportRepeatEvent=function(Transport,options){Tone.TransportEvent.call(this,Transport,options),options=Tone.defaultArg(options,Tone.TransportRepeatEvent.defaults),this.duration=options.duration,this._interval=options.interval,this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},Tone.extend(Tone.TransportRepeatEvent,Tone.TransportEvent),Tone.TransportRepeatEvent.defaults={duration:1/0,interval:1},Tone.TransportRepeatEvent.prototype.invoke=function(time){this._createEvents(),Tone.TransportEvent.prototype.invoke.call(this,time)},Tone.TransportRepeatEvent.prototype._createEvents=function(){var ticks=this.Transport.ticks;ticks>=this.time&&ticks>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),Tone.TransportTime(this._nextTick,"i")))},Tone.TransportRepeatEvent.prototype._restart=function(){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId);var ticks=this.Transport.ticks;this._nextTick=this.time,ticks>this.time&&(this._nextTick=this.time+Math.ceil((ticks-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),Tone.TransportTime(this._nextTick,"i")),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),Tone.TransportTime(this._nextTick,"i"))},Tone.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,Tone.TransportEvent.prototype.dispose.call(this),this},Tone.TransportRepeatEvent}),Module(function(Tone){Tone.Transport=function(){Tone.Emitter.call(this),Tone.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=TransportConstructor.defaults.PPQ,this._clock=new Tone.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=Tone.Type.BPM,this.bpm.value=TransportConstructor.defaults.bpm,this._readOnly("bpm"),this._timeSignature=TransportConstructor.defaults.timeSignature,this._scheduledEvents={},this._timeline=new Tone.Timeline,this._repeatedEvents=new Tone.IntervalTimeline,this._syncedSignals=[],this._swingTicks=TransportConstructor.defaults.PPQ/2,this._swingAmount=0}.bind(this))},Tone.extend(Tone.Transport,Tone.Emitter),Tone.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},Tone.Transport.prototype._processTick=function(tickTime){var ticks=this._clock.ticks;if(this._swingAmount>0&&ticks%this._ppq!=0&&ticks%(2*this._swingTicks)!=0){var progress=ticks%(2*this._swingTicks)/(2*this._swingTicks),amount=Math.sin(progress*Math.PI)*this._swingAmount;tickTime+=Tone.Time(2*this._swingTicks/3,"i")*amount}this.loop&&ticks>=this._loopEnd&&(this.emit("loopEnd",tickTime),this._clock.ticks=this._loopStart,ticks=this._loopStart,this.emit("loopStart",tickTime,this.seconds),this.emit("loop",tickTime)),this._timeline.forEachAtTime(ticks,function(event){event.invoke(tickTime)})},Tone.Transport.prototype.schedule=function(callback,time){var event=new Tone.TransportEvent(this,{time:this.toTicks(time),callback:callback});return this._addEvent(event,this._timeline)},Tone.Transport.prototype.scheduleRepeat=function(callback,interval,startTime,duration){var event=new Tone.TransportRepeatEvent(this,{callback:callback,interval:this.toTicks(interval),time:this.toTicks(startTime),duration:this.toTicks(Tone.defaultArg(duration,1/0))});return this._addEvent(event,this._repeatedEvents)},Tone.Transport.prototype.scheduleOnce=function(callback,time){var event=new Tone.TransportEvent(this,{time:this.toTicks(time),callback:callback,once:!0});return this._addEvent(event,this._timeline)},Tone.Transport.prototype.clear=function(eventId){if(this._scheduledEvents.hasOwnProperty(eventId)){var item=this._scheduledEvents[eventId.toString()];item.timeline.remove(item.event),item.event.dispose(),delete this._scheduledEvents[eventId.toString()]}return this},Tone.Transport.prototype._addEvent=function(event,timeline){return this._scheduledEvents[event.id.toString()]={event:event,timeline:timeline},timeline.add(event),event.id},Tone.Transport.prototype.cancel=function(after){return after=Tone.defaultArg(after,0),after=this.toTicks(after),this._timeline.cancel(after),this._repeatedEvents.cancel(after),this},Tone.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(time,offset){offset=Tone.Time(this._clock.ticks,"i").toSeconds(),this.emit("start",time,offset)}.bind(this)),this._clock.on("stop",function(time){this.emit("stop",time)}.bind(this)),this._clock.on("pause",function(time){this.emit("pause",time)}.bind(this))},Object.defineProperty(Tone.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),Tone.Transport.prototype.start=function(time,offset){return Tone.isUndef(offset)||(offset=this.toTicks(offset)),this._clock.start(time,offset),this},Tone.Transport.prototype.stop=function(time){return this._clock.stop(time),this},Tone.Transport.prototype.pause=function(time){return this._clock.pause(time),this},Tone.Transport.prototype.toggle=function(time){return time=this.toSeconds(time),this._clock.getStateAtTime(time)!==Tone.State.Started?this.start(time):this.stop(time),this},Object.defineProperty(Tone.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(timeSig){Tone.isArray(timeSig)&&(timeSig=timeSig[0]/timeSig[1]*4),this._timeSignature=timeSig}}),Object.defineProperty(Tone.Transport.prototype,"loopStart",{get:function(){return Tone.TransportTime(this._loopStart,"i").toSeconds()},set:function(startPosition){this._loopStart=this.toTicks(startPosition)}}),Object.defineProperty(Tone.Transport.prototype,"loopEnd",{get:function(){return Tone.TransportTime(this._loopEnd,"i").toSeconds()},set:function(endPosition){this._loopEnd=this.toTicks(endPosition)}}),Tone.Transport.prototype.setLoopPoints=function(startPosition,endPosition){return this.loopStart=startPosition,this.loopEnd=endPosition,this},Object.defineProperty(Tone.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(amount){this._swingAmount=amount}}),Object.defineProperty(Tone.Transport.prototype,"swingSubdivision",{get:function(){return Tone.Time(this._swingTicks,"i").toNotation()},set:function(subdivision){this._swingTicks=this.toTicks(subdivision)}}),Object.defineProperty(Tone.Transport.prototype,"position",{get:function(){return Tone.TransportTime(this.ticks,"i").toBarsBeatsSixteenths()},set:function(progress){var ticks=this.toTicks(progress);this.ticks=ticks}}),Object.defineProperty(Tone.Transport.prototype,"seconds",{get:function(){return Tone.TransportTime(this.ticks,"i").toSeconds()},set:function(progress){var ticks=this.toTicks(progress);this.ticks=ticks}}),Object.defineProperty(Tone.Transport.prototype,"progress",{get:function(){return this.loop?(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart):0}}),Object.defineProperty(Tone.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(t){if(this._clock.ticks!==t){var now=this.now();this.state===Tone.State.Started?(this.emit("stop",now),this._clock.ticks=t,this.emit("start",now,this.seconds)):this._clock.ticks=t}}}),Object.defineProperty(Tone.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(ppq){var bpm=this.bpm.value;this._ppq=ppq,this.bpm.value=bpm}}),Tone.Transport.prototype._fromUnits=function(bpm){return 1/(60/bpm/this.PPQ)},Tone.Transport.prototype._toUnits=function(freq){return freq/this.PPQ*60},Tone.Transport.prototype.nextSubdivision=function(subdivision){var now;if(subdivision=this.toSeconds(subdivision),this.state!==Tone.State.Started)return 0;now=this._clock._nextTick;var remainingTime=subdivision-Tone.Time(this.ticks,"i")%subdivision;return 0===remainingTime&&(remainingTime=subdivision),now+remainingTime},Tone.Transport.prototype.syncSignal=function(signal,ratio){ratio||(ratio=0!==signal._param.value?signal._param.value/this.bpm._param.value:0);var ratioSignal=new Tone.Gain(ratio);return this.bpm.chain(ratioSignal,signal._param),this._syncedSignals.push({ratio:ratioSignal,signal:signal,initial:signal._param.value}),signal._param.value=0,this},Tone.Transport.prototype.unsyncSignal=function(signal){for(var i=this._syncedSignals.length-1;i>=0;i--){var syncedSignal=this._syncedSignals[i];syncedSignal.signal===signal&&(syncedSignal.ratio.dispose(),syncedSignal.signal._param.value=syncedSignal.initial,this._syncedSignals.splice(i,1))}return this},Tone.Transport.prototype.dispose=function(){return Tone.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var TransportConstructor=Tone.Transport;return Tone.Transport=new TransportConstructor,Tone.Context.on("init",function(context){context.Transport instanceof TransportConstructor?Tone.Transport=context.Transport:Tone.Transport=new TransportConstructor,context.Transport=Tone.Transport}),Tone.Context.on("close",function(context){context.Transport instanceof TransportConstructor&&context.Transport.dispose()}),Tone.Transport}),Module(function(Tone){return Tone.Volume=function(){var options=Tone.defaults(arguments,["volume"],Tone.Volume);Tone.AudioNode.call(this),this.output=this.input=new Tone.Gain(options.volume,Tone.Type.Decibels),this._unmutedVolume=options.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=options.mute},Tone.extend(Tone.Volume,Tone.AudioNode),Tone.Volume.defaults={volume:0,mute:!1},Object.defineProperty(Tone.Volume.prototype,"mute",{get:function(){return this.volume.value===-1/0},set:function(mute){!this.mute&&mute?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!mute&&(this.volume.value=this._unmutedVolume)}}),Tone.Volume.prototype.dispose=function(){return this.input.dispose(),Tone.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},Tone.Volume}),Module(function(Tone){Tone.Master=function(){Tone.AudioNode.call(this),Tone.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new Tone.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)}.bind(this))},Tone.extend(Tone.Master,Tone.AudioNode),Tone.Master.defaults={volume:0,mute:!1},Object.defineProperty(Tone.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Tone.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},Tone.Master.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},Tone.AudioNode.prototype.toMaster=function(){return this.connect(Tone.Master),this},window.AudioNode&&(AudioNode.prototype.toMaster=function(){return this.connect(Tone.Master),this});var MasterConstructor=Tone.Master;return Tone.Master=new MasterConstructor,Tone.Context.on("init",function(context){context.Master instanceof MasterConstructor?Tone.Master=context.Master:Tone.Master=new MasterConstructor,context.Master=Tone.Master}),Tone.Context.on("close",function(context){context.Master instanceof MasterConstructor&&context.Master.dispose()}),Tone.Master}),Module(function(Tone){return Tone.Source=function(options){options=Tone.defaultArg(options,Tone.Source.defaults),Tone.AudioNode.call(this),this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new Tone.TimelineState(Tone.State.Stopped),this._state.memory=10,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=options.mute},Tone.extend(Tone.Source,Tone.AudioNode),Tone.Source.defaults={volume:0,mute:!1},Object.defineProperty(Tone.Source.prototype,"state",{get:function(){return this._synced?Tone.Transport.state===Tone.State.Started?this._state.getValueAtTime(Tone.Transport.seconds):Tone.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(Tone.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Tone.Source.prototype._start=Tone.noOp,Tone.Source.prototype._stop=Tone.noOp,Tone.Source.prototype.start=function(time,offset,duration){if(time=Tone.isUndef(time)&&this._synced?Tone.Transport.seconds:this.toSeconds(time),this.retrigger||this._state.getValueAtTime(time)!==Tone.State.Started||this.stop(time),this._state.setStateAtTime(Tone.State.Started,time),this._synced){var event=this._state.get(time);event.offset=Tone.defaultArg(offset,0),event.duration=duration;var sched=Tone.Transport.schedule(function(t){this._start(t,offset,duration)}.bind(this),time);this._scheduled.push(sched)}else this._start.apply(this,arguments);return this},Tone.Source.prototype.stop=function(time){if(time=Tone.isUndef(time)&&this._synced?Tone.Transport.seconds:this.toSeconds(time),this._state.cancel(time),this._state.setStateAtTime(Tone.State.Stopped,time),this._synced){var sched=Tone.Transport.schedule(this._stop.bind(this),time);this._scheduled.push(sched)}else this._stop.apply(this,arguments);return this},Tone.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(time,offset){if(offset>0){var stateEvent=this._state.get(offset);if(stateEvent&&stateEvent.state===Tone.State.Started&&stateEvent.time!==offset){var duration,startOffset=offset-this.toSeconds(stateEvent.time);stateEvent.duration&&(duration=this.toSeconds(stateEvent.duration)-startOffset),this._start(time,this.toSeconds(stateEvent.offset)+startOffset,duration)}}}.bind(this),this._syncedStop=function(time){this._state.getValueAtTime(Tone.Transport.seconds)===Tone.State.Started&&this._stop(time)}.bind(this),Tone.Transport.on("start loopStart",this._syncedStart),Tone.Transport.on("stop pause loopEnd",this._syncedStop),this},Tone.Source.prototype.unsync=function(){this._synced&&(Tone.Transport.off("stop pause loopEnd",this._syncedStop),Tone.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var i=0;i<this._scheduled.length;i++){var id=this._scheduled[i];Tone.Transport.clear(id)}return this._scheduled=[],this._state.cancel(0),this},Tone.Source.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},Tone.Source}),Module(function(Tone){return window.OscillatorNode&&!OscillatorNode.prototype.start&&(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn,OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff,OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable)),Tone.Oscillator=function(){var options=Tone.defaults(arguments,["frequency","type"],Tone.Oscillator);Tone.Source.call(this,options),this._oscillator=null,this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this._wave=null,this._partials=Tone.defaultArg(options.partials,[1]),this._phase=options.phase,this._type=null,this.type=options.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},Tone.extend(Tone.Oscillator,Tone.Source),Tone.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},Tone.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},Tone.Oscillator.prototype._start=function(time){this._oscillator=this.context.createOscillator(),this._oscillator.setPeriodicWave(this._wave),this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),time=this.toSeconds(time),Tone.isPast(time),this._oscillator.start(time)},Tone.Oscillator.prototype._stop=function(time){return this._oscillator&&(time=this.toSeconds(time),Tone.isPast(time),this._oscillator.stop(time),this._oscillator=null),this},Tone.Oscillator.prototype.syncFrequency=function(){return Tone.Transport.syncSignal(this.frequency),this},Tone.Oscillator.prototype.unsyncFrequency=function(){return Tone.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(Tone.Oscillator.prototype,"type",{get:function(){return this._type},set:function(type){var coefs=this._getRealImaginary(type,this._phase),periodicWave=this.context.createPeriodicWave(coefs[0],coefs[1]);this._wave=periodicWave,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),this._type=type}}),Tone.Oscillator.prototype._getRealImaginary=function(type,phase){var periodicWaveSize=2048,real=new Float32Array(periodicWaveSize),imag=new Float32Array(periodicWaveSize),partialCount=1;if(type===Tone.Oscillator.Type.Custom)periodicWaveSize=partialCount=this._partials.length+1;else{var partial=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(type);partial&&(partialCount=parseInt(partial[2])+1,type=partial[1],periodicWaveSize=partialCount=Math.max(partialCount,2))}for(var n=1;n<periodicWaveSize;++n){var b,piFactor=2/(n*Math.PI);switch(type){case Tone.Oscillator.Type.Sine:b=n<=partialCount?1:0;break;case Tone.Oscillator.Type.Square:b=1&n?2*piFactor:0;break;case Tone.Oscillator.Type.Sawtooth:b=piFactor*(1&n?1:-1);break;case Tone.Oscillator.Type.Triangle:b=1&n?piFactor*piFactor*2*(n-1>>1&1?-1:1):0;break;case Tone.Oscillator.Type.Custom:b=this._partials[n-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+type)}0!==b?(real[n]=-b*Math.sin(phase*n),imag[n]=b*Math.cos(phase*n)):(real[n]=0,imag[n]=0)}return[real,imag]},Tone.Oscillator.prototype._inverseFFT=function(real,imag,phase){for(var sum=0,len=real.length,i=0;i<len;i++)sum+=real[i]*Math.cos(i*phase)+imag[i]*Math.sin(i*phase);return sum},Tone.Oscillator.prototype._getInitialValue=function(){for(var coefs=this._getRealImaginary(this._type,0),real=coefs[0],imag=coefs[1],maxValue=0,twoPi=2*Math.PI,i=0;i<8;i++)maxValue=Math.max(this._inverseFFT(real,imag,i/8*twoPi),maxValue);return-this._inverseFFT(real,imag,this._phase)/maxValue},Object.defineProperty(Tone.Oscillator.prototype,"partials",{get:function(){return this._type!==Tone.Oscillator.Type.Custom?[]:this._partials},set:function(partials){this._partials=partials,this.type=Tone.Oscillator.Type.Custom}}),Object.defineProperty(Tone.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(phase){this._phase=phase*Math.PI/180,this.type=this._type}}),Tone.Oscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},Tone.Oscillator}),Module(function(Tone){return Tone.Zero=function(){Tone.SignalBase.call(this),this._gain=this.input=this.output=new Tone.Gain,this.context.getConstant(0).connect(this._gain)},Tone.extend(Tone.Zero,Tone.SignalBase),Tone.Zero.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},Tone.Zero}),Module(function(Tone){return Tone.LFO=function(){var options=Tone.defaults(arguments,["frequency","min","max"],Tone.LFO);Tone.AudioNode.call(this),this._oscillator=new Tone.Oscillator({frequency:options.frequency,type:options.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=Tone.Type.NormalRange,this.amplitude.value=options.amplitude,this._stoppedSignal=new Tone.Signal(0,Tone.Type.AudioRange),this._zeros=new Tone.Zero,this._stoppedValue=0,this._a2g=new Tone.AudioToGain,this._scaler=this.output=new Tone.Scale(options.min,options.max),this._units=Tone.Type.Default,this.units=options.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=options.phase},Tone.extend(Tone.LFO,Tone.AudioNode),Tone.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:Tone.Type.Default},Tone.LFO.prototype.start=function(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(0,time),this._oscillator.start(time),this},Tone.LFO.prototype.stop=function(time){return time=this.toSeconds(time),this._stoppedSignal.setValueAtTime(this._stoppedValue,time),this._oscillator.stop(time),this},Tone.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},Tone.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(Tone.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(min){min=this._fromUnits(min),this._scaler.min=min}}),Object.defineProperty(Tone.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(max){max=this._fromUnits(max),this._scaler.max=max}}),Object.defineProperty(Tone.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(type){this._oscillator.type=type,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(Tone.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(Tone.LFO.prototype,"units",{get:function(){return this._units},set:function(val){var currentMin=this.min,currentMax=this.max;this._units=val,this.min=currentMin,this.max=currentMax}}),Object.defineProperty(Tone.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(mute){this._oscillator.mute=mute}}),Object.defineProperty(Tone.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),Tone.LFO.prototype.connect=function(node){return node.constructor!==Tone.Signal&&node.constructor!==Tone.Param&&node.constructor!==Tone.TimelineSignal||(this.convert=node.convert,this.units=node.units),Tone.Signal.prototype.connect.apply(this,arguments),this},Tone.LFO.prototype._fromUnits=Tone.Param.prototype._fromUnits,Tone.LFO.prototype._toUnits=Tone.Param.prototype._toUnits,Tone.LFO.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},Tone.LFO}),Module(function(Tone){return Tone.Limiter=function(){var options=Tone.defaults(arguments,["threshold"],Tone.Limiter);Tone.AudioNode.call(this),this._compressor=this.input=this.output=new Tone.Compressor({attack:.001,decay:.001,threshold:options.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},Tone.extend(Tone.Limiter,Tone.AudioNode),Tone.Limiter.defaults={threshold:-12},Tone.Limiter.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},Tone.Limiter}),Module(function(Tone){return Tone.LowpassCombFilter=function(){var options=Tone.defaults(arguments,["delayTime","resonance","dampening"],Tone.LowpassCombFilter);Tone.AudioNode.call(this),this.createInsOuts(1,1),this._delay=this.input=new Tone.Delay(options.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new Tone.Param({param:this._lowpass.frequency,units:Tone.Type.Frequency,value:options.dampening}),this._feedback=new Tone.Gain(options.resonance,Tone.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},Tone.extend(Tone.LowpassCombFilter,Tone.AudioNode),Tone.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},Tone.LowpassCombFilter.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},Tone.LowpassCombFilter}),Module(function(Tone){return Tone.Merge=function(){Tone.AudioNode.call(this),this.createInsOuts(2,0),this.left=this.input[0]=new Tone.Gain,this.right=this.input[1]=new Tone.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},Tone.extend(Tone.Merge,Tone.AudioNode),Tone.Merge.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},Tone.Merge}),Module(function(Tone){return Tone.Meter=function(){var options=Tone.defaults(arguments,["smoothing"],Tone.Meter);Tone.AudioNode.call(this),this.input=this.output=this._analyser=new Tone.Analyser("waveform",1024),this.smoothing=options.smoothing},Tone.extend(Tone.Meter,Tone.AudioNode),Tone.Meter.defaults={smoothing:.8},Tone.Meter.prototype.getLevel=function(){this._analyser.type="fft";var values=this._analyser.getValue();return Math.max.apply(this,values)+28},Tone.Meter.prototype.getValue=function(){return this._analyser.type="waveform",this._analyser.getValue()[0]},Object.defineProperty(Tone.Meter.prototype,"smoothing",{get:function(){return this._analyser.smoothing},set:function(val){this._analyser.smoothing=val}}),Tone.Meter.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},Tone.Meter}),Module(function(Tone){return Tone.Split=function(){Tone.AudioNode.call(this),this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this._splitter.channelCount=2,this._splitter.channelCountMode="explicit",this.left=this.output[0]=new Tone.Gain,this.right=this.output[1]=new Tone.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},Tone.extend(Tone.Split,Tone.AudioNode),Tone.Split.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},Tone.Split}),Module(function(Tone){return Tone.MidSideSplit=function(){Tone.AudioNode.call(this),this.createInsOuts(0,2),this._split=this.input=new Tone.Split,this.mid=this.output[0]=new Tone.Expr("($0 + $1) * $2"),this.side=this.output[1]=new Tone.Expr("($0 - $1) * $2"),this._split.connect(this.mid,0,0),this._split.connect(this.mid,1,1),this._split.connect(this.side,0,0),this._split.connect(this.side,1,1),this.context.getConstant(Math.SQRT1_2).connect(this.mid,0,2),this.context.getConstant(Math.SQRT1_2).connect(this.side,0,2)},Tone.extend(Tone.MidSideSplit,Tone.AudioNode),Tone.MidSideSplit.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._split.dispose(),this._split=null,this},Tone.MidSideSplit}),Module(function(Tone){return Tone.MidSideMerge=function(){Tone.AudioNode.call(this),this.createInsOuts(2,0),this.mid=this.input[0]=new Tone.Gain,this._left=new Tone.Expr("($0 + $1) * $2"),this.side=this.input[1]=new Tone.Gain,this._right=new Tone.Expr("($0 - $1) * $2"),this._merge=this.output=new Tone.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._merge,0,0),this._right.connect(this._merge,0,1),this.context.getConstant(Math.SQRT1_2).connect(this._left,0,2),this.context.getConstant(Math.SQRT1_2).connect(this._right,0,2)},Tone.extend(Tone.MidSideMerge,Tone.AudioNode),Tone.MidSideMerge.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._right.dispose(),this._right=null,this._merge.dispose(),this._merge=null,this},Tone.MidSideMerge}),Module(function(Tone){return Tone.MidSideCompressor=function(options){Tone.AudioNode.call(this),options=Tone.defaultArg(options,Tone.MidSideCompressor.defaults),this._midSideSplit=this.input=new Tone.MidSideSplit,this._midSideMerge=this.output=new Tone.MidSideMerge,this.mid=new Tone.Compressor(options.mid),this.side=new Tone.Compressor(options.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},Tone.extend(Tone.MidSideCompressor,Tone.AudioNode),Tone.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},Tone.MidSideCompressor.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},Tone.MidSideCompressor}),Module(function(Tone){return Tone.Mono=function(){Tone.AudioNode.call(this),this.createInsOuts(1,0),this._merge=this.output=new Tone.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1),this.input.gain.value=Tone.dbToGain(-10)},Tone.extend(Tone.Mono),Tone.Mono.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},Tone.Mono}),Module(function(Tone){return Tone.MultibandCompressor=function(options){Tone.AudioNode.call(this),options=Tone.defaultArg(arguments,Tone.MultibandCompressor.defaults),this._splitter=this.input=new Tone.MultibandSplit({lowFrequency:options.lowFrequency,highFrequency:options.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new Tone.Gain,this.low=new Tone.Compressor(options.low),this.mid=new Tone.Compressor(options.mid),this.high=new Tone.Compressor(options.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},Tone.extend(Tone.MultibandCompressor,Tone.AudioNode),Tone.MultibandCompressor.defaults={low:Tone.Compressor.defaults,mid:Tone.Compressor.defaults,high:Tone.Compressor.defaults,lowFrequency:250,highFrequency:2e3},Tone.MultibandCompressor.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},Tone.MultibandCompressor}),Module(function(Tone){return Tone.Panner=function(initialPan){Tone.AudioNode.call(this),Tone.Panner.hasStereoPanner?(this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan):(this._crossFade=new Tone.CrossFade,this._merger=this.output=new Tone.Merge,this._splitter=this.input=new Tone.Split,this.pan=new Tone.Signal(0,Tone.Type.AudioRange),this._zero=new Tone.Zero,this._a2g=new Tone.AudioToGain,this._zero.connect(this._a2g),this.pan.chain(this._a2g,this._crossFade.fade),this._splitter.connect(this._crossFade,0,0),this._splitter.connect(this._crossFade,1,1),this._crossFade.a.connect(this._merger,0,0),this._crossFade.b.connect(this._merger,0,1)),this.pan.value=Tone.defaultArg(initialPan,0),this._readOnly("pan")},Tone.extend(Tone.Panner,Tone.AudioNode),Tone.Panner.hasStereoPanner=Tone.context&&Tone.isFunction(Tone.context.createStereoPanner),Tone.Panner.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable("pan"),Tone.Panner.hasStereoPanner?(this._panner.disconnect(),this._panner=null,this.pan=null):(this._zero.dispose(),this._zero=null,this._crossFade.dispose(),this._crossFade=null,this._splitter.dispose(),this._splitter=null,this._merger.dispose(),this._merger=null,this.pan.dispose(),this.pan=null,this._a2g.dispose(),this._a2g=null),this},Tone.Panner}),Module(function(Tone){return Tone.Panner3D=function(){var options=Tone.defaults(arguments,["positionX","positionY","positionZ"],Tone.Panner3D);Tone.AudioNode.call(this),this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=options.panningModel,this._panner.maxDistance=options.maxDistance,this._panner.distanceModel=options.distanceModel,this._panner.coneOuterGain=options.coneOuterGain,this._panner.coneOuterAngle=options.coneOuterAngle,this._panner.coneInnerAngle=options.coneInnerAngle,this._panner.refDistance=options.refDistance,this._panner.rolloffFactor=options.rolloffFactor,this._orientation=[options.orientationX,options.orientationY,options.orientationZ],this._position=[options.positionX,options.positionY,options.positionZ],this.orientationX=options.orientationX,this.orientationY=options.orientationY,this.orientationZ=options.orientationZ,this.positionX=options.positionX,this.positionY=options.positionY,this.positionZ=options.positionZ},Tone.extend(Tone.Panner3D,Tone.AudioNode),Tone.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},Tone.Panner3D.prototype._rampTimeConstant=.01,Tone.Panner3D.prototype.setPosition=function(x,y,z){if(this._panner.positionX){var now=this.now();this._panner.positionX.setTargetAtTime(x,now,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(y,now,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(z,now,this._rampTimeConstant)}else this._panner.setPosition(x,y,z);return this._position=Array.prototype.slice.call(arguments),this},Tone.Panner3D.prototype.setOrientation=function(x,y,z){if(this._panner.orientationX){var now=this.now();this._panner.orientationX.setTargetAtTime(x,now,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(y,now,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(z,now,this._rampTimeConstant)}else this._panner.setOrientation(x,y,z);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(Tone.Panner3D.prototype,"positionX",{set:function(pos){this._position[0]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(Tone.Panner3D.prototype,"positionY",{set:function(pos){this._position[1]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(Tone.Panner3D.prototype,"positionZ",{set:function(pos){this._position[2]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(Tone.Panner3D.prototype,"orientationX",{set:function(pos){this._orientation[0]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(Tone.Panner3D.prototype,"orientationY",{set:function(pos){this._orientation[1]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(Tone.Panner3D.prototype,"orientationZ",{set:function(pos){this._orientation[2]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Tone.Panner3D._aliasProperty=function(prop){Object.defineProperty(Tone.Panner3D.prototype,prop,{set:function(val){this._panner[prop]=val},get:function(){return this._panner[prop]}})},Tone.Panner3D._aliasProperty("panningModel"),Tone.Panner3D._aliasProperty("refDistance"),Tone.Panner3D._aliasProperty("rolloffFactor"),Tone.Panner3D._aliasProperty("distanceModel"),Tone.Panner3D._aliasProperty("coneInnerAngle"),Tone.Panner3D._aliasProperty("coneOuterAngle"),Tone.Panner3D._aliasProperty("coneOuterGain"),Tone.Panner3D._aliasProperty("maxDistance"),Tone.Panner3D.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},Tone.Panner3D}),Module(function(Tone){return Tone.PanVol=function(){var options=Tone.defaults(arguments,["pan","volume"],Tone.PanVol);Tone.AudioNode.call(this),this._panner=this.input=new Tone.Panner(options.pan),this.pan=this._panner.pan,this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=options.mute,this._readOnly(["pan","volume"])},Tone.extend(Tone.PanVol,Tone.AudioNode),Tone.PanVol.defaults={pan:0,volume:0,mute:!1},Object.defineProperty(Tone.PanVol.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Tone.PanVol.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},Tone.PanVol}),Module(function(Tone){return Tone.Solo=function(){var options=Tone.defaults(arguments,["solo"],Tone.Solo);Tone.AudioNode.call(this),this.input=this.output=new Tone.Gain,this._soloBind=this._soloed.bind(this),this.context.on("solo",this._soloBind),this.solo=options.solo},Tone.extend(Tone.Solo,Tone.AudioNode),Tone.Solo.defaults={solo:!1},Object.defineProperty(Tone.Solo.prototype,"solo",{get:function(){return this._isSoloed()},set:function(solo){solo?this._addSolo():this._removeSolo(),this.context.emit("solo",this)}}),Object.defineProperty(Tone.Solo.prototype,"muted",{get:function(){return 0===this.input.gain.value}}),Tone.Solo.prototype._addSolo=function(){Tone.isArray(this.context._currentSolo)||(this.context._currentSolo=[]),this._isSoloed()||this.context._currentSolo.push(this)},Tone.Solo.prototype._removeSolo=function(){if(this._isSoloed()){var index=this.context._currentSolo.indexOf(this);this.context._currentSolo.splice(index,1)}},Tone.Solo.prototype._isSoloed=function(){return!!Tone.isArray(this.context._currentSolo)&&(0!==this.context._currentSolo.length&&-1!==this.context._currentSolo.indexOf(this))},Tone.Solo.prototype._noSolos=function(){return!Tone.isArray(this.context._currentSolo)||0===this.context._currentSolo.length},Tone.Solo.prototype._soloed=function(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0},Tone.Solo.prototype.dispose=function(){return this.context.off("solo",this._soloBind),this._removeSolo(),this._soloBind=null,Tone.AudioNode.prototype.dispose.call(this),this},Tone.Solo}),Module(function(Tone){return Tone.Waveform=function(){var options=Tone.defaults(arguments,["size"],Tone.Waveform);options.type=Tone.Analyser.Type.Waveform,Tone.AudioNode.call(this),this._analyser=this.input=this.output=new Tone.Analyser(options)},Tone.extend(Tone.Waveform,Tone.AudioNode),Tone.Waveform.defaults={size:1024},Tone.Waveform.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(Tone.Waveform.prototype,"size",{get:function(){return this._analyser.size},set:function(size){this._analyser.size=size}}),Tone.Waveform.prototype.dispose=function(){Tone.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},Tone.Waveform}),Module(function(Tone){return Tone.CtrlInterpolate=function(){var options=Tone.defaults(arguments,["values","index"],Tone.CtrlInterpolate);Tone.call(this),this.values=options.values,this.index=options.index},Tone.extend(Tone.CtrlInterpolate),Tone.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(Tone.CtrlInterpolate.prototype,"value",{get:function(){var index=this.index;index=Math.min(index,this.values.length-1);var lowerPosition=Math.floor(index),lower=this.values[lowerPosition],upper=this.values[Math.ceil(index)];return this._interpolate(index-lowerPosition,lower,upper)}}),Tone.CtrlInterpolate.prototype._interpolate=function(index,lower,upper){if(Tone.isArray(lower)){for(var retArray=[],i=0;i<lower.length;i++)retArray[i]=this._interpolate(index,lower[i],upper[i]);return retArray}if(Tone.isObject(lower)){var retObj={};for(var attr in lower)retObj[attr]=this._interpolate(index,lower[attr],upper[attr]);return retObj}return(1-index)*(lower=this._toNumber(lower))+index*(upper=this._toNumber(upper))},Tone.CtrlInterpolate.prototype._toNumber=function(val){return Tone.isNumber(val)?val:this.toSeconds(val)},Tone.CtrlInterpolate.prototype.dispose=function(){this.values=null},Tone.CtrlInterpolate}),Module(function(Tone){return Tone.CtrlMarkov=function(values,initial){Tone.call(this),this.values=Tone.defaultArg(values,{}),this.value=Tone.defaultArg(initial,Object.keys(this.values)[0])},Tone.extend(Tone.CtrlMarkov),Tone.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var next=this.values[this.value];if(Tone.isArray(next))for(var distribution=this._getProbDistribution(next),rand=Math.random(),total=0,i=0;i<distribution.length;i++){var dist=distribution[i];if(rand>total&&rand<total+dist){var chosen=next[i];Tone.isObject(chosen)?this.value=chosen.value:this.value=chosen}total+=dist}else this.value=next}return this.value},Tone.CtrlMarkov.prototype._getProbDistribution=function(options){for(var distribution=[],total=0,needsNormalizing=!1,i=0;i<options.length;i++){var option=options[i];Tone.isObject(option)?(needsNormalizing=!0,distribution[i]=option.probability):distribution[i]=1/options.length,total+=distribution[i]}if(needsNormalizing)for(var j=0;j<distribution.length;j++)distribution[j]=distribution[j]/total;return distribution},Tone.CtrlMarkov.prototype.dispose=function(){this.values=null},Tone.CtrlMarkov}),Module(function(Tone){return Tone.CtrlPattern=function(){var options=Tone.defaults(arguments,["values","type"],Tone.CtrlPattern);Tone.call(this),this.values=options.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=options.type},Tone.extend(Tone.CtrlPattern),Tone.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},Tone.CtrlPattern.defaults={type:Tone.CtrlPattern.Type.Up,values:[]},Object.defineProperty(Tone.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var val=this.values[this.index];return this.type===Tone.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),val=this.values[this._shuffled[this.index]]),val}}}),Object.defineProperty(Tone.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(type){this._type=type,this._shuffled=null,this._type===Tone.CtrlPattern.Type.Up||this._type===Tone.CtrlPattern.Type.UpDown||this._type===Tone.CtrlPattern.Type.RandomOnce||this._type===Tone.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==Tone.CtrlPattern.Type.Down&&this._type!==Tone.CtrlPattern.Type.DownUp&&this._type!==Tone.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1),this._type===Tone.CtrlPattern.Type.UpDown||this._type===Tone.CtrlPattern.Type.AlternateUp?this._direction=Tone.CtrlPattern.Type.Up:this._type!==Tone.CtrlPattern.Type.DownUp&&this._type!==Tone.CtrlPattern.Type.AlternateDown||(this._direction=Tone.CtrlPattern.Type.Down),this._type===Tone.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===Tone.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),Tone.CtrlPattern.prototype.next=function(){var type=this.type;return type===Tone.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):type===Tone.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):type===Tone.CtrlPattern.Type.UpDown||type===Tone.CtrlPattern.Type.DownUp?(this._direction===Tone.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=Tone.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=Tone.CtrlPattern.Type.Down)):type===Tone.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):type===Tone.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):type===Tone.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):type===Tone.CtrlPattern.Type.AlternateUp?(this._direction===Tone.CtrlPattern.Type.Up?(this.index+=2,this._direction=Tone.CtrlPattern.Type.Down):(this.index-=1,this._direction=Tone.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=Tone.CtrlPattern.Type.Up)):type===Tone.CtrlPattern.Type.AlternateDown&&(this._direction===Tone.CtrlPattern.Type.Up?(this.index+=1,this._direction=Tone.CtrlPattern.Type.Down):(this.index-=2,this._direction=Tone.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=Tone.CtrlPattern.Type.Down)),this.value},Tone.CtrlPattern.prototype._shuffleValues=function(){var copy=[];this._shuffled=[];for(var i=0;i<this.values.length;i++)copy[i]=i;for(;copy.length>0;){var randVal=copy.splice(Math.floor(copy.length*Math.random()),1);this._shuffled.push(randVal[0])}},Tone.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},Tone.CtrlPattern}),Module(function(Tone){return Tone.CtrlRandom=function(){var options=Tone.defaults(arguments,["min","max"],Tone.CtrlRandom);Tone.call(this),this.min=options.min,this.max=options.max,this.integer=options.integer},Tone.extend(Tone.CtrlRandom),Tone.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(Tone.CtrlRandom.prototype,"value",{get:function(){var min=this.toSeconds(this.min),max=this.toSeconds(this.max),rand=Math.random(),val=rand*min+(1-rand)*max;return this.integer&&(val=Math.floor(val)),val}}),Tone.CtrlRandom}),Module(function(Tone){return window.AudioBuffer&&!AudioBuffer.prototype.copyToChannel&&(AudioBuffer.prototype.copyToChannel=function(src,chanNum,start){var channel=this.getChannelData(chanNum);start=start||0;for(var i=0;i<channel.length;i++)channel[i+start]=src[i]},AudioBuffer.prototype.copyFromChannel=function(dest,chanNum,start){var channel=this.getChannelData(chanNum);start=start||0;for(var i=0;i<dest.length;i++)dest[i]=channel[i+start]}),Tone.Buffer=function(){var options=Tone.defaults(arguments,["url","onload","onerror"],Tone.Buffer);Tone.call(this),this._buffer=null,this._reversed=options.reverse,this._xhr=null,options.url instanceof AudioBuffer||options.url instanceof Tone.Buffer?(this.set(options.url),options.onload&&options.onload(this)):Tone.isString(options.url)&&this.load(options.url,options.onload,options.onerror)},Tone.extend(Tone.Buffer),Tone.Buffer.defaults={url:void 0,reverse:!1},Tone.Buffer.prototype.set=function(buffer){return buffer instanceof Tone.Buffer?this._buffer=buffer.get():this._buffer=buffer,this},Tone.Buffer.prototype.get=function(){return this._buffer},Tone.Buffer.prototype.load=function(url,onload,onerror){return new Promise(function(load,error){this._xhr=Tone.Buffer.load(url,function(buff){this._xhr=null,this.set(buff),load(this),onload&&onload(this)}.bind(this),function(err){this._xhr=null,error(err),onerror&&onerror(err)}.bind(this))}.bind(this))},Tone.Buffer.prototype.dispose=function(){return Tone.prototype.dispose.call(this),this._buffer=null,this._xhr&&(Tone.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(Tone.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(Tone.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(Tone.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(Tone.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),Tone.Buffer.prototype.fromArray=function(array){var isMultidimensional=array[0].length>0,channels=isMultidimensional?array.length:1,len=isMultidimensional?array[0].length:array.length,buffer=this.context.createBuffer(channels,len,this.context.sampleRate);isMultidimensional||1!==channels||(array=[array]);for(var c=0;c<channels;c++)buffer.copyToChannel(array[c],c);return this._buffer=buffer,this},Tone.Buffer.prototype.toMono=function(chanNum){if(Tone.isNumber(chanNum))this.fromArray(this.toArray(chanNum));else{for(var outputArray=new Float32Array(this.length),numChannels=this.numberOfChannels,channel=0;channel<numChannels;channel++)for(var channelArray=this.toArray(channel),i=0;i<channelArray.length;i++)outputArray[i]+=channelArray[i];outputArray=outputArray.map(function(sample){return sample/numChannels}),this.fromArray(outputArray)}return this},Tone.Buffer.prototype.toArray=function(channel){if(Tone.isNumber(channel))return this.getChannelData(channel);if(1===this.numberOfChannels)return this.toArray(0);for(var ret=[],c=0;c<this.numberOfChannels;c++)ret[c]=this.getChannelData(c);return ret},Tone.Buffer.prototype.getChannelData=function(channel){return this._buffer.getChannelData(channel)},Tone.Buffer.prototype.slice=function(start,end){end=Tone.defaultArg(end,this.duration);for(var startSamples=Math.floor(this.context.sampleRate*this.toSeconds(start)),endSamples=Math.floor(this.context.sampleRate*this.toSeconds(end)),replacement=[],i=0;i<this.numberOfChannels;i++)replacement[i]=this.toArray(i).slice(startSamples,endSamples);return(new Tone.Buffer).fromArray(replacement)},Tone.Buffer.prototype._reverse=function(){if(this.loaded)for(var i=0;i<this.numberOfChannels;i++)Array.prototype.reverse.call(this.getChannelData(i));return this},Object.defineProperty(Tone.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(rev){this._reversed!==rev&&(this._reversed=rev,this._reverse())}}),Tone.Emitter.mixin(Tone.Buffer),Tone.Buffer._downloadQueue=[],Tone.Buffer.baseUrl="",Tone.Buffer.fromArray=function(array){return(new Tone.Buffer).fromArray(array)},Tone.Buffer._removeFromDownloadQueue=function(request){var index=Tone.Buffer._downloadQueue.indexOf(request);-1!==index&&Tone.Buffer._downloadQueue.splice(index,1)},Tone.Buffer.load=function(url,onload,onerror){onload=Tone.defaultArg(onload,Tone.noOp);var matches=url.match(/\[(.+\|?)+\]$/);if(matches){for(var extensions=matches[1].split("|"),extension=extensions[0],i=0;i<extensions.length;i++)if(Tone.Buffer.supportsType(extensions[i])){extension=extensions[i];break}url=url.replace(matches[0],extension)}function onError(e){if(Tone.Buffer._removeFromDownloadQueue(request),Tone.Buffer.emit("error",e),!onerror)throw e;onerror(e)}function onProgress(){for(var totalProgress=0,i=0;i<Tone.Buffer._downloadQueue.length;i++)totalProgress+=Tone.Buffer._downloadQueue[i].progress;Tone.Buffer.emit("progress",totalProgress/Tone.Buffer._downloadQueue.length)}var request=new XMLHttpRequest;return request.open("GET",Tone.Buffer.baseUrl+url,!0),request.responseType="arraybuffer",request.progress=0,Tone.Buffer._downloadQueue.push(request),request.addEventListener("load",function(){200===request.status?Tone.context.decodeAudioData(request.response,function(buff){request.progress=1,onProgress(),onload(buff),Tone.Buffer._removeFromDownloadQueue(request),0===Tone.Buffer._downloadQueue.length&&Tone.Buffer.emit("load")},function(){Tone.Buffer._removeFromDownloadQueue(request),onError("Tone.Buffer: could not decode audio data: "+url)}):onError("Tone.Buffer: could not locate file: "+url)}),request.addEventListener("error",onError),request.addEventListener("progress",function(event){event.lengthComputable&&(request.progress=event.loaded/event.total*.95,onProgress())}),request.send(),request},Tone.Buffer.cancelDownloads=function(){return Tone.Buffer._downloadQueue.slice().forEach(function(request){Tone.Buffer._removeFromDownloadQueue(request),request.abort()}),Tone.Buffer},Tone.Buffer.supportsType=function(url){var extension=url.split(".");return extension=extension[extension.length-1],""!==document.createElement("audio").canPlayType("audio/"+extension)},Tone.loaded=function(){var onload,onerror;function removeEvents(){Tone.Buffer.off("load",onload),Tone.Buffer.off("error",onerror)}return new Promise(function(success,fail){onload=function(){success()},onerror=function(){fail()},Tone.Buffer.on("load",onload),Tone.Buffer.on("error",onerror)}).then(removeEvents).catch(function(e){throw removeEvents(),new Error(e)})},Tone.Buffer}),Module(function(Tone){return Tone.Buffers=function(urls){var args=Array.prototype.slice.call(arguments);args.shift();var options=Tone.defaults(args,["onload","baseUrl"],Tone.Buffers);for(var key in Tone.call(this),this._buffers={},this.baseUrl=options.baseUrl,this._loadingCount=0,urls)this._loadingCount++,this.add(key,urls[key],this._bufferLoaded.bind(this,options.onload))},Tone.extend(Tone.Buffers),Tone.Buffers.defaults={onload:Tone.noOp,baseUrl:""},Tone.Buffers.prototype.has=function(name){return this._buffers.hasOwnProperty(name)},Tone.Buffers.prototype.get=function(name){if(this.has(name))return this._buffers[name];throw new Error("Tone.Buffers: no buffer named "+name)},Tone.Buffers.prototype._bufferLoaded=function(callback){this._loadingCount--,0===this._loadingCount&&callback&&callback(this)},Object.defineProperty(Tone.Buffers.prototype,"loaded",{get:function(){var isLoaded=!0;for(var buffName in this._buffers){var buff=this.get(buffName);isLoaded=isLoaded&&buff.loaded}return isLoaded}}),Tone.Buffers.prototype.add=function(name,url,callback){return callback=Tone.defaultArg(callback,Tone.noOp),url instanceof Tone.Buffer?(this._buffers[name]=url,callback(this)):url instanceof AudioBuffer?(this._buffers[name]=new Tone.Buffer(url),callback(this)):Tone.isString(url)&&(this._buffers[name]=new Tone.Buffer(this.baseUrl+url,callback)),this},Tone.Buffers.prototype.dispose=function(){for(var name in Tone.prototype.dispose.call(this),this._buffers)this._buffers[name].dispose();return this._buffers=null,this},Tone.Buffers}),Module(function(Tone){var Buses={};return Tone.prototype.send=function(channelName,amount){Buses.hasOwnProperty(channelName)||(Buses[channelName]=this.context.createGain()),amount=Tone.defaultArg(amount,0);var sendKnob=new Tone.Gain(amount,Tone.Type.Decibels);return this.output.chain(sendKnob,Buses[channelName]),sendKnob},Tone.prototype.receive=function(channelName,inputNum){return Buses.hasOwnProperty(channelName)||(Buses[channelName]=this.context.createGain()),Buses[channelName].connect(this,0,inputNum),this},Tone.Context.on("init",function(context){context.Buses?Buses=context.Buses:(Buses={},context.Buses=Buses)}),Tone}),Module(function(Tone){return Tone.Draw=function(){Tone.call(this),this._events=new Tone.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},Tone.extend(Tone.Draw),Tone.Draw.prototype.schedule=function(callback,time){return this._events.add({callback:callback,time:this.toSeconds(time)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},Tone.Draw.prototype.cancel=function(after){return this._events.cancel(this.toSeconds(after)),this},Tone.Draw.prototype._drawLoop=function(){for(var now=Tone.now();this._events.length&&this._events.peek().time-this.anticipation<=now;){var event=this._events.shift();now-event.time<=this.expiration&&event.callback()}this._events.length>0&&requestAnimationFrame(this._boundDrawLoop)},Tone.Draw=new Tone.Draw,Tone.Draw}),Module(function(Tone){Tone.Listener=function(){Tone.call(this),this._orientation=[0,0,0,0,0,0],this._position=[0,0,0],Tone.getContext(function(){this.set(ListenerConstructor.defaults)}.bind(this))},Tone.extend(Tone.Listener),Tone.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},Tone.Listener.prototype._rampTimeConstant=.01,Tone.Listener.prototype.setPosition=function(x,y,z){if(this.context.listener.positionX){var now=this.now();this.context.listener.positionX.setTargetAtTime(x,now,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(y,now,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(z,now,this._rampTimeConstant)}else this.context.listener.setPosition(x,y,z);return this._position=Array.prototype.slice.call(arguments),this},Tone.Listener.prototype.setOrientation=function(x,y,z,upX,upY,upZ){if(this.context.listener.forwardX){var now=this.now();this.context.listener.forwardX.setTargetAtTime(x,now,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(y,now,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(z,now,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(upX,now,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(upY,now,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(upZ,now,this._rampTimeConstant)}else this.context.listener.setOrientation(x,y,z,upX,upY,upZ);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(Tone.Listener.prototype,"positionX",{set:function(pos){this._position[0]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(Tone.Listener.prototype,"positionY",{set:function(pos){this._position[1]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(Tone.Listener.prototype,"positionZ",{set:function(pos){this._position[2]=pos,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(Tone.Listener.prototype,"forwardX",{set:function(pos){this._orientation[0]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(Tone.Listener.prototype,"forwardY",{set:function(pos){this._orientation[1]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(Tone.Listener.prototype,"forwardZ",{set:function(pos){this._orientation[2]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(Tone.Listener.prototype,"upX",{set:function(pos){this._orientation[3]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(Tone.Listener.prototype,"upY",{set:function(pos){this._orientation[4]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(Tone.Listener.prototype,"upZ",{set:function(pos){this._orientation[5]=pos,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),Tone.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var ListenerConstructor=Tone.Listener;return Tone.Listener=new ListenerConstructor,Tone.Context.on("init",function(context){context.Listener instanceof ListenerConstructor?Tone.Listener=context.Listener:Tone.Listener=new ListenerConstructor,context.Listener=Tone.Listener}),Tone.Listener}),Module(function(Tone){return!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),Tone.OfflineContext=function(channels,duration,sampleRate){var offlineContext=new OfflineAudioContext(channels,duration*sampleRate,sampleRate);Tone.Context.call(this,{context:offlineContext,clockSource:"offline",lookAhead:0,updateInterval:128/sampleRate}),this._duration=duration,this._currentTime=0},Tone.extend(Tone.OfflineContext,Tone.Context),Tone.OfflineContext.prototype.now=function(){return this._currentTime},Tone.OfflineContext.prototype.render=function(){for(;this._duration-this._currentTime>=0;)this.emit("tick"),this._currentTime+=this.blockTime;return new Promise(function(done){this._context.oncomplete=function(e){done(e.renderedBuffer)},this._context.startRendering()}.bind(this))},Tone.OfflineContext.prototype.close=function(){this._context=null},Tone.OfflineContext}),Module(function(Tone){return Tone.Offline=function(callback,duration){var sampleRate=Tone.context.sampleRate,originalContext=Tone.context,context=new Tone.OfflineContext(2,duration,sampleRate);Tone.context=context,callback(Tone.Transport);var rendered=context.render();return Tone.context=originalContext,rendered.then(function(buffer){return new Tone.Buffer(buffer)})},Tone.Offline}),Module(function(Tone){return Tone.Effect=function(){var options=Tone.defaults(arguments,["wet"],Tone.Effect);Tone.AudioNode.call(this),this.createInsOuts(1,1),this._dryWet=new Tone.CrossFade(options.wet),this.wet=this._dryWet.fade,this.effectSend=new Tone.Gain,this.effectReturn=new Tone.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},Tone.extend(Tone.Effect,Tone.AudioNode),Tone.Effect.defaults={wet:1},Tone.Effect.prototype.connectEffect=function(effect){return this.effectSend.chain(effect,this.effectReturn),this},Tone.Effect.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},Tone.Effect}),Module(function(Tone){return Tone.AutoFilter=function(){var options=Tone.defaults(arguments,["frequency","baseFrequency","octaves"],Tone.AutoFilter);Tone.Effect.call(this,options),this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new Tone.Filter(options.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=options.type,this._readOnly(["frequency","depth"]),this.octaves=options.octaves,this.baseFrequency=options.baseFrequency},Tone.extend(Tone.AutoFilter,Tone.Effect),Tone.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},Tone.AutoFilter.prototype.start=function(time){return this._lfo.start(time),this},Tone.AutoFilter.prototype.stop=function(time){return this._lfo.stop(time),this},Tone.AutoFilter.prototype.sync=function(delay){return this._lfo.sync(delay),this},Tone.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(Tone.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}}),Object.defineProperty(Tone.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(freq){this._lfo.min=this.toFrequency(freq),this.octaves=this._octaves}}),Object.defineProperty(Tone.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(oct){this._octaves=oct,this._lfo.max=this.baseFrequency*Math.pow(2,oct)}}),Tone.AutoFilter.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},Tone.AutoFilter}),Module(function(Tone){return Tone.AutoPanner=function(){var options=Tone.defaults(arguments,["frequency"],Tone.AutoPanner);Tone.Effect.call(this,options),this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new Tone.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=options.type,this._readOnly(["depth","frequency"])},Tone.extend(Tone.AutoPanner,Tone.Effect),Tone.AutoPanner.defaults={frequency:1,type:"sine",depth:1},Tone.AutoPanner.prototype.start=function(time){return this._lfo.start(time),this},Tone.AutoPanner.prototype.stop=function(time){return this._lfo.stop(time),this},Tone.AutoPanner.prototype.sync=function(delay){return this._lfo.sync(delay),this},Tone.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(Tone.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}}),Tone.AutoPanner.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},Tone.AutoPanner}),Module(function(Tone){return Tone.AutoWah=function(){var options=Tone.defaults(arguments,["baseFrequency","octaves","sensitivity"],Tone.AutoWah);Tone.Effect.call(this,options),this.follower=new Tone.Follower(options.follower),this._sweepRange=new Tone.ScaleExp(0,1,.5),this._baseFrequency=options.baseFrequency,this._octaves=options.octaves,this._inputBoost=new Tone.Gain,this._bandpass=new Tone.Filter({rolloff:-48,frequency:0,Q:options.Q}),this._peaking=new Tone.Filter(0,"peaking"),this._peaking.gain.value=options.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=options.sensitivity,this._readOnly(["gain","Q"])},Tone.extend(Tone.AutoWah,Tone.Effect),Tone.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(Tone.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves,this._setSweepRange()}}),Object.defineProperty(Tone.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(baseFreq){this._baseFrequency=baseFreq,this._setSweepRange()}}),Object.defineProperty(Tone.AutoWah.prototype,"sensitivity",{get:function(){return Tone.gainToDb(1/this._inputBoost.gain.value)},set:function(sensitivy){this._inputBoost.gain.value=1/Tone.dbToGain(sensitivy)}}),Tone.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},Tone.AutoWah.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},Tone.AutoWah}),Module(function(Tone){return Tone.BitCrusher=function(){var options=Tone.defaults(arguments,["bits"],Tone.BitCrusher);Tone.Effect.call(this,options);var invStepSize=1/Math.pow(2,options.bits-1);this._subtract=new Tone.Subtract,this._modulo=new Tone.Modulo(invStepSize),this._bits=options.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},Tone.extend(Tone.BitCrusher,Tone.Effect),Tone.BitCrusher.defaults={bits:4},Object.defineProperty(Tone.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(bits){this._bits=bits;var invStepSize=1/Math.pow(2,bits-1);this._modulo.value=invStepSize}}),Tone.BitCrusher.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},Tone.BitCrusher}),Module(function(Tone){return Tone.Chebyshev=function(){var options=Tone.defaults(arguments,["order"],Tone.Chebyshev);Tone.Effect.call(this,options),this._shaper=new Tone.WaveShaper(4096),this._order=options.order,this.connectEffect(this._shaper),this.order=options.order,this.oversample=options.oversample},Tone.extend(Tone.Chebyshev,Tone.Effect),Tone.Chebyshev.defaults={order:1,oversample:"none"},Tone.Chebyshev.prototype._getCoefficient=function(x,degree,memo){return memo.hasOwnProperty(degree)?memo[degree]:(memo[degree]=0===degree?0:1===degree?x:2*x*this._getCoefficient(x,degree-1,memo)-this._getCoefficient(x,degree-2,memo),memo[degree])},Object.defineProperty(Tone.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(order){this._order=order;for(var curve=new Array(4096),len=curve.length,i=0;i<len;++i){var x=2*i/len-1;curve[i]=0===x?0:this._getCoefficient(x,order,{})}this._shaper.curve=curve}}),Object.defineProperty(Tone.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}}),Tone.Chebyshev.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},Tone.Chebyshev}),Module(function(Tone){return Tone.StereoEffect=function(){Tone.AudioNode.call(this);var options=Tone.defaults(arguments,["wet"],Tone.Effect);this.createInsOuts(1,1),this._dryWet=new Tone.CrossFade(options.wet),this.wet=this._dryWet.fade,this._split=new Tone.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new Tone.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},Tone.extend(Tone.StereoEffect,Tone.Effect),Tone.StereoEffect.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},Tone.StereoEffect}),Module(function(Tone){return Tone.FeedbackEffect=function(){var options=Tone.defaults(arguments,["feedback"],Tone.FeedbackEffect);Tone.Effect.call(this,options),this._feedbackGain=new Tone.Gain(options.feedback,Tone.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},Tone.extend(Tone.FeedbackEffect,Tone.Effect),Tone.FeedbackEffect.defaults={feedback:.125},Tone.FeedbackEffect.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},Tone.FeedbackEffect}),Module(function(Tone){return Tone.StereoXFeedbackEffect=function(){var options=Tone.defaults(arguments,["feedback"],Tone.FeedbackEffect);Tone.StereoEffect.call(this,options),this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange),this._feedbackLR=new Tone.Gain,this._feedbackRL=new Tone.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},Tone.extend(Tone.StereoXFeedbackEffect,Tone.StereoEffect),Tone.StereoXFeedbackEffect.prototype.dispose=function(){return Tone.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},Tone.StereoXFeedbackEffect}),Module(function(Tone){return Tone.Chorus=function(){var options=Tone.defaults(arguments,["frequency","delayTime","depth"],Tone.Chorus);Tone.StereoXFeedbackEffect.call(this,options),this._depth=options.depth,this._delayTime=options.delayTime/1e3,this._lfoL=new Tone.LFO({frequency:options.frequency,min:0,max:1}),this._lfoR=new Tone.LFO({frequency:options.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Tone.Delay,this._delayNodeR=new Tone.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=options.frequency,this.type=options.type,this._readOnly(["frequency"]),this.spread=options.spread},Tone.extend(Tone.Chorus,Tone.StereoXFeedbackEffect),Tone.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine",spread:180},Object.defineProperty(Tone.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(depth){this._depth=depth;var deviation=this._delayTime*depth;this._lfoL.min=Math.max(this._delayTime-deviation,0),this._lfoL.max=this._delayTime+deviation,this._lfoR.min=Math.max(this._delayTime-deviation,0),this._lfoR.max=this._delayTime+deviation}}),Object.defineProperty(Tone.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(delayTime){this._delayTime=delayTime/1e3,this.depth=this._depth}}),Object.defineProperty(Tone.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type,this._lfoR.type=type}}),Object.defineProperty(Tone.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}}),Tone.Chorus.prototype.dispose=function(){return Tone.StereoXFeedbackEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},Tone.Chorus}),Module(function(Tone){return Tone.Convolver=function(){var options=Tone.defaults(arguments,["url","onload"],Tone.Convolver);Tone.Effect.call(this,options),this._convolver=this.context.createConvolver(),this._buffer=new Tone.Buffer,Tone.isString(options.url)?this._buffer.load(options.url,function(buffer){this.buffer=buffer,options.onload()}.bind(this)):options.url&&(this.buffer=options.url,options.onload()),this.connectEffect(this._convolver)},Tone.extend(Tone.Convolver,Tone.Effect),Tone.Convolver.defaults={onload:Tone.noOp},Object.defineProperty(Tone.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(buffer){this._buffer.set(buffer),this._convolver.buffer=this._buffer.get()}}),Tone.Convolver.prototype.load=function(url,callback){return this._buffer.load(url,function(buff){this.buffer=buff,callback&&callback()}.bind(this))},Tone.Convolver.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},Tone.Convolver}),Module(function(Tone){return Tone.Distortion=function(){var options=Tone.defaults(arguments,["distortion"],Tone.Distortion);Tone.Effect.call(this,options),this._shaper=new Tone.WaveShaper(4096),this._distortion=options.distortion,this.connectEffect(this._shaper),this.distortion=options.distortion,this.oversample=options.oversample},Tone.extend(Tone.Distortion,Tone.Effect),Tone.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(Tone.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(amount){this._distortion=amount;var k=100*amount,deg=Math.PI/180;this._shaper.setMap(function(x){return Math.abs(x)<.001?0:(3+k)*x*20*deg/(Math.PI+k*Math.abs(x))})}}),Object.defineProperty(Tone.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}}),Tone.Distortion.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},Tone.Distortion}),Module(function(Tone){return Tone.FeedbackDelay=function(){var options=Tone.defaults(arguments,["delayTime","feedback"],Tone.FeedbackDelay);Tone.FeedbackEffect.call(this,options),this._delayNode=new Tone.Delay(options.delayTime),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},Tone.extend(Tone.FeedbackDelay,Tone.FeedbackEffect),Tone.FeedbackDelay.defaults={delayTime:.25},Tone.FeedbackDelay.prototype.dispose=function(){return Tone.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},Tone.FeedbackDelay}),Module(function(Tone){var combFilterTunings=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],allpassFilterFrequencies=[225,556,441,341];return Tone.Freeverb=function(){var options=Tone.defaults(arguments,["roomSize","dampening"],Tone.Freeverb);Tone.StereoEffect.call(this,options),this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange),this.dampening=new Tone.Signal(options.dampening,Tone.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var l=0;l<allpassFilterFrequencies.length;l++){var allpassL=this.context.createBiquadFilter();allpassL.type="allpass",allpassL.frequency.value=allpassFilterFrequencies[l],this._allpassFiltersL.push(allpassL)}for(var r=0;r<allpassFilterFrequencies.length;r++){var allpassR=this.context.createBiquadFilter();allpassR.type="allpass",allpassR.frequency.value=allpassFilterFrequencies[r],this._allpassFiltersR.push(allpassR)}for(var c=0;c<combFilterTunings.length;c++){var lfpf=new Tone.LowpassCombFilter(combFilterTunings[c]);c<combFilterTunings.length/2?this.effectSendL.chain(lfpf,this._allpassFiltersL[0]):this.effectSendR.chain(lfpf,this._allpassFiltersR[0]),this.roomSize.connect(lfpf.resonance),this.dampening.connect(lfpf.dampening),this._combFilters.push(lfpf)}Tone.connectSeries.apply(Tone,this._allpassFiltersL),Tone.connectSeries.apply(Tone,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},Tone.extend(Tone.Freeverb,Tone.StereoEffect),Tone.Freeverb.defaults={roomSize:.7,dampening:3e3},Tone.Freeverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var al=0;al<this._allpassFiltersL.length;al++)this._allpassFiltersL[al].disconnect(),this._allpassFiltersL[al]=null;this._allpassFiltersL=null;for(var ar=0;ar<this._allpassFiltersR.length;ar++)this._allpassFiltersR[ar].disconnect(),this._allpassFiltersR[ar]=null;this._allpassFiltersR=null;for(var cf=0;cf<this._combFilters.length;cf++)this._combFilters[cf].dispose(),this._combFilters[cf]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},Tone.Freeverb}),Module(function(Tone){var combFilterDelayTimes=[.06748,.06404,.08212,.09004],combFilterResonances=[.773,.802,.753,.733],allpassFilterFreqs=[347,113,37];return Tone.JCReverb=function(){var options=Tone.defaults(arguments,["roomSize"],Tone.JCReverb);Tone.StereoEffect.call(this,options),this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange),this._scaleRoomSize=new Tone.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var af=0;af<allpassFilterFreqs.length;af++){var allpass=this.context.createBiquadFilter();allpass.type="allpass",allpass.frequency.value=allpassFilterFreqs[af],this._allpassFilters.push(allpass)}for(var cf=0;cf<combFilterDelayTimes.length;cf++){var fbcf=new Tone.FeedbackCombFilter(combFilterDelayTimes[cf],.1);this._scaleRoomSize.connect(fbcf.resonance),fbcf.resonance.value=combFilterResonances[cf],this._allpassFilters[this._allpassFilters.length-1].connect(fbcf),cf<combFilterDelayTimes.length/2?fbcf.connect(this.effectReturnL):fbcf.connect(this.effectReturnR),this._feedbackCombFilters.push(fbcf)}this.roomSize.connect(this._scaleRoomSize),Tone.connectSeries.apply(Tone,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},Tone.extend(Tone.JCReverb,Tone.StereoEffect),Tone.JCReverb.defaults={roomSize:.5},Tone.JCReverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var apf=0;apf<this._allpassFilters.length;apf++)this._allpassFilters[apf].disconnect(),this._allpassFilters[apf]=null;this._allpassFilters=null;for(var fbcf=0;fbcf<this._feedbackCombFilters.length;fbcf++)this._feedbackCombFilters[fbcf].dispose(),this._feedbackCombFilters[fbcf]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},Tone.JCReverb}),Module(function(Tone){return Tone.MidSideEffect=function(){Tone.Effect.apply(this,arguments),this._midSideSplit=new Tone.MidSideSplit,this._midSideMerge=new Tone.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},Tone.extend(Tone.MidSideEffect,Tone.Effect),Tone.MidSideEffect.prototype.dispose=function(){return Tone.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},Tone.MidSideEffect}),Module(function(Tone){return Tone.Phaser=function(){var options=Tone.defaults(arguments,["frequency","octaves","baseFrequency"],Tone.Phaser);Tone.StereoEffect.call(this,options),this._lfoL=new Tone.LFO(options.frequency,0,1),this._lfoR=new Tone.LFO(options.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=options.baseFrequency,this._octaves=options.octaves,this.Q=new Tone.Signal(options.Q,Tone.Type.Positive),this._filtersL=this._makeFilters(options.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(options.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=options.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[options.stages-1].connect(this.effectReturnL),this._filtersR[options.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=options.baseFrequency,this.octaves=options.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},Tone.extend(Tone.Phaser,Tone.StereoEffect),Tone.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},Tone.Phaser.prototype._makeFilters=function(stages,connectToFreq,Q){for(var filters=new Array(stages),i=0;i<stages;i++){var filter=this.context.createBiquadFilter();filter.type="allpass",Q.connect(filter.Q),connectToFreq.connect(filter.frequency),filters[i]=filter}return Tone.connectSeries.apply(Tone,filters),filters},Object.defineProperty(Tone.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;var max=this._baseFrequency*Math.pow(2,octaves);this._lfoL.max=max,this._lfoR.max=max}}),Object.defineProperty(Tone.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(freq){this._baseFrequency=freq,this._lfoL.min=freq,this._lfoR.min=freq,this.octaves=this._octaves}}),Tone.Phaser.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var i=0;i<this._filtersL.length;i++)this._filtersL[i].disconnect(),this._filtersL[i]=null;this._filtersL=null;for(var j=0;j<this._filtersR.length;j++)this._filtersR[j].disconnect(),this._filtersR[j]=null;return this._filtersR=null,this.frequency=null,this},Tone.Phaser}),Module(function(Tone){return Tone.PingPongDelay=function(){var options=Tone.defaults(arguments,["delayTime","feedback"],Tone.PingPongDelay);Tone.StereoXFeedbackEffect.call(this,options),this._leftDelay=new Tone.Delay(0,options.maxDelayTime),this._rightDelay=new Tone.Delay(0,options.maxDelayTime),this._rightPreDelay=new Tone.Delay(0,options.maxDelayTime),this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},Tone.extend(Tone.PingPongDelay,Tone.StereoXFeedbackEffect),Tone.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},Tone.PingPongDelay.prototype.dispose=function(){return Tone.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},Tone.PingPongDelay}),Module(function(Tone){return Tone.PitchShift=function(){var options=Tone.defaults(arguments,["pitch"],Tone.PitchShift);Tone.FeedbackEffect.call(this,options),this._frequency=new Tone.Signal(0),this._delayA=new Tone.Delay(0,1),this._lfoA=new Tone.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Tone.Delay(0,1),this._lfoB=new Tone.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new Tone.CrossFade,this._crossFadeLFO=new Tone.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Tone.Delay(options.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=options.pitch,this._windowSize=options.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var now=this.now();this._lfoA.start(now),this._lfoB.start(now),this._crossFadeLFO.start(now),this.windowSize=this._windowSize},Tone.extend(Tone.PitchShift,Tone.FeedbackEffect),Tone.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(Tone.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(interval){this._pitch=interval;var factor=0;interval<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,factor=Tone.intervalToFrequencyRatio(interval-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,factor=Tone.intervalToFrequencyRatio(interval)-1),this._frequency.value=factor*(1.2/this._windowSize)}}),Object.defineProperty(Tone.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(size){this._windowSize=this.toSeconds(size),this.pitch=this._pitch}}),Tone.PitchShift.prototype.dispose=function(){return Tone.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},Tone.PitchShift}),Module(function(Tone){return Tone.StereoFeedbackEffect=function(){var options=Tone.defaults(arguments,["feedback"],Tone.FeedbackEffect);Tone.StereoEffect.call(this,options),this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange),this._feedbackL=new Tone.Gain,this._feedbackR=new Tone.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},Tone.extend(Tone.StereoFeedbackEffect,Tone.StereoEffect),Tone.StereoFeedbackEffect.prototype.dispose=function(){return Tone.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},Tone.StereoFeedbackEffect}),Module(function(Tone){return Tone.StereoWidener=function(){var options=Tone.defaults(arguments,["width"],Tone.StereoWidener);Tone.MidSideEffect.call(this,options),this.width=new Tone.Signal(options.width,Tone.Type.NormalRange),this._midMult=new Tone.Expr("$0 * ($1 * (1 - $2))"),this._sideMult=new Tone.Expr("$0 * ($1 * $2)"),this._two=new Tone.Signal(2),this._two.connect(this._midMult,0,1),this.width.connect(this._midMult,0,2),this._two.connect(this._sideMult,0,1),this.width.connect(this._sideMult,0,2),this.midSend.chain(this._midMult,this.midReturn),this.sideSend.chain(this._sideMult,this.sideReturn),this._readOnly(["width"])},Tone.extend(Tone.StereoWidener,Tone.MidSideEffect),Tone.StereoWidener.defaults={width:.5},Tone.StereoWidener.prototype.dispose=function(){return Tone.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._two.dispose(),this._two=null,this},Tone.StereoWidener}),Module(function(Tone){return Tone.Tremolo=function(){var options=Tone.defaults(arguments,["frequency","depth"],Tone.Tremolo);Tone.StereoEffect.call(this,options),this._lfoL=new Tone.LFO({phase:options.spread,min:1,max:0}),this._lfoR=new Tone.LFO({phase:options.spread,min:1,max:0}),this._amplitudeL=new Tone.Gain,this._amplitudeR=new Tone.Gain,this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.depth=new Tone.Signal(options.depth,Tone.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=options.type,this.spread=options.spread},Tone.extend(Tone.Tremolo,Tone.StereoEffect),Tone.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},Tone.Tremolo.prototype.start=function(time){return this._lfoL.start(time),this._lfoR.start(time),this},Tone.Tremolo.prototype.stop=function(time){return this._lfoL.stop(time),this._lfoR.stop(time),this},Tone.Tremolo.prototype.sync=function(delay){return this._lfoL.sync(delay),this._lfoR.sync(delay),this},Tone.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),this},Object.defineProperty(Tone.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type,this._lfoR.type=type}}),Object.defineProperty(Tone.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2,this._lfoR.phase=spread/2+90}}),Tone.Tremolo.prototype.dispose=function(){return Tone.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},Tone.Tremolo}),Module(function(Tone){return Tone.Vibrato=function(){var options=Tone.defaults(arguments,["frequency","depth"],Tone.Vibrato);Tone.Effect.call(this,options),this._delayNode=new Tone.Delay(0,options.maxDelay),this._lfo=new Tone.LFO({type:options.type,min:0,max:options.maxDelay,frequency:options.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=options.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},Tone.extend(Tone.Vibrato,Tone.Effect),Tone.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(Tone.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}}),Tone.Vibrato.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},Tone.Vibrato}),Module(function(Tone){return Tone.Event=function(){var options=Tone.defaults(arguments,["callback","value"],Tone.Event);Tone.call(this),this._loop=options.loop,this.callback=options.callback,this.value=options.value,this._loopStart=this.toTicks(options.loopStart),this._loopEnd=this.toTicks(options.loopEnd),this._state=new Tone.TimelineState(Tone.State.Stopped),this._playbackRate=1,this._startOffset=0,this._probability=options.probability,this._humanize=options.humanize,this.mute=options.mute,this.playbackRate=options.playbackRate},Tone.extend(Tone.Event),Tone.Event.defaults={callback:Tone.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},Tone.Event.prototype._rescheduleEvents=function(after){return after=Tone.defaultArg(after,-1),this._state.forEachFrom(after,function(event){var duration;if(event.state===Tone.State.Started){Tone.isUndef(event.id)||Tone.Transport.clear(event.id);var startTick=event.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){duration=1/0,Tone.isNumber(this._loop)&&(duration=this._loop*this._getLoopDuration());var nextEvent=this._state.getAfter(startTick);null!==nextEvent&&(duration=Math.min(duration,nextEvent.time-startTick)),duration!==1/0&&(this._state.setStateAtTime(Tone.State.Stopped,startTick+duration+1),duration=Tone.Time(duration,"i"));var interval=Tone.Time(this._getLoopDuration(),"i");event.id=Tone.Transport.scheduleRepeat(this._tick.bind(this),interval,Tone.TransportTime(startTick,"i"),duration)}else event.id=Tone.Transport.schedule(this._tick.bind(this),startTick+"i")}}.bind(this)),this},Object.defineProperty(Tone.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(Tone.Transport.ticks)}}),Object.defineProperty(Tone.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(offset){this._startOffset=offset}}),Object.defineProperty(Tone.Event.prototype,"probability",{get:function(){return this._probability},set:function(prob){this._probability=prob}}),Object.defineProperty(Tone.Event.prototype,"humanize",{get:function(){return this._humanize},set:function(variation){this._humanize=variation}}),Tone.Event.prototype.start=function(time){return time=this.toTicks(time),this._state.getValueAtTime(time)===Tone.State.Stopped&&(this._state.add({state:Tone.State.Started,time:time,id:void 0}),this._rescheduleEvents(time)),this},Tone.Event.prototype.stop=function(time){if(this.cancel(time),time=this.toTicks(time),this._state.getValueAtTime(time)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Stopped,time);var previousEvent=this._state.getBefore(time),reschedulTime=time;null!==previousEvent&&(reschedulTime=previousEvent.time),this._rescheduleEvents(reschedulTime)}return this},Tone.Event.prototype.cancel=function(time){return time=Tone.defaultArg(time,-1/0),time=this.toTicks(time),this._state.forEachFrom(time,function(event){Tone.Transport.clear(event.id)}),this._state.cancel(time),this},Tone.Event.prototype._tick=function(time){if(!this.mute&&this._state.getValueAtTime(Tone.Transport.ticks)===Tone.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var variation=.02;Tone.isBoolean(this.humanize)||(variation=this.toSeconds(this.humanize)),time+=(2*Math.random()-1)*variation}this.callback(time,this.value)}},Tone.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(Tone.Event.prototype,"loop",{get:function(){return this._loop},set:function(loop){this._loop=loop,this._rescheduleEvents()}}),Object.defineProperty(Tone.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._rescheduleEvents()}}),Object.defineProperty(Tone.Event.prototype,"loopEnd",{get:function(){return Tone.TransportTime(this._loopEnd,"i").toNotation()},set:function(loopEnd){this._loopEnd=this.toTicks(loopEnd),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(Tone.Event.prototype,"loopStart",{get:function(){return Tone.TransportTime(this._loopStart,"i").toNotation()},set:function(loopStart){this._loopStart=this.toTicks(loopStart),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(Tone.Event.prototype,"progress",{get:function(){if(this._loop){var ticks=Tone.Transport.ticks,lastEvent=this._state.get(ticks);if(null!==lastEvent&&lastEvent.state===Tone.State.Started){var loopDuration=this._getLoopDuration();return(ticks-lastEvent.time)%loopDuration/loopDuration}return 0}return 0}}),Tone.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},Tone.Event}),Module(function(Tone){return Tone.Loop=function(){var options=Tone.defaults(arguments,["callback","interval"],Tone.Loop);Tone.call(this),this._event=new Tone.Event({callback:this._tick.bind(this),loop:!0,loopEnd:options.interval,playbackRate:options.playbackRate,probability:options.probability}),this.callback=options.callback,this.iterations=options.iterations},Tone.extend(Tone.Loop),Tone.Loop.defaults={interval:"4n",callback:Tone.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},Tone.Loop.prototype.start=function(time){return this._event.start(time),this},Tone.Loop.prototype.stop=function(time){return this._event.stop(time),this},Tone.Loop.prototype.cancel=function(time){return this._event.cancel(time),this},Tone.Loop.prototype._tick=function(time){this.callback(time)},Object.defineProperty(Tone.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(Tone.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(Tone.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(interval){this._event.loopEnd=interval}}),Object.defineProperty(Tone.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(rate){this._event.playbackRate=rate}}),Object.defineProperty(Tone.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(variation){this._event.humanize=variation}}),Object.defineProperty(Tone.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(prob){this._event.probability=prob}}),Object.defineProperty(Tone.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(mute){this._event.mute=mute}}),Object.defineProperty(Tone.Loop.prototype,"iterations",{get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(iters){this._event.loop=iters===1/0||iters}}),Tone.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},Tone.Loop}),Module(function(Tone){return Tone.Part=function(){var options=Tone.defaults(arguments,["callback","events"],Tone.Part);Tone.Event.call(this,options),this._events=[];for(var i=0;i<options.events.length;i++)Array.isArray(options.events[i])?this.add(options.events[i][0],options.events[i][1]):this.add(options.events[i])},Tone.extend(Tone.Part,Tone.Event),Tone.Part.defaults={callback:Tone.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1,events:[]},Tone.Part.prototype.start=function(time,offset){var ticks=this.toTicks(time);return this._state.getValueAtTime(ticks)!==Tone.State.Started&&(offset=this._loop?Tone.defaultArg(offset,this._loopStart):Tone.defaultArg(offset,0),offset=this.toTicks(offset),this._state.add({state:Tone.State.Started,time:ticks,offset:offset}),this._forEach(function(event){this._startNote(event,ticks,offset)})),this},Tone.Part.prototype._startNote=function(event,ticks,offset){ticks-=offset,this._loop?event.startOffset>=this._loopStart&&event.startOffset<this._loopEnd?(event.startOffset<offset&&(ticks+=this._getLoopDuration()),event.start(Tone.TransportTime(ticks,"i"))):event.startOffset<this._loopStart&&event.startOffset>=offset&&(event.loop=!1,event.start(Tone.TransportTime(ticks,"i"))):event.startOffset>=offset&&event.start(Tone.TransportTime(ticks,"i"))},Object.defineProperty(Tone.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(offset){this._startOffset=offset,this._forEach(function(event){event.startOffset+=this._startOffset})}}),Tone.Part.prototype.stop=function(time){var ticks=this.toTicks(time);return this._state.cancel(ticks),this._state.setStateAtTime(Tone.State.Stopped,ticks),this._forEach(function(event){event.stop(time)}),this},Tone.Part.prototype.at=function(time,value){time=Tone.TransportTime(time);for(var tickTime=Tone.Time(1,"i").toSeconds(),i=0;i<this._events.length;i++){var event=this._events[i];if(Math.abs(time.toTicks()-event.startOffset)<tickTime)return Tone.isUndef(value)||(event.value=value),event}return Tone.isUndef(value)?null:(this.add(time,value),this._events[this._events.length-1])},Tone.Part.prototype.add=function(time,value){var event;return time.hasOwnProperty("time")&&(time=(value=time).time),time=this.toTicks(time),value instanceof Tone.Event?(event=value).callback=this._tick.bind(this):event=new Tone.Event({callback:this._tick.bind(this),value:value}),event.startOffset=time,event.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(event),this._restartEvent(event),this},Tone.Part.prototype._restartEvent=function(event){this._state.forEach(function(stateEvent){stateEvent.state===Tone.State.Started?this._startNote(event,stateEvent.time,stateEvent.offset):event.stop(Tone.TransportTime(stateEvent.time,"i"))}.bind(this))},Tone.Part.prototype.remove=function(time,value){time.hasOwnProperty("time")&&(time=(value=time).time),time=this.toTicks(time);for(var i=this._events.length-1;i>=0;i--){var event=this._events[i];event instanceof Tone.Part?event.remove(time,value):event.startOffset===time&&(Tone.isUndef(value)||!Tone.isUndef(value)&&event.value===value)&&(this._events.splice(i,1),event.dispose())}return this},Tone.Part.prototype.removeAll=function(){return this._forEach(function(event){event.dispose()}),this._events=[],this},Tone.Part.prototype.cancel=function(after){return this._forEach(function(event){event.cancel(after)}),this._state.cancel(this.toTicks(after)),this},Tone.Part.prototype._forEach=function(callback,ctx){if(this._events){ctx=Tone.defaultArg(ctx,this);for(var i=this._events.length-1;i>=0;i--){var e=this._events[i];e instanceof Tone.Part?e._forEach(callback,ctx):callback.call(ctx,e)}}return this},Tone.Part.prototype._setAll=function(attr,value){this._forEach(function(event){event[attr]=value})},Tone.Part.prototype._tick=function(time,value){this.mute||this.callback(time,value)},Tone.Part.prototype._testLoopBoundries=function(event){event.startOffset<this._loopStart||event.startOffset>=this._loopEnd?event.cancel(0):event.state===Tone.State.Stopped&&this._restartEvent(event)},Object.defineProperty(Tone.Part.prototype,"probability",{get:function(){return this._probability},set:function(prob){this._probability=prob,this._setAll("probability",prob)}}),Object.defineProperty(Tone.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(variation){this._humanize=variation,this._setAll("humanize",variation)}}),Object.defineProperty(Tone.Part.prototype,"loop",{get:function(){return this._loop},set:function(loop){this._loop=loop,this._forEach(function(event){event._loopStart=this._loopStart,event._loopEnd=this._loopEnd,event.loop=loop,this._testLoopBoundries(event)})}}),Object.defineProperty(Tone.Part.prototype,"loopEnd",{get:function(){return Tone.TransportTime(this._loopEnd,"i").toNotation()},set:function(loopEnd){this._loopEnd=this.toTicks(loopEnd),this._loop&&this._forEach(function(event){event.loopEnd=loopEnd,this._testLoopBoundries(event)})}}),Object.defineProperty(Tone.Part.prototype,"loopStart",{get:function(){return Tone.TransportTime(this._loopStart,"i").toNotation()},set:function(loopStart){this._loopStart=this.toTicks(loopStart),this._loop&&this._forEach(function(event){event.loopStart=this.loopStart,this._testLoopBoundries(event)})}}),Object.defineProperty(Tone.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._setAll("playbackRate",rate)}}),Object.defineProperty(Tone.Part.prototype,"length",{get:function(){return this._events.length}}),Tone.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},Tone.Part}),Module(function(Tone){return Tone.Pattern=function(){var options=Tone.defaults(arguments,["callback","values","pattern"],Tone.Pattern);Tone.Loop.call(this,options),this._pattern=new Tone.CtrlPattern({values:options.values,type:options.pattern,index:options.index})},Tone.extend(Tone.Pattern,Tone.Loop),Tone.Pattern.defaults={pattern:Tone.CtrlPattern.Type.Up,callback:Tone.noOp,values:[]},Tone.Pattern.prototype._tick=function(time){this.callback(time,this._pattern.value),this._pattern.next()},Object.defineProperty(Tone.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(i){this._pattern.index=i}}),Object.defineProperty(Tone.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(vals){this._pattern.values=vals}}),Object.defineProperty(Tone.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(Tone.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(pattern){this._pattern.type=pattern}}),Tone.Pattern.prototype.dispose=function(){Tone.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},Tone.Pattern}),Module(function(Tone){return Tone.Sequence=function(){var options=Tone.defaults(arguments,["callback","events","subdivision"],Tone.Sequence),events=options.events;if(delete options.events,Tone.Part.call(this,options),this._subdivision=this.toTicks(options.subdivision),Tone.isUndef(options.loopEnd)&&!Tone.isUndef(events)&&(this._loopEnd=events.length*this._subdivision),this._loop=!0,!Tone.isUndef(events))for(var i=0;i<events.length;i++)this.add(i,events[i])},Tone.extend(Tone.Sequence,Tone.Part),Tone.Sequence.defaults={subdivision:"4n"},Object.defineProperty(Tone.Sequence.prototype,"subdivision",{get:function(){return Tone.Time(this._subdivision,"i").toNotation()}}),Tone.Sequence.prototype.at=function(index,value){return Tone.isArray(value)&&this.remove(index),Tone.Part.prototype.at.call(this,this._indexTime(index),value)},Tone.Sequence.prototype.add=function(index,value){if(null===value)return this;if(Tone.isArray(value)){var subSubdivision=Math.round(this._subdivision/value.length);value=new Tone.Sequence(this._tick.bind(this),value,Tone.Time(subSubdivision,"i"))}return Tone.Part.prototype.add.call(this,this._indexTime(index),value),this},Tone.Sequence.prototype.remove=function(index,value){return Tone.Part.prototype.remove.call(this,this._indexTime(index),value),this},Tone.Sequence.prototype._indexTime=function(index){return index instanceof Tone.TransportTime?index:Tone.TransportTime(index*this._subdivision+this.startOffset,"i")},Tone.Sequence.prototype.dispose=function(){return Tone.Part.prototype.dispose.call(this),this},Tone.Sequence}),Module(function(Tone){return Tone.PulseOscillator=function(){var options=Tone.defaults(arguments,["frequency","width"],Tone.Oscillator);Tone.Source.call(this,options),this.width=new Tone.Signal(options.width,Tone.Type.NormalRange),this._widthGate=new Tone.Gain,this._sawtooth=new Tone.Oscillator({frequency:options.frequency,detune:options.detune,type:"sawtooth",phase:options.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new Tone.WaveShaper(function(val){return val<0?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},Tone.extend(Tone.PulseOscillator,Tone.Source),Tone.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},Tone.PulseOscillator.prototype._start=function(time){time=this.toSeconds(time),this._sawtooth.start(time),this._widthGate.gain.setValueAtTime(1,time)},Tone.PulseOscillator.prototype._stop=function(time){time=this.toSeconds(time),this._sawtooth.stop(time),this._widthGate.gain.setValueAtTime(0,time)},Object.defineProperty(Tone.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(phase){this._sawtooth.phase=phase}}),Object.defineProperty(Tone.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(Tone.PulseOscillator.prototype,"partials",{get:function(){return[]}}),Tone.PulseOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},Tone.PulseOscillator}),Module(function(Tone){return Tone.PWMOscillator=function(){var options=Tone.defaults(arguments,["frequency","modulationFrequency"],Tone.PWMOscillator);Tone.Source.call(this,options),this._pulse=new Tone.PulseOscillator(options.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new Tone.Oscillator({frequency:options.frequency,detune:options.detune,phase:options.phase}),this._scale=new Tone.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},Tone.extend(Tone.PWMOscillator,Tone.Source),Tone.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},Tone.PWMOscillator.prototype._start=function(time){time=this.toSeconds(time),this._modulator.start(time),this._pulse.start(time)},Tone.PWMOscillator.prototype._stop=function(time){time=this.toSeconds(time),this._modulator.stop(time),this._pulse.stop(time)},Object.defineProperty(Tone.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(Tone.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(Tone.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(phase){this._modulator.phase=phase}}),Tone.PWMOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},Tone.PWMOscillator}),Module(function(Tone){return Tone.FMOscillator=function(){var options=Tone.defaults(arguments,["frequency","type","modulationType"],Tone.FMOscillator);Tone.Source.call(this,options),this._carrier=new Tone.Oscillator(options.frequency,options.type),this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=options.detune,this.modulationIndex=new Tone.Multiply(options.modulationIndex),this.modulationIndex.units=Tone.Type.Positive,this._modulator=new Tone.Oscillator(options.frequency,options.modulationType),this.harmonicity=new Tone.Multiply(options.harmonicity),this.harmonicity.units=Tone.Type.Positive,this._modulationNode=new Tone.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=options.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},Tone.extend(Tone.FMOscillator,Tone.Source),Tone.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},Tone.FMOscillator.prototype._start=function(time){time=this.toSeconds(time),this._modulator.start(time),this._carrier.start(time)},Tone.FMOscillator.prototype._stop=function(time){time=this.toSeconds(time),this._modulator.stop(time),this._carrier.stop(time)},Object.defineProperty(Tone.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(type){this._carrier.type=type}}),Object.defineProperty(Tone.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(type){this._modulator.type=type}}),Object.defineProperty(Tone.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(phase){this._carrier.phase=phase,this._modulator.phase=phase}}),Object.defineProperty(Tone.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(partials){this._carrier.partials=partials}}),Tone.FMOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},Tone.FMOscillator}),Module(function(Tone){return Tone.AMOscillator=function(){var options=Tone.defaults(arguments,["frequency","type","modulationType"],Tone.AMOscillator);Tone.Source.call(this,options),this._carrier=new Tone.Oscillator(options.frequency,options.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=options.detune,this._modulator=new Tone.Oscillator(options.frequency,options.modulationType),this._modulationScale=new Tone.AudioToGain,this.harmonicity=new Tone.Multiply(options.harmonicity),this.harmonicity.units=Tone.Type.Positive,this._modulationNode=new Tone.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=options.phase,this._readOnly(["frequency","detune","harmonicity"])},Tone.extend(Tone.AMOscillator,Tone.Oscillator),Tone.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},Tone.AMOscillator.prototype._start=function(time){time=this.toSeconds(time),this._modulator.start(time),this._carrier.start(time)},Tone.AMOscillator.prototype._stop=function(time){time=this.toSeconds(time),this._modulator.stop(time),this._carrier.stop(time)},Object.defineProperty(Tone.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(type){this._carrier.type=type}}),Object.defineProperty(Tone.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(type){this._modulator.type=type}}),Object.defineProperty(Tone.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(phase){this._carrier.phase=phase,this._modulator.phase=phase}}),Object.defineProperty(Tone.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(partials){this._carrier.partials=partials}}),Tone.AMOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},Tone.AMOscillator}),Module(function(Tone){return Tone.FatOscillator=function(){var options=Tone.defaults(arguments,["frequency","type","spread"],Tone.FatOscillator);Tone.Source.call(this,options),this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this._oscillators=[],this._spread=options.spread,this._type=options.type,this._phase=options.phase,this._partials=Tone.defaultArg(options.partials,[]),this.count=options.count,this._readOnly(["frequency","detune"])},Tone.extend(Tone.FatOscillator,Tone.Source),Tone.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},Tone.FatOscillator.prototype._start=function(time){time=this.toSeconds(time),this._forEach(function(osc){osc.start(time)})},Tone.FatOscillator.prototype._stop=function(time){time=this.toSeconds(time),this._forEach(function(osc){osc.stop(time)})},Tone.FatOscillator.prototype._forEach=function(iterator){for(var i=0;i<this._oscillators.length;i++)iterator.call(this,this._oscillators[i],i)},Object.defineProperty(Tone.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(type){this._type=type,this._forEach(function(osc){osc.type=type})}}),Object.defineProperty(Tone.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(spread){if(this._spread=spread,this._oscillators.length>1){var start=-spread/2,step=spread/(this._oscillators.length-1);this._forEach(function(osc,i){osc.detune.value=start+step*i})}}}),Object.defineProperty(Tone.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(count){if(count=Math.max(count,1),this._oscillators.length!==count){this._forEach(function(osc){osc.dispose()}),this._oscillators=[];for(var i=0;i<count;i++){var osc=new Tone.Oscillator;this.type===Tone.Oscillator.Type.Custom?osc.partials=this._partials:osc.type=this._type,osc.phase=this._phase,osc.volume.value=-6-count,this.frequency.connect(osc.frequency),this.detune.connect(osc.detune),osc.connect(this.output),this._oscillators[i]=osc}this.spread=this._spread,this.state===Tone.State.Started&&this._forEach(function(osc){osc.start()})}}}),Object.defineProperty(Tone.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(phase){this._phase=phase,this._forEach(function(osc){osc.phase=phase})}}),Object.defineProperty(Tone.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(partials){this._partials=partials,this._type=Tone.Oscillator.Type.Custom,this._forEach(function(osc){osc.partials=partials})}}),Tone.FatOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(osc){osc.dispose()}),this._oscillators=null,this._partials=null,this},Tone.FatOscillator}),Module(function(Tone){Tone.OmniOscillator=function(){var options=Tone.defaults(arguments,["frequency","type"],Tone.OmniOscillator);Tone.Source.call(this,options),this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=options.type,this._readOnly(["frequency","detune"]),this.set(options)},Tone.extend(Tone.OmniOscillator,Tone.Source),Tone.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var OmniOscType_Pulse="PulseOscillator",OmniOscType_PWM="PWMOscillator",OmniOscType_Osc="Oscillator",OmniOscType_FM="FMOscillator",OmniOscType_AM="AMOscillator",OmniOscType_Fat="FatOscillator";return Tone.OmniOscillator.prototype._start=function(time){this._oscillator.start(time)},Tone.OmniOscillator.prototype._stop=function(time){this._oscillator.stop(time)},Object.defineProperty(Tone.OmniOscillator.prototype,"type",{get:function(){var prefix="";return this._sourceType===OmniOscType_FM?prefix="fm":this._sourceType===OmniOscType_AM?prefix="am":this._sourceType===OmniOscType_Fat&&(prefix="fat"),prefix+this._oscillator.type},set:function(type){"fm"===type.substr(0,2)?(this._createNewOscillator(OmniOscType_FM),this._oscillator.type=type.substr(2)):"am"===type.substr(0,2)?(this._createNewOscillator(OmniOscType_AM),this._oscillator.type=type.substr(2)):"fat"===type.substr(0,3)?(this._createNewOscillator(OmniOscType_Fat),this._oscillator.type=type.substr(3)):"pwm"===type?this._createNewOscillator(OmniOscType_PWM):"pulse"===type?this._createNewOscillator(OmniOscType_Pulse):(this._createNewOscillator(OmniOscType_Osc),this._oscillator.type=type)}}),Object.defineProperty(Tone.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(partials){this._oscillator.partials=partials}}),Tone.OmniOscillator.prototype.set=function(params,value){return"type"===params?this.type=value:Tone.isObject(params)&&params.hasOwnProperty("type")&&(this.type=params.type),Tone.prototype.set.apply(this,arguments),this},Tone.OmniOscillator.prototype._createNewOscillator=function(oscType){if(oscType!==this._sourceType){this._sourceType=oscType;var OscillatorConstructor=Tone[oscType],now=this.now();if(null!==this._oscillator){var oldOsc=this._oscillator;oldOsc.stop(now),this.context.setTimeout(function(){oldOsc.dispose(),oldOsc=null},this.blockTime)}this._oscillator=new OscillatorConstructor,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===Tone.State.Started&&this._oscillator.start(now)}},Object.defineProperty(Tone.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase}}),Object.defineProperty(Tone.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===OmniOscType_Pulse)return this._oscillator.width}}),Object.defineProperty(Tone.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===OmniOscType_Fat)return this._oscillator.count},set:function(count){this._sourceType===OmniOscType_Fat&&(this._oscillator.count=count)}}),Object.defineProperty(Tone.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===OmniOscType_Fat)return this._oscillator.spread},set:function(spread){this._sourceType===OmniOscType_Fat&&(this._oscillator.spread=spread)}}),Object.defineProperty(Tone.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===OmniOscType_FM||this._sourceType===OmniOscType_AM)return this._oscillator.modulationType},set:function(mType){this._sourceType!==OmniOscType_FM&&this._sourceType!==OmniOscType_AM||(this._oscillator.modulationType=mType)}}),Object.defineProperty(Tone.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===OmniOscType_FM)return this._oscillator.modulationIndex}}),Object.defineProperty(Tone.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===OmniOscType_FM||this._sourceType===OmniOscType_AM)return this._oscillator.harmonicity}}),Object.defineProperty(Tone.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===OmniOscType_PWM)return this._oscillator.modulationFrequency}}),Tone.OmniOscillator.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},Tone.OmniOscillator}),Module(function(Tone){return Tone.Instrument=function(options){options=Tone.defaultArg(options,Tone.Instrument.defaults),Tone.AudioNode.call(this),this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume")},Tone.extend(Tone.Instrument,Tone.AudioNode),Tone.Instrument.defaults={volume:0},Tone.Instrument.prototype.triggerAttack=Tone.noOp,Tone.Instrument.prototype.triggerRelease=Tone.noOp,Tone.Instrument.prototype.triggerAttackRelease=function(note,duration,time,velocity){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(note,time,velocity),this.triggerRelease(time+duration),this},Tone.Instrument.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this},Tone.Instrument}),Module(function(Tone){return Tone.Monophonic=function(options){options=Tone.defaultArg(options,Tone.Monophonic.defaults),Tone.Instrument.call(this,options),this.portamento=options.portamento},Tone.extend(Tone.Monophonic,Tone.Instrument),Tone.Monophonic.defaults={portamento:0},Tone.Monophonic.prototype.triggerAttack=function(note,time,velocity){return time=this.toSeconds(time),this._triggerEnvelopeAttack(time,velocity),this.setNote(note,time),this},Tone.Monophonic.prototype.triggerRelease=function(time){return time=this.toSeconds(time),this._triggerEnvelopeRelease(time),this},Tone.Monophonic.prototype._triggerEnvelopeAttack=function(){},Tone.Monophonic.prototype._triggerEnvelopeRelease=function(){},Tone.Monophonic.prototype.setNote=function(note,time){if(time=this.toSeconds(time),this.portamento>0){var currentNote=this.frequency.value;this.frequency.setValueAtTime(currentNote,time);var portTime=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(note,time+portTime)}else this.frequency.setValueAtTime(note,time);return this},Tone.Monophonic}),Module(function(Tone){return Tone.Synth=function(options){options=Tone.defaultArg(options,Tone.Synth.defaults),Tone.Monophonic.call(this,options),this.oscillator=new Tone.OmniOscillator(options.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Tone.AmplitudeEnvelope(options.envelope),this.oscillator.chain(this.envelope,this.output),this.oscillator.start(),this._readOnly(["oscillator","frequency","detune","envelope"])},Tone.extend(Tone.Synth,Tone.Monophonic),Tone.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},Tone.Synth.prototype._triggerEnvelopeAttack=function(time,velocity){return this.envelope.triggerAttack(time,velocity),this},Tone.Synth.prototype._triggerEnvelopeRelease=function(time){return this.envelope.triggerRelease(time),this},Tone.Synth.prototype.dispose=function(){return Tone.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},Tone.Synth}),Module(function(Tone){return Tone.AMSynth=function(options){options=Tone.defaultArg(options,Tone.AMSynth.defaults),Tone.Monophonic.call(this,options),this._carrier=new Tone.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(options.envelope),this._modulator=new Tone.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(options.modulation),this.modulationEnvelope=this._modulator.envelope.set(options.modulationEnvelope),this.frequency=new Tone.Signal(440,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this.harmonicity=new Tone.Multiply(options.harmonicity),this.harmonicity.units=Tone.Type.Positive,this._modulationScale=new Tone.AudioToGain,this._modulationNode=new Tone.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},Tone.extend(Tone.AMSynth,Tone.Monophonic),Tone.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},Tone.AMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){return time=this.toSeconds(time),this.envelope.triggerAttack(time,velocity),this.modulationEnvelope.triggerAttack(time,velocity),this},Tone.AMSynth.prototype._triggerEnvelopeRelease=function(time){return this.envelope.triggerRelease(time),this.modulationEnvelope.triggerRelease(time),this},Tone.AMSynth.prototype.dispose=function(){return Tone.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},Tone.AMSynth}),Module(function(Tone){return Tone.MonoSynth=function(options){options=Tone.defaultArg(options,Tone.MonoSynth.defaults),Tone.Monophonic.call(this,options),this.oscillator=new Tone.OmniOscillator(options.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Tone.Filter(options.filter),this.filterEnvelope=new Tone.FrequencyEnvelope(options.filterEnvelope),this.envelope=new Tone.AmplitudeEnvelope(options.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.oscillator.start(),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},Tone.extend(Tone.MonoSynth,Tone.Monophonic),Tone.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},Tone.MonoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){return this.envelope.triggerAttack(time,velocity),this.filterEnvelope.triggerAttack(time),this},Tone.MonoSynth.prototype._triggerEnvelopeRelease=function(time){return this.envelope.triggerRelease(time),this.filterEnvelope.triggerRelease(time),this},Tone.MonoSynth.prototype.dispose=function(){return Tone.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},Tone.MonoSynth}),Module(function(Tone){return Tone.DuoSynth=function(options){options=Tone.defaultArg(options,Tone.DuoSynth.defaults),Tone.Monophonic.call(this,options),this.voice0=new Tone.MonoSynth(options.voice0),this.voice0.volume.value=-10,this.voice1=new Tone.MonoSynth(options.voice1),this.voice1.volume.value=-10,this._vibrato=new Tone.LFO(options.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new Tone.Gain(options.vibratoAmount,Tone.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Tone.Signal(440,Tone.Type.Frequency),this.harmonicity=new Tone.Multiply(options.harmonicity),this.harmonicity.units=Tone.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},Tone.extend(Tone.DuoSynth,Tone.Monophonic),Tone.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},Tone.DuoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){return time=this.toSeconds(time),this.voice0.envelope.triggerAttack(time,velocity),this.voice1.envelope.triggerAttack(time,velocity),this.voice0.filterEnvelope.triggerAttack(time),this.voice1.filterEnvelope.triggerAttack(time),this},Tone.DuoSynth.prototype._triggerEnvelopeRelease=function(time){return this.voice0.triggerRelease(time),this.voice1.triggerRelease(time),this},Tone.DuoSynth.prototype.dispose=function(){return Tone.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},Tone.DuoSynth}),Module(function(Tone){return Tone.FMSynth=function(options){options=Tone.defaultArg(options,Tone.FMSynth.defaults),Tone.Monophonic.call(this,options),this._carrier=new Tone.Synth(options.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(options.envelope),this._modulator=new Tone.Synth(options.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(options.modulation),this.modulationEnvelope=this._modulator.envelope.set(options.modulationEnvelope),this.frequency=new Tone.Signal(440,Tone.Type.Frequency),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this.harmonicity=new Tone.Multiply(options.harmonicity),this.harmonicity.units=Tone.Type.Positive,this.modulationIndex=new Tone.Multiply(options.modulationIndex),this.modulationIndex.units=Tone.Type.Positive,this._modulationNode=new Tone.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},Tone.extend(Tone.FMSynth,Tone.Monophonic),Tone.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},Tone.FMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){return time=this.toSeconds(time),this.envelope.triggerAttack(time,velocity),this.modulationEnvelope.triggerAttack(time),this},Tone.FMSynth.prototype._triggerEnvelopeRelease=function(time){return time=this.toSeconds(time),this.envelope.triggerRelease(time),this.modulationEnvelope.triggerRelease(time),this},Tone.FMSynth.prototype.dispose=function(){return Tone.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},Tone.FMSynth}),Module(function(Tone){return Tone.MembraneSynth=function(options){options=Tone.defaultArg(options,Tone.MembraneSynth.defaults),Tone.Instrument.call(this,options),this.oscillator=new Tone.OmniOscillator(options.oscillator).start(),this.envelope=new Tone.AmplitudeEnvelope(options.envelope),this.octaves=options.octaves,this.pitchDecay=options.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},Tone.extend(Tone.MembraneSynth,Tone.Instrument),Tone.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},Tone.MembraneSynth.prototype.triggerAttack=function(note,time,velocity){time=this.toSeconds(time);var maxNote=(note=this.toFrequency(note))*this.octaves;return this.oscillator.frequency.setValueAtTime(maxNote,time),this.oscillator.frequency.exponentialRampToValueAtTime(note,time+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(time,velocity),this},Tone.MembraneSynth.prototype.triggerRelease=function(time){return this.envelope.triggerRelease(time),this},Tone.MembraneSynth.prototype.dispose=function(){return Tone.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},Tone.MembraneSynth}),Module(function(Tone){var inharmRatios=[1,1.483,1.932,2.546,2.63,3.897];return Tone.MetalSynth=function(options){options=Tone.defaultArg(options,Tone.MetalSynth.defaults),Tone.Instrument.call(this,options),this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new Tone.Gain(0).connect(this.output),this._highpass=new Tone.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=options.octaves,this._filterFreqScaler=new Tone.Scale(options.resonance,7e3),this.envelope=new Tone.Envelope({attack:options.envelope.attack,attackCurve:"linear",decay:options.envelope.decay,sustain:0,release:options.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var i=0;i<inharmRatios.length;i++){var osc=new Tone.FMOscillator({type:"square",modulationType:"square",harmonicity:options.harmonicity,modulationIndex:options.modulationIndex});osc.connect(this._highpass).start(),this._oscillators[i]=osc;var mult=new Tone.Multiply(inharmRatios[i]);this._freqMultipliers[i]=mult,this.frequency.chain(mult,osc.frequency)}this.octaves=options.octaves},Tone.extend(Tone.MetalSynth,Tone.Instrument),Tone.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},Tone.MetalSynth.prototype.triggerAttack=function(time,vel){return time=this.toSeconds(time),vel=Tone.defaultArg(vel,1),this.envelope.triggerAttack(time,vel),this},Tone.MetalSynth.prototype.triggerRelease=function(time){return time=this.toSeconds(time),this.envelope.triggerRelease(time),this},Tone.MetalSynth.prototype.triggerAttackRelease=function(duration,time,velocity){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(time,velocity),this.triggerRelease(time+duration),this},Object.defineProperty(Tone.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(val){for(var i=0;i<this._oscillators.length;i++)this._oscillators[i].modulationIndex.value=val}}),Object.defineProperty(Tone.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(val){for(var i=0;i<this._oscillators.length;i++)this._oscillators[i].harmonicity.value=val}}),Object.defineProperty(Tone.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(val){this._filterFreqScaler.min=val,this.octaves=this._octaves}}),Object.defineProperty(Tone.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(octs){this._octaves=octs,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,octs)}}),Tone.MetalSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);for(var i=0;i<this._oscillators.length;i++)this._oscillators[i].dispose(),this._freqMultipliers[i].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},Tone.MetalSynth}),Module(function(Tone){return window.AudioBufferSourceNode&&!AudioBufferSourceNode.prototype.start&&(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn,AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),Tone.BufferSource=function(){var options=Tone.defaults(arguments,["buffer","onload"],Tone.BufferSource);Tone.AudioNode.call(this),this.onended=options.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new Tone.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this._buffer=new Tone.Buffer(options.buffer,options.onload),this.playbackRate=new Tone.Param(this._source.playbackRate,Tone.Type.Positive),this.fadeIn=options.fadeIn,this.fadeOut=options.fadeOut,this.curve=options.curve,this._gain=1,this._onendedTimeout=-1,this.loop=options.loop,this.loopStart=options.loopStart,this.loopEnd=options.loopEnd,this.playbackRate.value=options.playbackRate},Tone.extend(Tone.BufferSource,Tone.AudioNode),Tone.BufferSource.defaults={onended:Tone.noOp,onload:Tone.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(Tone.BufferSource.prototype,"state",{get:function(){var now=this.now();return-1!==this._startTime&&now>=this._startTime&&now<this._stopTime?Tone.State.Started:Tone.State.Stopped}}),Tone.BufferSource.prototype.start=function(time,offset,duration,gain,fadeInTime){if(-1!==this._startTime)throw new Error("Tone.BufferSource can only be started once.");if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");time=this.toSeconds(time),offset=this.loop?Tone.defaultArg(offset,this.loopStart):Tone.defaultArg(offset,0),offset=this.toSeconds(offset),gain=Tone.defaultArg(gain,1),this._gain=gain,fadeInTime=this.toSeconds(Tone.defaultArg(fadeInTime,this.fadeIn)),this.fadeIn=fadeInTime,fadeInTime>0?(this._gainNode.gain.setValueAtTime(0,time),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(this._gain,time+fadeInTime):this._gainNode.gain.setTargetAtTime(this._gain,time,this._gainNode.gain.getTimeConstant(fadeInTime))):this._gainNode.gain.setValueAtTime(gain,time),this._startTime=time;var computedDur=this.toSeconds(Tone.defaultArg(duration,this.buffer.duration-offset));if(computedDur=Math.max(computedDur,0),(!this.loop||this.loop&&!Tone.isUndef(duration))&&(this.loop||(computedDur=Math.min(computedDur,this.buffer.duration-offset)),this.stop(time+computedDur,this.fadeOut)),this.loop){var loopEnd=this.loopEnd||this.buffer.duration,loopStart=this.loopStart;offset>loopEnd&&(offset=(offset-loopStart)%(loopEnd-loopStart)+loopStart)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,Tone.isPast(time),this._source.start(time,offset),this},Tone.BufferSource.prototype.stop=function(time,fadeOutTime){if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");if(time=this.toSeconds(time),-1===this._stopTime||this._stopTime>time){if(time<=this._startTime)return this._gainNode.gain.cancelScheduledValues(time),this._gainNode.gain.value=0,this;time=Math.max(this._startTime+this.fadeIn+this.sampleTime,time),this._gainNode.gain.cancelScheduledValues(time),this._stopTime=time,fadeOutTime=this.toSeconds(Tone.defaultArg(fadeOutTime,this.fadeOut));var heldDuration=Math.min(time-this._startTime-this.fadeIn-this.sampleTime,this.buffer.duration),startFade=time-(fadeOutTime=Math.min(heldDuration,fadeOutTime));fadeOutTime>this.sampleTime?(this._gainNode.gain.setValueAtTime(this._gain,startFade),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(0,time):this._gainNode.gain.setTargetAtTime(0,startFade,this._gainNode.gain.getTimeConstant(fadeOutTime))):this._gainNode.gain.setValueAtTime(0,time),Tone.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=Tone.context.setTimeout(this._onended.bind(this),this._stopTime-this.now())}return this},Tone.BufferSource.prototype._onended=function(){this.onended(this)},Object.defineProperty(Tone.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(loopStart){this._source.loopStart=this.toSeconds(loopStart)}}),Object.defineProperty(Tone.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(loopEnd){this._source.loopEnd=this.toSeconds(loopEnd)}}),Object.defineProperty(Tone.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(buffer){this._buffer.set(buffer)}}),Object.defineProperty(Tone.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(loop){this._source.loop=loop}}),Tone.BufferSource.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,Tone.context.clearTimeout(this._onendedTimeout),this},Tone.BufferSource}),Module(function(Tone){Tone.Noise=function(){var options=Tone.defaults(arguments,["type"],Tone.Noise);Tone.Source.call(this,options),this._source=null,this._type=options.type,this._playbackRate=options.playbackRate},Tone.extend(Tone.Noise,Tone.Source),Tone.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(Tone.Noise.prototype,"type",{get:function(){return this._type},set:function(type){if(this._type!==type){if(!(type in _noiseBuffers))throw new TypeError("Tone.Noise: invalid type: "+type);if(this._type=type,this.state===Tone.State.Started){var now=this.now();this._stop(now),this._start(now)}}}}),Object.defineProperty(Tone.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._source&&(this._source.playbackRate.value=rate)}}),Tone.Noise.prototype._start=function(time){var buffer=_noiseBuffers[this._type];this._source=new Tone.BufferSource(buffer).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(time),Math.random()*(buffer.duration-.001))},Tone.Noise.prototype._stop=function(time){this._source&&(this._source.stop(this.toSeconds(time)),this._source=null)},Tone.Noise.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var _noiseArrays={pink:function(){for(var buffer=[],channelNum=0;channelNum<2;channelNum++){var b0,b1,b2,b3,b4,b5,b6,channel=new Float32Array(220500);buffer[channelNum]=channel,b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<220500;i++){var white=2*Math.random()-1;b0=.99886*b0+.0555179*white,b1=.99332*b1+.0750759*white,b2=.969*b2+.153852*white,b3=.8665*b3+.3104856*white,b4=.55*b4+.5329522*white,b5=-.7616*b5-.016898*white,channel[i]=b0+b1+b2+b3+b4+b5+b6+.5362*white,channel[i]*=.11,b6=.115926*white}}return buffer}(),brown:function(){for(var buffer=[],channelNum=0;channelNum<2;channelNum++){var channel=new Float32Array(220500);buffer[channelNum]=channel;for(var lastOut=0,i=0;i<220500;i++){var white=2*Math.random()-1;channel[i]=(lastOut+.02*white)/1.02,lastOut=channel[i],channel[i]*=3.5}}return buffer}(),white:function(){for(var buffer=[],channelNum=0;channelNum<2;channelNum++){var channel=new Float32Array(220500);buffer[channelNum]=channel;for(var i=0;i<220500;i++)channel[i]=2*Math.random()-1}return buffer}()},_noiseBuffers={};function createBuffers(){for(var type in _noiseArrays)_noiseBuffers[type]=(new Tone.Buffer).fromArray(_noiseArrays[type])}return Tone.getContext(createBuffers),Tone.Context.on("init",createBuffers),Tone.Noise}),Module(function(Tone){return Tone.NoiseSynth=function(options){options=Tone.defaultArg(options,Tone.NoiseSynth.defaults),Tone.Instrument.call(this,options),this.noise=new Tone.Noise,this.envelope=new Tone.AmplitudeEnvelope(options.envelope),this.noise.chain(this.envelope,this.output),this.noise.start(),this._readOnly(["noise","envelope"])},Tone.extend(Tone.NoiseSynth,Tone.Instrument),Tone.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},Tone.NoiseSynth.prototype.triggerAttack=function(time,velocity){return this.envelope.triggerAttack(time,velocity),this},Tone.NoiseSynth.prototype.triggerRelease=function(time){return this.envelope.triggerRelease(time),this},Tone.NoiseSynth.prototype.triggerAttackRelease=function(duration,time,velocity){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(time,velocity),this.triggerRelease(time+duration),this},Tone.NoiseSynth.prototype.dispose=function(){return Tone.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},Tone.NoiseSynth}),Module(function(Tone){return Tone.PluckSynth=function(options){options=Tone.defaultArg(options,Tone.PluckSynth.defaults),Tone.Instrument.call(this,options),this._noise=new Tone.Noise("pink"),this.attackNoise=options.attackNoise,this._lfcf=new Tone.LowpassCombFilter({resonance:options.resonance,dampening:options.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},Tone.extend(Tone.PluckSynth,Tone.Instrument),Tone.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.9},Tone.PluckSynth.prototype.triggerAttack=function(note,time){note=this.toFrequency(note),time=this.toSeconds(time);var delayAmount=1/note;return this._lfcf.delayTime.setValueAtTime(delayAmount,time),this._noise.start(time),this._noise.stop(time+delayAmount*this.attackNoise),this},Tone.PluckSynth.prototype.dispose=function(){return Tone.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},Tone.PluckSynth}),Module(function(Tone){return Tone.PolySynth=function(){var options=Tone.defaults(arguments,["polyphony","voice"],Tone.PolySynth);Tone.Instrument.call(this,options),(options=Tone.defaultArg(options,Tone.Instrument.defaults)).polyphony=Math.min(Tone.PolySynth.MAX_POLYPHONY,options.polyphony),this.voices=new Array(options.polyphony),this._triggers=new Array(options.polyphony),this.detune=new Tone.Signal(options.detune,Tone.Type.Cents),this._readOnly("detune");for(var i=0;i<options.polyphony;i++){var v=new options.voice(arguments[2],arguments[3]);this.voices[i]=v,v.connect(this.output),v.hasOwnProperty("detune")&&this.detune.connect(v.detune),this._triggers[i]={release:-1,note:null,voice:v}}},Tone.extend(Tone.PolySynth,Tone.Instrument),Tone.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:Tone.Synth},Tone.PolySynth.prototype.triggerAttack=function(notes,time,velocity){Array.isArray(notes)||(notes=[notes]),time=this.toSeconds(time);for(var i=0;i<notes.length;i++){for(var val=notes[i],oldest=this._triggers[0],j=1;j<this._triggers.length;j++)this._triggers[j].release<oldest.release&&(oldest=this._triggers[j],j);oldest.release=1/0,oldest.note=JSON.stringify(val),oldest.voice.triggerAttack(val,time,velocity)}return this},Tone.PolySynth.prototype.triggerAttackRelease=function(notes,duration,time,velocity){if(time=this.toSeconds(time),this.triggerAttack(notes,time,velocity),Tone.isArray(duration)&&Tone.isArray(notes))for(var i=0;i<notes.length;i++){var d=duration[Math.min(i,duration.length-1)];this.triggerRelease(notes[i],time+this.toSeconds(d))}else this.triggerRelease(notes,time+this.toSeconds(duration));return this},Tone.PolySynth.prototype.triggerRelease=function(notes,time){Array.isArray(notes)||(notes=[notes]),time=this.toSeconds(time);for(var i=0;i<notes.length;i++)for(var stringified=JSON.stringify(notes[i]),v=0;v<this._triggers.length;v++){var desc=this._triggers[v];desc.note===stringified&&desc.release>time&&(desc.voice.triggerRelease(time),desc.release=time)}return this},Tone.PolySynth.prototype.set=function(params,value,rampTime){for(var i=0;i<this.voices.length;i++)this.voices[i].set(params,value,rampTime);return this},Tone.PolySynth.prototype.get=function(params){return this.voices[0].get(params)},Tone.PolySynth.prototype.releaseAll=function(time){time=this.toSeconds(time);for(var i=0;i<this._triggers.length;i++){var desc=this._triggers[i];desc.release>time&&(desc.release=time,desc.voice.triggerRelease(time))}return this},Tone.PolySynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);for(var i=0;i<this.voices.length;i++)this.voices[i].dispose(),this.voices[i]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},Tone.PolySynth.MAX_POLYPHONY=20,Tone.PolySynth}),Module(function(Tone){return Tone.Sampler=function(urls){var args=Array.prototype.slice.call(arguments);args.shift();var options=Tone.defaults(args,["onload","baseUrl"],Tone.Sampler);Tone.Instrument.call(this,options);var urlMap={};for(var note in urls)if(Tone.isNote(note)){urlMap[Tone.Frequency(note).toMidi()]=urls[note]}else{if(isNaN(parseFloat(note)))throw new Error("Tone.Sampler: url keys must be the note's pitch");urlMap[note]=urls[note]}this._buffers=new Tone.Buffers(urlMap,options.onload,options.baseUrl),this._activeSources={},this.attack=options.attack,this.release=options.release},Tone.extend(Tone.Sampler,Tone.Instrument),Tone.Sampler.defaults={attack:0,release:.1,onload:Tone.noOp,baseUrl:""},Tone.Sampler.prototype._findClosest=function(midi){for(var interval=0;interval<24;){if(this._buffers.has(midi+interval))return-interval;if(this._buffers.has(midi-interval))return interval;interval++}return null},Tone.Sampler.prototype.triggerAttack=function(note,time,velocity){var midi=Tone.Frequency(note).toMidi(),difference=this._findClosest(midi);if(null!==difference){var closestNote=midi-difference,buffer=this._buffers.get(closestNote),source=new Tone.BufferSource({buffer:buffer,playbackRate:Tone.intervalToFrequencyRatio(difference),fadeIn:this.attack,fadeOut:this.release,curve:"exponential"}).connect(this.output);source.start(time,0,buffer.duration,velocity),Tone.isArray(this._activeSources[midi])||(this._activeSources[midi]=[]),this._activeSources[midi].push({note:midi,source:source})}return this},Tone.Sampler.prototype.triggerRelease=function(note,time){var midi=Tone.Frequency(note).toMidi();if(this._activeSources[midi]&&this._activeSources[midi].length){var source=this._activeSources[midi].shift().source;time=this.toSeconds(time),source.stop(time+this.release,this.release)}},Tone.Sampler.prototype.triggerAttackRelease=function(note,duration,time,velocity){return time=this.toSeconds(time),duration=this.toSeconds(duration),this.triggerAttack(note,time,velocity),this.triggerRelease(note,time+duration),this},Tone.Sampler.prototype.add=function(note,url,callback){if(Tone.isNote(note)){var mid=Tone.Frequency(note).toMidi();this._buffers.add(mid,url,callback)}else{if(isNaN(parseFloat(note)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+note);this._buffers.add(note,url,callback)}},Object.defineProperty(Tone.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),Tone.Sampler.prototype.dispose=function(){for(var midi in Tone.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null,this._activeSources)this._activeSources[midi].forEach(function(event){event.source.dispose()});return this._activeSources=null,this},Tone.Sampler}),Module(function(Tone){return Tone.GainToAudio=function(){Tone.SignalBase.call(this),this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return 2*Math.abs(x)-1})},Tone.extend(Tone.GainToAudio,Tone.SignalBase),Tone.GainToAudio.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},Tone.GainToAudio}),Module(function(Tone){return Tone.Normalize=function(inputMin,inputMax){Tone.SignalBase.call(this),this._inputMin=Tone.defaultArg(inputMin,0),this._inputMax=Tone.defaultArg(inputMax,1),this._sub=this.input=new Tone.Add(0),this._div=this.output=new Tone.Multiply(1),this._sub.connect(this._div),this._setRange()},Tone.extend(Tone.Normalize,Tone.SignalBase),Object.defineProperty(Tone.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(min){this._inputMin=min,this._setRange()}}),Object.defineProperty(Tone.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(max){this._inputMax=max,this._setRange()}}),Tone.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},Tone.Normalize.prototype.dispose=function(){return Tone.SignalBase.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},Tone.Normalize}),Module(function(Tone){return Tone.TransportTimelineSignal=function(){Tone.TimelineSignal.apply(this,arguments),this.output=this._outputSig=new Tone.Signal(this._initial),this._lastVal=this.value,this._synced=Tone.Transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._bindAnchorValue=this._anchorValue.bind(this),Tone.Transport.on("start stop pause",this._bindAnchorValue),this._events.memory=1/0},Tone.extend(Tone.TransportTimelineSignal,Tone.TimelineSignal),Tone.TransportTimelineSignal.prototype._onTick=function(time){var val=this.getValueAtTime(Tone.Transport.seconds);this._lastVal!==val&&(this._lastVal=val,this._outputSig.linearRampToValueAtTime(val,time))},Tone.TransportTimelineSignal.prototype._anchorValue=function(time){var val=this.getValueAtTime(Tone.Transport.ticks);return this._lastVal=val,this._outputSig.cancelScheduledValues(time),this._outputSig.setValueAtTime(val,time),this},Tone.TransportTimelineSignal.prototype.getValueAtTime=function(time){return time=this.toTicks(time),Tone.TimelineSignal.prototype.getValueAtTime.call(this,time)},Tone.TransportTimelineSignal.prototype.setValueAtTime=function(value,time){return time=this.toTicks(time),Tone.TimelineSignal.prototype.setValueAtTime.call(this,value,time),this},Tone.TransportTimelineSignal.prototype.linearRampToValueAtTime=function(value,time){return time=this.toTicks(time),Tone.TimelineSignal.prototype.linearRampToValueAtTime.call(this,value,time),this},Tone.TransportTimelineSignal.prototype.exponentialRampToValueAtTime=function(value,time){return time=this.toTicks(time),Tone.TimelineSignal.prototype.exponentialRampToValueAtTime.call(this,value,time),this},Tone.TransportTimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){return startTime=this.toTicks(startTime),Tone.TimelineSignal.prototype.setTargetAtTime.call(this,value,startTime,timeConstant),this},Tone.TransportTimelineSignal.prototype.cancelScheduledValues=function(startTime){return startTime=this.toTicks(startTime),Tone.TimelineSignal.prototype.cancelScheduledValues.call(this,startTime),this},Tone.TransportTimelineSignal.prototype.setValueCurveAtTime=function(values,startTime,duration,scaling){return startTime=this.toTicks(startTime),duration=this.toTicks(duration),Tone.TimelineSignal.prototype.setValueCurveAtTime.call(this,values,startTime,duration,scaling),this},Tone.TransportTimelineSignal.prototype.dispose=function(){Tone.Transport.clear(this._synced),Tone.Transport.off("start stop pause",this._syncedCallback),this._events.cancel(0),Tone.TimelineSignal.prototype.dispose.call(this),this._outputSig.dispose(),this._outputSig=null},Tone.TransportTimelineSignal}),Module(function(Tone){return Tone.MultiPlayer=function(urls){console.warn("Tone.MultiPlayer is deprecated. Use Tone.Players instead."),1!==arguments.length||Tone.isUndef(arguments[0])||arguments[0].hasOwnProperty("urls")||(urls={urls:urls});var options=Tone.defaults(arguments,["urls","onload"],Tone.MultiPlayer);Tone.Source.call(this,options),options.urls instanceof Tone.Buffers?this.buffers=options.urls:this.buffers=new Tone.Buffers(options.urls,options.onload),this._activeSources={},this.fadeIn=options.fadeIn,this.fadeOut=options.fadeOut},Tone.extend(Tone.MultiPlayer,Tone.Source),Tone.MultiPlayer.defaults={onload:Tone.noOp,fadeIn:0,fadeOut:0},Tone.MultiPlayer.prototype._makeSource=function(bufferName){var buffer;Tone.isString(bufferName)||Tone.isNumber(bufferName)?buffer=this.buffers.get(bufferName).get():bufferName instanceof Tone.Buffer?buffer=bufferName.get():bufferName instanceof AudioBuffer&&(buffer=bufferName);var source=new Tone.BufferSource(buffer).connect(this.output);return this._activeSources.hasOwnProperty(bufferName)||(this._activeSources[bufferName]=[]),this._activeSources[bufferName].push(source),source},Tone.MultiPlayer.prototype.start=function(bufferName,time,offset,duration,pitch,gain){time=this.toSeconds(time);var source=this._makeSource(bufferName);return source.start(time,offset,duration,Tone.defaultArg(gain,1),this.fadeIn),duration&&source.stop(time+this.toSeconds(duration),this.fadeOut),pitch=Tone.defaultArg(pitch,0),source.playbackRate.value=Tone.intervalToFrequencyRatio(pitch),this},Tone.MultiPlayer.prototype.startLoop=function(bufferName,time,offset,loopStart,loopEnd,pitch,gain){time=this.toSeconds(time);var source=this._makeSource(bufferName);return source.loop=!0,source.loopStart=this.toSeconds(Tone.defaultArg(loopStart,0)),source.loopEnd=this.toSeconds(Tone.defaultArg(loopEnd,0)),source.start(time,offset,void 0,Tone.defaultArg(gain,1),this.fadeIn),pitch=Tone.defaultArg(pitch,0),source.playbackRate.value=Tone.intervalToFrequencyRatio(pitch),this},Tone.MultiPlayer.prototype.stop=function(bufferName,time){if(!this._activeSources[bufferName]||!this._activeSources[bufferName].length)throw new Error("Tone.MultiPlayer: cannot stop a buffer that hasn't been started or is already stopped");return time=this.toSeconds(time),this._activeSources[bufferName].shift().stop(time,this.fadeOut),this},Tone.MultiPlayer.prototype.stopAll=function(time){for(var bufferName in time=this.toSeconds(time),this._activeSources)for(var sources=this._activeSources[bufferName],i=0;i<sources.length;i++)sources[i].stop(time);return this},Tone.MultiPlayer.prototype.add=function(name,url,callback){return this.buffers.add(name,url,callback),this},Object.defineProperty(Tone.MultiPlayer.prototype,"state",{get:function(){return this._activeSources.length>0?Tone.State.Started:Tone.State.Stopped}}),Object.defineProperty(Tone.MultiPlayer.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Tone.MultiPlayer.prototype.dispose=function(){for(var bufferName in Tone.Source.prototype.dispose.call(this),this._activeSources)this._activeSources[bufferName].forEach(function(source){source.dispose()});return this.buffers.dispose(),this.buffers=null,this._activeSources=null,this},Tone.MultiPlayer}),Module(function(Tone){return Tone.GrainPlayer=function(){var options=Tone.defaults(arguments,["url","onload"],Tone.GrainPlayer);Tone.Source.call(this,options),this.buffer=new Tone.Buffer(options.url,options.onload),this._clock=new Tone.Clock(this._tick.bind(this),options.grainSize),this._loopStart=0,this._loopEnd=0,this._activeSources=[],this._playbackRate=options.playbackRate,this._grainSize=options.grainSize,this._overlap=options.overlap,this.detune=options.detune,this.overlap=options.overlap,this.loop=options.loop,this.playbackRate=options.playbackRate,this.grainSize=options.grainSize,this.loopStart=options.loopStart,this.loopEnd=options.loopEnd,this.reverse=options.reverse,this._clock.on("stop",this._onstop.bind(this))},Tone.extend(Tone.GrainPlayer,Tone.Source),Tone.GrainPlayer.defaults={onload:Tone.noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},Tone.GrainPlayer.prototype._start=function(time,offset,duration){offset=Tone.defaultArg(offset,0),offset=this.toSeconds(offset),time=this.toSeconds(time),this._offset=offset,this._clock.start(time),duration&&this.stop(time+this.toSeconds(duration))},Tone.GrainPlayer.prototype._stop=function(time){this._clock.stop(time)},Tone.GrainPlayer.prototype._onstop=function(time){this._activeSources.forEach(function(source){source.stop(time,0)})},Tone.GrainPlayer.prototype._tick=function(time){var fadeIn=this._offset<this._overlap?0:this._overlap,source=new Tone.BufferSource({buffer:this.buffer,fadeIn:fadeIn,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Tone.intervalToFrequencyRatio(this.detune/100)}).connect(this.output);source.start(time,this._offset),this._offset+=this.grainSize,source.stop(time+this.grainSize),this._activeSources.push(source),source.onended=function(){var index=this._activeSources.indexOf(source);-1!==index&&this._activeSources.splice(index,1)}.bind(this)},Tone.GrainPlayer.prototype.seek=function(offset,time){return this._offset=this.toSeconds(offset),this._tick(this.toSeconds(time)),this},Object.defineProperty(Tone.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this.grainSize=this._grainSize}}),Object.defineProperty(Tone.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(time){this._loopStart=this.toSeconds(time)}}),Object.defineProperty(Tone.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(time){this._loopEnd=this.toSeconds(time)}}),Object.defineProperty(Tone.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(rev){this.buffer.reverse=rev}}),Object.defineProperty(Tone.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(size){this._grainSize=this.toSeconds(size),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(Tone.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(time){this._overlap=this.toSeconds(time)}}),Tone.GrainPlayer.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._clock.dispose(),this._clock=null,this._activeSources.forEach(function(source){source.dispose()}),this._activeSources=null,this},Tone.GrainPlayer}),Module(function(Tone){return Tone.Player=function(url){var options;url instanceof Tone.Buffer?(url=url.get(),options=Tone.Player.defaults):options=Tone.defaults(arguments,["url","onload"],Tone.Player),Tone.Source.call(this,options),this._source=null,this.autostart=options.autostart,this._buffer=new Tone.Buffer({url:options.url,onload:this._onload.bind(this,options.onload),reverse:options.reverse}),url instanceof AudioBuffer&&this._buffer.set(url),this._loop=options.loop,this._loopStart=options.loopStart,this._loopEnd=options.loopEnd,this._playbackRate=options.playbackRate,this.retrigger=options.retrigger,this.fadeIn=options.fadeIn,this.fadeOut=options.fadeOut},Tone.extend(Tone.Player,Tone.Source),Tone.Player.defaults={onload:Tone.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1,fadeIn:0,fadeOut:0},Tone.Player.prototype.load=function(url,callback){return this._buffer.load(url,this._onload.bind(this,callback))},Tone.Player.prototype._onload=function(callback){(callback=Tone.defaultArg(callback,Tone.noOp))(this),this.autostart&&this.start()},Tone.Player.prototype._start=function(startTime,offset,duration){return offset=this._loop?Tone.defaultArg(offset,this._loopStart):Tone.defaultArg(offset,0),offset=this.toSeconds(offset),duration=Tone.defaultArg(duration,Math.max(this._buffer.duration-offset,0)),duration=this.toSeconds(duration),startTime=this.toSeconds(startTime),this._source=new Tone.BufferSource({buffer:this._buffer,loop:this._loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:this._playbackRate,fadeIn:this.fadeIn,fadeOut:this.fadeOut}).connect(this.output),this._loop||this._synced||this._state.setStateAtTime(Tone.State.Stopped,startTime+duration),this._loop?this._source.start(startTime,offset):this._source.start(startTime,offset,duration),this},Tone.Player.prototype._stop=function(time){return this._source&&this._source.stop(this.toSeconds(time)),this},Tone.Player.prototype.seek=function(offset,time){return time=this.toSeconds(time),this._state.getValueAtTime(time)===Tone.State.Started&&(offset=this.toSeconds(offset),this._stop(time),this._start(time,offset)),this},Tone.Player.prototype.setLoopPoints=function(loopStart,loopEnd){return this.loopStart=loopStart,this.loopEnd=loopEnd,this},Object.defineProperty(Tone.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(loopStart){this._loopStart=loopStart,this._source&&(this._source.loopStart=this.toSeconds(loopStart))}}),Object.defineProperty(Tone.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(loopEnd){this._loopEnd=loopEnd,this._source&&(this._source.loopEnd=this.toSeconds(loopEnd))}}),Object.defineProperty(Tone.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(buffer){this._buffer.set(buffer)}}),Object.defineProperty(Tone.Player.prototype,"loop",{get:function(){return this._loop},set:function(loop){this._loop=loop,this._source&&(this._source.loop=loop)}}),Object.defineProperty(Tone.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate,this._source&&(this._source.playbackRate.value=rate)}}),Object.defineProperty(Tone.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(rev){this._buffer.reverse=rev}}),Object.defineProperty(Tone.Player.prototype,"loaded",{get:function(){return this._buffer.loaded}}),Tone.Player.prototype.dispose=function(){return Tone.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer.dispose(),this._buffer=null,this},Tone.Player}),Module(function(Tone){return Tone.Players=function(urls){var args=Array.prototype.slice.call(arguments);args.shift();var options=Tone.defaults(args,["onload"],Tone.Players);for(var name in Tone.call(this),this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=options.mute,this._players={},this._loadingCount=0,this._fadeIn=options.fadeIn,this._fadeOut=options.fadeOut,urls)this._loadingCount++,this.add(name,urls[name],this._bufferLoaded.bind(this,options.onload))},Tone.extend(Tone.Players,Tone.AudioNode),Tone.Players.defaults={volume:0,mute:!1,onload:Tone.noOp,fadeIn:0,fadeOut:0},Tone.Players.prototype._bufferLoaded=function(callback){this._loadingCount--,0===this._loadingCount&&callback&&callback(this)},Object.defineProperty(Tone.Players.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Object.defineProperty(Tone.Players.prototype,"fadeIn",{get:function(){return this._fadeIn},set:function(fadeIn){this._fadeIn=fadeIn,this._forEach(function(player){player.fadeIn=fadeIn})}}),Object.defineProperty(Tone.Players.prototype,"fadeOut",{get:function(){return this._fadeOut},set:function(fadeOut){this._fadeOut=fadeOut,this._forEach(function(player){player.fadeOut=fadeOut})}}),Object.defineProperty(Tone.Players.prototype,"state",{get:function(){var playing=!1;return this._forEach(function(player){playing=playing||player.state===Tone.State.Started}),playing?Tone.State.Started:Tone.State.Stopped}}),Tone.Players.prototype.has=function(name){return this._players.hasOwnProperty(name)},Tone.Players.prototype.get=function(name){if(this.has(name))return this._players[name];throw new Error("Tone.Players: no player named "+name)},Tone.Players.prototype._forEach=function(callback){for(var playerName in this._players)callback(this._players[playerName],playerName);return this},Object.defineProperty(Tone.Players.prototype,"loaded",{get:function(){var isLoaded=!0;return this._forEach(function(player){isLoaded=isLoaded&&player.loaded}),isLoaded}}),Tone.Players.prototype.add=function(name,url,callback){return this._players[name]=new Tone.Player(url,callback).connect(this.output),this._players[name].fadeIn=this._fadeIn,this._players[name].fadeOut=this._fadeOut,this},Tone.Players.prototype.stopAll=function(time){this._forEach(function(player){player.stop(time)})},Tone.Players.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null,this.output=null,this._forEach(function(player){player.dispose()}),this._players=null,this},Tone.Players}),Module(function(Tone){return Tone.UserMedia=function(){var options=Tone.defaults(arguments,["volume"],Tone.UserMedia);Tone.AudioNode.call(this),this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new Tone.Volume(options.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=options.mute},Tone.extend(Tone.UserMedia,Tone.AudioNode),Tone.UserMedia.defaults={volume:0,mute:!1},Tone.UserMedia.prototype.open=function(labelOrId){return labelOrId=Tone.defaultArg(labelOrId,"default"),Tone.UserMedia.enumerateDevices().then(function(devices){var device;if(Tone.isNumber(labelOrId))device=devices[labelOrId];else if(!(device=devices.find(function(device){return device.label===labelOrId||device.deviceId===labelOrId})))throw new Error("Tone.UserMedia: no matching device: "+labelOrId);this._device=device;var constraints={audio:{deviceId:device.deviceId,echoCancellation:!1,sampleRate:this.context.sampleRate}};return navigator.mediaDevices.getUserMedia(constraints).then(function(stream){return this._stream||(this._stream=stream,this._mediaStream=this.context.createMediaStreamSource(stream),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},Tone.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach(function(track){track.stop()}),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},Tone.UserMedia.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then(function(devices){return devices.filter(function(device){return"audioinput"===device.kind})})},Object.defineProperty(Tone.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?Tone.State.Started:Tone.State.Stopped}}),Object.defineProperty(Tone.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(Tone.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(Tone.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(Tone.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(mute){this._volume.mute=mute}}),Tone.UserMedia.prototype.dispose=function(){return Tone.AudioNode.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(Tone.UserMedia,"supported",{get:function(){return!Tone.isUndef(navigator.mediaDevices)&&Tone.isFunction(navigator.mediaDevices.getUserMedia)}}),Tone.UserMedia}),Tone},"function"==typeof define&&define.amd?define(function(){return factory()}):"object"==typeof module?module.exports=factory():root.Tone=factory()},{}],233:[function(require,module,exports){"use strict";var punycode=require("punycode"),util=require("./util");function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{"./util":234,punycode:210,querystring:213}],234:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},{}],235:[function(require,module,exports){"use strict";var prev,alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0;function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded,num=Math.floor(num/length)}while(num>0);return encoded}function yeast(){var now=encode(+new Date);return now!==prev?(seed=0,prev=now):now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=function(str){var decoded=0;for(i=0;i<str.length;i++)decoded=decoded*length+map[str.charAt(i)];return decoded},module.exports=yeast},{}],236:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.world=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PIXI=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("pixi.js")),_matterJs2=_interopRequireDefault(require("matter-js")),_tween2=_interopRequireDefault(require("@tweenjs/tween.js")),_sketch=require("./sketch"),_controls=(require("./sounds"),require("./controls"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var engine=new _matterJs2.default.Engine.create,world=engine.world;_matterJs2.default.Engine.run(engine);var instrument1=PIXI.Texture.fromImage("./assets/png/1.png"),instrument2=PIXI.Texture.fromImage("./assets/png/2.png"),instrument3=PIXI.Texture.fromImage("./assets/png/3.png");instrument1.baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR,instrument2.baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR,instrument3.baseTexture.scaleMode=PIXI.SCALE_MODES.LINEAR;var Rectangle=function(){function Rectangle(x,y,updatePos,soundPos){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Rectangle),"soundsA"===_controls.selectedInstrument.name?this.rectangle=new PIXI.Sprite(instrument1):"soundsB"===_controls.selectedInstrument.name?this.rectangle=new PIXI.Sprite(instrument2):this.rectangle=new PIXI.Sprite(instrument3),this.rectangle.updatePos=updatePos,this.rectangle.interactive=!0,this.rectangle.buttonMode=!0,this.rectangle.anchor.set(.5),this.rectangle.scale.set(.2),this.playing=!1,this.options={scale:.2},this.rectangle.on("pointerdown",this.onDragStart).on("pointerup",this.onDragEnd).on("pointerupoutside",this.onDragEnd).on("pointermove",this.onDragMove),this.instrument=_controls.selectedInstrument.sounds,this.sound=this.instrument[soundPos],this.sound.start(),this.rectangle.x=x,this.rectangle.y=y,_sketch.rectangles.addChild(this.rectangle),this.playCollision()}return _createClass(Rectangle,[{key:"playCollision",value:function(){var _this=this;this.playing||(this.playing=!0,this.sound.start(),new _tween2.default.Tween(this.options).to({scale:.25},500).repeat(1).delay(0).yoyo(!0).easing(_tween2.default.Easing.Exponential.Out).onUpdate(function(){_this.rectangle.scale.set(_this.options.scale)}).start().onComplete(function(){_this.playing=!1}))}},{key:"onDragStart",value:function(event){this.data=event.data,this.alpha=.5,this.dragging=!0}},{key:"onDragEnd",value:function(){this.alpha=1,this.dragging=!1,this.data=null}},{key:"onDragMove",value:function(){if(this.dragging){var newPosition=this.data.getLocalPosition(this.parent);this.x=newPosition.x,this.y=newPosition.y,this.updatePos(this.x,this.y)}}}]),Rectangle}();exports.default=function(x,y,soundPos){var matterRectangle=_matterJs2.default.Bodies.rectangle(x,y,60,70,{isStatic:!0});matterRectangle.pixiRectangle=new Rectangle(x,y,function(x,y){return _matterJs2.default.Body.setPosition(matterRectangle,{x:x,y:y})},soundPos),_matterJs2.default.World.add(world,matterRectangle)},exports.world=world},{"./controls":239,"./sketch":241,"./sounds":243,"@tweenjs/tween.js":1,"matter-js":35,"pixi.js":175}],237:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendCanvas=exports.canvas2send=exports.updateCanvas2send=void 0;var _const=require("./const"),_socket=require("./socket"),video=document.getElementById("video"),canvas2send=document.getElementById("canvas2send"),context=canvas2send.getContext("2d");exports.updateCanvas2send=function(){context.drawImage(video,0,0,_const.SIZE.width,_const.SIZE.height)},exports.canvas2send=canvas2send,exports.sendCanvas=function(){(0,_socket.sendData)(canvas2send.toDataURL("image/jpg"))}},{"./const":238,"./socket":242}],238:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.CONNECTIONS=[["Nose","Left_Eye"],["Left_Eye","Left_Ear"],["Nose","Right_Eye"],["Right_Eye","Right_Ear"],["Nose","Neck"],["Neck","Right_Shoulder"],["Neck","Left_Shoulder"],["Right_Shoulder","Right_Elbow"],["Right_Elbow","Right_Wrist"],["Left_Shoulder","Left_Elbow"],["Left_Elbow","Left_Wrist"],["Neck","Right_Hip"],["Right_Hip","Right_Knee"],["Right_Knee","Right_Ankle"],["Neck","Left_Hip"],["Left_Hip","Left_Knee"],["Left_Knee","Left_Ankle"]],exports.BODY_PARTS=["Neck","Right_Shoulder","Right_Elbow","Right_Wrist","Left_Shoulder","Left_Elbow","Left_Wrist","Right_Hip","Right_Knee","Right_Ankle","Left_Hip","Left_Knee","Left_Ankle"],exports.videos=["./src/video/nyc.mp4","./src/video/street01.mp4","./src/video/street03.mp4"],exports.SIZE={width:432,height:368}},{}],239:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.map=exports.selectedInstrument=void 0;var _matterJs2=_interopRequireDefault(require("matter-js")),_canvas2send=require("./canvas2send"),_Rectangle=require("./Rectangle"),_Rectangle2=_interopRequireDefault(_Rectangle),_sketch=require("./sketch"),_const=require("./const"),_sounds=require("./sounds");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var map=function(input,in_min,in_max,out_min,out_max){return Math.floor((input-in_min)*(out_max-out_min)/(in_max-in_min)+out_min)},selectedInstrument={name:"soundsA",sounds:_sounds.soundsA};window.addEventListener("load",function(event){var playPause=document.getElementById("playPause"),playPauseIcon=document.getElementById("playPauseIcon"),video=document.getElementById("video"),videoSpeed=document.getElementById("videoSpeed"),tracking=document.getElementById("tracking"),reset=document.getElementById("reset"),pixiCanvas=document.getElementById("pixiCanvas"),instrument1=document.getElementById("instrument1"),instrument2=document.getElementById("instrument2"),instrument3=document.getElementById("instrument3");reset.addEventListener("click",function(){_sketch.rectangles.removeChildren(),_matterJs2.default.World.clear(_Rectangle.world,!1)}),instrument1.addEventListener("click",function(){_sounds.soundsA[4].start(),selectedInstrument.sounds=_sounds.soundsA,selectedInstrument.name="soundsA"}),instrument2.addEventListener("click",function(){_sounds.soundsB[4].start(),selectedInstrument.sounds=_sounds.soundsB,selectedInstrument.name="soundsB"}),instrument3.addEventListener("click",function(){_sounds.soundsC[6].start(),selectedInstrument.sounds=_sounds.soundsC,selectedInstrument.name="soundsC"}),video.playbackRate=.5,video.pause(),tracking.addEventListener("click",function(){(0,_sketch.changeLoop)(),_sketch.loop&&(0,_canvas2send.sendCanvas)()}),playPause.addEventListener("click",function(){video.paused?(video.play(),playPauseIcon.src="assets/svg/stop.svg"):(video.pause(),playPauseIcon.src="assets/svg/start.svg")}),videoSpeed.addEventListener("change",function(){video.playbackRate=videoSpeed.value});var currentVideo=0;changeVideo.addEventListener("click",function(){currentVideo<_const.videos.length-1?currentVideo++:currentVideo=0,video.src=_const.videos[currentVideo]}),pixiCanvas.addEventListener("dblclick",function(e){(0,_Rectangle2.default)(e.pageX,e.pageY,map(e.pageY,0,window.innerHeight,0,8))})}),exports.selectedInstrument=selectedInstrument,exports.map=map},{"./Rectangle":236,"./canvas2send":237,"./const":238,"./sketch":241,"./sounds":243,"matter-js":35}],240:[function(require,module,exports){"use strict";var obj,_sketch=require("./sketch");(obj=_sketch)&&obj.__esModule;require("./controls"),require("./sounds")},{"./controls":239,"./sketch":241,"./sounds":243}],241:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rectangles=exports.changeLoop=exports.clearCanvas=exports.drawCircles=exports.drawHuman=exports.doneDrawing=exports.loop=exports.app=void 0;var PIXI=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(require("pixi.js")),_matterJs2=_interopRequireDefault(require("matter-js")),_tween2=_interopRequireDefault(require("@tweenjs/tween.js")),_const=(require("./webcam"),require("./const")),_canvas2send=require("./canvas2send"),_Rectangle=require("./Rectangle");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fullWidth=window.innerWidth,fullHeight=window.innerHeight,loop=!1,OPTIONS={antialias:!0,width:fullWidth,height:fullHeight,resolution:1,transparent:!0,legacy:!0,forceCanvas:!0},app=new PIXI.Application(OPTIONS);app.view.id="pixiCanvas";var container=new PIXI.Container,rectangles=new PIXI.Container,graphics=new PIXI.Graphics,videoTexture=new PIXI.Texture.fromVideo(document.getElementById("video")),videoSprite=new PIXI.Sprite(videoTexture),clearCanvas=function(){graphics.clear()},playOnCollision=function(x1,y1,x2,y2){_Rectangle.world.bodies.forEach(function(body){var collision1=_matterJs2.default.Query.point(_Rectangle.world.bodies,{x:x1,y:y1});_matterJs2.default.Query.point(_Rectangle.world.bodies,{x:x2,y:y2});collision1.forEach(function(e){return e.pixiRectangle.playCollision()})})};requestAnimationFrame(function animate(){requestAnimationFrame(animate),(0,_canvas2send.updateCanvas2send)(),_tween2.default.update(),app.renderer.render(app.stage)}),container.addChild(graphics),app.stage.addChild(videoSprite),app.stage.addChild(container),app.stage.addChild(rectangles),videoSprite.width=fullWidth,videoSprite.height=fullHeight,document.body.appendChild(app.renderer.view),exports.app=app,exports.loop=loop,exports.doneDrawing=!0,exports.drawHuman=function(human,totalHumans,humanIndex){_const.CONNECTIONS.forEach(function(connection,connectionIndex){var start=null,end=null;if(human.forEach(function(bodyPart){var name=bodyPart[0];name===connection[0]?start=bodyPart:name===connection[1]&&(end=bodyPart)}),start&&end){var x1=start[1]*fullWidth,y1=start[2]*fullHeight,x2=end[1]*fullWidth,y2=end[2]*fullHeight;!function(x1,y1,x2,y2){graphics.lineStyle(3,16777215,1),graphics.moveTo(x1,y1),graphics.lineTo(x2,y2)}(x1,y1,x2,y2),playOnCollision(x1,y1,x2,y2)}totalHumans===humanIndex+1&&_const.CONNECTIONS.length===connectionIndex+1&&(loop?setTimeout(function(){return(0,_canvas2send.sendCanvas)()},50):clearCanvas())})},exports.drawCircles=function(human){human.forEach(function(bodyPart){var x,y;x=bodyPart[1]*fullWidth,y=bodyPart[2]*fullHeight,graphics.lineStyle(0),graphics.beginFill(16711680,1),graphics.drawCircle(x,y,10),graphics.endFill()})},exports.clearCanvas=clearCanvas,exports.changeLoop=function(){exports.loop=loop=!loop},exports.rectangles=rectangles},{"./Rectangle":236,"./canvas2send":237,"./const":238,"./webcam":244,"@tweenjs/tween.js":1,"matter-js":35,"pixi.js":175}],242:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sendData=void 0;var obj,_socket=require("socket.io-client"),_socket2=(obj=_socket)&&obj.__esModule?obj:{default:obj},_canvas2send=require("./canvas2send"),_sketch=require("./sketch");var socket=_socket2.default.connect("http://64.62.141.30:33000/query");socket.on("connect",function(){log.innerHTML="connected"}),socket.on("update_response",function(data){(0,_sketch.clearCanvas)();var total=data.results.humans.length;total>0?data.results.humans.forEach(function(human,index){return(0,_sketch.drawHuman)(human,total,index)}):(0,_canvas2send.sendCanvas)()});exports.sendData=function(img){socket.emit("update_request",{data:img,model:"mobilenet_thin"})}},{"./canvas2send":237,"./sketch":241,"socket.io-client":221}],243:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.soundsC=exports.soundsB=exports.soundsA=void 0;var obj,_tone=require("tone"),_tone2=(obj=_tone)&&obj.__esModule?obj:{default:obj};for(var soundsA=exports.soundsA=[],i=1;i<9;i++)soundsA.push(new _tone2.default.Player({url:"./src/mp3/c/"+i+".mp3",retrigger:!1}).toMaster());for(var soundsB=exports.soundsB=[],_i=1;_i<9;_i++)soundsB.push(new _tone2.default.Player({url:"./src/mp3/d/"+_i+".mp3",retrigger:!1}).toMaster());for(var soundsC=exports.soundsC=[],_i2=1;_i2<9;_i2++)soundsC.push(new _tone2.default.Player({url:"./src/mp3/b/"+_i2+".mp3",retrigger:!1}).toMaster());var street=new _tone2.default.Player({url:"./src/mp3/nyc.mp3",retrigger:!1}).toMaster();street.loop=!0,street.volume.value=-15,street.autostart=!0},{tone:232}],244:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var video=document.getElementById("video");exports.video=video,exports.startWebcam=function(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(stream){video.src=window.URL.createObjectURL(stream),video.play()})}},{}]},{},[240]);
